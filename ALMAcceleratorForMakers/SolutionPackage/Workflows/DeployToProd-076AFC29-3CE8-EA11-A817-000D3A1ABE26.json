{
  "properties": {
    "connectionReferences": {
      "shared_approvals": {
        "api": {
          "name": "shared_approvals"
        },
        "connection": {
          "connectionReferenceLogicalName": "cat_ApprovalConnection"
        },
        "runtimeSource": "embedded"
      },
      "shared_commondataserviceforapps": {
        "api": {
          "name": "shared_commondataserviceforapps"
        },
        "connection": {
          "connectionReferenceLogicalName": "cat_CDSConnection"
        },
        "runtimeSource": "embedded"
      },
      "shared_github": {
        "api": {
          "name": "shared_github"
        },
        "connection": {
          "connectionReferenceLogicalName": "cat_GitHub"
        },
        "runtimeSource": "embedded"
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "actions": {
        "Catch": {
          "actions": {
            "Apply_to_each:_Extract_errors": {
              "actions": {
                "Append_to_string_variable_4": {
                  "inputs": {
                    "name": "ErrorDetails",
                    "value": "@body('Fetch_Localized_Error_Message')?['Body']?['localizedtext']"
                  },
                  "runAfter": {
                    "Fetch_Localized_Error": [
                      "Succeeded"
                    ]
                  },
                  "type": "AppendToStringVariable"
                },
                "Fetch_Localized_Error": {
                  "actions": {
                    "Compose_13": {
                      "inputs": "@concat('name==',items('Apply_to_each:_Extract_errors')?['name'],'##code==',items('Apply_to_each:_Extract_errors')?['code'],'##errorName==',if(equals(null,items('Apply_to_each:_Extract_errors')?['outputs']?['body']),items('Apply_to_each:_Extract_errors')?['error'],items('Apply_to_each:_Extract_errors')?['outputs']?['body']))",
                      "runAfter": {},
                      "type": "Compose"
                    },
                    "Fetch_Localized_Error_Message": {
                      "inputs": {
                        "body": {
                          "text": "errorMessageFlow",
                          "text_2": "@outputs('Compose_13')"
                        },
                        "host": {
                          "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                        }
                      },
                      "runAfter": {
                        "Compose_13": [
                          "Succeeded"
                        ]
                      },
                      "type": "Workflow"
                    }
                  },
                  "runAfter": {},
                  "type": "Scope"
                },
                "Log_Telemetry": {
                  "inputs": {
                    "body": {
                      "text": "@triggerBody()?['text_15']",
                      "text_1": "Error",
                      "text_12": "@workflow()?['run']?['name']",
                      "text_13": "@triggerBody()['text_14']",
                      "text_3": "Project Creation",
                      "text_4": "@string(if(equals(null, items('Apply_to_each:_Extract_errors')?['outputs']?['body']), items('Apply_to_each:_Extract_errors')?['error'], items('Apply_to_each:_Extract_errors')?['outputs']?['body']))",
                      "text_6": "@workflow()?['tags']?['flowDisplayName']",
                      "text_8": "@items('Apply_to_each:_Extract_errors')?['name']"
                    },
                    "host": {
                      "workflowReferenceName": "05dc414d-78eb-ea11-a817-000d3a56b702"
                    }
                  },
                  "runAfter": {
                    "Append_to_string_variable_4": [
                      "Succeeded"
                    ]
                  },
                  "type": "Workflow"
                }
              },
              "foreach": "@body('Filter_array')",
              "runAfter": {
                "Filter_array": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Condition": {
              "actions": {
                "Response_Failure": {
                  "inputs": {
                    "body": "@variables('ErrorDetails')",
                    "statusCode": 409
                  },
                  "kind": "Http",
                  "runAfter": {},
                  "type": "Response"
                }
              },
              "else": {
                "actions": {
                  "Response": {
                    "inputs": {
                      "body": "success",
                      "statusCode": 200
                    },
                    "kind": "Http",
                    "runAfter": {},
                    "type": "Response"
                  }
                }
              },
              "expression": {
                "equals": [
                  "@variables('DoRaiseReturnError')",
                  true
                ]
              },
              "runAfter": {
                "Apply_to_each:_Extract_errors": [
                  "Succeeded"
                ]
              },
              "type": "If"
            },
            "Filter_array": {
              "inputs": {
                "from": "@result('Try')",
                "where": "@or(equals(item()?['status'], 'Failed'), equals(item()?['status'], 'TimedOut'))"
              },
              "runAfter": {},
              "type": "Query"
            }
          },
          "runAfter": {
            "Try": [
              "Failed",
              "TimedOut",
              "Skipped"
            ]
          },
          "type": "Scope"
        },
        "Commit_Message_": {
          "inputs": "Deployment to @{triggerBody()['text_8']} for project @{triggerBody()['text_6']}",
          "runAfter": {
            "Env_Sec_Name": [
              "Succeeded"
            ]
          },
          "type": "Compose"
        },
        "Env_Sec_Name": {
          "inputs": "@{triggerBody()['text_19']}_ENVIRONMENT_SECRET",
          "runAfter": {
            "Initialize_variable_:_Approval_Response": [
              "Succeeded"
            ]
          },
          "type": "Compose"
        },
        "Initialize_variable": {
          "inputs": {
            "variables": [
              {
                "name": "Error",
                "type": "string"
              }
            ]
          },
          "runAfter": {
            "Initialize_variable_2": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_variable_2": {
          "inputs": {
            "variables": [
              {
                "name": "ErrorDetails",
                "type": "string"
              }
            ]
          },
          "runAfter": {
            "Initialize_variable_:_DoRaiseReturnError": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_variable_:_Approval_Response": {
          "inputs": {
            "variables": [
              {
                "name": "ApprovalResponse",
                "type": "string"
              }
            ]
          },
          "runAfter": {
            "Initialize_variable": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_variable_:_DoRaiseReturnError": {
          "inputs": {
            "variables": [
              {
                "name": "DoRaiseReturnError",
                "type": "boolean",
                "value": true
              }
            ]
          },
          "runAfter": {},
          "type": "InitializeVariable"
        },
        "Response_Success": {
          "inputs": {
            "body": "Success",
            "statusCode": 200
          },
          "kind": "Http",
          "runAfter": {
            "Catch": [
              "Skipped"
            ]
          },
          "type": "Response"
        },
        "Try": {
          "actions": {
            "Compare_two_commits": {
              "inputs": {
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_github",
                  "connectionName": "shared_github",
                  "operationId": "CompareRepositoryCommits"
                },
                "parameters": {
                  "base": "@triggerBody()['text_3']",
                  "head": "@triggerBody()['text_2']",
                  "repositoryName": "@triggerBody()['text_1']",
                  "repositoryOwner": "@triggerBody()['text']"
                }
              },
              "runAfter": {
                "Create_pull_request": [
                  "Failed"
                ]
              },
              "type": "OpenApiConnection"
            },
            "Condition:_PR_approval": {
              "actions": {
                "Condition:_Merge_error_approval": {
                  "actions": {
                    "Create_a_repository_dispatch_event": {
                      "inputs": {
                        "authentication": {
                          "type": "Raw",
                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                        },
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_github",
                          "connectionName": "shared_github",
                          "operationId": "CreateRepositoryDispatchEvent"
                        },
                        "parameters": {
                          "body/client_payload": "@outputs('JSON_Payload_-_Deploy_to_Prod')",
                          "body/event_type": "deploy_to_prod",
                          "repositoryName": "@triggerBody()['text_1']",
                          "repositoryOwner": "@triggerBody()['text']"
                        }
                      },
                      "runAfter": {
                        "JSON_Payload_-_Deploy_to_Prod": [
                          "Succeeded"
                        ]
                      },
                      "type": "OpenApiConnection"
                    },
                    "JSON_Payload_-_Deploy_to_Prod": {
                      "inputs": {
                        "branch": "@triggerBody()['text_3']",
                        "notes": "@outputs('Commit_Message_')",
                        "requestid": "@triggerBody()['text_14']",
                        "solutionname": "@triggerBody()['text_10']",
                        "targetenvironmentsecretname": "@outputs('Env_Sec_Name')",
                        "targetenvironmenturl": "@triggerBody()['text_17']",
                        "targetenvironmentuserid": "@triggerBody()['text_18']",
                        "webhookurl": "@triggerBody()['text_11']"
                      },
                      "runAfter": {},
                      "type": "Compose"
                    },
                    "Scope_3": {
                      "actions": {
                        "Update_Build_Request_7": {
                          "inputs": {
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "UpdateRecord"
                            },
                            "parameters": {
                              "entityName": "cat_buildrequests",
                              "item/cat_buildstatus": 809060005,
                              "recordId": "@triggerBody()['text_14']"
                            }
                          },
                          "runAfter": {},
                          "type": "OpenApiConnection"
                        },
                        "Update_Project_Status_7": {
                          "inputs": {
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "UpdateRecord"
                            },
                            "parameters": {
                              "entityName": "cat_projects",
                              "item/cat_deploymentstatus": 809060012,
                              "recordId": "@outputs('Update_Build_Request_7')?['body/_cat_project_value']"
                            }
                          },
                          "runAfter": {
                            "Update_Build_Request_7": [
                              "Succeeded"
                            ]
                          },
                          "type": "OpenApiConnection"
                        }
                      },
                      "runAfter": {
                        "Create_a_repository_dispatch_event": [
                          "Succeeded"
                        ]
                      },
                      "type": "Scope"
                    }
                  },
                  "else": {
                    "actions": {
                      "Apply_to_each:_Send_Email_Notification": {
                        "actions": {
                          "Append_to_string_variable_2": {
                            "inputs": {
                              "name": "ApprovalResponse",
                              "value": "@items('Apply_to_each:_Send_Email_Notification')?['comments']"
                            },
                            "runAfter": {
                              "Send_Rejection_Notification_2": [
                                "Succeeded"
                              ]
                            },
                            "type": "AppendToStringVariable"
                          },
                          "Fetch_Localized_Rejection_Notification": {
                            "actions": {
                              "Compose_5": {
                                "inputs": "@concat('projectOwnerName==',triggerBody()['text_7'],'##projectName==',triggerBody()['text_6'],'##stageName==',triggerBody()['text_8'],'##rejectedBy==',items('Apply_to_each:_Send_Email_Notification')?['responder/displayName'],'##rejectedReason==',items('Apply_to_each:_Send_Email_Notification')?['comments'])",
                                "runAfter": {
                                  "Fetch_Localized_Subject": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Compose"
                              },
                              "Fetch_Localized_Body": {
                                "inputs": {
                                  "body": {
                                    "text": "deployToProdFlow6",
                                    "text_2": "@outputs('Compose_5')"
                                  },
                                  "host": {
                                    "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                                  }
                                },
                                "runAfter": {
                                  "Compose_5": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Workflow"
                              },
                              "Fetch_Localized_Subject": {
                                "inputs": {
                                  "body": {
                                    "text": "deployToProdFlow5"
                                  },
                                  "host": {
                                    "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                                  }
                                },
                                "runAfter": {},
                                "type": "Workflow"
                              }
                            },
                            "runAfter": {},
                            "type": "Scope"
                          },
                          "Send_Rejection_Notification_2": {
                            "inputs": {
                              "body": {
                                "text": "@triggerBody()['text_12']",
                                "text_1": "@outputs('Fetch_Localized_Subject')?['Body']?['localizedtext']",
                                "text_2": "@outputs('Fetch_Localized_Body')?['Body']?['localizedtext']"
                              },
                              "host": {
                                "workflowReferenceName": "4528dfaf-782e-eb11-a813-000d3a33febe"
                              }
                            },
                            "runAfter": {
                              "Fetch_Localized_Rejection_Notification": [
                                "Succeeded"
                              ]
                            },
                            "type": "Workflow"
                          }
                        },
                        "foreach": "@outputs('Notify_for_Merge_Error_and_ask_approval')?['body/responses']",
                        "runAfter": {},
                        "type": "Foreach"
                      },
                      "Close_Pull_Request": {
                        "inputs": {
                          "authentication": {
                            "type": "Raw",
                            "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                          },
                          "host": {
                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_github",
                            "connectionName": "shared_github",
                            "operationId": "UpdatePullRequest"
                          },
                          "parameters": {
                            "body/body": "Closing as the Approver has been rejected it.\nRejection Reason: @{variables('ApprovalResponse')}",
                            "body/state": "closed",
                            "pullNumber": "@outputs('Create_pull_request')?['body/number']",
                            "repositoryName": "@triggerBody()['text_1']",
                            "repositoryOwner": "@triggerBody()['text']"
                          }
                        },
                        "runAfter": {
                          "Apply_to_each:_Send_Email_Notification": [
                            "Succeeded"
                          ]
                        },
                        "type": "OpenApiConnection"
                      },
                      "Set_variable_2": {
                        "inputs": {
                          "name": "DoRaiseReturnError",
                          "value": false
                        },
                        "runAfter": {
                          "Update_Project_Status": [
                            "Succeeded"
                          ]
                        },
                        "type": "SetVariable"
                      },
                      "Update_Build_Request": {
                        "inputs": {
                          "authentication": {
                            "type": "Raw",
                            "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                          },
                          "host": {
                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                            "connectionName": "shared_commondataserviceforapps",
                            "operationId": "UpdateRecord"
                          },
                          "parameters": {
                            "entityName": "cat_buildrequests",
                            "item/cat_buildstatus": 809060004,
                            "item/cat_error": "@substring(variables('ApprovalResponse'),0,min(length(variables('ApprovalResponse')),3999))",
                            "recordId": "@triggerBody()['text_14']"
                          }
                        },
                        "runAfter": {
                          "Close_Pull_Request": [
                            "Succeeded"
                          ]
                        },
                        "type": "OpenApiConnection"
                      },
                      "Update_Project_Status": {
                        "inputs": {
                          "authentication": {
                            "type": "Raw",
                            "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                          },
                          "host": {
                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                            "connectionName": "shared_commondataserviceforapps",
                            "operationId": "UpdateRecord"
                          },
                          "parameters": {
                            "entityName": "cat_projects",
                            "item/cat_deploymentstatus": 809060009,
                            "item/cat_errormessage": "@substring(variables('ApprovalResponse'),0,min(length(variables('ApprovalResponse')),3999))",
                            "recordId": "@outputs('Update_Build_Request')?['body/_cat_project_value']"
                          }
                        },
                        "runAfter": {
                          "Update_Build_Request": [
                            "Succeeded"
                          ]
                        },
                        "type": "OpenApiConnection"
                      }
                    }
                  },
                  "expression": {
                    "equals": [
                      "@outputs('Notify_for_Merge_Error_and_ask_approval')?['body/outcome']",
                      "Approve"
                    ]
                  },
                  "runAfter": {
                    "Notify_for_Merge_Error_and_ask_approval": [
                      "Succeeded"
                    ]
                  },
                  "type": "If"
                },
                "Fetch_Localized_Approval_for_Deployment_2": {
                  "actions": {
                    "Compose_3": {
                      "inputs": "@concat('errorDetails==',variables('Error'),'##pullRequestLink==',outputs('Create_pull_request')?['body/html_url'],'##environmentName==',triggerBody()['text_9'])",
                      "runAfter": {},
                      "type": "Compose"
                    },
                    "Compose_4": {
                      "inputs": "@concat('projectName==', triggerBody()['text_6'])",
                      "runAfter": {
                        "Fetch_Localized_Approval_for_Deployment_Details_2": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose"
                    },
                    "Fetch_Localized_Approval_for_Deployment_Details_2": {
                      "inputs": {
                        "body": {
                          "text": "deployToProdFlow4",
                          "text_2": "@outputs('Compose_3')"
                        },
                        "host": {
                          "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                        }
                      },
                      "runAfter": {
                        "Compose_3": [
                          "Succeeded"
                        ]
                      },
                      "type": "Workflow"
                    },
                    "Fetch_Localized_Approval_for_Deployment_Title_2": {
                      "inputs": {
                        "body": {
                          "text": "deployToProdFlow3",
                          "text_2": "@outputs('Compose_4')"
                        },
                        "host": {
                          "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                        }
                      },
                      "runAfter": {
                        "Compose_4": [
                          "Succeeded"
                        ]
                      },
                      "type": "Workflow"
                    }
                  },
                  "runAfter": {
                    "Merge_pull_request": [
                      "Failed"
                    ]
                  },
                  "type": "Scope"
                },
                "JSON_Payload_-_Merge_Conflicts": {
                  "inputs": {
                    "branch": "@triggerBody()['text_3']",
                    "notes": "@outputs('Commit_Message_')",
                    "requestid": "@triggerBody()['text_14']",
                    "solutionname": "@triggerBody()['text_10']",
                    "targetenvironmentsecretname": "@outputs('Env_Sec_Name')",
                    "targetenvironmenturl": "@triggerBody()['text_17']",
                    "targetenvironmentuserid": "@triggerBody()['text_18']",
                    "webhookurl": "@triggerBody()['text_11']"
                  },
                  "runAfter": {
                    "Merge_pull_request": [
                      "Succeeded"
                    ]
                  },
                  "type": "Compose"
                },
                "Merge_pull_request": {
                  "inputs": {
                    "authentication": {
                      "type": "Raw",
                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_github",
                      "connectionName": "shared_github",
                      "operationId": "MergePullRequest"
                    },
                    "parameters": {
                      "body/commitTitle": "Commit for project @{triggerBody()['text_6']}",
                      "body/sha": "@outputs('Create_pull_request')?['body/head/sha']",
                      "pullNumber": "@outputs('Create_pull_request')?['body/number']",
                      "repositoryName": "@triggerBody()['text_1']",
                      "repositoryOwner": "@triggerBody()['text']"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                },
                "Notify_for_Merge_Error_and_ask_approval": {
                  "inputs": {
                    "authentication": {
                      "type": "Raw",
                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_approvals",
                      "connectionName": "shared_approvals",
                      "operationId": "StartAndWaitForAnApproval"
                    },
                    "parameters": {
                      "WebhookApprovalCreationInput/assignedTo": "@triggerBody()['text_5']",
                      "WebhookApprovalCreationInput/details": "@outputs('Fetch_Localized_Approval_for_Deployment_Details_2')?['Body']?['localizedtext']",
                      "WebhookApprovalCreationInput/enableNotifications": true,
                      "WebhookApprovalCreationInput/enableReassignment": true,
                      "WebhookApprovalCreationInput/title": "@outputs('Fetch_Localized_Approval_for_Deployment_Title_2')?['Body']?['localizedtext']",
                      "approvalType": "Basic"
                    }
                  },
                  "runAfter": {
                    "Fetch_Localized_Approval_for_Deployment_2": [
                      "Succeeded"
                    ]
                  },
                  "type": "OpenApiConnectionWebhook"
                },
                "Scope": {
                  "actions": {
                    "Update_Build_Request_5": {
                      "inputs": {
                        "authentication": {
                          "type": "Raw",
                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                        },
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "UpdateRecord"
                        },
                        "parameters": {
                          "entityName": "cat_buildrequests",
                          "item/cat_buildstatus": 809060005,
                          "recordId": "@triggerBody()['text_14']"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    },
                    "Update_Project_Status_5": {
                      "inputs": {
                        "authentication": {
                          "type": "Raw",
                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                        },
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "UpdateRecord"
                        },
                        "parameters": {
                          "entityName": "cat_projects",
                          "item/cat_deploymentstatus": 809060012,
                          "recordId": "@outputs('Update_Build_Request_5')?['body/_cat_project_value']"
                        }
                      },
                      "runAfter": {
                        "Update_Build_Request_5": [
                          "Succeeded"
                        ]
                      },
                      "type": "OpenApiConnection"
                    }
                  },
                  "runAfter": {
                    "Trigger_Prod_Workflow_Without_Merge_conflicts": [
                      "Succeeded"
                    ]
                  },
                  "type": "Scope"
                },
                "Trigger_Prod_Workflow_Without_Merge_conflicts": {
                  "inputs": {
                    "authentication": {
                      "type": "Raw",
                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_github",
                      "connectionName": "shared_github",
                      "operationId": "CreateRepositoryDispatchEvent"
                    },
                    "parameters": {
                      "body/client_payload": "@outputs('JSON_Payload_-_Merge_Conflicts')",
                      "body/event_type": "deploy_to_prod",
                      "repositoryName": "@triggerBody()['text_1']",
                      "repositoryOwner": "@triggerBody()['text']"
                    }
                  },
                  "runAfter": {
                    "JSON_Payload_-_Merge_Conflicts": [
                      "Succeeded"
                    ]
                  },
                  "type": "OpenApiConnection"
                }
              },
              "else": {
                "actions": {
                  "Apply_to_each:_Notification_for_PR_rejection": {
                    "actions": {
                      "Append_to_string_variable_5": {
                        "inputs": {
                          "name": "ApprovalResponse",
                          "value": "@items('Apply_to_each:_Notification_for_PR_rejection')?['comments']"
                        },
                        "runAfter": {
                          "Send_Rejection_Notification": [
                            "Succeeded"
                          ]
                        },
                        "type": "AppendToStringVariable"
                      },
                      "Fetch_Localized_Rejection_Notification_2": {
                        "actions": {
                          "Compose_6": {
                            "inputs": "@concat('projectOwnerName==',triggerBody()['text_7'],'##projectName==',triggerBody()['text_6'],'##stageName==',triggerBody()['text_8'],'##rejectedBy==',items('Apply_to_each:_Notification_for_PR_rejection')?['responder/displayName'],'##rejectedReason==',items('Apply_to_each:_Notification_for_PR_rejection')?['comments'])",
                            "runAfter": {
                              "Fetch_Localized_Subject_2": [
                                "Succeeded"
                              ]
                            },
                            "type": "Compose"
                          },
                          "Fetch_Localized_Body_2": {
                            "inputs": {
                              "body": {
                                "text": "deployToProdFlow6",
                                "text_2": "@outputs('Compose_6')"
                              },
                              "host": {
                                "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                              }
                            },
                            "runAfter": {
                              "Compose_6": [
                                "Succeeded"
                              ]
                            },
                            "type": "Workflow"
                          },
                          "Fetch_Localized_Subject_2": {
                            "inputs": {
                              "body": {
                                "text": "deployToProdFlow5"
                              },
                              "host": {
                                "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                              }
                            },
                            "runAfter": {},
                            "type": "Workflow"
                          }
                        },
                        "runAfter": {},
                        "type": "Scope"
                      },
                      "Send_Rejection_Notification": {
                        "inputs": {
                          "body": {
                            "text": "@triggerBody()['text_12']",
                            "text_1": "@outputs('Fetch_Localized_Subject_2')?['Body']?['localizedtext']",
                            "text_2": "@outputs('Fetch_Localized_Body_2')?['Body']?['localizedtext']"
                          },
                          "host": {
                            "workflowReferenceName": "4528dfaf-782e-eb11-a813-000d3a33febe"
                          }
                        },
                        "runAfter": {
                          "Fetch_Localized_Rejection_Notification_2": [
                            "Succeeded"
                          ]
                        },
                        "type": "Workflow"
                      }
                    },
                    "foreach": "@outputs('Raise_Approval_for_Deployment')?['body/responses']",
                    "runAfter": {},
                    "type": "Foreach"
                  },
                  "Close_Pull_Request_1": {
                    "inputs": {
                      "authentication": {
                        "type": "Raw",
                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                      },
                      "host": {
                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_github",
                        "connectionName": "shared_github",
                        "operationId": "UpdatePullRequest"
                      },
                      "parameters": {
                        "body/body": "Closing as the Approver has rejected it.\nRejection Reason: @{variables('ApprovalResponse')}",
                        "pullNumber": "@outputs('Create_pull_request')?['body/number']",
                        "repositoryName": "@triggerBody()['text_1']",
                        "repositoryOwner": "@triggerBody()['text']"
                      }
                    },
                    "runAfter": {
                      "Apply_to_each:_Notification_for_PR_rejection": [
                        "Succeeded"
                      ]
                    },
                    "type": "OpenApiConnection"
                  },
                  "Set_variable_3": {
                    "inputs": {
                      "name": "DoRaiseReturnError",
                      "value": false
                    },
                    "runAfter": {
                      "Update_Project_Status_2": [
                        "Succeeded"
                      ]
                    },
                    "type": "SetVariable"
                  },
                  "Update_Build_Request_2": {
                    "inputs": {
                      "authentication": {
                        "type": "Raw",
                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                      },
                      "host": {
                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                        "connectionName": "shared_commondataserviceforapps",
                        "operationId": "UpdateRecord"
                      },
                      "parameters": {
                        "entityName": "cat_buildrequests",
                        "item/cat_buildstatus": 809060004,
                        "item/cat_error": "@substring(variables('ApprovalResponse'), 0, min(length(variables('ApprovalResponse')), 3999))",
                        "recordId": "@triggerBody()['text_14']"
                      }
                    },
                    "runAfter": {
                      "Close_Pull_Request_1": [
                        "Succeeded"
                      ]
                    },
                    "type": "OpenApiConnection"
                  },
                  "Update_Project_Status_2": {
                    "inputs": {
                      "authentication": {
                        "type": "Raw",
                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                      },
                      "host": {
                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                        "connectionName": "shared_commondataserviceforapps",
                        "operationId": "UpdateRecord"
                      },
                      "parameters": {
                        "entityName": "cat_projects",
                        "item/cat_deploymentstatus": 809060009,
                        "item/cat_errormessage": "@substring(variables('ApprovalResponse'), 0, min(length(variables('ApprovalResponse')), 3999))",
                        "recordId": "@outputs('Update_Build_Request_2')?['body/_cat_project_value']"
                      }
                    },
                    "runAfter": {
                      "Update_Build_Request_2": [
                        "Succeeded"
                      ]
                    },
                    "type": "OpenApiConnection"
                  }
                }
              },
              "expression": {
                "equals": [
                  "@outputs('Raise_Approval_for_Deployment')?['body/outcome']",
                  "Approve"
                ]
              },
              "runAfter": {
                "Raise_Approval_for_Deployment": [
                  "Succeeded"
                ]
              },
              "type": "If"
            },
            "Condition_:_If_user_branch_is_ahead_count_=_0": {
              "actions": {
                "Condition:_Deployment_approval": {
                  "actions": {
                    "JSON_Payload_-_Trigger_Prod_Workflow_without_merge": {
                      "inputs": {
                        "branch": "@triggerBody()['text_3']",
                        "notes": "@outputs('Commit_Message_')",
                        "requestid": "@triggerBody()['text_14']",
                        "solutionname": "@triggerBody()['text_10']",
                        "targetenvironmentsecretname": "@outputs('Env_Sec_Name')",
                        "targetenvironmenturl": "@triggerBody()['text_17']",
                        "targetenvironmentuserid": "@triggerBody()['text_18']",
                        "webhookurl": "@triggerBody()['text_11']"
                      },
                      "runAfter": {},
                      "type": "Compose"
                    },
                    "Scope_2": {
                      "actions": {
                        "Update_Build_Request_6": {
                          "inputs": {
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "UpdateRecord"
                            },
                            "parameters": {
                              "entityName": "cat_buildrequests",
                              "item/cat_buildstatus": 809060005,
                              "recordId": "@triggerBody()['text_14']"
                            }
                          },
                          "runAfter": {},
                          "type": "OpenApiConnection"
                        },
                        "Update_Project_Status_6": {
                          "inputs": {
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "UpdateRecord"
                            },
                            "parameters": {
                              "entityName": "cat_projects",
                              "item/cat_deploymentstatus": 809060012,
                              "recordId": "@outputs('Update_Build_Request_6')?['body/_cat_project_value']"
                            }
                          },
                          "runAfter": {
                            "Update_Build_Request_6": [
                              "Succeeded"
                            ]
                          },
                          "type": "OpenApiConnection"
                        }
                      },
                      "runAfter": {
                        "Set_variable_4": [
                          "Succeeded"
                        ]
                      },
                      "type": "Scope"
                    },
                    "Set_variable_4": {
                      "inputs": {
                        "name": "DoRaiseReturnError",
                        "value": false
                      },
                      "runAfter": {
                        "Trigger_Prod_Workflow_without_merge": [
                          "Succeeded"
                        ]
                      },
                      "type": "SetVariable"
                    },
                    "Trigger_Prod_Workflow_without_merge": {
                      "inputs": {
                        "authentication": {
                          "type": "Raw",
                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                        },
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_github",
                          "connectionName": "shared_github",
                          "operationId": "CreateRepositoryDispatchEvent"
                        },
                        "parameters": {
                          "body/client_payload": "@outputs('JSON_Payload_-_Trigger_Prod_Workflow_without_merge')",
                          "body/event_type": "deploy_to_prod",
                          "repositoryName": "@triggerBody()['text_1']",
                          "repositoryOwner": "@triggerBody()['text']"
                        }
                      },
                      "runAfter": {
                        "JSON_Payload_-_Trigger_Prod_Workflow_without_merge": [
                          "Succeeded"
                        ]
                      },
                      "type": "OpenApiConnection"
                    }
                  },
                  "else": {
                    "actions": {
                      "Apply_to_each:_Notification_for_PR_rejection_2": {
                        "actions": {
                          "Append_to_string_variable_6": {
                            "inputs": {
                              "name": "ApprovalResponse",
                              "value": "@{items('Apply_to_each:_Notification_for_PR_rejection_2')?['comments']}\n"
                            },
                            "runAfter": {
                              "Send_Rejection_Notification_3": [
                                "Succeeded"
                              ]
                            },
                            "type": "AppendToStringVariable"
                          },
                          "Fetch_Localized_Rejection_Notification_3": {
                            "actions": {
                              "Compose_9": {
                                "inputs": "@concat('projectOwnerName==',triggerBody()['text_7'],'##projectName==',triggerBody()['text_6'],'##stageName==',triggerBody()['text_8'],'##rejectedBy==',items('Apply_to_each:_Notification_for_PR_rejection_2')?['responder/displayName'],'##rejectedReason==',items('Apply_to_each:_Notification_for_PR_rejection_2')?['comments'])",
                                "runAfter": {
                                  "Fetch_Localized_Subject_3": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Compose"
                              },
                              "Fetch_Localized_Body_3": {
                                "inputs": {
                                  "body": {
                                    "text": "deployToProdFlow6",
                                    "text_2": "@outputs('Compose_9')"
                                  },
                                  "host": {
                                    "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                                  }
                                },
                                "runAfter": {
                                  "Compose_9": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Workflow"
                              },
                              "Fetch_Localized_Subject_3": {
                                "inputs": {
                                  "body": {
                                    "text": "deployToProdFlow5"
                                  },
                                  "host": {
                                    "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                                  }
                                },
                                "runAfter": {},
                                "type": "Workflow"
                              }
                            },
                            "runAfter": {},
                            "type": "Scope"
                          },
                          "Send_Rejection_Notification_3": {
                            "inputs": {
                              "body": {
                                "text": "@triggerBody()['text_12']",
                                "text_1": "@outputs('Fetch_Localized_Subject_3')?['Body']?['localizedtext']",
                                "text_2": "@outputs('Fetch_Localized_Body_3')?['Body']?['localizedtext']"
                              },
                              "host": {
                                "workflowReferenceName": "4528dfaf-782e-eb11-a813-000d3a33febe"
                              }
                            },
                            "runAfter": {
                              "Fetch_Localized_Rejection_Notification_3": [
                                "Succeeded"
                              ]
                            },
                            "type": "Workflow"
                          }
                        },
                        "foreach": "@outputs('Raise_Approval_for_Deployment_2')?['body/responses']",
                        "runAfter": {},
                        "type": "Foreach"
                      },
                      "Set_variable_5": {
                        "inputs": {
                          "name": "DoRaiseReturnError",
                          "value": false
                        },
                        "runAfter": {
                          "Update_Project_Status_4": [
                            "Succeeded"
                          ]
                        },
                        "type": "SetVariable"
                      },
                      "Update_Build_Request_4": {
                        "inputs": {
                          "authentication": {
                            "type": "Raw",
                            "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                          },
                          "host": {
                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                            "connectionName": "shared_commondataserviceforapps",
                            "operationId": "UpdateRecord"
                          },
                          "parameters": {
                            "entityName": "cat_buildrequests",
                            "item/cat_buildstatus": 809060004,
                            "item/cat_error": "@substring(variables('ApprovalResponse'), 0, min(length(variables('ApprovalResponse')), 3999))",
                            "recordId": "@triggerBody()['text_14']"
                          }
                        },
                        "runAfter": {
                          "Apply_to_each:_Notification_for_PR_rejection_2": [
                            "Succeeded"
                          ]
                        },
                        "type": "OpenApiConnection"
                      },
                      "Update_Project_Status_4": {
                        "inputs": {
                          "authentication": {
                            "type": "Raw",
                            "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                          },
                          "host": {
                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                            "connectionName": "shared_commondataserviceforapps",
                            "operationId": "UpdateRecord"
                          },
                          "parameters": {
                            "entityName": "cat_projects",
                            "item/cat_deploymentstatus": 809060009,
                            "item/cat_errormessage": "@substring(variables('ApprovalResponse'), 0, min(length(variables('ApprovalResponse')), 3999))",
                            "recordId": "@outputs('Update_Build_Request_4')?['body/_cat_project_value']"
                          }
                        },
                        "runAfter": {
                          "Update_Build_Request_4": [
                            "Succeeded"
                          ]
                        },
                        "type": "OpenApiConnection"
                      }
                    }
                  },
                  "expression": {
                    "equals": [
                      "@outputs('Raise_Approval_for_Deployment_2')?['body/outcome']",
                      "Approve"
                    ]
                  },
                  "runAfter": {
                    "Raise_Approval_for_Deployment_2": [
                      "Succeeded"
                    ]
                  },
                  "type": "If"
                },
                "Fetch_Localized_Approval_for_Deployment_3": {
                  "actions": {
                    "Compose_7": {
                      "inputs": "@concat('projectOwnerName==', triggerBody()['text_7'], '##projectName==', triggerBody()['text_6'], '##stageName==', triggerBody()['text_8'], '##releaseNotes==', triggerBody()['text_4'])",
                      "runAfter": {},
                      "type": "Compose"
                    },
                    "Compose_8": {
                      "inputs": "@concat('projectName==', triggerBody()['text_6'])",
                      "runAfter": {
                        "Fetch_Localized_Approval_for_Deployment_Details_3": [
                          "Succeeded"
                        ]
                      },
                      "type": "Compose"
                    },
                    "Fetch_Localized_Approval_for_Deployment_Details_3": {
                      "inputs": {
                        "body": {
                          "text": "deployToProdFlow1",
                          "text_2": "@outputs('Compose_7')"
                        },
                        "host": {
                          "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                        }
                      },
                      "runAfter": {
                        "Compose_7": [
                          "Succeeded"
                        ]
                      },
                      "type": "Workflow"
                    },
                    "Fetch_Localized_Approval_for_Deployment_Title_3": {
                      "inputs": {
                        "body": {
                          "text": "deployToProdFlow2",
                          "text_2": "@outputs('Compose_8')"
                        },
                        "host": {
                          "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                        }
                      },
                      "runAfter": {
                        "Compose_8": [
                          "Succeeded"
                        ]
                      },
                      "type": "Workflow"
                    }
                  },
                  "runAfter": {},
                  "type": "Scope"
                },
                "Raise_Approval_for_Deployment_2": {
                  "inputs": {
                    "authentication": {
                      "type": "Raw",
                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_approvals",
                      "connectionName": "shared_approvals",
                      "operationId": "StartAndWaitForAnApproval"
                    },
                    "parameters": {
                      "WebhookApprovalCreationInput/assignedTo": "@triggerBody()['text_16']",
                      "WebhookApprovalCreationInput/details": "@outputs('Fetch_Localized_Approval_for_Deployment_Details_3')?['Body']?['localizedtext']",
                      "WebhookApprovalCreationInput/enableNotifications": true,
                      "WebhookApprovalCreationInput/enableReassignment": true,
                      "WebhookApprovalCreationInput/requestor": "@triggerBody()['text_12']",
                      "WebhookApprovalCreationInput/title": "@outputs('Fetch_Localized_Approval_for_Deployment_Title_3')?['Body']?['localizedtext']",
                      "approvalType": "Basic"
                    }
                  },
                  "runAfter": {
                    "Fetch_Localized_Approval_for_Deployment_3": [
                      "Succeeded"
                    ]
                  },
                  "type": "OpenApiConnectionWebhook"
                }
              },
              "else": {
                "actions": {
                  "Apply_to_each": {
                    "actions": {
                      "Append_to_string_variable": {
                        "inputs": {
                          "name": "Error",
                          "value": "@items('Apply_to_each')?['message']"
                        },
                        "runAfter": {},
                        "type": "AppendToStringVariable"
                      }
                    },
                    "foreach": "@body('Parse_JSON')?['errors']",
                    "runAfter": {
                      "Parse_JSON": [
                        "Succeeded"
                      ]
                    },
                    "type": "Foreach"
                  },
                  "Fetch_Localized_Email_PR_creation_failure:_Owner": {
                    "actions": {
                      "Compose_12": {
                        "inputs": "@concat('projectOwnerName==',triggerBody()['text_7'],'##projectName==',triggerBody()['text_6'])",
                        "runAfter": {
                          "Fetch_Localized_Subject_5": [
                            "Succeeded"
                          ]
                        },
                        "type": "Compose"
                      },
                      "Fetch_Localized_Body_5": {
                        "inputs": {
                          "body": {
                            "text": "deployToProdFlow8",
                            "text_2": "@outputs('Compose_12')"
                          },
                          "host": {
                            "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                          }
                        },
                        "runAfter": {
                          "Compose_12": [
                            "Succeeded"
                          ]
                        },
                        "type": "Workflow"
                      },
                      "Fetch_Localized_Subject_5": {
                        "inputs": {
                          "body": {
                            "text": "deployToProdFlow7"
                          },
                          "host": {
                            "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                          }
                        },
                        "runAfter": {},
                        "type": "Workflow"
                      }
                    },
                    "runAfter": {
                      "Send_PR_creation_failure:_Admin": [
                        "Succeeded"
                      ]
                    },
                    "type": "Scope"
                  },
                  "Fetch_Localized_Email_for_PR_creation_failure:_Admin": {
                    "actions": {
                      "Compose_10": {
                        "inputs": "@concat('projectName==',triggerBody()['text_6'])",
                        "runAfter": {},
                        "type": "Compose"
                      },
                      "Compose_11": {
                        "inputs": "@concat('repoName==',triggerBody()['text_1'],'##repoUrl==',triggerBody()['text_13'],'##userBranchName==',triggerBody()['text_2'],'##errorMessage==',variables('Error'))",
                        "runAfter": {
                          "Fetch_Localized_Subject_4": [
                            "Succeeded"
                          ]
                        },
                        "type": "Compose"
                      },
                      "Fetch_Localized_Body_4": {
                        "inputs": {
                          "body": {
                            "text": "deployToProdFlow10",
                            "text_2": "@outputs('Compose_11')"
                          },
                          "host": {
                            "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                          }
                        },
                        "runAfter": {
                          "Compose_11": [
                            "Succeeded"
                          ]
                        },
                        "type": "Workflow"
                      },
                      "Fetch_Localized_Subject_4": {
                        "inputs": {
                          "body": {
                            "text": "deployToProdFlow9",
                            "text_2": "@outputs('Compose_10')"
                          },
                          "host": {
                            "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                          }
                        },
                        "runAfter": {
                          "Compose_10": [
                            "Succeeded"
                          ]
                        },
                        "type": "Workflow"
                      }
                    },
                    "runAfter": {
                      "Apply_to_each": [
                        "Succeeded"
                      ]
                    },
                    "type": "Scope"
                  },
                  "Parse_JSON": {
                    "inputs": {
                      "content": "@outputs('Create_pull_request')?['body']",
                      "schema": {
                        "properties": {
                          "documentation_url": {
                            "type": "string"
                          },
                          "errors": {
                            "items": {
                              "properties": {
                                "code": {
                                  "type": "string"
                                },
                                "message": {
                                  "type": "string"
                                },
                                "resource": {
                                  "type": "string"
                                }
                              },
                              "required": [
                                "resource",
                                "code",
                                "message"
                              ],
                              "type": "object"
                            },
                            "type": "array"
                          },
                          "message": {
                            "type": "string"
                          }
                        },
                        "type": "object"
                      }
                    },
                    "runAfter": {},
                    "type": "ParseJson"
                  },
                  "Send_PR_creation_failure:_Admin": {
                    "inputs": {
                      "body": {
                        "text": "@triggerBody()['text_5']",
                        "text_1": "@outputs('Fetch_Localized_Subject_4')?['Body']?['localizedtext']",
                        "text_2": "@outputs('Fetch_Localized_Body_4')?['Body']?['localizedtext']"
                      },
                      "host": {
                        "workflowReferenceName": "4528dfaf-782e-eb11-a813-000d3a33febe"
                      }
                    },
                    "runAfter": {
                      "Fetch_Localized_Email_for_PR_creation_failure:_Admin": [
                        "Succeeded"
                      ]
                    },
                    "type": "Workflow"
                  },
                  "Send_PR_creation_failure:_Owner": {
                    "inputs": {
                      "body": {
                        "text": "@triggerBody()['text_12']",
                        "text_1": "@outputs('Fetch_Localized_Subject_5')?['Body']?['localizedtext']",
                        "text_2": "@outputs('Fetch_Localized_Body_5')?['Body']?['localizedtext']"
                      },
                      "host": {
                        "workflowReferenceName": "4528dfaf-782e-eb11-a813-000d3a33febe"
                      }
                    },
                    "runAfter": {
                      "Fetch_Localized_Email_PR_creation_failure:_Owner": [
                        "Succeeded"
                      ]
                    },
                    "type": "Workflow"
                  },
                  "Set_variable": {
                    "inputs": {
                      "name": "DoRaiseReturnError",
                      "value": false
                    },
                    "runAfter": {
                      "Update_Project_Status_3": [
                        "Succeeded"
                      ]
                    },
                    "type": "SetVariable"
                  },
                  "Update_Build_Request_3": {
                    "inputs": {
                      "authentication": {
                        "type": "Raw",
                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                      },
                      "host": {
                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                        "connectionName": "shared_commondataserviceforapps",
                        "operationId": "UpdateRecord"
                      },
                      "parameters": {
                        "entityName": "cat_buildrequests",
                        "item/cat_buildstatus": 809060003,
                        "item/cat_error": "@substring(variables('Error'), 0, min(length(variables('Error')), 3999))",
                        "recordId": "@triggerBody()['text_14']"
                      }
                    },
                    "runAfter": {
                      "Send_PR_creation_failure:_Owner": [
                        "Succeeded"
                      ]
                    },
                    "type": "OpenApiConnection"
                  },
                  "Update_Project_Status_3": {
                    "inputs": {
                      "authentication": {
                        "type": "Raw",
                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                      },
                      "host": {
                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                        "connectionName": "shared_commondataserviceforapps",
                        "operationId": "UpdateRecord"
                      },
                      "parameters": {
                        "entityName": "cat_projects",
                        "item/cat_deploymentstatus": 809060008,
                        "item/cat_errormessage": "@substring(variables('Error'), 0, min(length(variables('Error')), 3999))",
                        "recordId": "@outputs('Update_Build_Request_3')?['body/_cat_project_value']"
                      }
                    },
                    "runAfter": {
                      "Update_Build_Request_3": [
                        "Succeeded"
                      ]
                    },
                    "type": "OpenApiConnection"
                  }
                }
              },
              "expression": {
                "equals": [
                  "@outputs('Compare_two_commits')?['body/ahead_by']",
                  0
                ]
              },
              "runAfter": {
                "Compare_two_commits": [
                  "Succeeded"
                ]
              },
              "type": "If"
            },
            "Create_pull_request": {
              "inputs": {
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_github",
                  "connectionName": "shared_github",
                  "operationId": "CreatePullRequest"
                },
                "parameters": {
                  "body/base": "@triggerBody()['text_3']",
                  "body/body": "Release notes: @{triggerBody()['text_4']}",
                  "body/head": "@triggerBody()['text_2']",
                  "body/maintainer_can_modify": true,
                  "body/title": "Merge from @{triggerBody()['text_2']} to @{triggerBody()['text_3']} for project @{triggerBody()['text_6']}",
                  "repositoryName": "@triggerBody()['text_1']",
                  "repositoryOwner": "@triggerBody()['text']"
                }
              },
              "runAfter": {},
              "type": "OpenApiConnection"
            },
            "Fetch_Localized_Approval_for_Deployment": {
              "actions": {
                "Compose": {
                  "inputs": "@concat('projectOwnerName==',triggerBody()['text_7'],'##projectName==',triggerBody()['text_6'],'##stageName==',triggerBody()['text_8'],'##releaseNotes==',triggerBody()['text_4'])",
                  "runAfter": {},
                  "type": "Compose"
                },
                "Compose_2": {
                  "inputs": "@concat('projectName==',triggerBody()['text_6'])",
                  "runAfter": {
                    "Fetch_Localized_Approval_for_Deployment_Details": [
                      "Succeeded"
                    ]
                  },
                  "type": "Compose"
                },
                "Fetch_Localized_Approval_for_Deployment_Details": {
                  "inputs": {
                    "body": {
                      "text": "deployToProdFlow1",
                      "text_2": "@outputs('Compose')"
                    },
                    "host": {
                      "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                    }
                  },
                  "runAfter": {
                    "Compose": [
                      "Succeeded"
                    ]
                  },
                  "type": "Workflow"
                },
                "Fetch_Localized_Approval_for_Deployment_Title": {
                  "inputs": {
                    "body": {
                      "text": "deployToProdFlow2",
                      "text_2": "@outputs('Compose_2')"
                    },
                    "host": {
                      "workflowReferenceName": "4ada345e-9007-eb11-a813-000d3aa3e751"
                    }
                  },
                  "runAfter": {
                    "Compose_2": [
                      "Succeeded"
                    ]
                  },
                  "type": "Workflow"
                }
              },
              "runAfter": {
                "Create_pull_request": [
                  "Succeeded"
                ]
              },
              "type": "Scope"
            },
            "Raise_Approval_for_Deployment": {
              "inputs": {
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_approvals",
                  "connectionName": "shared_approvals",
                  "operationId": "StartAndWaitForAnApproval"
                },
                "parameters": {
                  "WebhookApprovalCreationInput/assignedTo": "@triggerBody()['text_16']",
                  "WebhookApprovalCreationInput/details": "@outputs('Fetch_Localized_Approval_for_Deployment_Details')?['Body']?['localizedtext']",
                  "WebhookApprovalCreationInput/enableNotifications": true,
                  "WebhookApprovalCreationInput/enableReassignment": true,
                  "WebhookApprovalCreationInput/requestor": "@triggerBody()['text_12']",
                  "WebhookApprovalCreationInput/title": "@outputs('Fetch_Localized_Approval_for_Deployment_Title')?['Body']?['localizedtext']",
                  "approvalType": "Basic"
                }
              },
              "runAfter": {
                "Fetch_Localized_Approval_for_Deployment": [
                  "Succeeded"
                ]
              },
              "type": "OpenApiConnectionWebhook"
            }
          },
          "runAfter": {
            "Commit_Message_": [
              "Succeeded"
            ]
          },
          "type": "Scope"
        }
      },
      "contentVersion": "1.0.0.0",
      "outputs": {},
      "parameters": {
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        }
      },
      "triggers": {
        "manual": {
          "inputs": {
            "headersSchema": {
              "x-ms-user-name-encoded": {
                "format": "byte",
                "title": "User name",
                "type": "string",
                "x-ms-dynamically-added": false
              }
            },
            "schema": {
              "properties": {
                "text": {
                  "description": "Please enter your input",
                  "title": "OrgName",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_1": {
                  "description": "Please enter your input",
                  "title": "RepoName",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_10": {
                  "description": "Please enter your input",
                  "title": "SolutionName",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_11": {
                  "description": "Please enter your input",
                  "title": "TriggerWorflowUrl",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_12": {
                  "description": "Please enter your input",
                  "title": "ProjectOwnerEmail",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_13": {
                  "description": "Please enter your input",
                  "title": "RepoUrl",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_14": {
                  "description": "Please enter your input",
                  "title": "BuildRequestID",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_15": {
                  "description": "Please enter your input",
                  "title": "CorrelationID",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_16": {
                  "description": "Please enter your input",
                  "title": "ApproverEmailIDs",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_17": {
                  "description": "Please enter your input",
                  "title": "TargetEnvironmentUrl",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_18": {
                  "description": "Please enter your input",
                  "title": "TargetEnvironmentUserId",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_19": {
                  "description": "Please enter your input",
                  "title": "TargetStageName",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_2": {
                  "description": "Please enter your input",
                  "title": "UserBranchName",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_3": {
                  "description": "Please enter your input",
                  "title": "TargetBranch",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_4": {
                  "description": "Please enter your input",
                  "title": "ReleaseNotes",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_5": {
                  "description": "Please enter your input",
                  "title": "AdminEmail",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_6": {
                  "description": "Please enter your input",
                  "title": "ProjectName",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_7": {
                  "description": "Please enter your input",
                  "title": "ProjectOwnerName",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_8": {
                  "description": "Please enter your input",
                  "title": "StageName",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                },
                "text_9": {
                  "description": "Please enter your input",
                  "title": "EnvironmentName",
                  "type": "string",
                  "x-ms-content-hint": "TEXT",
                  "x-ms-dynamically-added": true
                }
              },
              "required": [
                "text",
                "text_1",
                "text_2",
                "text_3",
                "text_4",
                "text_5",
                "text_6",
                "text_7",
                "text_8",
                "text_10",
                "text_11",
                "text_12",
                "text_13",
                "text_14",
                "text_16",
                "text_17",
                "text_18",
                "text_19"
              ],
              "type": "object"
            }
          },
          "kind": "Button",
          "type": "Request"
        }
      }
    }
  },
  "schemaVersion": "1.0.0.0"
}
