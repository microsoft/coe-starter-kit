{
  "properties": {
    "connectionReferences": {
      "shared_commondataservice": {
        "api": {
          "name": "shared_commondataservice"
        },
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreDataverseLegacy"
        },
        "runtimeSource": "embedded"
      },
      "shared_commondataserviceforapps_2": {
        "api": {
          "name": "shared_commondataserviceforapps"
        },
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreDataverse2"
        },
        "runtimeSource": "embedded"
      },
      "shared_flowmanagement_1": {
        "api": {
          "name": "shared_flowmanagement"
        },
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerAutomateManagement"
        },
        "runtimeSource": "embedded"
      },
      "shared_powerappsforadmins_1": {
        "api": {
          "name": "shared_powerappsforadmins"
        },
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerAppsforAdmins"
        },
        "runtimeSource": "embedded"
      },
      "shared_powerplatformforadmins": {
        "api": {
          "name": "shared_powerplatformforadmins"
        },
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerPlatformforAdmins"
        },
        "runtimeSource": "embedded"
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "actions": {
        "Delete_Bad_Data": {
          "actions": {
            "Delete_Apps_without_Environments": {
              "actions": {
                "Delete_app_without_environment": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "DeleteRecord"
                    },
                    "parameters": {
                      "entityName": "admin_apps",
                      "recordId": "@items('Delete_Apps_without_Environments')?['admin_appid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_Apps_with_No_Environment')?['body/value']",
              "runAfter": {
                "List_Apps_with_No_Environment": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Delete_CoE_Connection_References_with_neither_app_nor_flow": {
              "actions": {
                "Delete_connection_reference_2": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "DeleteRecord"
                    },
                    "parameters": {
                      "entityName": "admin_connectionreferences",
                      "recordId": "@items('Delete_CoE_Connection_References_with_neither_app_nor_flow')?['admin_connectionreferenceid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_CoE_Connection_References_with_neither_app_nor_flow')?['body/value']",
              "runAfter": {
                "List_CoE_Connection_References_with_neither_app_nor_flow": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Delete_CoE_Connection_References_with_no_Connection": {
              "actions": {
                "Delete_connection_reference": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "DeleteRecord"
                    },
                    "parameters": {
                      "entityName": "admin_connectionreferences",
                      "recordId": "@items('Delete_CoE_Connection_References_with_no_Connection')?['admin_connectionreferenceid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_CoE_Connection_References_with_no_Connection')?['body/value']",
              "runAfter": {
                "List_CoE_Connection_References_with_no_Connection": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Delete_Custom_Connection_with_no_Environmnet": {
              "actions": {
                "Delete_custom_connection": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "DeleteRecord"
                    },
                    "parameters": {
                      "entityName": "admin_connectors",
                      "recordId": "@items('Delete_Custom_Connection_with_no_Environmnet')?['admin_connectorid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_Custom_Connection_with_no_Environment')?['body/value']",
              "runAfter": {
                "List_Custom_Connection_with_no_Environment": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Delete_Desktop_Flows_without_Environments": {
              "actions": {
                "Delete_desktop_flow_without_environment": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "DeleteRecord"
                    },
                    "parameters": {
                      "entityName": "admin_rpas",
                      "recordId": "@items('Delete_Desktop_Flows_without_Environments')?['admin_rpaid']"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_Desktop_Flows_with_No_Environment')?['body/value']",
              "runAfter": {
                "List_Desktop_Flows_with_No_Environment": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Delete_Flow_Actions_with_no_Flow_or_Envt": {
              "actions": {
                "Delete_flow_action_detail": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "DeleteRecord"
                    },
                    "parameters": {
                      "entityName": "admin_flowactiondetails",
                      "recordId": "@items('Delete_Flow_Actions_with_no_Flow_or_Envt')?['admin_flowactiondetailid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_Flow_Actions_with_no_Flow_or_no_Envt')?['body/value']",
              "runAfter": {
                "List_Flow_Actions_with_no_Flow_or_no_Envt": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Delete_Flows_without_Environments": {
              "actions": {
                "Delete_flow_without_environment": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "DeleteRecord"
                    },
                    "parameters": {
                      "entityName": "admin_flows",
                      "recordId": "@items('Delete_Flows_without_Environments')?['admin_flowid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_Flow_with_No_Environment')?['body/value']",
              "runAfter": {
                "List_Flow_with_No_Environment": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "List_Apps_with_No_Environment": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "_admin_appenvironment_value eq null",
                  "$select": "admin_appid",
                  "entityName": "admin_apps"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {},
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            },
            "List_CoE_Connection_References_with_neither_app_nor_flow": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "_admin_app_value eq null and _admin_flow_value eq null",
                  "$select": "admin_connectionreferenceid",
                  "entityName": "admin_connectionreferences"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {
                "Delete_CoE_Connection_References_with_no_Connection": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            },
            "List_CoE_Connection_References_with_no_Connection": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "_admin_connector_value eq null",
                  "$select": "admin_connectionreferenceid",
                  "entityName": "admin_connectionreferences"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {
                "Delete_Flows_without_Environments": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            },
            "List_Custom_Connection_with_no_Environment": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "_admin_environmentcustomconnector_value eq null and admin_iscustomapi eq true",
                  "$select": "admin_connectorid",
                  "entityName": "admin_connectors"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {
                "Delete_CoE_Connection_References_with_neither_app_nor_flow": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            },
            "List_Desktop_Flows_with_No_Environment": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "_admin_desktopflowenvironment_value eq null",
                  "$select": "admin_rpaid",
                  "entityName": "admin_rpas"
                }
              },
              "runAfter": {
                "Delete_Apps_without_Environments": [
                  "Succeeded"
                ]
              },
              "type": "OpenApiConnection"
            },
            "List_Flow_Actions_with_no_Flow_or_no_Envt": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "_admin_flow_value eq null or _admin_flowactiondetailenvrinment_value eq null",
                  "$select": "admin_flowactiondetailid",
                  "entityName": "admin_flowactiondetails"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {
                "Delete_Custom_Connection_with_no_Environmnet": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            },
            "List_Flow_with_No_Environment": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "_admin_flowenvironment_value eq null",
                  "$select": "admin_flowid",
                  "entityName": "admin_flows"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {
                "Delete_Desktop_Flows_without_Environments": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            }
          },
          "description": "We will build to this clean up over time. For now just a few to get it started",
          "runAfter": {
            "Initialize_varNoMDAs": [
              "Succeeded"
            ]
          },
          "type": "Scope"
        },
        "Deletes_items_from_CoE_": {
          "actions": {
            "Check_if_they_want_to_delete_from_CoE": {
              "actions": {
                "Delete_Each_App": {
                  "actions": {
                    "Delete_App": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_apps",
                          "recordId": "@items('Delete_Each_App')?['admin_appid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_Apps_Marked_Deleted_To_Delete')?['body/value']",
                  "runAfter": {
                    "List_Apps_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_Environment": {
                  "actions": {
                    "Delete_Environment": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_environments",
                          "recordId": "@items('Delete_Each_Environment')?['admin_environmentid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_Envts_Marked_Deleted_To_Delete')?['body/value']",
                  "runAfter": {
                    "List_Envts_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_Flow": {
                  "actions": {
                    "Delete_Flow": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_flows",
                          "recordId": "@items('Delete_Each_Flow')?['admin_flowid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_Flows_Marked_Deleted_To_Delete')?['body/value']",
                  "runAfter": {
                    "List_Flows_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_Flow_Action": {
                  "actions": {
                    "Delete_Flow_Action": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_flowactiondetails",
                          "recordId": "@items('Delete_Each_Flow_Action')?['admin_flowactiondetailid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_Flow_Actions_Marked_Deleted_To_Delete')?['body/value']",
                  "runAfter": {
                    "List_Flow_Actions_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA": {
                  "actions": {
                    "Delete_PVA": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_pvas",
                          "recordId": "@items('Delete_Each_PVA')?['admin_pvaid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_PVAs_Marked_Deleted_To_Delete')?['body/value']",
                  "runAfter": {
                    "List_PVAs_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA_Component": {
                  "actions": {
                    "Delete_PVA_Component": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_pvacomponents",
                          "recordId": "@items('Delete_Each_PVA_Component')?['admin_pvacomponentid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_PVA_Components_Marked_Deleted_To_Delete')?['body/value']",
                  "runAfter": {
                    "List_PVA_Components_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA_Component_Flow_1": {
                  "actions": {
                    "Delete_PVA_Component_Flow_1": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_pvacomponentflowlookups",
                          "recordId": "@items('Delete_Each_PVA_Component_Flow_1')?['admin_pvacomponentflowlookupid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_PVA_Component_Flows_with_Missing_Flow')?['body/value']",
                  "runAfter": {
                    "List_PVA_Component_Flows_with_Missing_Flow": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA_Component_Flow_2": {
                  "actions": {
                    "Delete_PVA_Component_Flow_2": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_pvacomponentflowlookups",
                          "recordId": "@items('Delete_Each_PVA_Component_Flow_2')?['admin_pvacomponentflowlookupid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_PVA_Component_Flows_with_Missing_PVA_Component')?['body/value']",
                  "runAfter": {
                    "List_PVA_Component_Flows_with_Missing_PVA_Component": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "List_Apps_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_appdeleted eq true",
                      "$select": "admin_appid",
                      "entityName": "admin_apps"
                    }
                  },
                  "runAfter": {},
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_Envts_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_environmentdeleted eq true",
                      "$select": "admin_environmentid",
                      "entityName": "admin_environments"
                    }
                  },
                  "runAfter": {
                    "Delete_Each_PVA_Component_Flow_2": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_Flow_Actions_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_flowactiondetaildeleted eq true",
                      "$select": "admin_flowactiondetailid",
                      "entityName": "admin_flowactiondetails"
                    }
                  },
                  "runAfter": {
                    "Delete_Each_Flow": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_Flows_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_flowdeleted eq true",
                      "$select": "admin_flowid",
                      "entityName": "admin_flows"
                    }
                  },
                  "runAfter": {
                    "Delete_Each_App": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_PVA_Component_Flows_with_Missing_Flow": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "_admin_flow_value eq null",
                      "$select": "admin_pvacomponentflowlookupid",
                      "entityName": "admin_pvacomponentflowlookups"
                    }
                  },
                  "runAfter": {
                    "Delete_Each_PVA_Component": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_PVA_Component_Flows_with_Missing_PVA_Component": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "_admin_pvacomponent_value eq null",
                      "$select": "admin_pvacomponentflowlookupid",
                      "entityName": "admin_pvacomponentflowlookups"
                    }
                  },
                  "runAfter": {
                    "Delete_Each_PVA_Component_Flow_1": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_PVA_Components_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_componentdeleted eq true",
                      "$select": "admin_pvacomponentid",
                      "entityName": "admin_pvacomponents"
                    }
                  },
                  "runAfter": {
                    "Delete_Each_PVA": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_PVAs_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_pvadeleted eq true",
                      "$select": "admin_pvaid",
                      "entityName": "admin_pvas"
                    }
                  },
                  "runAfter": {
                    "Delete_Each_Flow_Action": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                }
              },
              "expression": {
                "equals": [
                  "@variables('varDeleteFromCoE')",
                  "yes"
                ]
              },
              "runAfter": {},
              "type": "If"
            }
          },
          "runAfter": {
            "Error_Handling_Canvas_Apps": [
              "Succeeded",
              "Skipped"
            ]
          },
          "type": "Scope"
        },
        "Error_Handling_Canvas_Apps": {
          "actions": {
            "Create_a_new_record_-_Sync_Flow_Errors_4": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "CreateRecord"
                },
                "parameters": {
                  "entityName": "admin_syncflowerrorses",
                  "item/admin_flowinstanceurl": "@concat(variables('flowEnvironment'), workflow()?['tags']['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])",
                  "item/admin_name": "Admin | Sync Template v3 (Check Deleted) - Canvas Apps"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {},
              "type": "OpenApiConnection"
            },
            "Set_failureOccured_true_4": {
              "inputs": {
                "name": "failureOccurred",
                "value": "@true"
              },
              "runAfter": {
                "Create_a_new_record_-_Sync_Flow_Errors_4": [
                  "Succeeded"
                ]
              },
              "type": "SetVariable"
            }
          },
          "runAfter": {
            "Newly_Deleted_Canvas_Apps": [
              "Failed"
            ]
          },
          "type": "Scope"
        },
        "Error_Handling_Flows": {
          "actions": {
            "Create_a_new_record_-_Sync_Flow_Errors_3": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "CreateRecord"
                },
                "parameters": {
                  "entityName": "admin_syncflowerrorses",
                  "item/admin_name": "Admin | Sync Template v3 (Check Deleted) - Flows"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {},
              "type": "OpenApiConnection"
            },
            "Set_failureOccured_true_3": {
              "inputs": {
                "name": "failureOccurred",
                "value": "@true"
              },
              "runAfter": {
                "Create_a_new_record_-_Sync_Flow_Errors_3": [
                  "Succeeded"
                ]
              },
              "type": "SetVariable"
            }
          },
          "runAfter": {
            "Newly_Deleted_Flows": [
              "Failed"
            ]
          },
          "type": "Scope"
        },
        "Error_Handling_Model_Driven_Apps": {
          "actions": {
            "Create_a_new_record_-_Sync_Flow_Errors_2": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "CreateRecord"
                },
                "parameters": {
                  "entityName": "admin_syncflowerrorses",
                  "item/admin_flowinstanceurl": "@concat(variables('flowEnvironment'), workflow()?['tags']['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])",
                  "item/admin_name": "Admin | Sync Template v3 (Check Deleted) - Model Driven Apps"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {},
              "type": "OpenApiConnection"
            },
            "Set_failureOccured_true_2": {
              "inputs": {
                "name": "failureOccurred",
                "value": "@true"
              },
              "runAfter": {
                "Create_a_new_record_-_Sync_Flow_Errors_2": [
                  "Succeeded"
                ]
              },
              "type": "SetVariable"
            }
          },
          "runAfter": {
            "Newly_Deleted_Model_Driven_Apps": [
              "Failed"
            ]
          },
          "type": "Scope"
        },
        "Error_Handling_PVA": {
          "actions": {
            "Create_a_new_record_-_Sync_Flow_Errors": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "CreateRecord"
                },
                "parameters": {
                  "entityName": "admin_syncflowerrorses",
                  "item/admin_flowinstanceurl": "@concat(variables('flowEnvironment'), workflow()?['tags']['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])",
                  "item/admin_name": "Admin | Sync Template v3 (Check Deleted) - PVA"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {},
              "type": "OpenApiConnection"
            },
            "Set_failureOccured_true": {
              "inputs": {
                "name": "failureOccurred",
                "value": "@true"
              },
              "runAfter": {
                "Create_a_new_record_-_Sync_Flow_Errors": [
                  "Succeeded"
                ]
              },
              "type": "SetVariable"
            }
          },
          "runAfter": {
            "Newly_Deleted_Power_Virtual_Agents": [
              "Failed"
            ]
          },
          "type": "Scope"
        },
        "Get_Environments": {
          "inputs": {
            "authentication": "@parameters('$authentication')",
            "host": {
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_powerplatformforadmins",
              "connectionName": "shared_powerplatformforadmins",
              "operationId": "Get-AdminEnvironment"
            },
            "parameters": {
              "api-version": "2020-09-01"
            },
            "retryPolicy": {
              "count": 10,
              "interval": "PT10S",
              "type": "exponential"
            }
          },
          "runAfter": {
            "Unmark_Objects_as_Deleted": [
              "Succeeded",
              "Failed"
            ]
          },
          "runtimeConfiguration": {
            "paginationPolicy": {
              "minimumItemCount": 100000
            }
          },
          "type": "OpenApiConnection"
        },
        "Initialize_GuidFound": {
          "inputs": {
            "variables": [
              {
                "name": "GuidFound",
                "type": "string"
              }
            ]
          },
          "runAfter": {
            "Initialize_failureOccurred": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_failureOccurred": {
          "inputs": {
            "variables": [
              {
                "name": "failureOccurred",
                "type": "boolean",
                "value": "@false"
              }
            ]
          },
          "runAfter": {},
          "type": "InitializeVariable"
        },
        "Initialize_systemMaker": {
          "description": "SYSTEM maker is used to identify the owner record for Environments generated by the system, such as the default environment",
          "inputs": {
            "variables": [
              {
                "name": " systemMaker",
                "type": "string"
              }
            ]
          },
          "runAfter": {
            "Initialize_GuidFound": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_varBotFound": {
          "inputs": {
            "variables": [
              {
                "name": "varBotFound",
                "type": "boolean",
                "value": "@false"
              }
            ]
          },
          "runAfter": {
            "Initialize_varMDAfound": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_varDeleteFromCoE": {
          "inputs": {
            "variables": [
              {
                "name": "varDeleteFromCoE",
                "type": "string",
                "value": "@parameters('Also Delete From CoE')"
              }
            ]
          },
          "runAfter": {
            "Initialize_variable_flowEnvironment": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_varMDAfound": {
          "inputs": {
            "variables": [
              {
                "name": "varMDAfound",
                "type": "boolean",
                "value": "@false"
              }
            ]
          },
          "runAfter": {
            "Initialize_varDeleteFromCoE": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_varNoBots": {
          "inputs": {
            "variables": [
              {
                "name": "varNoBots",
                "type": "boolean",
                "value": "@false"
              }
            ]
          },
          "runAfter": {
            "Initialize_varBotFound": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_varNoMDAs": {
          "inputs": {
            "variables": [
              {
                "name": "varNoMDAs",
                "type": "boolean",
                "value": "@false"
              }
            ]
          },
          "runAfter": {
            "Initialize_varNoBots": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_variable_flowEnvironment": {
          "description": "Environment location specific Flow URL - remember / at the end",
          "inputs": {
            "variables": [
              {
                "name": "flowEnvironment",
                "type": "string",
                "value": "@parameters('Power Automate Environment Variable')"
              }
            ]
          },
          "runAfter": {
            "Initialize_variable_today": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_variable_today": {
          "inputs": {
            "variables": [
              {
                "name": "today",
                "type": "string",
                "value": "@{utcNow()}"
              }
            ]
          },
          "runAfter": {
            "Initialize_systemMaker": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "List_CoE_Environments_not_marked_deleted": {
          "inputs": {
            "authentication": "@parameters('$authentication')",
            "host": {
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
              "connectionName": "shared_commondataserviceforapps_2",
              "operationId": "ListRecords"
            },
            "parameters": {
              "$filter": "admin_environmentdeleted eq false",
              "$select": "admin_environmentid, admin_environmentsku, admin_hascds, admin_environmentname, admin_environmentcdsmetadataname, admin_environmentdeletedon",
              "entityName": "admin_environments"
            },
            "retryPolicy": {
              "count": 10,
              "interval": "PT10S",
              "type": "exponential"
            }
          },
          "runAfter": {
            "Newly_Deleted_Environments": [
              "Succeeded"
            ]
          },
          "runtimeConfiguration": {
            "paginationPolicy": {
              "minimumItemCount": 100000
            }
          },
          "type": "OpenApiConnection"
        },
        "List_CoE_Environments_not_marked_deleted_-_pre_new_deletes": {
          "inputs": {
            "authentication": "@parameters('$authentication')",
            "host": {
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
              "connectionName": "shared_commondataserviceforapps_2",
              "operationId": "ListRecords"
            },
            "parameters": {
              "$filter": "admin_environmentdeleted eq false",
              "$select": "admin_environmentid, admin_environmentsku, admin_environmentname, admin_environmentdeletedon",
              "entityName": "admin_environments"
            },
            "retryPolicy": {
              "count": 10,
              "interval": "PT10S",
              "type": "exponential"
            }
          },
          "runAfter": {
            "Get_Environments": [
              "Succeeded"
            ]
          },
          "runtimeConfiguration": {
            "paginationPolicy": {
              "minimumItemCount": 100000
            }
          },
          "type": "OpenApiConnection"
        },
        "Newly_Deleted_Canvas_Apps": {
          "actions": {
            "Loop_envs_4": {
              "actions": {
                "Apply_to_each_app_in_CoE": {
                  "actions": {
                    "Filter_tenant_apps_to_this_app_from_CoE": {
                      "inputs": {
                        "from": "@outputs('Get_Apps_as_Admin')?['body/value']",
                        "where": "@equals(item()?['name'], items('Apply_to_each_app_in_CoE')?['admin_appid'])"
                      },
                      "runAfter": {},
                      "type": "Query"
                    },
                    "If_not_found_in_tenant,_mark_deleted": {
                      "actions": {
                        "Mark_Canvas_App_as_Deleted": {
                          "inputs": {
                            "authentication": "@parameters('$authentication')",
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "connectionName": "shared_commondataserviceforapps_2",
                              "operationId": "UpdateRecord"
                            },
                            "parameters": {
                              "entityName": "admin_apps",
                              "item/admin_appdeleted": true,
                              "item/admin_appdeletedon": "@if(empty(items('Apply_to_each_app_in_CoE')?['admin_appdeletedon']), variables('today'), if(less(items('Apply_to_each_app_in_CoE')?['admin_appdeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Apply_to_each_app_in_CoE')?['admin_appdeletedon']))",
                              "recordId": "@items('Apply_to_each_app_in_CoE')?['admin_appid']"
                            },
                            "retryPolicy": {
                              "count": 10,
                              "interval": "PT10S",
                              "type": "exponential"
                            }
                          },
                          "runAfter": {},
                          "type": "OpenApiConnection"
                        }
                      },
                      "expression": {
                        "equals": [
                          "@length(body('Filter_tenant_apps_to_this_app_from_CoE'))",
                          0
                        ]
                      },
                      "runAfter": {
                        "Filter_tenant_apps_to_this_app_from_CoE": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    }
                  },
                  "foreach": "@outputs('List_Apps_from_CoE')?['body/value']",
                  "runAfter": {
                    "Get_Apps_as_Admin": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Get_Apps_as_Admin": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_powerappsforadmins",
                      "connectionName": "shared_powerappsforadmins_1",
                      "operationId": "Get-AdminApps"
                    },
                    "parameters": {
                      "$top": 250,
                      "api-version": "2016-11-01",
                      "environment": "@items('Loop_envs_4')?['admin_environmentname']"
                    }
                  },
                  "runAfter": {
                    "List_Apps_from_CoE": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_Apps_from_CoE": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "_admin_appenvironment_value eq '@{items('Loop_envs_4')?['admin_environmentid']}' and admin_appdeleted eq false and admin_powerappstype eq 597910000",
                      "$select": "admin_appid, admin_appdeletedon",
                      "entityName": "admin_apps"
                    }
                  },
                  "runAfter": {},
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_CoE_Environments_not_marked_deleted')?['body/value']",
              "runAfter": {},
              "type": "Foreach"
            }
          },
          "runAfter": {
            "Error_Handling_Flows": [
              "Succeeded",
              "Skipped"
            ]
          },
          "type": "Scope"
        },
        "Newly_Deleted_Environments": {
          "actions": {
            "For_Each_non_del_env_in_CoE": {
              "actions": {
                "Find_env_in_tenant": {
                  "inputs": {
                    "from": "@outputs('Get_Environments')?['body/value']",
                    "where": "@equals(item()?['name'], items('For_Each_non_del_env_in_CoE')?['admin_environmentname'])"
                  },
                  "runAfter": {},
                  "type": "Query"
                },
                "If_Not_Found,_mark_it_and_its_objects_as_deleted": {
                  "actions": {
                    "Mark_Apps_as_deleted_in_COE": {
                      "actions": {
                        "Apply_to_each_App_and_mark_App_as_deleted": {
                          "actions": {
                            "Mark_App_as_deleted": {
                              "inputs": {
                                "authentication": "@parameters('$authentication')",
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                  "connectionName": "shared_commondataserviceforapps_2",
                                  "operationId": "UpdateRecord"
                                },
                                "parameters": {
                                  "entityName": "admin_apps",
                                  "item/admin_appdeleted": true,
                                  "item/admin_appdeletedon": "@if(empty(items('Apply_to_each_App_and_mark_App_as_deleted')?['admin_appdeletedon']), variables('today'), if(less(items('Apply_to_each_App_and_mark_App_as_deleted')?['admin_appdeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Apply_to_each_App_and_mark_App_as_deleted')?['admin_appdeletedon']))",
                                  "recordId": "@items('Apply_to_each_App_and_mark_App_as_deleted')?['admin_appid']"
                                },
                                "retryPolicy": {
                                  "count": 10,
                                  "interval": "PT10S",
                                  "type": "exponential"
                                }
                              },
                              "runAfter": {},
                              "type": "OpenApiConnection"
                            }
                          },
                          "foreach": "@outputs('List_Apps_for_the_deleted_Environment')?['body/value']",
                          "runAfter": {
                            "List_Apps_for_the_deleted_Environment": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "List_Apps_for_the_deleted_Environment": {
                          "inputs": {
                            "authentication": "@parameters('$authentication')",
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "connectionName": "shared_commondataserviceforapps_2",
                              "operationId": "ListRecords"
                            },
                            "parameters": {
                              "$filter": "_admin_appenvironment_value eq '@{body('Mark_Environment_as_deleted')?['admin_environmentid']}'",
                              "$select": "admin_appid, admin_appdeletedon",
                              "entityName": "admin_apps"
                            }
                          },
                          "runAfter": {},
                          "runtimeConfiguration": {
                            "paginationPolicy": {
                              "minimumItemCount": 100000
                            }
                          },
                          "type": "OpenApiConnection"
                        }
                      },
                      "runAfter": {
                        "Mark_Environment_as_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "Scope"
                    },
                    "Mark_Environment_as_deleted": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "UpdateRecord"
                        },
                        "parameters": {
                          "entityName": "admin_environments",
                          "item/admin_environmentdeleted": true,
                          "item/admin_environmentdeletedon": "@if(empty(items('For_Each_non_del_env_in_CoE')?['admin_environmentdeletedon']), variables('today'), if(less(items('For_Each_non_del_env_in_CoE')?['admin_environmentdeletedon'], addDays(utcNow(), -5000)), variables('today'), items('For_Each_non_del_env_in_CoE')?['admin_environmentdeletedon']))",
                          "recordId": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    },
                    "Mark_Flows_as_deleted_in_COE": {
                      "actions": {
                        "Apply_to_each_Flow_to_get_Flow_Actions_and_mark_Flow_as_deleted": {
                          "actions": {
                            "Apply_to_each_Flow_Action_as_deleted": {
                              "actions": {
                                "Mark_Flow_Action_as_deleted": {
                                  "inputs": {
                                    "authentication": "@parameters('$authentication')",
                                    "host": {
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                      "connectionName": "shared_commondataserviceforapps_2",
                                      "operationId": "UpdateRecord"
                                    },
                                    "parameters": {
                                      "entityName": "admin_flowactiondetails",
                                      "item/admin_flowactiondetaildeleted": true,
                                      "item/admin_flowactiondetaildeletedon": "@if(empty(items('Apply_to_each_Flow_Action_as_deleted')?['admin_flowactiondetaildeletedon']), variables('today'), if(less(items('Apply_to_each_Flow_Action_as_deleted')?['admin_flowactiondetaildeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Apply_to_each_Flow_Action_as_deleted')?['admin_flowactiondetaildeletedon']))",
                                      "recordId": "@items('Apply_to_each_Flow_Action_as_deleted')?['admin_flowactiondetailid']"
                                    },
                                    "retryPolicy": {
                                      "count": 10,
                                      "interval": "PT10S",
                                      "type": "exponential"
                                    }
                                  },
                                  "runAfter": {},
                                  "type": "OpenApiConnection"
                                }
                              },
                              "foreach": "@outputs('List_Flow_Actions')?['body/value']",
                              "runAfter": {
                                "List_Flow_Actions": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "List_Flow_Actions": {
                              "inputs": {
                                "authentication": "@parameters('$authentication')",
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                  "connectionName": "shared_commondataserviceforapps_2",
                                  "operationId": "ListRecords"
                                },
                                "parameters": {
                                  "$filter": "_admin_flow_value eq '@{items('Apply_to_each_Flow_to_get_Flow_Actions_and_mark_Flow_as_deleted')?['admin_flowid']}'",
                                  "$select": "admin_flowactiondetailid, admin_flowactiondetaildeletedon",
                                  "entityName": "admin_flowactiondetails"
                                }
                              },
                              "runAfter": {},
                              "runtimeConfiguration": {
                                "paginationPolicy": {
                                  "minimumItemCount": 100000
                                }
                              },
                              "type": "OpenApiConnection"
                            },
                            "Mark_Flow_as_deleted": {
                              "inputs": {
                                "authentication": "@parameters('$authentication')",
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                  "connectionName": "shared_commondataserviceforapps_2",
                                  "operationId": "UpdateRecord"
                                },
                                "parameters": {
                                  "entityName": "admin_flows",
                                  "item/admin_flowdeleted": true,
                                  "item/admin_flowdeletedon": "@if(empty(items('Apply_to_each_Flow_to_get_Flow_Actions_and_mark_Flow_as_deleted')?['admin_flowdeletedon']), variables('today'), if(less(items('Apply_to_each_Flow_to_get_Flow_Actions_and_mark_Flow_as_deleted')?['admin_flowdeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Apply_to_each_Flow_to_get_Flow_Actions_and_mark_Flow_as_deleted')?['admin_flowdeletedon']))",
                                  "recordId": "@items('Apply_to_each_Flow_to_get_Flow_Actions_and_mark_Flow_as_deleted')?['admin_flowid']"
                                },
                                "retryPolicy": {
                                  "count": 10,
                                  "interval": "PT10S",
                                  "type": "exponential"
                                }
                              },
                              "runAfter": {
                                "Apply_to_each_Flow_Action_as_deleted": [
                                  "Succeeded"
                                ]
                              },
                              "type": "OpenApiConnection"
                            }
                          },
                          "foreach": "@outputs('List_Flows_for_the_deleted_Environment')?['body/value']",
                          "runAfter": {
                            "List_Flows_for_the_deleted_Environment": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "List_Flows_for_the_deleted_Environment": {
                          "inputs": {
                            "authentication": "@parameters('$authentication')",
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "connectionName": "shared_commondataserviceforapps_2",
                              "operationId": "ListRecords"
                            },
                            "parameters": {
                              "$filter": "_admin_flowenvironment_value eq '@{body('Mark_Environment_as_deleted')?['admin_environmentid']}'",
                              "$select": "admin_flowid, admin_flowdeletedon",
                              "entityName": "admin_flows"
                            }
                          },
                          "runAfter": {},
                          "runtimeConfiguration": {
                            "paginationPolicy": {
                              "minimumItemCount": 100000
                            }
                          },
                          "type": "OpenApiConnection"
                        }
                      },
                      "runAfter": {
                        "Mark_Environment_as_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "Scope"
                    },
                    "Mark_PVAs_as_deleted_in_COE": {
                      "actions": {
                        "Apply_to_each": {
                          "actions": {
                            "Apply_to_each_Bot_Component_as_deleted": {
                              "actions": {
                                "Mark_Bot_Component_as_Deleted": {
                                  "inputs": {
                                    "authentication": "@parameters('$authentication')",
                                    "host": {
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                      "connectionName": "shared_commondataserviceforapps_2",
                                      "operationId": "UpdateRecord"
                                    },
                                    "parameters": {
                                      "entityName": "admin_pvacomponents",
                                      "item/admin_componentdeleted": true,
                                      "item/admin_componentdeletedon": "@if(empty(items('Apply_to_each_Bot_Component_as_deleted')?['admin_componentdeletedon']), variables('today'), if(less(items('Apply_to_each_Bot_Component_as_deleted')?['admin_componentdeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Apply_to_each_Bot_Component_as_deleted')?['admin_componentdeletedon']))",
                                      "recordId": "@items('Apply_to_each_Bot_Component_as_deleted')?['admin_pvacomponentid']"
                                    },
                                    "retryPolicy": {
                                      "count": 10,
                                      "interval": "PT10S",
                                      "type": "exponential"
                                    }
                                  },
                                  "runAfter": {},
                                  "type": "OpenApiConnection"
                                }
                              },
                              "foreach": "@outputs('List_Bot_Components')?['body/value']",
                              "runAfter": {
                                "List_Bot_Components": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "List_Bot_Components": {
                              "inputs": {
                                "authentication": "@parameters('$authentication')",
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                  "connectionName": "shared_commondataserviceforapps_2",
                                  "operationId": "ListRecords"
                                },
                                "parameters": {
                                  "$filter": "_admin_pvabot_value eq @{items('Apply_to_each')?['admin_pvaid']}",
                                  "$select": "admin_pvacomponentid, admin_componentdeletedon",
                                  "entityName": "admin_pvacomponents"
                                }
                              },
                              "runAfter": {},
                              "runtimeConfiguration": {
                                "paginationPolicy": {
                                  "minimumItemCount": 100000
                                }
                              },
                              "type": "OpenApiConnection"
                            },
                            "Mark_Bot_as_Deleted": {
                              "inputs": {
                                "authentication": "@parameters('$authentication')",
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                  "connectionName": "shared_commondataserviceforapps_2",
                                  "operationId": "UpdateRecord"
                                },
                                "parameters": {
                                  "entityName": "admin_pvas",
                                  "item/admin_pvadeleted": true,
                                  "item/admin_pvadeletedon": "@if(empty(items('Apply_to_each')?['admin_pvadeletedon']), variables('today'), if(less(items('Apply_to_each')?['admin_pvadeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Apply_to_each')?['admin_pvadeletedon']))",
                                  "recordId": "@items('Apply_to_each')?['admin_pvaid']"
                                },
                                "retryPolicy": {
                                  "count": 10,
                                  "interval": "PT10S",
                                  "type": "exponential"
                                }
                              },
                              "runAfter": {
                                "Apply_to_each_Bot_Component_as_deleted": [
                                  "Succeeded"
                                ]
                              },
                              "type": "OpenApiConnection"
                            }
                          },
                          "foreach": "@outputs('List_bots_for_the_deleted_Environment')?['body/value']",
                          "runAfter": {
                            "List_bots_for_the_deleted_Environment": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "List_bots_for_the_deleted_Environment": {
                          "inputs": {
                            "authentication": "@parameters('$authentication')",
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "connectionName": "shared_commondataserviceforapps_2",
                              "operationId": "ListRecords"
                            },
                            "parameters": {
                              "$filter": "_admin_pvaenvironment_value eq '@{body('Mark_Environment_as_deleted')?['admin_environmentid']}' and admin_pvadeleted eq false",
                              "$select": "admin_pvaid, admin_pvadeletedon",
                              "entityName": "admin_pvas"
                            }
                          },
                          "runAfter": {},
                          "runtimeConfiguration": {
                            "paginationPolicy": {
                              "minimumItemCount": 100000
                            }
                          },
                          "type": "OpenApiConnection"
                        }
                      },
                      "runAfter": {
                        "Mark_Environment_as_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "Scope"
                    }
                  },
                  "expression": {
                    "and": [
                      {
                        "equals": [
                          "@length(body('Find_env_in_tenant'))",
                          0
                        ]
                      },
                      {
                        "not": {
                          "equals": [
                            "@items('For_Each_non_del_env_in_CoE')?['admin_environmentsku']",
                            "Default"
                          ]
                        }
                      }
                    ]
                  },
                  "runAfter": {
                    "Find_env_in_tenant": [
                      "Succeeded"
                    ]
                  },
                  "type": "If"
                }
              },
              "foreach": "@outputs('List_CoE_Environments_not_marked_deleted_-_pre_new_deletes')?['body/value']",
              "runAfter": {},
              "type": "Foreach"
            }
          },
          "runAfter": {
            "List_CoE_Environments_not_marked_deleted_-_pre_new_deletes": [
              "Succeeded"
            ]
          },
          "type": "Scope"
        },
        "Newly_Deleted_Flows": {
          "actions": {
            "Loop_envs_3": {
              "actions": {
                "Apply_to_each_flow_in_CoE": {
                  "actions": {
                    "Filter_tenant_flows_to_this_flow_from_CoE": {
                      "inputs": {
                        "from": "@outputs('List_Flows_as_Admin')?['body/value']",
                        "where": "@equals(item()?['name'], items('Apply_to_each_flow_in_CoE')?['admin_flowid'])"
                      },
                      "runAfter": {},
                      "type": "Query"
                    },
                    "If_not_found_in_tenant,_mark_flow_deleted": {
                      "actions": {
                        "List_Flow_Actions_for_This_Flow": {
                          "inputs": {
                            "authentication": "@parameters('$authentication')",
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "connectionName": "shared_commondataserviceforapps_2",
                              "operationId": "ListRecords"
                            },
                            "parameters": {
                              "$filter": "_admin_flow_value eq '@{items('Apply_to_each_flow_in_CoE')?['admin_flowid']}'",
                              "$select": "admin_flowactiondetailid, admin_flowactiondetaildeletedon",
                              "entityName": "admin_flowactiondetails"
                            }
                          },
                          "runAfter": {
                            "Mark_Flow_deleted_": [
                              "Succeeded"
                            ]
                          },
                          "runtimeConfiguration": {
                            "paginationPolicy": {
                              "minimumItemCount": 100000
                            }
                          },
                          "type": "OpenApiConnection"
                        },
                        "Mark_Flow_deleted_": {
                          "inputs": {
                            "authentication": "@parameters('$authentication')",
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "connectionName": "shared_commondataserviceforapps_2",
                              "operationId": "UpdateRecord"
                            },
                            "parameters": {
                              "entityName": "admin_flows",
                              "item/admin_flowdeleted": true,
                              "item/admin_flowdeletedon": "@if(empty(items('Apply_to_each_flow_in_CoE')?['admin_flowdeletedon']), variables('today'), if(less(items('Apply_to_each_flow_in_CoE')?['admin_flowdeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Apply_to_each_flow_in_CoE')?['admin_flowdeletedon']))",
                              "recordId": "@items('Apply_to_each_flow_in_CoE')?['admin_flowid']"
                            },
                            "retryPolicy": {
                              "count": 10,
                              "interval": "PT10S",
                              "type": "exponential"
                            }
                          },
                          "runAfter": {},
                          "type": "OpenApiConnection"
                        },
                        "Mark_each_Flow_Action_Detail_as_deleted": {
                          "actions": {
                            "Mark_Flow_Action_Detail_Deleted": {
                              "inputs": {
                                "authentication": "@parameters('$authentication')",
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                  "connectionName": "shared_commondataserviceforapps_2",
                                  "operationId": "UpdateRecord"
                                },
                                "parameters": {
                                  "entityName": "admin_flowactiondetails",
                                  "item/admin_flowactiondetaildeleted": true,
                                  "item/admin_flowactiondetaildeletedon": "@if(empty(items('Mark_each_Flow_Action_Detail_as_deleted')?['admin_flowactiondetaildeletedon']), variables('today'), if(less(items('Mark_each_Flow_Action_Detail_as_deleted')?['admin_flowactiondetaildeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Mark_each_Flow_Action_Detail_as_deleted')?['admin_flowactiondetaildeletedon']))",
                                  "recordId": "@items('Mark_each_Flow_Action_Detail_as_deleted')?['admin_flowactiondetailid']"
                                },
                                "retryPolicy": {
                                  "count": 10,
                                  "interval": "PT10S",
                                  "type": "exponential"
                                }
                              },
                              "runAfter": {},
                              "type": "OpenApiConnection"
                            }
                          },
                          "foreach": "@outputs('List_Flow_Actions_for_This_Flow')?['body/value']",
                          "runAfter": {
                            "List_Flow_Actions_for_This_Flow": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        }
                      },
                      "expression": {
                        "equals": [
                          "@length(body('Filter_tenant_flows_to_this_flow_from_CoE'))",
                          0
                        ]
                      },
                      "runAfter": {
                        "Filter_tenant_flows_to_this_flow_from_CoE": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    }
                  },
                  "foreach": "@outputs('List_Flow_from_CoE')?['body/value']",
                  "runAfter": {
                    "List_Flows_as_Admin": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "List_Flow_from_CoE": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "_admin_flowenvironment_value eq '@{items('Loop_envs_3')?['admin_environmentid']}' and admin_flowdeleted eq false",
                      "$select": "admin_flowid, admin_flowdeletedon",
                      "entityName": "admin_flows"
                    }
                  },
                  "runAfter": {},
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_Flows_as_Admin": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_flowmanagement",
                      "connectionName": "shared_flowmanagement_1",
                      "operationId": "ListFlowsInEnvironment"
                    },
                    "parameters": {
                      "environmentName": "@items('Loop_envs_3')?['admin_environmentname']"
                    }
                  },
                  "runAfter": {
                    "List_Flow_from_CoE": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_CoE_Environments_not_marked_deleted')?['body/value']",
              "runAfter": {},
              "type": "Foreach"
            }
          },
          "runAfter": {
            "Error_Handling_Model_Driven_Apps": [
              "Succeeded",
              "Skipped"
            ]
          },
          "type": "Scope"
        },
        "Newly_Deleted_Model_Driven_Apps": {
          "actions": {
            "Loop_envs_2": {
              "actions": {
                "MDA_check_if_CDS,_if_not_no_model_driven_apps": {
                  "actions": {
                    "Get_Environment_as_for_appmodules": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_powerplatformforadmins",
                          "connectionName": "shared_powerplatformforadmins",
                          "operationId": "GetSingleEnvironment"
                        },
                        "parameters": {
                          "api-version": "2020-06-01",
                          "environment": "@items('Loop_envs_2')?['admin_environmentname']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    },
                    "Get_this_envs_MDAs_from_appmodules": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataservice",
                          "connectionName": "shared_commondataservice",
                          "operationId": "GetItems_V2"
                        },
                        "parameters": {
                          "dataset": "@items('Loop_envs_2')?['admin_environmentcdsmetadataname']",
                          "table": "appmodules"
                        }
                      },
                      "runAfter": {
                        "List_Model_Driven_Apps_from_CoE": [
                          "Succeeded"
                        ]
                      },
                      "runtimeConfiguration": {
                        "paginationPolicy": {
                          "minimumItemCount": 100000
                        }
                      },
                      "type": "OpenApiConnection"
                    },
                    "List_Model_Driven_Apps_from_CoE": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "ListRecords"
                        },
                        "parameters": {
                          "$filter": "_admin_appenvironment_value eq '@{items('Loop_envs_2')?['admin_environmentid']}' and admin_appdeleted eq false and admin_powerappstype eq 597910001",
                          "$select": "admin_appid, admin_appdeletedon",
                          "entityName": "admin_apps"
                        }
                      },
                      "runAfter": {
                        "ReSet_varNoMDAs": [
                          "Succeeded"
                        ]
                      },
                      "runtimeConfiguration": {
                        "paginationPolicy": {
                          "minimumItemCount": 100000
                        }
                      },
                      "type": "OpenApiConnection"
                    },
                    "ReSet_varNoMDAs": {
                      "inputs": {
                        "name": "varNoMDAs",
                        "value": "@false"
                      },
                      "runAfter": {
                        "Get_Environment_as_for_appmodules": [
                          "Succeeded"
                        ]
                      },
                      "type": "SetVariable"
                    },
                    "Set_varNoMDAs_to_true": {
                      "inputs": {
                        "name": "varNoMDAs",
                        "value": "@true"
                      },
                      "runAfter": {
                        "Get_this_envs_MDAs_from_appmodules": [
                          "Failed"
                        ]
                      },
                      "type": "SetVariable"
                    },
                    "if_no_MDAs,_mark_all_deleted,_else_look_each_up": {
                      "actions": {
                        "Mark_all_MDAs_deleted": {
                          "actions": {
                            "Mark_all_MDAs_deleted_-_this_MDA": {
                              "inputs": {
                                "authentication": "@parameters('$authentication')",
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                  "connectionName": "shared_commondataserviceforapps_2",
                                  "operationId": "UpdateRecord"
                                },
                                "parameters": {
                                  "entityName": "admin_apps",
                                  "item/admin_appdeleted": true,
                                  "item/admin_appdeletedon": "@if(empty(items('Mark_all_MDAs_deleted')?['admin_appdeletedon']), variables('today'), if(less(items('Mark_all_MDAs_deleted')?['admin_appdeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Mark_all_MDAs_deleted')?['admin_appdeletedon']))",
                                  "recordId": "@items('Mark_all_MDAs_deleted')?['admin_appid']"
                                },
                                "retryPolicy": {
                                  "count": 10,
                                  "interval": "PT10S",
                                  "type": "exponential"
                                }
                              },
                              "runAfter": {},
                              "type": "OpenApiConnection"
                            }
                          },
                          "foreach": "@outputs('List_Model_Driven_Apps_from_CoE')?['body/value']",
                          "runAfter": {},
                          "type": "Foreach"
                        }
                      },
                      "else": {
                        "actions": {
                          "Apply_to_each_MDA_in_CoE": {
                            "actions": {
                              "Apply_to_each_Model_Driven_App": {
                                "actions": {
                                  "Parse_Model_Driven_App_JSON": {
                                    "inputs": {
                                      "content": "@items('Apply_to_each_Model_Driven_App')",
                                      "schema": {
                                        "properties": {
                                          "@@odata.etag": {
                                            "type": "string"
                                          },
                                          "@@odata.id": {
                                            "type": "string"
                                          },
                                          "ItemInternalId": {
                                            "type": "string"
                                          },
                                          "_componentstate_label": {
                                            "type": "string"
                                          },
                                          "_createdby_type": {
                                            "type": "string"
                                          },
                                          "_createdby_value": {
                                            "type": "string"
                                          },
                                          "_modifiedby_type": {
                                            "type": "string"
                                          },
                                          "_modifiedby_value": {
                                            "type": "string"
                                          },
                                          "_navigationtype_label": {
                                            "type": "string"
                                          },
                                          "_organizationid_type": {
                                            "type": "string"
                                          },
                                          "_organizationid_value": {
                                            "type": "string"
                                          },
                                          "appmoduleid": {
                                            "type": "string"
                                          },
                                          "appmoduleidunique": {
                                            "type": "string"
                                          },
                                          "componentstate": {
                                            "type": "integer"
                                          },
                                          "createdon": {
                                            "type": "string"
                                          },
                                          "descriptor": {
                                            "type": "string"
                                          },
                                          "formfactor": {
                                            "type": "integer"
                                          },
                                          "isdefault": {
                                            "type": "boolean"
                                          },
                                          "isfeatured": {
                                            "type": "boolean"
                                          },
                                          "ismanaged": {
                                            "type": "boolean"
                                          },
                                          "modifiedon": {
                                            "type": "string"
                                          },
                                          "name": {
                                            "type": "string"
                                          },
                                          "navigationtype": {
                                            "type": "integer"
                                          },
                                          "overwritetime": {
                                            "type": "string"
                                          },
                                          "solutionid": {
                                            "type": "string"
                                          },
                                          "uniquename": {
                                            "type": "string"
                                          },
                                          "versionnumber": {
                                            "type": "integer"
                                          },
                                          "webresourceid": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      }
                                    },
                                    "runAfter": {},
                                    "type": "ParseJson"
                                  },
                                  "See_if_our_current_MDA": {
                                    "actions": {
                                      "Set_varMDAfound_to_true": {
                                        "inputs": {
                                          "name": "varMDAfound",
                                          "value": "@true"
                                        },
                                        "runAfter": {},
                                        "type": "SetVariable"
                                      }
                                    },
                                    "expression": {
                                      "equals": [
                                        "@body('Parse_Model_Driven_App_JSON')?['ItemInternalId']",
                                        "@items('Apply_to_each_MDA_in_CoE')?['admin_appid']"
                                      ]
                                    },
                                    "runAfter": {
                                      "Parse_Model_Driven_App_JSON": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "If"
                                  }
                                },
                                "foreach": "@outputs('Get_this_envs_MDAs_from_appmodules')?['body/value']",
                                "runAfter": {
                                  "ReSet_varMDAfound": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Foreach"
                              },
                              "If_MDA_not_found,_mark_deleted": {
                                "actions": {
                                  "Mark_MDA_Deleted": {
                                    "inputs": {
                                      "authentication": "@parameters('$authentication')",
                                      "host": {
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                        "connectionName": "shared_commondataserviceforapps_2",
                                        "operationId": "UpdateRecord"
                                      },
                                      "parameters": {
                                        "entityName": "admin_apps",
                                        "item/admin_appdeleted": true,
                                        "item/admin_appdeletedon": "@if(empty(items('Apply_to_each_MDA_in_CoE')?['admin_appdeletedon']), variables('today'), if(less(items('Apply_to_each_MDA_in_CoE')?['admin_appdeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Apply_to_each_MDA_in_CoE')?['admin_appdeletedon']))",
                                        "recordId": "@items('Apply_to_each_MDA_in_CoE')?['admin_appid']"
                                      },
                                      "retryPolicy": {
                                        "count": 10,
                                        "interval": "PT10S",
                                        "type": "exponential"
                                      }
                                    },
                                    "runAfter": {},
                                    "type": "OpenApiConnection"
                                  }
                                },
                                "expression": {
                                  "equals": [
                                    "@variables('varMDAfound')",
                                    "@false"
                                  ]
                                },
                                "runAfter": {
                                  "Apply_to_each_Model_Driven_App": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "If"
                              },
                              "ReSet_varMDAfound": {
                                "inputs": {
                                  "name": "varMDAfound",
                                  "value": "@false"
                                },
                                "runAfter": {},
                                "type": "SetVariable"
                              }
                            },
                            "foreach": "@outputs('List_Model_Driven_Apps_from_CoE')?['body/value']",
                            "runAfter": {},
                            "type": "Foreach"
                          }
                        }
                      },
                      "expression": {
                        "equals": [
                          "@variables('varNoMDAs')",
                          "@true"
                        ]
                      },
                      "runAfter": {
                        "Set_varNoMDAs_to_true": [
                          "Succeeded",
                          "Skipped"
                        ]
                      },
                      "type": "If"
                    }
                  },
                  "expression": {
                    "equals": [
                      "@items('Loop_envs_2')?['admin_hascds']",
                      "@true"
                    ]
                  },
                  "runAfter": {},
                  "type": "If"
                }
              },
              "foreach": "@outputs('List_CoE_Environments_not_marked_deleted')?['body/value']",
              "runAfter": {},
              "type": "Foreach"
            }
          },
          "runAfter": {
            "Error_Handling_PVA": [
              "Succeeded",
              "Skipped"
            ]
          },
          "type": "Scope"
        },
        "Newly_Deleted_Power_Virtual_Agents": {
          "actions": {
            "Loop_envs": {
              "actions": {
                "PVA_Check_if_CDS_env._if_not,_no_bots": {
                  "actions": {
                    "Get_Environment_as_for_bots": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_powerplatformforadmins",
                          "connectionName": "shared_powerplatformforadmins",
                          "operationId": "GetSingleEnvironment"
                        },
                        "parameters": {
                          "api-version": "2020-06-01",
                          "environment": "@items('Loop_envs')?['admin_environmentname']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    },
                    "Get_this_envs_PVAs_from_bots": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataservice",
                          "connectionName": "shared_commondataservice",
                          "operationId": "GetItems_V2"
                        },
                        "parameters": {
                          "dataset": "@items('Loop_envs')?['admin_environmentcdsmetadataname']",
                          "table": "bots"
                        }
                      },
                      "runAfter": {
                        "List_Bots_from_CoE": [
                          "Succeeded"
                        ]
                      },
                      "runtimeConfiguration": {
                        "paginationPolicy": {
                          "minimumItemCount": 100000
                        }
                      },
                      "type": "OpenApiConnection"
                    },
                    "List_Bots_from_CoE": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "ListRecords"
                        },
                        "parameters": {
                          "$filter": "_admin_pvaenvironment_value eq '@{items('Loop_envs')?['admin_environmentid']}' and admin_pvadeleted eq false",
                          "$select": "admin_pvaid, admin_pvadeletedon",
                          "entityName": "admin_pvas"
                        }
                      },
                      "runAfter": {
                        "ReSet_varNoBots": [
                          "Succeeded"
                        ]
                      },
                      "runtimeConfiguration": {
                        "paginationPolicy": {
                          "minimumItemCount": 100000
                        }
                      },
                      "type": "OpenApiConnection"
                    },
                    "ReSet_varNoBots": {
                      "inputs": {
                        "name": "varNoBots",
                        "value": "@false"
                      },
                      "runAfter": {
                        "Get_Environment_as_for_bots": [
                          "Succeeded"
                        ]
                      },
                      "type": "SetVariable"
                    },
                    "Set_varNoBots_to_true": {
                      "inputs": {
                        "name": "varNoBots",
                        "value": "@true"
                      },
                      "runAfter": {
                        "Get_this_envs_PVAs_from_bots": [
                          "Failed"
                        ]
                      },
                      "type": "SetVariable"
                    },
                    "if_no_bots,_mark_all_deleted,_else_look_each_up": {
                      "actions": {
                        "Mark_all_bots_deleted": {
                          "actions": {
                            "List_Bot_Components_for_Marking_Delete_-_this_bot": {
                              "inputs": {
                                "authentication": "@parameters('$authentication')",
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                  "connectionName": "shared_commondataserviceforapps_2",
                                  "operationId": "ListRecords"
                                },
                                "parameters": {
                                  "$filter": "_admin_pvabot_value eq @{outputs('Mark_all_bots_deleted_-_this_bot')?['body/admin_pvaid']}",
                                  "$select": "admin_pvacomponentid, admin_componentdeletedon",
                                  "entityName": "admin_pvacomponents"
                                }
                              },
                              "runAfter": {
                                "Mark_all_bots_deleted_-_this_bot": [
                                  "Succeeded"
                                ]
                              },
                              "runtimeConfiguration": {
                                "paginationPolicy": {
                                  "minimumItemCount": 100000
                                }
                              },
                              "type": "OpenApiConnection"
                            },
                            "Loop_Bot_Components_-_this_bot": {
                              "actions": {
                                "Mark_PVA_Component_Deleted_-_this_bot": {
                                  "inputs": {
                                    "authentication": "@parameters('$authentication')",
                                    "host": {
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                      "connectionName": "shared_commondataserviceforapps_2",
                                      "operationId": "UpdateRecord"
                                    },
                                    "parameters": {
                                      "entityName": "admin_pvacomponents",
                                      "item/admin_componentdeleted": true,
                                      "item/admin_componentdeletedon": "@if(empty(items('Loop_Bot_Components_-_this_bot')?['admin_componentdeletedon']), variables('today'), if(less(items('Loop_Bot_Components_-_this_bot')?['admin_componentdeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Loop_Bot_Components_-_this_bot')?['admin_componentdeletedon']))",
                                      "recordId": "@items('Loop_Bot_Components_-_this_bot')?['admin_pvacomponentid']"
                                    },
                                    "retryPolicy": {
                                      "count": 10,
                                      "interval": "PT10S",
                                      "type": "exponential"
                                    }
                                  },
                                  "runAfter": {},
                                  "type": "OpenApiConnection"
                                }
                              },
                              "foreach": "@outputs('List_Bot_Components_for_Marking_Delete_-_this_bot')?['body/value']",
                              "runAfter": {
                                "List_Bot_Components_for_Marking_Delete_-_this_bot": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            },
                            "Mark_all_bots_deleted_-_this_bot": {
                              "inputs": {
                                "authentication": "@parameters('$authentication')",
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                  "connectionName": "shared_commondataserviceforapps_2",
                                  "operationId": "UpdateRecord"
                                },
                                "parameters": {
                                  "entityName": "admin_pvas",
                                  "item/admin_pvadeleted": true,
                                  "item/admin_pvadeletedon": "@if(empty(items('Mark_all_bots_deleted')?['admin_pvadeletedon']), variables('today'), if(less(items('Mark_all_bots_deleted')?['admin_pvadeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Mark_all_bots_deleted')?['admin_pvadeletedon']))",
                                  "recordId": "@items('Mark_all_bots_deleted')?['admin_pvaid']"
                                },
                                "retryPolicy": {
                                  "count": 10,
                                  "interval": "PT10S",
                                  "type": "exponential"
                                }
                              },
                              "runAfter": {},
                              "type": "OpenApiConnection"
                            }
                          },
                          "foreach": "@outputs('List_Bots_from_CoE')?['body/value']",
                          "runAfter": {},
                          "type": "Foreach"
                        }
                      },
                      "else": {
                        "actions": {
                          "Apply_to_each_bot_in_CoE": {
                            "actions": {
                              "Apply_to_each_bot": {
                                "actions": {
                                  "Parse_Bot_JSON": {
                                    "inputs": {
                                      "content": "@items('Apply_to_each_bot')",
                                      "schema": {
                                        "properties": {
                                          "@@odata.etag": {
                                            "type": "string"
                                          },
                                          "@@odata.id": {
                                            "type": "string"
                                          },
                                          "ItemInternalId": {
                                            "type": "string"
                                          },
                                          "_componentstate_label": {
                                            "type": "string"
                                          },
                                          "_createdby_type": {
                                            "type": "string"
                                          },
                                          "_createdby_value": {
                                            "type": "string"
                                          },
                                          "_language_label": {
                                            "type": "string"
                                          },
                                          "_modifiedby_type": {
                                            "type": "string"
                                          },
                                          "_modifiedby_value": {
                                            "type": "string"
                                          },
                                          "_ownerid_type": {
                                            "type": "string"
                                          },
                                          "_ownerid_value": {
                                            "type": "string"
                                          },
                                          "_owningbusinessunit_type": {
                                            "type": "string"
                                          },
                                          "_owningbusinessunit_value": {
                                            "type": "string"
                                          },
                                          "_owningteam_value": {},
                                          "_statecode_label": {
                                            "type": "string"
                                          },
                                          "_statuscode_label": {
                                            "type": "string"
                                          },
                                          "botid": {
                                            "type": "string"
                                          },
                                          "componentidunique": {
                                            "type": "string"
                                          },
                                          "componentstate": {
                                            "type": "integer"
                                          },
                                          "createdon": {
                                            "type": "string"
                                          },
                                          "importsequencenumber": {},
                                          "iscustomizable": {
                                            "type": "boolean"
                                          },
                                          "ismanaged": {
                                            "type": "boolean"
                                          },
                                          "language": {
                                            "type": "integer"
                                          },
                                          "modifiedon": {
                                            "type": "string"
                                          },
                                          "name": {
                                            "type": "string"
                                          },
                                          "overriddencreatedon": {},
                                          "overwritetime": {
                                            "type": "string"
                                          },
                                          "schemaname": {
                                            "type": "string"
                                          },
                                          "solutionid": {
                                            "type": "string"
                                          },
                                          "statecode": {
                                            "type": "integer"
                                          },
                                          "statuscode": {
                                            "type": "integer"
                                          },
                                          "timezoneruleversionnumber": {},
                                          "utcconversiontimezonecode": {},
                                          "versionnumber": {
                                            "type": "integer"
                                          }
                                        },
                                        "type": "object"
                                      }
                                    },
                                    "runAfter": {},
                                    "type": "ParseJson"
                                  },
                                  "See_if_our_current_bot": {
                                    "actions": {
                                      "Set_varBotFound_to_true": {
                                        "inputs": {
                                          "name": "varBotFound",
                                          "value": "@true"
                                        },
                                        "runAfter": {},
                                        "type": "SetVariable"
                                      }
                                    },
                                    "expression": {
                                      "equals": [
                                        "@body('Parse_Bot_JSON')?['botid']",
                                        "@items('Apply_to_each_bot_in_CoE')?['admin_pvaid']"
                                      ]
                                    },
                                    "runAfter": {
                                      "Parse_Bot_JSON": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "If"
                                  }
                                },
                                "foreach": "@outputs('Get_this_envs_PVAs_from_bots')?['body/value']",
                                "runAfter": {
                                  "ReSet_varBotFound": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Foreach"
                              },
                              "If_bot_not_found,_mark_deleted": {
                                "actions": {
                                  "List_Bot_Components_for_Marking_Delete": {
                                    "inputs": {
                                      "authentication": "@parameters('$authentication')",
                                      "host": {
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                        "connectionName": "shared_commondataserviceforapps_2",
                                        "operationId": "ListRecords"
                                      },
                                      "parameters": {
                                        "$filter": "_admin_pvabot_value eq @{body('Mark_Bot_Deleted')?['admin_pvaid']}",
                                        "$select": "admin_pvacomponentid, admin_componentdeletedon",
                                        "entityName": "admin_pvacomponents"
                                      }
                                    },
                                    "runAfter": {
                                      "Mark_Bot_Deleted": [
                                        "Succeeded"
                                      ]
                                    },
                                    "runtimeConfiguration": {
                                      "paginationPolicy": {
                                        "minimumItemCount": 100000
                                      }
                                    },
                                    "type": "OpenApiConnection"
                                  },
                                  "Loop_Bot_Components": {
                                    "actions": {
                                      "Mark_PVA_Component_Deleted": {
                                        "inputs": {
                                          "authentication": "@parameters('$authentication')",
                                          "host": {
                                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                            "connectionName": "shared_commondataserviceforapps_2",
                                            "operationId": "UpdateRecord"
                                          },
                                          "parameters": {
                                            "entityName": "admin_pvacomponents",
                                            "item/admin_componentdeleted": true,
                                            "item/admin_componentdeletedon": "@if(empty(items('Loop_Bot_Components')?['admin_componentdeletedon']), variables('today'), if(less(items('Loop_Bot_Components')?['admin_componentdeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Loop_Bot_Components')?['admin_componentdeletedon']))",
                                            "recordId": "@items('Loop_Bot_Components')?['admin_pvacomponentid']"
                                          },
                                          "retryPolicy": {
                                            "count": 10,
                                            "interval": "PT10S",
                                            "type": "exponential"
                                          }
                                        },
                                        "runAfter": {},
                                        "type": "OpenApiConnection"
                                      }
                                    },
                                    "foreach": "@outputs('List_Bot_Components_for_Marking_Delete')?['body/value']",
                                    "runAfter": {
                                      "List_Bot_Components_for_Marking_Delete": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "Foreach"
                                  },
                                  "Mark_Bot_Deleted": {
                                    "inputs": {
                                      "authentication": "@parameters('$authentication')",
                                      "host": {
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                        "connectionName": "shared_commondataserviceforapps_2",
                                        "operationId": "UpdateRecord"
                                      },
                                      "parameters": {
                                        "entityName": "admin_pvas",
                                        "item/admin_pvadeleted": true,
                                        "item/admin_pvadeletedon": "@if(empty(items('Apply_to_each_bot_in_CoE')?['admin_pvadeletedon']), variables('today'), if(less(items('Apply_to_each_bot_in_CoE')?['admin_pvadeletedon'], addDays(utcNow(), -5000)), variables('today'), items('Apply_to_each_bot_in_CoE')?['admin_pvadeletedon']))",
                                        "recordId": "@items('Apply_to_each_bot_in_CoE')?['admin_pvaid']"
                                      },
                                      "retryPolicy": {
                                        "count": 10,
                                        "interval": "PT10S",
                                        "type": "exponential"
                                      }
                                    },
                                    "runAfter": {},
                                    "type": "OpenApiConnection"
                                  }
                                },
                                "expression": {
                                  "equals": [
                                    "@variables('varBotFound')",
                                    "@false"
                                  ]
                                },
                                "runAfter": {
                                  "Apply_to_each_bot": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "If"
                              },
                              "ReSet_varBotFound": {
                                "inputs": {
                                  "name": "varBotFound",
                                  "value": "@false"
                                },
                                "runAfter": {},
                                "type": "SetVariable"
                              }
                            },
                            "foreach": "@outputs('List_Bots_from_CoE')?['body/value']",
                            "runAfter": {},
                            "type": "Foreach"
                          }
                        }
                      },
                      "expression": {
                        "equals": [
                          "@variables('varNoBots')",
                          "@true"
                        ]
                      },
                      "runAfter": {
                        "Set_varNoBots_to_true": [
                          "Succeeded",
                          "Skipped"
                        ]
                      },
                      "type": "If"
                    }
                  },
                  "expression": {
                    "equals": [
                      "@items('Loop_envs')?['admin_hascds']",
                      "@true"
                    ]
                  },
                  "runAfter": {},
                  "type": "If"
                }
              },
              "foreach": "@outputs('List_CoE_Environments_not_marked_deleted')?['body/value']",
              "runAfter": {},
              "type": "Foreach"
            }
          },
          "runAfter": {
            "List_CoE_Environments_not_marked_deleted": [
              "Succeeded"
            ]
          },
          "type": "Scope"
        },
        "See_if_anything_failed_above": {
          "actions": {
            "Terminate_Flow_with_Failure": {
              "inputs": {
                "runError": {
                  "code": "500",
                  "message": "Flow failed in at least one scope above"
                },
                "runStatus": "Failed"
              },
              "runAfter": {},
              "type": "Terminate"
            }
          },
          "expression": {
            "equals": [
              "@variables('failureOccurred')",
              "@true"
            ]
          },
          "runAfter": {
            "Deletes_items_from_CoE_": [
              "Succeeded"
            ]
          },
          "type": "If"
        },
        "Unmark_Objects_as_Deleted": {
          "actions": {
            "List_Apps_Marked_Deleted": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "admin_appdeleted eq true",
                  "$select": "admin_appid",
                  "entityName": "admin_apps"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {},
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            },
            "List_Envs_Marked_Deleted": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "admin_environmentdeleted eq true",
                  "$select": "admin_environmentid",
                  "entityName": "admin_environments"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {
                "Unmark_All_PVA_Components": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            },
            "List_Flow_Action_Details_Marked_Deleted": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "admin_flowactiondetaildeleted eq true",
                  "$select": "admin_flowactiondetailid",
                  "entityName": "admin_flowactiondetails"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {
                "Unmark_All_Flows": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            },
            "List_Flows_Marked_Deleted": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "admin_flowdeleted eq true",
                  "$select": "admin_flowid",
                  "entityName": "admin_flows"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {
                "Unmark_All_Apps": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            },
            "List_PVA_Components_Deleted": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "admin_componentdeleted eq true",
                  "$select": "admin_pvacomponentid",
                  "entityName": "admin_pvacomponents"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {
                "Unmark_All_PVAs": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            },
            "List_PVAs_Marked_Deleted": {
              "inputs": {
                "authentication": "@parameters('$authentication')",
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "connectionName": "shared_commondataserviceforapps_2",
                  "operationId": "ListRecords"
                },
                "parameters": {
                  "$filter": "admin_pvadeleted eq true",
                  "$select": "admin_pvaid",
                  "entityName": "admin_pvas"
                },
                "retryPolicy": {
                  "count": 10,
                  "interval": "PT10S",
                  "type": "exponential"
                }
              },
              "runAfter": {
                "Unmark_All_Flows_Action_Details": [
                  "Succeeded"
                ]
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              },
              "type": "OpenApiConnection"
            },
            "Unmark_All_Apps": {
              "actions": {
                "Unmark_App": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "UpdateRecord"
                    },
                    "parameters": {
                      "entityName": "admin_apps",
                      "item/admin_appdeleted": false,
                      "recordId": "@items('Unmark_All_Apps')?['admin_appid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_Apps_Marked_Deleted')?['body/value']",
              "runAfter": {
                "List_Apps_Marked_Deleted": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Unmark_All_Envs": {
              "actions": {
                "Unmark_Env": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "UpdateRecord"
                    },
                    "parameters": {
                      "entityName": "admin_environments",
                      "item/admin_environmentdeleted": false,
                      "recordId": "@items('Unmark_All_Envs')?['admin_environmentid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_Envs_Marked_Deleted')?['body/value']",
              "runAfter": {
                "List_Envs_Marked_Deleted": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Unmark_All_Flows": {
              "actions": {
                "Unmark_Flow": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "UpdateRecord"
                    },
                    "parameters": {
                      "entityName": "admin_flows",
                      "item/admin_flowdeleted": false,
                      "recordId": "@items('Unmark_All_Flows')?['admin_flowid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_Flows_Marked_Deleted')?['body/value']",
              "runAfter": {
                "List_Flows_Marked_Deleted": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Unmark_All_Flows_Action_Details": {
              "actions": {
                "Unmark_Flow_Action_Detail": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "UpdateRecord"
                    },
                    "parameters": {
                      "entityName": "admin_flowactiondetails",
                      "item/admin_flowactiondetaildeleted": false,
                      "recordId": "@items('Unmark_All_Flows_Action_Details')?['admin_flowactiondetailid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_Flow_Action_Details_Marked_Deleted')?['body/value']",
              "runAfter": {
                "List_Flow_Action_Details_Marked_Deleted": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Unmark_All_PVA_Components": {
              "actions": {
                "Unmark_PVA_Component": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "UpdateRecord"
                    },
                    "parameters": {
                      "entityName": "admin_pvacomponents",
                      "item/admin_componentdeleted": false,
                      "recordId": "@items('Unmark_All_PVA_Components')?['admin_pvacomponentid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_PVA_Components_Deleted')?['body/value']",
              "runAfter": {
                "List_PVA_Components_Deleted": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            },
            "Unmark_All_PVAs": {
              "actions": {
                "Unmark_PVA": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "UpdateRecord"
                    },
                    "parameters": {
                      "entityName": "admin_pvas",
                      "item/admin_pvadeleted": false,
                      "recordId": "@items('Unmark_All_PVAs')?['admin_pvaid']"
                    },
                    "retryPolicy": {
                      "count": 10,
                      "interval": "PT10S",
                      "type": "exponential"
                    }
                  },
                  "runAfter": {},
                  "type": "OpenApiConnection"
                }
              },
              "foreach": "@outputs('List_PVAs_Marked_Deleted')?['body/value']",
              "runAfter": {
                "List_PVAs_Marked_Deleted": [
                  "Succeeded"
                ]
              },
              "type": "Foreach"
            }
          },
          "runAfter": {
            "Delete_Bad_Data": [
              "Succeeded"
            ]
          },
          "type": "Scope"
        }
      },
      "contentVersion": "1.0.0.0",
      "outputs": {},
      "parameters": {
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        },
        "Also Delete From CoE": {
          "defaultValue": "no",
          "metadata": {
            "description": "when we run \"Admin | Sync Template v2 (Check Deleted)\", delete the items from CoE (yes) or just mark deleted (no)",
            "schemaName": "admin_DeleteFromCoE"
          },
          "type": "String"
        },
        "Power Automate Environment Variable": {
          "defaultValue": "https://us.flow.microsoft.com/manage/environments/",
          "metadata": {
            "description": "Environment, including geographic location, for Power Automate - for example https://us.flow.microsoft.com/manage/environments/ for US environments",
            "schemaName": "admin_PowerAutomateEnvironmentVariable"
          },
          "type": "String"
        }
      },
      "triggers": {
        "Recurrence": {
          "recurrence": {
            "frequency": "Week",
            "interval": 2,
            "schedule": {
              "weekDays": [
                "Saturday"
              ]
            }
          },
          "type": "Recurrence"
        }
      }
    }
  },
  "schemaVersion": "1.0.0.0"
}
