{
  "properties": {
    "connectionReferences": {
      "shared_commondataserviceforapps": {
        "api": {
          "name": "shared_commondataserviceforapps"
        },
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreDataverse2"
        },
        "impersonation": {},
        "runtimeSource": "embedded"
      },
      "shared_powerplatformforadmins_1": {
        "api": {
          "name": "shared_powerplatformforadmins"
        },
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerPlatformforAdmins"
        },
        "runtimeSource": "embedded"
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "actions": {
        "Deleted_Objects_in_Existing_Environments": {
          "actions": {
            "Apply_to_each_environment": {
              "actions": {
                "Call_Canvas_Helper_-_check_deleted": {
                  "inputs": {
                    "body": {
                      "boolean": true,
                      "boolean_1": "@variables('DeleteFromCoE')",
                      "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                      "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                    },
                    "host": {
                      "workflowReferenceName": "2e6ae3e2-8afb-eb11-94ef-002248237d7d"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "5010d1c4-babf-42c8-a935-9a9dbbd97acc"
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "type": "Workflow"
                },
                "Call_Cloud_Flows_Helper_-_check_deleted": {
                  "inputs": {
                    "body": {
                      "boolean": true,
                      "boolean_1": "@variables('DeleteFromCoE')",
                      "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                      "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                    },
                    "host": {
                      "workflowReferenceName": "6bd20554-9bfb-eb11-94ef-002248237d7d"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "c692c61f-9768-49d3-b9a0-03bdebe38c99"
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "type": "Workflow"
                },
                "Call_Custom_Connector_Helper_-_check_deleted": {
                  "inputs": {
                    "body": {
                      "boolean": true,
                      "boolean_1": "@variables('DeleteFromCoE')",
                      "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                      "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                    },
                    "host": {
                      "workflowReferenceName": "b3f4f0d4-cb1b-ec11-b6e6-00224828c7b0"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "11cfe8d8-8e77-41af-b767-2498fea9e0ff"
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "type": "Workflow"
                },
                "Call_each_object_type_helper_for_this_environment": {
                  "inputs": "Call each object type helper for this environment",
                  "metadata": {
                    "operationMetadataId": "7a969d84-fb74-428a-a3d0-2f4bdfb17a58"
                  },
                  "runAfter": {},
                  "type": "Compose"
                },
                "Check_if_Teams_-_MDA": {
                  "actions": {
                    "Call_MDA_Helper_-_check_deleted": {
                      "inputs": {
                        "body": {
                          "boolean": true,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                        },
                        "host": {
                          "workflowReferenceName": "9a470548-58fc-eb11-94ef-002248237f74"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "147f2b96-7c9a-41e6-840a-f35e1ea705e1"
                      },
                      "runAfter": {},
                      "type": "Workflow"
                    },
                    "check_return_-_Call_MDA_Helper_-_check_deleted": {
                      "actions": {
                        "Append_Failure_-_MDA": {
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                              "obj type": "MDAs",
                              "which loop": "existing envts"
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "756c9cc1-a414-49e3-88db-980e3f8f5e60"
                          },
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_MDA_Helper_-_check_deleted": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToArrayVariable"
                        },
                        "set_failure_occurred_true_-_Call_MDA_Helper_-_check_deleted": {
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          },
                          "metadata": {
                            "operationMetadataId": "85a9ca51-9722-43f6-b14c-2c14b758127c"
                          },
                          "runAfter": {},
                          "type": "SetVariable"
                        }
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@outputs('Call_MDA_Helper_-_check_deleted')?['Body']?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "2f62ac30-624e-499f-8dc7-64a20ce0a483"
                      },
                      "runAfter": {
                        "Call_MDA_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    }
                  },
                  "expression": {
                    "not": {
                      "equals": [
                        "@items('Apply_to_each_environment')?['admin_environmentsku']",
                        "Teams"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "a9134bda-66f7-4a09-9bab-47cf59ab4cd1"
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "type": "If"
                },
                "Check_if_Teams_-_PVA": {
                  "actions": {
                    "Call_PVA_Helper_-_check_deleted": {
                      "inputs": {
                        "body": {
                          "boolean": true,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                        },
                        "host": {
                          "workflowReferenceName": "ffd82928-64fc-eb11-94ef-002248237d7d"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "77bc805d-53b8-4caf-93f9-4995956df05f"
                      },
                      "runAfter": {},
                      "type": "Workflow"
                    },
                    "check_return_-_Call_PVA_Helper_-_check_deleted": {
                      "actions": {
                        "Append_Failure_-_PVA": {
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                              "obj type": "PVAs",
                              "which loop": "existing envts"
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "408ee11c-e8cb-44ea-8957-ff9ad19b77ff"
                          },
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_PVA_Helper_-_check_deleted": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToArrayVariable"
                        },
                        "set_failure_occurred_true_-_Call_PVA_Helper_-_check_deleted": {
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          },
                          "metadata": {
                            "operationMetadataId": "8bcd2d79-ec37-443a-82e5-204b2967b325"
                          },
                          "runAfter": {},
                          "type": "SetVariable"
                        }
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@outputs('Call_PVA_Helper_-_check_deleted')?['Body']?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "3b7a2e8e-3de6-4818-878d-667cb41b2730"
                      },
                      "runAfter": {
                        "Call_PVA_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    }
                  },
                  "expression": {
                    "not": {
                      "equals": [
                        "@items('Apply_to_each_environment')?['admin_environmentsku']",
                        "Teams"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "e5c640ae-2971-4605-91e4-15796c334f5d"
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "type": "If"
                },
                "check_return_-_Call_Canvas_Helper_-_check_deleted": {
                  "actions": {
                    "Append_Failure_-_Canvas": {
                      "inputs": {
                        "name": "varFailures",
                        "value": {
                          "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "obj type": "canvas",
                          "which loop": "existing envts"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                      },
                      "runAfter": {
                        "set_failure_occurred_true_-_Call_Canvas_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "AppendToArrayVariable"
                    },
                    "set_failure_occurred_true_-_Call_Canvas_Helper_-_check_deleted": {
                      "inputs": {
                        "name": "failureOccurred",
                        "value": "@true"
                      },
                      "metadata": {
                        "operationMetadataId": "645cc266-88ba-4fa1-b020-4550c29738cf"
                      },
                      "runAfter": {},
                      "type": "SetVariable"
                    }
                  },
                  "expression": {
                    "not": {
                      "equals": [
                        "@outputs('Call_Canvas_Helper_-_check_deleted')?['Body']?['thereturnvalue']",
                        "pass"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "62c8a103-239a-4eb3-97cf-db4372a9aad9"
                  },
                  "runAfter": {
                    "Call_Canvas_Helper_-_check_deleted": [
                      "Succeeded"
                    ]
                  },
                  "type": "If"
                },
                "check_return_-_Call_Cloud_Flows_Helper_-_check_deleted": {
                  "actions": {
                    "Append_Failure_-_Flows": {
                      "inputs": {
                        "name": "varFailures",
                        "value": {
                          "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "obj type": "flows",
                          "which loop": "existing envts"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "9c5faad1-016d-44d3-940c-2a55b94355e4"
                      },
                      "runAfter": {
                        "set_failure_occurred_true_-_Call_Cloud_Flows_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "AppendToArrayVariable"
                    },
                    "set_failure_occurred_true_-_Call_Cloud_Flows_Helper_-_check_deleted": {
                      "inputs": {
                        "name": "failureOccurred",
                        "value": "@true"
                      },
                      "metadata": {
                        "operationMetadataId": "b2869541-7cf9-4386-bc04-d131bcf15483"
                      },
                      "runAfter": {},
                      "type": "SetVariable"
                    }
                  },
                  "expression": {
                    "not": {
                      "equals": [
                        "@outputs('Call_Cloud_Flows_Helper_-_check_deleted')?['Body']?['thereturnvalue']",
                        "pass"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "d741b453-f24e-4e36-b42e-bb017acba80b"
                  },
                  "runAfter": {
                    "Call_Cloud_Flows_Helper_-_check_deleted": [
                      "Succeeded"
                    ]
                  },
                  "type": "If"
                },
                "check_return_-_Call_Custom_Connector_Helper_-_check_deleted": {
                  "actions": {
                    "Append_Failure_-_Custom_Connectors": {
                      "inputs": {
                        "name": "varFailures",
                        "value": {
                          "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "obj type": "custom connectors",
                          "which loop": "existing envts"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "02851b83-6aca-40d5-b1dd-d894974e1375"
                      },
                      "runAfter": {
                        "set_failure_occurred_true_-_Call_Custom_Connector_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "AppendToArrayVariable"
                    },
                    "set_failure_occurred_true_-_Call_Custom_Connector_Helper_-_check_deleted": {
                      "inputs": {
                        "name": "failureOccurred",
                        "value": "@true"
                      },
                      "metadata": {
                        "operationMetadataId": "2870d86a-a09d-40fb-b608-b52379f4a195"
                      },
                      "runAfter": {},
                      "type": "SetVariable"
                    }
                  },
                  "expression": {
                    "not": {
                      "equals": [
                        "@outputs('Call_Custom_Connector_Helper_-_check_deleted')?['Body']?['thereturnvalue']",
                        "pass"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "2b6b2a42-755c-46dc-9bb4-d1449d31872b"
                  },
                  "runAfter": {
                    "Call_Custom_Connector_Helper_-_check_deleted": [
                      "Succeeded"
                    ]
                  },
                  "type": "If"
                }
              },
              "foreach": "@outputs('List_CoE_Environments_not_marked_deleted')?['body/value']",
              "metadata": {
                "operationMetadataId": "1806028d-8aa4-4ac9-bb6e-81d76c6c60de"
              },
              "runAfter": {},
              "runtimeConfiguration": {
                "concurrency": {
                  "repetitions": 50
                }
              },
              "type": "Foreach"
            }
          },
          "metadata": {
            "operationMetadataId": "d9ec4c6e-66c0-4f2a-884c-406034f46edd"
          },
          "runAfter": {
            "List_CoE_Environments_not_marked_deleted": [
              "Succeeded"
            ]
          },
          "type": "Scope"
        },
        "Deletes_old_items_from_CoE_inventory": {
          "actions": {
            "Check_if_they_want_to_delete_from_CoE": {
              "actions": {
                "Delete_Each_App": {
                  "actions": {
                    "Delete_App": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_apps",
                          "recordId": "@items('Delete_Each_App')?['admin_appid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "54d6934e-e2e6-46c8-93b9-c869882b00e4"
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_Apps_Marked_Deleted_To_Delete')?['body/value']",
                  "metadata": {
                    "operationMetadataId": "992de43a-1ac0-4f7b-8c46-98740496eaf9"
                  },
                  "runAfter": {
                    "List_Apps_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_Environment": {
                  "actions": {
                    "Delete_Environment": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_environments",
                          "recordId": "@items('Delete_Each_Environment')?['admin_environmentid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "2220c6f4-76a0-49d6-bd1f-6d50b3f5ffdb"
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_Envts_Marked_Deleted_To_Delete')?['body/value']",
                  "metadata": {
                    "operationMetadataId": "20c570c3-b601-4fc2-b69f-4abdf1d6b459"
                  },
                  "runAfter": {
                    "List_Envts_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_Flow": {
                  "actions": {
                    "Delete_Flow": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_flows",
                          "recordId": "@items('Delete_Each_Flow')?['admin_flowid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "65d87cb0-1ef5-4cde-9805-8da80102b6a7"
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_Flows_Marked_Deleted_To_Delete')?['body/value']",
                  "metadata": {
                    "operationMetadataId": "c87fb516-ffa5-4e82-84ad-a29974070886"
                  },
                  "runAfter": {
                    "List_Flows_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_Flow_Action": {
                  "actions": {
                    "Delete_Flow_Action": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_flowactiondetails",
                          "recordId": "@items('Delete_Each_Flow_Action')?['admin_flowactiondetailid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "75984ee3-9717-4d38-99b4-ecc07de1fae5"
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_Flow_Actions_Marked_Deleted_To_Delete')?['body/value']",
                  "metadata": {
                    "operationMetadataId": "bcb382f6-cc7e-4e95-956c-06b8855e5a98"
                  },
                  "runAfter": {
                    "List_Flow_Actions_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA": {
                  "actions": {
                    "Delete_PVA": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_pvas",
                          "recordId": "@items('Delete_Each_PVA')?['admin_pvaid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "0b45cc2f-97a8-4ddc-bcf2-d0850204cf86"
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_PVAs_Marked_Deleted_To_Delete')?['body/value']",
                  "metadata": {
                    "operationMetadataId": "7c2652c6-ec6f-4179-b52e-5025f50ed552"
                  },
                  "runAfter": {
                    "List_PVAs_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA_Component": {
                  "actions": {
                    "Delete_PVA_Component": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_pvacomponents",
                          "recordId": "@items('Delete_Each_PVA_Component')?['admin_pvacomponentid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "ec5e425a-0936-4495-add5-ef1bcc04f93a"
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_PVA_Components_Marked_Deleted_To_Delete')?['body/value']",
                  "metadata": {
                    "operationMetadataId": "3cfe3381-c3c6-40c5-bd66-b4ff1a3a300f"
                  },
                  "runAfter": {
                    "List_PVA_Components_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA_Component_Flow_1": {
                  "actions": {
                    "Delete_PVA_Component_Flow_1": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_pvacomponentflowlookups",
                          "recordId": "@items('Delete_Each_PVA_Component_Flow_1')?['admin_pvacomponentflowlookupid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "bd46c763-b1a8-4e69-986b-160ad04ce2bc"
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_PVA_Component_Flows_with_Missing_Flow')?['body/value']",
                  "metadata": {
                    "operationMetadataId": "a1f8b25e-fec7-4b1f-ad8d-1870b894a439"
                  },
                  "runAfter": {
                    "List_PVA_Component_Flows_with_Missing_Flow": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA_Component_Flow_2": {
                  "actions": {
                    "Delete_PVA_Component_Flow_2": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord"
                        },
                        "parameters": {
                          "entityName": "admin_pvacomponentflowlookups",
                          "recordId": "@items('Delete_Each_PVA_Component_Flow_2')?['admin_pvacomponentflowlookupid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "ef1726c2-1f6f-4aad-8c4e-7036080b96a2"
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    }
                  },
                  "foreach": "@outputs('List_PVA_Component_Flows_with_Missing_PVA_Component')?['body/value']",
                  "metadata": {
                    "operationMetadataId": "4798f546-ddb7-4449-80e8-f7346d102751"
                  },
                  "runAfter": {
                    "List_PVA_Component_Flows_with_Missing_PVA_Component": [
                      "Succeeded"
                    ]
                  },
                  "type": "Foreach"
                },
                "List_Apps_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_appdeleted eq true",
                      "$select": "admin_appid",
                      "entityName": "admin_apps"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "302736ff-0ca3-438a-9841-1f095783dad6"
                  },
                  "runAfter": {},
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_Envts_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_environmentdeleted eq true",
                      "$select": "admin_environmentid",
                      "entityName": "admin_environments"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "01d667b6-6242-4f0a-b6de-5b99f83f9dbd"
                  },
                  "runAfter": {
                    "Delete_Each_PVA_Component_Flow_2": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_Flow_Actions_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_flowactiondetaildeleted eq true",
                      "$select": "admin_flowactiondetailid",
                      "entityName": "admin_flowactiondetails"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "63bf55ff-77d2-4957-b437-bddd1ac1d9f6"
                  },
                  "runAfter": {
                    "Delete_Each_Flow": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_Flows_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_flowdeleted eq true",
                      "$select": "admin_flowid",
                      "entityName": "admin_flows"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "61b9b48f-499a-4e03-b70a-ba50a2c10df3"
                  },
                  "runAfter": {
                    "Delete_Each_App": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_PVA_Component_Flows_with_Missing_Flow": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "_admin_flow_value eq null",
                      "$select": "admin_pvacomponentflowlookupid",
                      "entityName": "admin_pvacomponentflowlookups"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "f21241d5-7052-4864-95f3-aa3fc61a6c4b"
                  },
                  "runAfter": {
                    "Delete_Each_PVA_Component": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_PVA_Component_Flows_with_Missing_PVA_Component": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "_admin_pvacomponent_value eq null",
                      "$select": "admin_pvacomponentflowlookupid",
                      "entityName": "admin_pvacomponentflowlookups"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "0dc70cf3-302e-4db4-9a22-8d2bdda7ea75"
                  },
                  "runAfter": {
                    "Delete_Each_PVA_Component_Flow_1": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_PVA_Components_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_componentdeleted eq true",
                      "$select": "admin_pvacomponentid",
                      "entityName": "admin_pvacomponents"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "2295b62f-976f-41a3-ad17-559fd89aee9d"
                  },
                  "runAfter": {
                    "Delete_Each_PVA": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                },
                "List_PVAs_Marked_Deleted_To_Delete": {
                  "inputs": {
                    "authentication": "@parameters('$authentication')",
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords"
                    },
                    "parameters": {
                      "$filter": "admin_pvadeleted eq true",
                      "$select": "admin_pvaid",
                      "entityName": "admin_pvas"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "3da35011-b120-4432-9414-a6144b42be2a"
                  },
                  "runAfter": {
                    "Delete_Each_Flow_Action": [
                      "Succeeded"
                    ]
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "type": "OpenApiConnection"
                }
              },
              "expression": {
                "equals": [
                  "@variables('DeleteFromCoE')",
                  ""
                ]
              },
              "metadata": {
                "operationMetadataId": "8e34a6de-0863-44b0-8ef3-bd5d5ae66d7c"
              },
              "runAfter": {},
              "type": "If"
            }
          },
          "description": "In the event the env var changes, we want to clean the inventory",
          "metadata": {
            "operationMetadataId": "2f5b781f-79ef-4856-8fd4-c3aa6372445c"
          },
          "runAfter": {
            "Initialize_varFailures": [
              "Succeeded"
            ]
          },
          "type": "Scope"
        },
        "Get_Environments": {
          "inputs": {
            "authentication": "@parameters('$authentication')",
            "host": {
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_powerplatformforadmins",
              "connectionName": "shared_powerplatformforadmins_1",
              "operationId": "Get-AdminEnvironment"
            },
            "parameters": {
              "api-version": "2020-09-01"
            },
            "retryPolicy": {
              "count": 10,
              "interval": "PT10S",
              "type": "exponential"
            }
          },
          "metadata": {
            "operationMetadataId": "df9ec811-25ed-4574-a7be-c4537561ea3b"
          },
          "runAfter": {
            "Deletes_old_items_from_CoE_inventory": [
              "Succeeded"
            ]
          },
          "runtimeConfiguration": {
            "paginationPolicy": {
              "minimumItemCount": 100000
            }
          },
          "type": "OpenApiConnection"
        },
        "Initialize_DeleteFromCoE": {
          "inputs": {
            "variables": [
              {
                "name": "DeleteFromCoE",
                "type": "boolean",
                "value": "@if(equals(tolower(parameters('Also Delete From CoE')), 'yes'), true, false)"
              }
            ]
          },
          "metadata": {
            "operationMetadataId": "86218be8-8f1e-486b-ac72-d181fd12591f"
          },
          "runAfter": {
            "Initialize_varDeleteFromCoE": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_GuidFound": {
          "inputs": {
            "variables": [
              {
                "name": "GuidFound",
                "type": "string"
              }
            ]
          },
          "metadata": {
            "operationMetadataId": "0a801dc1-674a-418b-b00b-18177b68d938"
          },
          "runAfter": {
            "Initialize_failureOccurred": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_failureOccurred": {
          "inputs": {
            "variables": [
              {
                "name": "failureOccurred",
                "type": "boolean",
                "value": "@false"
              }
            ]
          },
          "metadata": {
            "operationMetadataId": "43d91629-f6a2-4421-bf15-487cb255a233"
          },
          "runAfter": {},
          "type": "InitializeVariable"
        },
        "Initialize_systemMaker": {
          "description": "SYSTEM maker is used to identify the owner record for Environments generated by the system, such as the default environment",
          "inputs": {
            "variables": [
              {
                "name": " systemMaker",
                "type": "string"
              }
            ]
          },
          "metadata": {
            "operationMetadataId": "9d8982a2-6a67-4326-9ee9-3f1da51e5a8e"
          },
          "runAfter": {
            "Initialize_GuidFound": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_varDeleteFromCoE": {
          "inputs": {
            "variables": [
              {
                "name": "varDeleteFromCoE",
                "type": "string",
                "value": "@parameters('Also Delete From CoE')"
              }
            ]
          },
          "metadata": {
            "operationMetadataId": "bb64281e-bb45-4630-a482-f4f748c56824"
          },
          "runAfter": {
            "Initialize_variable_flowEnvironment": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_varFailures": {
          "inputs": {
            "variables": [
              {
                "name": "varFailures",
                "type": "array"
              }
            ]
          },
          "metadata": {
            "operationMetadataId": "9ea65c75-ed5d-4618-9000-c973f7dbc405"
          },
          "runAfter": {
            "Initialize_varNoBots": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_varNoBots": {
          "inputs": {
            "variables": [
              {
                "name": "varNoBots",
                "type": "boolean",
                "value": "@false"
              }
            ]
          },
          "metadata": {
            "operationMetadataId": "f1a346e2-5cd9-44ab-9d9c-0dd16a14a502"
          },
          "runAfter": {
            "Initialize_DeleteFromCoE": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_variable_flowEnvironment": {
          "description": "Environment location specific Flow URL - remember / at the end",
          "inputs": {
            "variables": [
              {
                "name": "flowEnvironment",
                "type": "string",
                "value": "@parameters('Power Automate Environment Variable')"
              }
            ]
          },
          "metadata": {
            "operationMetadataId": "5a818d12-3acd-4dd8-903b-6f33b6204e0c"
          },
          "runAfter": {
            "Initialize_variable_today": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "Initialize_variable_today": {
          "inputs": {
            "variables": [
              {
                "name": "today",
                "type": "string",
                "value": "@{utcNow()}"
              }
            ]
          },
          "metadata": {
            "operationMetadataId": "1a97d296-4d56-452e-af90-bfcaee002e8b"
          },
          "runAfter": {
            "Initialize_systemMaker": [
              "Succeeded"
            ]
          },
          "type": "InitializeVariable"
        },
        "List_CoE_Environments_not_marked_deleted": {
          "inputs": {
            "authentication": "@parameters('$authentication')",
            "host": {
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
              "connectionName": "shared_commondataserviceforapps",
              "operationId": "ListRecords"
            },
            "parameters": {
              "$filter": "admin_environmentdeleted eq false",
              "$select": "admin_environmentid, admin_environmentsku, admin_hascds, admin_environmentname, admin_environmentcdsmetadataname, admin_environmentdeletedon",
              "entityName": "admin_environments"
            },
            "retryPolicy": {
              "count": 10,
              "interval": "PT10S",
              "type": "exponential"
            }
          },
          "metadata": {
            "operationMetadataId": "f914913a-70ee-4c6e-8311-885e2c122032"
          },
          "runAfter": {
            "Test_-_fail_check_1": [
              "Succeeded"
            ]
          },
          "runtimeConfiguration": {
            "paginationPolicy": {
              "minimumItemCount": 100000
            }
          },
          "type": "OpenApiConnection"
        },
        "List_CoE_Environments_not_marked_deleted_-_pre_new_deletes": {
          "inputs": {
            "authentication": "@parameters('$authentication')",
            "host": {
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
              "connectionName": "shared_commondataserviceforapps",
              "operationId": "ListRecords"
            },
            "parameters": {
              "$filter": "admin_environmentdeleted eq false",
              "$select": "admin_environmentid, admin_environmentsku, admin_environmentname, admin_environmentdeletedon",
              "entityName": "admin_environments"
            },
            "retryPolicy": {
              "count": 10,
              "interval": "PT10S",
              "type": "exponential"
            }
          },
          "metadata": {
            "operationMetadataId": "b704cf19-76ae-4b56-b9fe-93a56935f39f"
          },
          "runAfter": {
            "Select": [
              "Succeeded"
            ]
          },
          "runtimeConfiguration": {
            "paginationPolicy": {
              "minimumItemCount": 100000
            }
          },
          "type": "OpenApiConnection"
        },
        "Newly_Deleted_Environments": {
          "actions": {
            "For_Each_non_del_env_in_CoE": {
              "actions": {
                "Find_env_in_tenant": {
                  "inputs": {
                    "from": "@body('Select')",
                    "where": "@equals(item()['name'], items('For_Each_non_del_env_in_CoE')?['admin_environmentname'])"
                  },
                  "metadata": {
                    "operationMetadataId": "914e313a-a008-4246-b1a7-a81966511214"
                  },
                  "runAfter": {},
                  "type": "Query"
                },
                "If_Not_Found,_mark_it_and_its_objects_as_deleted": {
                  "actions": {
                    "Call_Canvas_Helper_-_delete_all": {
                      "inputs": {
                        "body": {
                          "boolean": false,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                          "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                        },
                        "host": {
                          "workflowReferenceName": "2e6ae3e2-8afb-eb11-94ef-002248237d7d"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "df1f53a7-a4c1-41e6-9b7b-20c741931892"
                      },
                      "runAfter": {
                        "Mark_Environment_as_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "Workflow"
                    },
                    "Call_Cloud_Flow_Helper_-_delete_all": {
                      "inputs": {
                        "body": {
                          "boolean": false,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                          "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                        },
                        "host": {
                          "workflowReferenceName": "6bd20554-9bfb-eb11-94ef-002248237d7d"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "06f31bf3-ded6-4485-9492-cea0c0d2787a"
                      },
                      "runAfter": {
                        "Mark_Environment_as_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "Workflow"
                    },
                    "Call_Custom_Connector_Helper_-_delete_all": {
                      "inputs": {
                        "body": {
                          "boolean": false,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                          "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                        },
                        "host": {
                          "workflowReferenceName": "b3f4f0d4-cb1b-ec11-b6e6-00224828c7b0"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "7cb47e42-d766-4da1-ad39-4d230048d52a"
                      },
                      "runAfter": {
                        "Mark_Environment_as_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "Workflow"
                    },
                    "Call_MDA_Helper_-_delete_all": {
                      "inputs": {
                        "body": {
                          "boolean": false,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                          "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                        },
                        "host": {
                          "workflowReferenceName": "9a470548-58fc-eb11-94ef-002248237f74"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "09ec10f1-418d-4fa8-a577-21e07a28c1e9"
                      },
                      "runAfter": {
                        "Mark_Environment_as_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "Workflow"
                    },
                    "Call_PVA_Helper_-_delete_all": {
                      "inputs": {
                        "body": {
                          "boolean": false,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                          "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                        },
                        "host": {
                          "workflowReferenceName": "ffd82928-64fc-eb11-94ef-002248237d7d"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "87153866-f090-4e51-92a6-8d47bee10319"
                      },
                      "runAfter": {
                        "Mark_Environment_as_deleted": [
                          "Succeeded"
                        ]
                      },
                      "type": "Workflow"
                    },
                    "Mark_Environment_as_deleted": {
                      "inputs": {
                        "authentication": "@parameters('$authentication')",
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "UpdateRecord"
                        },
                        "parameters": {
                          "entityName": "admin_environments",
                          "item/admin_environmentdeleted": true,
                          "item/admin_environmentdeletedon": "@utcNow()",
                          "recordId": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentid']"
                        },
                        "retryPolicy": {
                          "count": 10,
                          "interval": "PT10S",
                          "type": "exponential"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "e0c9dd82-239c-4488-a786-6b3254e80ea2"
                      },
                      "runAfter": {},
                      "type": "OpenApiConnection"
                    },
                    "check_return_-_Call_Canvas_Helper_-_delete_all": {
                      "actions": {
                        "Append_Failure_-_Deleted_Envts_-_Canvas": {
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "obj type": "canvas",
                              "which loop": "deleted envts"
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                          },
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_Canvas_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToArrayVariable"
                        },
                        "set_failure_occurred_true_-_Call_Canvas_Helper_-_delete_all": {
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          },
                          "metadata": {
                            "operationMetadataId": "b2004d1c-bbfd-4fbb-b378-2810d8c74761"
                          },
                          "runAfter": {},
                          "type": "SetVariable"
                        }
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@outputs('Call_Canvas_Helper_-_delete_all')?['Body']?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "85e0a2bf-db51-43da-a444-f3946ee744c7"
                      },
                      "runAfter": {
                        "Call_Canvas_Helper_-_delete_all": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    },
                    "check_return_-_Call_Cloud_Flow_Helper_-_delete_all": {
                      "actions": {
                        "Append_Failure_-_Deleted_Envts_-_flows": {
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "obj type": "flows",
                              "which loop": "deleted envts"
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                          },
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_Cloud_Flow_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToArrayVariable"
                        },
                        "set_failure_occurred_true_-_Call_Cloud_Flow_Helper_-_delete_all": {
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          },
                          "metadata": {
                            "operationMetadataId": "d4d12add-c1bb-4180-89aa-4e3bf0760778"
                          },
                          "runAfter": {},
                          "type": "SetVariable"
                        }
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@outputs('Call_Cloud_Flow_Helper_-_delete_all')?['Body']?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "f0c7d502-daca-440c-9f4e-b837e1748d8b"
                      },
                      "runAfter": {
                        "Call_Cloud_Flow_Helper_-_delete_all": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    },
                    "check_return_-_Call_Custom_Connector_Helper_-_delete_all": {
                      "actions": {
                        "Append_Failure_-_Deleted_Envts_-_Custom_Connectors": {
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "obj type": "custom connectors",
                              "which loop": "deleted envts"
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                          },
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_Custom_Connector_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToArrayVariable"
                        },
                        "set_failure_occurred_true_-_Call_Custom_Connector_Helper_-_delete_all": {
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          },
                          "metadata": {
                            "operationMetadataId": "b550df2c-e3c7-40c0-8a6a-81b0f272d024"
                          },
                          "runAfter": {},
                          "type": "SetVariable"
                        }
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@outputs('Call_Custom_Connector_Helper_-_delete_all')?['Body']?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "3c2776a3-5ca9-4545-b6de-f954083cfdeb"
                      },
                      "runAfter": {
                        "Call_Custom_Connector_Helper_-_delete_all": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    },
                    "check_return_-_Call_MDA_Helper_-_delete_all": {
                      "actions": {
                        "Append_Failure_-_Deleted_Envts_-_MDAs": {
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "obj type": "MDAs",
                              "which loop": "deleted envts"
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                          },
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_MDA_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToArrayVariable"
                        },
                        "set_failure_occurred_true_-_Call_MDA_Helper_-_delete_all": {
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          },
                          "metadata": {
                            "operationMetadataId": "b36373a8-b46d-4cc4-a6e3-e994e4672d77"
                          },
                          "runAfter": {},
                          "type": "SetVariable"
                        }
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@outputs('Call_MDA_Helper_-_delete_all')?['Body']?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "ddcc53d6-a35f-4edf-b126-33e34bec0ff7"
                      },
                      "runAfter": {
                        "Call_MDA_Helper_-_delete_all": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    },
                    "check_return_-_Call_PVA_Helper_-_delete_all": {
                      "actions": {
                        "Append_Failure_-_Deleted_Envts_-_PVAs": {
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "obj type": "PVAs",
                              "which loop": "deleted envts"
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                          },
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_PVA_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "type": "AppendToArrayVariable"
                        },
                        "set_failure_occurred_true_-_Call_PVA_Helper_-_delete_all": {
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          },
                          "metadata": {
                            "operationMetadataId": "d3446123-7ec3-41cf-b67e-48a921cbae68"
                          },
                          "runAfter": {},
                          "type": "SetVariable"
                        }
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@body('Call_PVA_Helper_-_delete_all')?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "9a7fced8-dcec-4d9c-826a-f1c5ebc18f9c"
                      },
                      "runAfter": {
                        "Call_PVA_Helper_-_delete_all": [
                          "Succeeded"
                        ]
                      },
                      "type": "If"
                    }
                  },
                  "expression": {
                    "and": [
                      {
                        "equals": [
                          "@length(body('Find_env_in_tenant'))",
                          0
                        ]
                      },
                      {
                        "not": {
                          "equals": [
                            "@items('For_Each_non_del_env_in_CoE')?['admin_environmentsku']",
                            "Default"
                          ]
                        }
                      }
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "555ab1fd-63cf-4650-970f-1d4ea48eb236"
                  },
                  "runAfter": {
                    "Find_env_in_tenant": [
                      "Succeeded"
                    ]
                  },
                  "type": "If"
                }
              },
              "foreach": "@outputs('List_CoE_Environments_not_marked_deleted_-_pre_new_deletes')?['body/value']",
              "metadata": {
                "operationMetadataId": "f8888611-7e1b-47f4-b50d-cf0325286930"
              },
              "runAfter": {},
              "runtimeConfiguration": {
                "concurrency": {
                  "repetitions": 50
                }
              },
              "type": "Foreach"
            }
          },
          "metadata": {
            "operationMetadataId": "6ddbed25-5d76-4335-9783-022f6371180f"
          },
          "runAfter": {
            "List_CoE_Environments_not_marked_deleted_-_pre_new_deletes": [
              "Succeeded"
            ]
          },
          "type": "Scope"
        },
        "See_if_anything_failed_above": {
          "actions": {
            "Terminate_Flow_with_Failure": {
              "inputs": {
                "runError": {
                  "code": "500",
                  "message": "Flow failed in at least one scope above"
                },
                "runStatus": "Failed"
              },
              "metadata": {
                "operationMetadataId": "d5921bb6-aff5-4aa0-998e-b5f3fa59ee2f"
              },
              "runAfter": {
                "list_failures": [
                  "Succeeded"
                ]
              },
              "type": "Terminate"
            },
            "list_failures": {
              "inputs": "@variables('varFailures')",
              "metadata": {
                "operationMetadataId": "582938c2-168d-404d-b1e1-b86d2cbf9c68"
              },
              "runAfter": {},
              "type": "Compose"
            }
          },
          "expression": {
            "equals": [
              "@variables('failureOccurred')",
              "@true"
            ]
          },
          "metadata": {
            "operationMetadataId": "2a766ba0-9475-45f8-ad7a-1ddc49439fd6"
          },
          "runAfter": {
            "Test_-_fail_check": [
              "Succeeded"
            ]
          },
          "type": "If"
        },
        "Select": {
          "inputs": {
            "from": "@outputs('Get_Environments')?['body/value']",
            "select": {
              "name": "@item()?['name']"
            }
          },
          "metadata": {
            "operationMetadataId": "236d24b5-13c4-4750-af5f-d832983e5fda"
          },
          "runAfter": {
            "Get_Environments": [
              "Succeeded"
            ]
          },
          "type": "Select"
        },
        "Test_-_fail_check": {
          "inputs": "@variables('failureOccurred')",
          "metadata": {
            "operationMetadataId": "e54f041d-0d4b-470d-9aef-269899cc3b4f"
          },
          "runAfter": {
            "Deleted_Objects_in_Existing_Environments": [
              "Succeeded"
            ]
          },
          "type": "Compose"
        },
        "Test_-_fail_check_1": {
          "inputs": "@variables('failureOccurred')",
          "metadata": {
            "operationMetadataId": "155cc93e-8721-4401-92c2-2135b24864de"
          },
          "runAfter": {
            "Newly_Deleted_Environments": [
              "Succeeded"
            ]
          },
          "type": "Compose"
        }
      },
      "contentVersion": "1.0.0.0",
      "outputs": {},
      "parameters": {
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        },
        "Also Delete From CoE": {
          "defaultValue": "no",
          "metadata": {
            "description": "when we run \"Admin | Sync Template v2 (Check Deleted)\", delete the items from CoE (yes) or just mark deleted (no)",
            "schemaName": "admin_DeleteFromCoE"
          },
          "type": "String"
        },
        "Power Automate Environment Variable": {
          "defaultValue": "https://us.flow.microsoft.com/manage/environments/",
          "metadata": {
            "description": "Environment, including geographic location, for Power Automate - Ex for commercial: https://flow.microsoft.com/manage/environments/",
            "schemaName": "admin_PowerAutomateEnvironmentVariable"
          },
          "type": "String"
        }
      },
      "triggers": {
        "Recurrence": {
          "metadata": {
            "operationMetadataId": "1309ceff-cca9-4e22-a480-7ab3e793bddd"
          },
          "recurrence": {
            "frequency": "Week",
            "interval": 2,
            "schedule": {
              "weekDays": [
                "Saturday"
              ]
            }
          },
          "type": "Recurrence"
        }
      }
    }
  },
  "schemaVersion": "1.0.0.0"
}
