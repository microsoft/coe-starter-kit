{
  "properties": {
    "connectionReferences": {
      "shared_powerplatformforadmins": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerPlatformforAdminsEnvRequest"
        },
        "api": {
          "name": "shared_powerplatformforadmins"
        }
      },
      "shared_office365users": {
        "runtimeSource": "invoker",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreOffice365Users"
        },
        "api": {
          "name": "shared_office365users"
        }
      },
      "shared_office365": {
        "runtimeSource": "invoker",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreO365Outlook"
        },
        "api": {
          "name": "shared_office365"
        }
      },
      "shared_powerappsforadmins": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerAppsAdmin2"
        },
        "api": {
          "name": "shared_powerappsforadmins"
        }
      },
      "shared_commondataserviceforapps": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_sharedcommondataserviceforapps_98924"
        },
        "api": {
          "name": "shared_commondataserviceforapps"
        }
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        },
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)": {
          "defaultValue": "https://flow.microsoft.com/manage/environments/",
          "type": "String",
          "metadata": {
            "schemaName": "admin_PowerAutomateEnvironmentVariable",
            "description": "Inventory - REQUIRED. Environment, including geographic location, for Power Automate - Ex for commercial: https://flow.microsoft.com/manage/environments/"
          }
        }
      },
      "triggers": {
        "manual": {
          "metadata": {
            "operationMetadataId": "7fdd5802-ff40-47c1-94d7-be41126c3d19"
          },
          "type": "Request",
          "kind": "PowerAppV2",
          "inputs": {
            "schema": {
              "type": "object",
              "properties": {
                "text": {
                  "title": "UserName",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "Please enter your input",
                  "x-ms-content-hint": "TEXT"
                },
                "text_1": {
                  "title": "EnvtName",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "Please enter your input",
                  "x-ms-content-hint": "TEXT"
                },
                "text_2": {
                  "title": "Connector",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "Please enter your input",
                  "x-ms-content-hint": "TEXT"
                },
                "boolean": {
                  "title": "errorsOnly",
                  "type": "boolean",
                  "x-ms-dynamically-added": true,
                  "description": "Please select yes or no",
                  "x-ms-content-hint": "BOOLEAN"
                },
                "boolean_1": {
                  "title": "noAccountOnly",
                  "type": "boolean",
                  "x-ms-dynamically-added": true,
                  "description": "Please select yes or no",
                  "x-ms-content-hint": "BOOLEAN"
                },
                "boolean_2": {
                  "title": "sendToCSV",
                  "type": "boolean",
                  "x-ms-dynamically-added": true,
                  "description": "Please select yes or no",
                  "x-ms-content-hint": "BOOLEAN"
                },
                "text_3": {
                  "title": "sendToCSVEmail",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "Please enter your input",
                  "x-ms-content-hint": "TEXT"
                }
              },
              "required": [
                "text",
                "text_1",
                "text_2",
                "boolean",
                "boolean_1",
                "boolean_2",
                "text_3"
              ]
            }
          }
        }
      },
      "actions": {
        "Initialize_returnArray": {
          "runAfter": {},
          "metadata": {
            "operationMetadataId": "8d331410-deea-44f6-ac80-86394813d73d"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "returnArray",
                "type": "array"
              }
            ]
          }
        },
        "Get_Connections_to_Clean": {
          "actions": {
            "Input_Parameters": {
              "actions": {
                "User": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "733421f5-248c-4ff4-ab83-8a53fe62efc0"
                  },
                  "type": "Compose",
                  "inputs": "@toLower(triggerBody()['text'])"
                },
                "showAllUsers": {
                  "runAfter": {
                    "User": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "4072ed05-c00c-4e9d-9fae-e4c5c918f83d"
                  },
                  "type": "Compose",
                  "inputs": "@if(equals(outputs('User'), 'all'), true, false)"
                },
                "connector": {
                  "runAfter": {
                    "showAllUsers": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "a2c573f7-d7aa-4963-9ce5-6afe3ed0230a"
                  },
                  "type": "Compose",
                  "inputs": "@toLower(triggerBody()['text_2'])"
                },
                "showAllConnectors": {
                  "runAfter": {
                    "connector": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "c597017b-dbc4-431b-958d-a28230758027"
                  },
                  "type": "Compose",
                  "inputs": "@if(equals(outputs('connector'), 'all'), true, false)"
                },
                "showOnlyErrors": {
                  "runAfter": {
                    "showAllConnectors": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "6d1c3ce7-3870-4453-b7c8-8e1e9da29ad8"
                  },
                  "type": "Compose",
                  "inputs": "@triggerBody()['boolean']"
                },
                "showOnlyNoAccount": {
                  "runAfter": {
                    "showOnlyErrors": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "5e4f28e5-0498-4690-8852-079e568e47bb"
                  },
                  "type": "Compose",
                  "inputs": "@triggerBody()['boolean_1']"
                }
              },
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "9bbb74a8-8ef3-4669-a0ed-e07b4fb0d379"
              },
              "type": "Scope"
            },
            "Get_Envt_List": {
              "actions": {
                "If_all_envts": {
                  "actions": {
                    "List_Environments_as_Admin": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "2c0ddcca-8745-4c5c-a262-1dcf722eed90"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_powerplatformforadmins",
                          "operationId": "Get-AdminEnvironment",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_powerplatformforadmins"
                        },
                        "parameters": {
                          "api-version": "2018-10-01"
                        },
                        "authentication": "@parameters('$authentication')"
                      },
                      "runtimeConfiguration": {
                        "paginationPolicy": {
                          "minimumItemCount": 100000
                        }
                      }
                    },
                    "Select_Envts_All": {
                      "runAfter": {
                        "List_Environments_as_Admin": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "0ba35992-b402-4e84-9faf-dd97e17e1eec"
                      },
                      "type": "Select",
                      "inputs": {
                        "from": "@outputs('List_Environments_as_Admin')?['body/value']",
                        "select": {
                          "EnvtName": "@item()?['name']",
                          "EnvtDisplayName": "@item()?['properties/displayName']"
                        }
                      }
                    }
                  },
                  "runAfter": {},
                  "else": {
                    "actions": {
                      "Get_Environment_as_Admin": {
                        "runAfter": {},
                        "metadata": {
                          "operationMetadataId": "5489c4e8-8cb5-4697-a626-2df9940164bc"
                        },
                        "type": "OpenApiConnection",
                        "inputs": {
                          "host": {
                            "connectionName": "shared_powerplatformforadmins",
                            "operationId": "GetSingleEnvironment",
                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_powerplatformforadmins"
                          },
                          "parameters": {
                            "environment": "@triggerBody()['text_1']",
                            "api-version": "2018-10-01"
                          },
                          "authentication": "@parameters('$authentication')"
                        }
                      },
                      "Select_Envts_One": {
                        "runAfter": {
                          "Select_Envts_Empty": [
                            "Skipped"
                          ]
                        },
                        "metadata": {
                          "operationMetadataId": "40f3bccf-6483-4c24-ac2f-5b9e36c2ace1"
                        },
                        "type": "Compose",
                        "inputs": [
                          {
                            "EnvtName": "@{triggerBody()['text_1']}",
                            "EnvtDisplayName": "@{outputs('Get_Environment_as_Admin')?['body/properties/displayName']}"
                          }
                        ]
                      },
                      "Select_Envts_Empty": {
                        "runAfter": {
                          "Get_Environment_as_Admin": [
                            "Failed"
                          ]
                        },
                        "metadata": {
                          "operationMetadataId": "40f3bccf-6483-4c24-ac2f-5b9e36c2ace1"
                        },
                        "type": "Compose",
                        "inputs": []
                      }
                    }
                  },
                  "expression": {
                    "equals": [
                      "@triggerBody()['text_1']",
                      "all"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "47b20679-a04c-48dd-b910-34118c444f01"
                  },
                  "type": "If"
                },
                "EnvtsToCollect": {
                  "runAfter": {
                    "If_all_envts": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "2530e82f-b66e-483f-a5f9-fe7c6c9ac5a8"
                  },
                  "type": "Compose",
                  "inputs": "@if(equals(body('Select_Envts_All'), null), outputs('Select_Envts_One'), body('Select_Envts_All'))"
                }
              },
              "runAfter": {
                "Input_Parameters": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "a08501b6-b28d-4aaa-af25-3afde0e2d453"
              },
              "type": "Scope"
            },
            "Send_in_Email_if_Requested": {
              "actions": {
                "If_sendToCSV_true": {
                  "actions": {
                    "Get_user_profile_(V2)": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "5c040609-7080-4699-acce-099612680591"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_office365users",
                          "operationId": "UserProfile_V2",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
                        },
                        "parameters": {
                          "id": "@triggerBody()['text_3']",
                          "$select": "preferredLanguage, mail"
                        },
                        "authentication": "@parameters('$authentication')",
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    },
                    "Send_an_email_(V2)": {
                      "runAfter": {
                        "Create_CSV_table": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "d381ecd0-cb67-4176-9c21-f32ca19c901d"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_office365",
                          "operationId": "SendEmailV2",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365"
                        },
                        "parameters": {
                          "emailMessage/To": "@outputs('Get_user_profile_(V2)')?['body/mail']",
                          "emailMessage/Subject": "heres that csv",
                          "emailMessage/Body": "<p>attached</p>",
                          "emailMessage/Attachments": [
                            {
                              "Name": "ConnectionsList.csv",
                              "ContentBytes": "@body('Create_CSV_table')"
                            }
                          ],
                          "emailMessage/Importance": "Normal"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    },
                    "Create_CSV_table": {
                      "runAfter": {
                        "Get_user_profile_(V2)": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "bdcd6774-6495-402b-8aef-9504891282af"
                      },
                      "type": "Table",
                      "inputs": {
                        "from": "@variables('returnArray')",
                        "format": "CSV"
                      }
                    }
                  },
                  "runAfter": {},
                  "expression": {
                    "equals": [
                      "@triggerBody()['boolean_2']",
                      "@true"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "2074dd3b-3bf1-4372-82c0-e51c98f832b9"
                  },
                  "type": "If"
                }
              },
              "runAfter": {
                "Fetch_and_return_data_to_app": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "546452ab-69db-4591-a1af-85f9417a0cb1"
              },
              "type": "Scope"
            },
            "Fetch_and_return_data_to_app": {
              "actions": {
                "If_envt_exists": {
                  "actions": {
                    "Apply_to_each_envt": {
                      "foreach": "@outputs('EnvtsToCollect')",
                      "actions": {
                        "Get_Connections_as_Admin_for_this_Envt": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "9d1d082f-9fca-4703-87d3-d4501315dd53"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_powerappsforadmins",
                              "operationId": "Get-AdminConnections",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_powerappsforadmins"
                            },
                            "parameters": {
                              "environment": "@items('Apply_to_each_envt')?['EnvtName']",
                              "api-version": "2016-11-01",
                              "$top": 1000
                            },
                            "authentication": "@parameters('$authentication')"
                          },
                          "runtimeConfiguration": {
                            "paginationPolicy": {
                              "minimumItemCount": 100000
                            }
                          }
                        },
                        "Select": {
                          "runAfter": {
                            "Filter_to_non-null_api_id": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "f00a0de4-2959-4ff8-9c4b-d92054d8b7fb"
                          },
                          "type": "Select",
                          "inputs": {
                            "from": "@body('Filter_to_non-null_api_id')",
                            "select": {
                              "connectorName": "@tolower(last(split(item()?['properties/apiId'], '/')))",
                              "accountName": "@if(equals(item()?['properties/accountName'], null), '', tolower(item()?['properties/accountName']))",
                              "connectionCreator": "@item()?['properties']?['createdBy']?['id']",
                              "connectionCreatorUPN": "@item()?['properties']?['createdBy']?['userPrincipalName']",
                              "connectionEnvt": "@items('Apply_to_each_envt')?['EnvtName']",
                              "connectionEnvtDisplay": "@items('Apply_to_each_envt')?['EnvtDisplayName']",
                              "connectionIdentifier": "@item()?['name']",
                              "StatusIsError": "@if(equals(item()?['properties/statuses'][0]?['status'], 'Connected'), false, true)",
                              "StatusString": "@if(equals(item()?['properties/statuses'][0]?['status'], 'Connected'), 'Connected', 'Error')",
                              "StatusColorString": "@if(equals(item()?['properties/statuses'][0]?['status'], 'Connected'), '#dff6dd', '#fed9cc')",
                              "noAccount": "@if(equals(item()?['properties/accountName'], null), true, false)",
                              "connectionParamater": "@if(equals(item()?['properties/connectionParametersSet/name'], null), \r\nif(equals(item()?['properties/connectionParameters/workflowName'], null), '', \r\nitem()?['properties/connectionParameters/workflowName']), item()?['properties/connectionParametersSet/name'])",
                              "propertyDisplayName": "@if(equals(item()?['properties/displayName'], null), '', item()?['properties/displayName'])",
                              "flowURL": "@if(equals(tolower(last(split(item()?['properties/apiId'], '/'))), 'shared_logicflows'), concat(parameters('Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)'), substring(items('Apply_to_each_envt')?['EnvtName'], sub(length(items('Apply_to_each_envt')?['EnvtName']), 36), 36), '/flows/', if(equals(item()?['properties/connectionParameters/workflowName'], null), '', item()?['properties/connectionParameters/workflowName']), '/details'), '')"
                            }
                          }
                        },
                        "Filter_Account_Present_or_Not": {
                          "runAfter": {
                            "Select": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "c1767f5d-3d88-455b-af0f-d8696131c77d"
                          },
                          "type": "Query",
                          "inputs": {
                            "from": "@body('Select')",
                            "where": "@or(and(equals(item()?['noAccount'], true), equals(outputs('showOnlyNoAccount'), true)), and(equals(item()?['noAccount'], false), equals(outputs('showOnlyNoAccount'), false)))"
                          }
                        },
                        "Filter_to_User": {
                          "runAfter": {
                            "Filter_Account_Present_or_Not": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "d1dd55ea-58bf-4dfb-babe-22bfdbd7937a"
                          },
                          "type": "Query",
                          "inputs": {
                            "from": "@body('Filter_Account_Present_or_Not')",
                            "where": "@or(and(equals(item()?['accountName'], outputs('User')), equals(outputs('showAllUsers'), false)), and(not(equals(item()?['connectionIdentifier'], null)), equals(outputs('showAllUsers'), true)))"
                          }
                        },
                        "Filter_to_Connector": {
                          "runAfter": {
                            "Filter_to_User": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "e344a8e1-c327-4d90-8a0e-84f0fa21e8e7"
                          },
                          "type": "Query",
                          "inputs": {
                            "from": "@body('Filter_to_User')",
                            "where": "@or(and(equals(item()?['connectorName'], outputs('connector')), equals(outputs('showAllConnectors'), false)), and(not(equals(item()?['connectionIdentifier'], null)), equals(outputs('showAllConnectors'), true)))"
                          }
                        },
                        "Filter_to_Errors_Or_Not": {
                          "runAfter": {
                            "Filter_to_Connector": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "047eaa04-d6e9-4a22-8c5b-795a28298f59"
                          },
                          "type": "Query",
                          "inputs": {
                            "from": "@body('Filter_to_Connector')",
                            "where": "@or(and(equals(item()?['StatusIsError'], true), equals(outputs('showOnlyErrors'), true)), and(not(equals(item()?['connectionIdentifier'], null)), equals(outputs('showOnlyErrors'), false)))"
                          }
                        },
                        "Apply_to_each_connection": {
                          "foreach": "@body('Filter_to_Errors_Or_Not')",
                          "actions": {
                            "Append_to_array_variable": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "2cc6dea0-6fa5-4d68-b059-460fa6a5768b"
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "returnArray",
                                "value": "@items('Apply_to_each_connection')"
                              }
                            }
                          },
                          "runAfter": {
                            "Filter_to_Errors_Or_Not": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "173994e5-682e-4f85-9cdd-aaf639a889eb"
                          },
                          "type": "Foreach",
                          "runtimeConfiguration": {
                            "concurrency": {
                              "repetitions": 50
                            }
                          }
                        },
                        "Filter_to_non-null_api_id": {
                          "runAfter": {
                            "Get_Connections_as_Admin_for_this_Envt": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "79fc7ca5-209b-48e9-a8a3-a25eb2518274"
                          },
                          "type": "Query",
                          "inputs": {
                            "from": "@outputs('Get_Connections_as_Admin_for_this_Envt')?['body/value']",
                            "where": "@not(equals(item()?['properties/apiId'], null))"
                          }
                        }
                      },
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "150b5018-e25c-4fc6-a4c5-ce08466e34a5"
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 50
                        }
                      }
                    },
                    "Compose": {
                      "runAfter": {
                        "Apply_to_each_envt": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "b2dc896f-bba4-4f30-a8f0-9454eb9f58ee"
                      },
                      "type": "Compose",
                      "inputs": "@variables('returnArray')"
                    },
                    "Response": {
                      "runAfter": {
                        "Compose": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "7a9efa7c-d264-4817-8ac9-6b91dfdad4bd"
                      },
                      "type": "Response",
                      "kind": "Http",
                      "inputs": {
                        "statusCode": 200,
                        "body": "@variables('returnArray')",
                        "schema": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "connectorName": {
                                "type": "string"
                              },
                              "accountName": {
                                "type": "string"
                              },
                              "connectionCreator": {
                                "type": "string"
                              },
                              "connectionCreatorUPN": {
                                "type": "string"
                              },
                              "connectionEnvt": {
                                "type": "string"
                              },
                              "connectionEnvtDisplay": {
                                "type": "string"
                              },
                              "connectionIdentifier": {
                                "type": "string"
                              },
                              "StatusIsError": {
                                "type": "boolean"
                              },
                              "StatusString": {
                                "type": "string"
                              },
                              "StatusColorString": {
                                "type": "string"
                              },
                              "noAccount": {
                                "type": "boolean"
                              },
                              "connectionParamater": {
                                "type": "string"
                              },
                              "propertyDisplayName": {
                                "type": "string"
                              },
                              "flowURL": {
                                "type": "string"
                              }
                            },
                            "required": [
                              "connectorName",
                              "accountName",
                              "connectionCreator",
                              "connectionCreatorUPN",
                              "connectionEnvt",
                              "connectionEnvtDisplay",
                              "connectionIdentifier",
                              "StatusIsError",
                              "StatusString",
                              "StatusColorString",
                              "noAccount",
                              "connectionParamater",
                              "propertyDisplayName",
                              "flowURL"
                            ]
                          }
                        }
                      }
                    }
                  },
                  "runAfter": {},
                  "else": {
                    "actions": {
                      "Return_null_array": {
                        "runAfter": {},
                        "metadata": {
                          "operationMetadataId": "45bc4647-6576-44fa-8599-936a0f89eea7"
                        },
                        "type": "Response",
                        "kind": "Http",
                        "inputs": {
                          "statusCode": 200,
                          "body": [],
                          "schema": {
                            "type": "array",
                            "items": {
                              "type": "object",
                              "properties": {
                                "connectorName": {
                                  "type": "string"
                                },
                                "accountName": {
                                  "type": "string"
                                },
                                "connectionCreator": {
                                  "type": "string"
                                },
                                "connectionCreatorUPN": {
                                  "type": "string"
                                },
                                "connectionEnvt": {
                                  "type": "string"
                                },
                                "connectionEnvtDisplay": {
                                  "type": "string"
                                },
                                "connectionIdentifier": {
                                  "type": "string"
                                },
                                "StatusIsError": {
                                  "type": "boolean"
                                },
                                "StatusString": {
                                  "type": "string"
                                },
                                "StatusColorString": {
                                  "type": "string"
                                },
                                "noAccount": {
                                  "type": "boolean"
                                },
                                "connectionParamater": {
                                  "type": "string"
                                },
                                "propertyDisplayName": {
                                  "type": "string"
                                },
                                "flowURL": {
                                  "type": "string"
                                }
                              },
                              "required": [
                                "connectorName",
                                "accountName",
                                "connectionCreator",
                                "connectionCreatorUPN",
                                "connectionEnvt",
                                "connectionEnvtDisplay",
                                "connectionIdentifier",
                                "StatusIsError",
                                "StatusString",
                                "StatusColorString",
                                "noAccount",
                                "connectionParamater",
                                "propertyDisplayName",
                                "flowURL"
                              ]
                            }
                          }
                        }
                      }
                    }
                  },
                  "expression": {
                    "not": {
                      "equals": [
                        "@outputs('EnvtsToCollect')",
                        "@null"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "a81dd09a-6ca4-4eaf-840a-cf18b28160df"
                  },
                  "type": "If"
                }
              },
              "runAfter": {
                "Get_Envt_List": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "265ebc8e-b1ad-4781-b735-9351492fc8da"
              },
              "type": "Scope"
            }
          },
          "runAfter": {
            "Initialize_returnArray": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "3f7955e7-06d4-4cc2-99fb-e33775f1389d"
          },
          "type": "Scope"
        },
        "Error_Handling": {
          "actions": {
            "Create_a_new_record_-_Sync_Flow_Errors": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "87961ff0-e261-4890-9ab9-a53f88fe0de5"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "CreateRecord",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_syncflowerrorses",
                  "item/admin_name": "@workflow()?['tags']['flowDisplayName']",
                  "item/admin_environmentname": "envt: @{triggerBody()['text_1']} - user @{triggerBody()['text']} - connector @{triggerBody()['text_2']} - errorsOnly @{triggerBody()['boolean']} - noAccountsOnly @{triggerBody()['boolean_1']}",
                  "item/admin_flowinstanceurl": "@concat(parameters('Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)'), workflow()?['tags']['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])"
                },
                "authentication": "@parameters('$authentication')",
                "retryPolicy": {
                  "type": "exponential",
                  "count": 10,
                  "interval": "PT10S"
                }
              }
            },
            "Terminate": {
              "runAfter": {
                "Update_Last_Run_Fail": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "9e5a2a18-dba2-47a1-96d5-3356f4348e5a"
              },
              "type": "Terminate",
              "inputs": {
                "runStatus": "Failed",
                "runError": {
                  "code": "500",
                  "message": "Get Environments Failed"
                }
              }
            },
            "Get_ID_Fail": {
              "runAfter": {
                "Create_a_new_record_-_Sync_Flow_Errors": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "47329bf2-8aac-400d-9778-a793b4f1180f"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "$select": "admin_coesolutionmetadataid",
                  "$filter": "admin_objectname eq '@{workflow()?['tags']['flowDisplayName']}'",
                  "$top": 1
                },
                "authentication": "@parameters('$authentication')"
              }
            },
            "Update_Last_Run_Fail": {
              "runAfter": {
                "Get_ID_Fail": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "c63eb7cc-6101-4567-b520-a4a8881264e9"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "UpdateRecord",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "recordId": "@first(outputs('Get_ID_Fail')?['body/value'])?['admin_coesolutionmetadataid']",
                  "item/admin_lastrun": "@utcNow()",
                  "item/admin_lastrunpassed": false
                },
                "authentication": "@parameters('$authentication')"
              }
            }
          },
          "runAfter": {
            "Get_Connections_to_Clean": [
              "Failed"
            ]
          },
          "metadata": {
            "operationMetadataId": "38ae684e-622d-42ea-abd2-ee571aee3a5f"
          },
          "type": "Scope"
        },
        "Update_last_run_as_pass": {
          "actions": {
            "Update_Last_Run_Successful": {
              "runAfter": {
                "Get_ID_Pass": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "78ef70e5-7f67-4737-9a02-8533f12caa19"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "UpdateRecord",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "recordId": "@first(outputs('Get_ID_Pass')?['body/value'])?['admin_coesolutionmetadataid']",
                  "item/admin_lastrun": "@utcNow()",
                  "item/admin_lastrunpassed": true
                },
                "authentication": "@parameters('$authentication')"
              }
            },
            "Get_ID_Pass": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "f4f314b6-89d3-4056-af1c-73115e7d6bd1"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "$select": "admin_coesolutionmetadataid",
                  "$filter": "admin_objectname eq '@{workflow()?['tags']['flowDisplayName']}'",
                  "$top": 1
                },
                "authentication": "@parameters('$authentication')"
              }
            },
            "Catch_-_not_ready_to_take_last_run_date": {
              "runAfter": {
                "Update_Last_Run_Successful": [
                  "Failed"
                ]
              },
              "metadata": {
                "operationMetadataId": "f88cdefe-c402-49d7-8f4a-934475e6f741"
              },
              "type": "Compose",
              "inputs": "Catch - not ready to take last run date"
            }
          },
          "runAfter": {
            "Error_Handling": [
              "Skipped"
            ]
          },
          "metadata": {
            "operationMetadataId": "5c140442-d939-4ca4-8ec8-d1ee2bed4a81"
          },
          "type": "Scope"
        }
      }
    },
    "templateName": ""
  },
  "schemaVersion": "1.0.0.0"
}