{
  "properties": {
    "connectionReferences": {
      "shared_commondataserviceforapps": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_sharedcommondataserviceforapps_98924"
        },
        "api": {
          "name": "shared_commondataserviceforapps"
        }
      },
      "shared_commondataserviceforapps_1": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_sharedcommondataserviceforapps_98924"
        },
        "api": {
          "name": "shared_commondataserviceforapps"
        }
      },
      "shared_office365users_1": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreO365Users"
        },
        "api": {
          "name": "shared_office365users"
        }
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        },
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)": {
          "defaultValue": "https://flow.microsoft.com/manage/environments/",
          "type": "String",
          "metadata": {
            "schemaName": "admin_PowerAutomateEnvironmentVariable",
            "description": "Inventory - REQUIRED. Environment, including geographic location, for Power Automate - Ex for commercial: https://flow.microsoft.com/manage/environments/"
          }
        },
        "Inventory and Telemetry in Azure Data Storage account (admin_InventoryandTelemetryinAzureDataStorageaccount)": {
          "defaultValue": false,
          "type": "Bool",
          "metadata": {
            "schemaName": "admin_InventoryandTelemetryinAzureDataStorageaccount",
            "description": "Inventory - Have you set up data export in PPAC and is your inventory and telemetry in an Azure Data Storage folder (also referred to as Bring your own Datalake, self-serve analytics feature)"
          }
        }
      },
      "triggers": {
        "Recurrence": {
          "recurrence": {
            "frequency": "Week",
            "interval": 1,
            "schedule": {
              "weekDays": [
                "Monday"
              ],
              "hours": [
                "1"
              ]
            }
          },
          "metadata": {
            "operationMetadataId": "5af06e95-e1da-4ef7-8a95-b08c341fca85"
          },
          "type": "Recurrence"
        }
      },
      "actions": {
        "Initialize_Flow_Environment_variable": {
          "runAfter": {
            "Initialize_FailureOccurred": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "1317eec2-490e-44ed-8782-626f3e887243"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "flowEnvironment",
                "type": "String",
                "value": "@parameters('Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)')"
              }
            ]
          },
          "description": "Environment location specific Flow URL - remember / at the end"
        },
        "Find_No_Longer_Orphaned": {
          "actions": {
            "List_bots_no_longer_orphaned": {
              "runAfter": {
                "Check_if_BYODL_-_Find_No_Longer_Orphaned": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "562924fc-8b7b-49f1-92dd-1405494e6a69"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_pvas",
                  "$select": "admin_pvaid, _admin_pvaowner_value",
                  "$filter": "admin_pvadeleted ne true and admin_pvaisorphaned ne 'no' and admin_PVAOwner/admin_makerisorphaned ne true",
                  "$expand": "admin_PVAOwner($select=admin_makerisorphaned)"
                },
                "authentication": "@parameters('$authentication')"
              }
            },
            "List_ui_flows_no_longer_orphaned": {
              "runAfter": {
                "Apply_to_each_not_orphaned_bot": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "562924fc-8b7b-49f1-92dd-1405494e6a69"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_rpas",
                  "$select": "admin_rpaid, _admin_rpaowner_value ",
                  "$filter": "admin_rpadeleted ne true and admin_rpaisorphaned ne 'no' and admin_RPAOwner/admin_makerisorphaned ne true",
                  "$expand": "admin_RPAOwner($select=admin_makerisorphaned)"
                },
                "authentication": "@parameters('$authentication')"
              }
            },
            "List_custom_connectors_no_longer_orphaned": {
              "runAfter": {
                "Apply_to_each_not_orphaned_ui_flow": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "562924fc-8b7b-49f1-92dd-1405494e6a69"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_connectors",
                  "$select": "admin_connectorid, _admin_maker_value",
                  "$filter": "admin_connectordeleted ne true and admin_appisorphaned ne 'no' and admin_Maker/admin_makerisorphaned ne true and admin_iscustomapi eq true",
                  "$expand": "admin_Maker($select=admin_makerisorphaned)"
                },
                "authentication": "@parameters('$authentication')"
              }
            },
            "Apply_to_each_not_orphaned_bot": {
              "foreach": "@outputs('List_bots_no_longer_orphaned')?['body/value']",
              "actions": {
                "If_bot_owner_not_null": {
                  "actions": {
                    "Mark_bot_not_orphaned": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "55b0c26f-72b4-4cc4-8407-c84a8c637357"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "UpdateRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_pvas",
                          "recordId": "@items('Apply_to_each_not_orphaned_bot')?['admin_pvaid']",
                          "item/admin_pvaisorphaned": "No"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    }
                  },
                  "runAfter": {},
                  "expression": {
                    "not": {
                      "equals": [
                        "@items('Apply_to_each_not_orphaned_bot')?['_admin_pvaowner_value']",
                        "@null"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "54cc0433-610d-45ca-94db-47c37e85f977"
                  },
                  "type": "If"
                }
              },
              "runAfter": {
                "List_bots_no_longer_orphaned": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "11ec8179-587a-41c6-a936-c4e1e5b6275a"
              },
              "type": "Foreach",
              "runtimeConfiguration": {
                "concurrency": {
                  "repetitions": 50
                }
              }
            },
            "Apply_to_each_not_orphaned_ui_flow": {
              "foreach": "@outputs('List_ui_flows_no_longer_orphaned')?['body/value']",
              "actions": {
                "If_ui_flow_owner_not_null": {
                  "actions": {
                    "Mark_ui_flow_not_orphaned": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "2a5f468e-45b7-4914-8e70-96587e1eb8cc"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "UpdateRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_rpas",
                          "recordId": "@items('Apply_to_each_not_orphaned_ui_flow')?['admin_rpaid']",
                          "item/admin_rpaisorphaned": "No"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    }
                  },
                  "runAfter": {},
                  "expression": {
                    "not": {
                      "equals": [
                        "@items('Apply_to_each_not_orphaned_ui_flow')?['_admin_rpaowner_value']",
                        "@null"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "a08a460a-9deb-466d-9a3e-1d90d4338d92"
                  },
                  "type": "If"
                }
              },
              "runAfter": {
                "List_ui_flows_no_longer_orphaned": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "ad324bbc-d5b2-4cb5-bd95-c7dd706240b4"
              },
              "type": "Foreach",
              "runtimeConfiguration": {
                "concurrency": {
                  "repetitions": 50
                }
              }
            },
            "Apply_to_each_not_orphaned_custom_connector": {
              "foreach": "@outputs('List_custom_connectors_no_longer_orphaned')?['body/value']",
              "actions": {
                "If_custom_connector_owner_not_null": {
                  "actions": {
                    "Mark_custom_connector_not_orphaned": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "ef9665f8-2001-45dd-975a-f4f2851c0269"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "UpdateRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_connectors",
                          "recordId": "@items('Apply_to_each_not_orphaned_custom_connector')?['admin_connectorid']",
                          "item/admin_appisorphaned": "No"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    }
                  },
                  "runAfter": {},
                  "expression": {
                    "not": {
                      "equals": [
                        "@items('Apply_to_each_not_orphaned_custom_connector')?['_admin_maker_value']",
                        "@null"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "e6add358-a650-4cb9-9fa7-c065a84cd6e0"
                  },
                  "type": "If"
                }
              },
              "runAfter": {
                "List_custom_connectors_no_longer_orphaned": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "3b044552-2239-496f-8ef7-f8ce74d0af3d"
              },
              "type": "Foreach",
              "runtimeConfiguration": {
                "concurrency": {
                  "repetitions": 50
                }
              }
            },
            "List_BPFs_no_longer_orphaned": {
              "runAfter": {
                "Apply_to_each_not_orphaned_custom_connector": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "562924fc-8b7b-49f1-92dd-1405494e6a69"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_businessprocessflowses",
                  "$select": "admin_businessprocessflowsid, _admin_businessprocessflowowner_value",
                  "$filter": "admin_businessprocessflowdeleted ne true and admin_businessprocessflowisorphaned ne 'no' and admin_BusinessProcessFlowOwner/admin_makerisorphaned ne true",
                  "$expand": "admin_BusinessProcessFlowOwner($select=admin_makerisorphaned)"
                },
                "authentication": "@parameters('$authentication')"
              }
            },
            "Apply_to_each_not_orphaned_BPF": {
              "foreach": "@outputs('List_BPFs_no_longer_orphaned')?['body/value']",
              "actions": {
                "If_BPF_owner_not_null": {
                  "actions": {
                    "Mark_BPF_not_orphaned": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "14b60844-4f70-4d7a-8b02-0900e06f8a42"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps_1",
                          "operationId": "UpdateRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_businessprocessflowses",
                          "recordId": "@items('Apply_to_each_not_orphaned_BPF')?['admin_businessprocessflowsid']",
                          "item/admin_businessprocessflowisorphaned": "no"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    }
                  },
                  "runAfter": {},
                  "expression": {
                    "not": {
                      "equals": [
                        "@items('Apply_to_each_not_orphaned_BPF')?['_admin_businessprocessflowowner_value']",
                        "@null"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "8a894596-06ed-44df-8466-381c7169c1af"
                  },
                  "type": "If"
                }
              },
              "runAfter": {
                "List_BPFs_no_longer_orphaned": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "375030d3-cf17-4e0b-bad5-933124284a42"
              },
              "type": "Foreach",
              "runtimeConfiguration": {
                "concurrency": {
                  "repetitions": 50
                }
              }
            },
            "Check_if_BYODL_-_Find_No_Longer_Orphaned": {
              "actions": {
                "List_apps_no_longer_orphaned": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "562924fc-8b7b-49f1-92dd-1405494e6a69"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_apps",
                      "$select": "admin_appid, _admin_appowner_value",
                      "$filter": "admin_appdeleted ne true and cr5d5_appisorphaned ne 'no' and admin_AppOwner/admin_makerisorphaned ne true",
                      "$expand": "admin_AppOwner($select=admin_makerisorphaned)"
                    },
                    "authentication": "@parameters('$authentication')"
                  }
                },
                "Apply_to_each_not_orphaned_app": {
                  "foreach": "@outputs('List_apps_no_longer_orphaned')?['body/value']",
                  "actions": {
                    "If_app_owner_not_null": {
                      "actions": {
                        "Mark_app_not_orphaned": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "f071ba7c-1597-4530-a7aa-59811351dd4a"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_apps",
                              "recordId": "@items('Apply_to_each_not_orphaned_app')?['admin_appid']",
                              "item/cr5d5_appisorphaned": "No"
                            },
                            "authentication": "@parameters('$authentication')"
                          }
                        }
                      },
                      "runAfter": {},
                      "expression": {
                        "not": {
                          "equals": [
                            "@items('Apply_to_each_not_orphaned_app')?['_admin_appowner_value']",
                            "@null"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "942d77ba-406d-4be8-a3e8-d7d9b5b19f47"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "List_apps_no_longer_orphaned": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "1f4e72b9-d93a-424d-ab1d-403d815b74ee"
                  },
                  "type": "Foreach",
                  "runtimeConfiguration": {
                    "concurrency": {
                      "repetitions": 50
                    }
                  }
                },
                "List_flows_no_longer_orphaned": {
                  "runAfter": {
                    "Apply_to_each_not_orphaned_app": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "562924fc-8b7b-49f1-92dd-1405494e6a69"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_flows",
                      "$select": "admin_flowid, _admin_derivedowner_value",
                      "$filter": "admin_flowdeleted ne true and cr5d5_flowisorphaned ne 'no' and admin_DerivedOwner/admin_makerisorphaned ne true",
                      "$expand": "admin_DerivedOwner($select=admin_makerisorphaned)"
                    },
                    "authentication": "@parameters('$authentication')"
                  }
                },
                "Apply_to_each_not_orphaned_flow": {
                  "foreach": "@outputs('List_flows_no_longer_orphaned')?['body/value']",
                  "actions": {
                    "If_flow_owner_not_null": {
                      "actions": {
                        "Mark_flow_not_orphaned": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "dfdf08d0-59a0-4296-9d73-4231e8dfa8ba"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_flows",
                              "recordId": "@items('Apply_to_each_not_orphaned_flow')?['admin_flowid']",
                              "item/cr5d5_flowisorphaned": "No"
                            },
                            "authentication": "@parameters('$authentication')"
                          }
                        }
                      },
                      "runAfter": {},
                      "expression": {
                        "not": {
                          "equals": [
                            "@items('Apply_to_each_not_orphaned_flow')?['_admin_derivedowner_value']",
                            "@null"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "31ae4c6b-a96f-4895-91cb-aa5f44783650"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "List_flows_no_longer_orphaned": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "b57d5cc2-0ae5-474b-a536-7c5d78e93a8a"
                  },
                  "type": "Foreach",
                  "runtimeConfiguration": {
                    "concurrency": {
                      "repetitions": 50
                    }
                  }
                },
                "List_envts_no_longer_orphaned": {
                  "runAfter": {
                    "Apply_to_each_not_orphaned_flow": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "562924fc-8b7b-49f1-92dd-1405494e6a69"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_environments",
                      "$select": "admin_environmentid, _admin_maker_value",
                      "$filter": "admin_environmentdeleted ne true and admin_environmentisorphaned ne 'no' and admin_Maker/admin_makerisorphaned ne true",
                      "$expand": "admin_Maker($select=admin_makerisorphaned)"
                    },
                    "authentication": "@parameters('$authentication')"
                  }
                },
                "Apply_to_each_not_orphaned_envt": {
                  "foreach": "@outputs('List_envts_no_longer_orphaned')?['body/value']",
                  "actions": {
                    "If_envt_owner_not_null": {
                      "actions": {
                        "Mark_envt_not_orphaned": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "d4cb6af1-b448-4f97-9b86-34291a97cef5"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_environments",
                              "recordId": "@items('Apply_to_each_not_orphaned_envt')?['admin_environmentid']",
                              "item/admin_environmentisorphaned": "No"
                            },
                            "authentication": "@parameters('$authentication')"
                          }
                        }
                      },
                      "runAfter": {},
                      "expression": {
                        "not": {
                          "equals": [
                            "@items('Apply_to_each_not_orphaned_envt')?['_admin_maker_value']",
                            "@null"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "6626892a-f700-4fca-898a-b9cdfff30c76"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "List_envts_no_longer_orphaned": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "78d50d27-7eef-40a7-a1b1-b566e2fa06dd"
                  },
                  "type": "Foreach",
                  "runtimeConfiguration": {
                    "concurrency": {
                      "repetitions": 50
                    }
                  }
                }
              },
              "runAfter": {},
              "expression": {
                "not": {
                  "equals": [
                    "@parameters('Inventory and Telemetry in Azure Data Storage account (admin_InventoryandTelemetryinAzureDataStorageaccount)')",
                    "@true"
                  ]
                }
              },
              "metadata": {
                "operationMetadataId": "5e3720f9-451c-48b1-b60d-432b23ab4393"
              },
              "type": "If"
            }
          },
          "runAfter": {
            "Initialize_Flow_Environment_variable": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "e0f32238-060b-4ca6-a31f-42b7fb8f23ad"
          },
          "type": "Scope"
        },
        "Orphan_Makers_-_Error_Handling": {
          "actions": {
            "if_failure_occurred": {
              "actions": {
                "Create_a_new_record_-_Sync_Flow_Errors": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "0b009593-5797-43e6-9c77-d569fc4304bb"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "CreateRecord",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_syncflowerrorses",
                      "item/admin_name": "Admin | Sync Template v3 (Orphaned Makers)",
                      "item/admin_flowinstanceurl": "@concat(variables('flowEnvironment'), workflow()?['tags']['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])"
                    },
                    "authentication": "@parameters('$authentication')",
                    "retryPolicy": {
                      "type": "exponential",
                      "count": 10,
                      "interval": "PT10S"
                    }
                  }
                },
                "Terminate": {
                  "runAfter": {
                    "Update_Last_Run_Fail": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "37317aba-a6c8-44c7-ad2e-f78e0cfb94cc"
                  },
                  "type": "Terminate",
                  "inputs": {
                    "runStatus": "Failed",
                    "runError": {
                      "code": "500",
                      "message": "Orphan Makers Failed"
                    }
                  }
                },
                "Get_ID_Fail": {
                  "runAfter": {
                    "Create_a_new_record_-_Sync_Flow_Errors": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "47329bf2-8aac-400d-9778-a793b4f1180f"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_coesolutionmetadatas",
                      "$select": "admin_coesolutionmetadataid",
                      "$filter": "admin_objectguid eq @{workflow()?['name']}",
                      "$top": 1
                    },
                    "authentication": "@parameters('$authentication')"
                  }
                },
                "Update_Last_Run_Fail": {
                  "runAfter": {
                    "Get_ID_Fail": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "c63eb7cc-6101-4567-b520-a4a8881264e9"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "UpdateRecord",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_coesolutionmetadatas",
                      "recordId": "@first(outputs('Get_ID_Fail')?['body/value'])?['admin_coesolutionmetadataid']",
                      "item/admin_lastrun": "@utcNow()",
                      "item/admin_lastrunpassed": false
                    },
                    "authentication": "@parameters('$authentication')"
                  }
                }
              },
              "runAfter": {},
              "else": {
                "actions": {
                  "Update_last_run_as_pass": {
                    "actions": {
                      "Update_Last_Run_Successful": {
                        "runAfter": {
                          "Get_ID_Pass": [
                            "Succeeded"
                          ]
                        },
                        "metadata": {
                          "operationMetadataId": "78ef70e5-7f67-4737-9a02-8533f12caa19"
                        },
                        "type": "OpenApiConnection",
                        "inputs": {
                          "host": {
                            "connectionName": "shared_commondataserviceforapps",
                            "operationId": "UpdateRecord",
                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                          },
                          "parameters": {
                            "entityName": "admin_coesolutionmetadatas",
                            "recordId": "@first(outputs('Get_ID_Pass')?['body/value'])?['admin_coesolutionmetadataid']",
                            "item/admin_lastrun": "@utcNow()",
                            "item/admin_lastrunpassed": true
                          },
                          "authentication": "@parameters('$authentication')"
                        }
                      },
                      "Get_ID_Pass": {
                        "runAfter": {},
                        "metadata": {
                          "operationMetadataId": "f4f314b6-89d3-4056-af1c-73115e7d6bd1"
                        },
                        "type": "OpenApiConnection",
                        "inputs": {
                          "host": {
                            "connectionName": "shared_commondataserviceforapps",
                            "operationId": "ListRecords",
                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                          },
                          "parameters": {
                            "entityName": "admin_coesolutionmetadatas",
                            "$select": "admin_coesolutionmetadataid",
                            "$filter": "admin_objectguid eq @{workflow()?['name']}",
                            "$top": 1
                          },
                          "authentication": "@parameters('$authentication')"
                        }
                      },
                      "Catch_-_not_ready_to_take_last_run_date": {
                        "runAfter": {
                          "Update_Last_Run_Successful": [
                            "Failed"
                          ]
                        },
                        "metadata": {
                          "operationMetadataId": "29d324c3-e28e-4fa1-89f7-e27e7a521657"
                        },
                        "type": "Compose",
                        "inputs": "Catch - not ready to take last run date"
                      }
                    },
                    "runAfter": {},
                    "metadata": {
                      "operationMetadataId": "5c140442-d939-4ca4-8ec8-d1ee2bed4a81"
                    },
                    "type": "Scope"
                  }
                }
              },
              "expression": {
                "equals": [
                  "@variables('FailureOccurred')",
                  "@true"
                ]
              },
              "metadata": {
                "operationMetadataId": "4fe7de37-6e4b-4841-8d28-12e1db142953"
              },
              "type": "If"
            }
          },
          "runAfter": {
            "Set_FailureOccurred_true_-_new_orphans": [
              "Succeeded",
              "Skipped"
            ],
            "Set_FailureOccurred_true_-_old_orphan_checks": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "e0179844-f2ce-403f-80ca-1e51f39beee5"
          },
          "type": "Scope"
        },
        "Find_New_Orphans_and_Update_Existing_Makers": {
          "actions": {
            "List_Makers": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "90b2ba83-c24a-4ece-9a1d-30aabe4b1d38"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_makers",
                  "$select": "admin_makerid, admin_displayname",
                  "$filter": "admin_makerisorphaned ne true and admin_displayname ne 'SYSTEM'"
                },
                "authentication": "@parameters('$authentication')",
                "retryPolicy": {
                  "type": "exponential",
                  "count": 10,
                  "interval": "PT10S"
                }
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              }
            },
            "Apply_to_each_maker": {
              "foreach": "@outputs('List_Makers')?['body/value']",
              "actions": {
                "See_if_now_orphaned": {
                  "actions": {
                    "Mark_all_objects_as_orphaned": {
                      "actions": {
                        "Update_Maker_record_(mark_as_orphaned)": {
                          "runAfter": {
                            "Apply_to_each_BPF": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "0e6b1341-7c60-4816-9193-4f0c5d2c122f"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_makers",
                              "recordId": "@items('Apply_to_each_maker')?['admin_makerid']",
                              "item/admin_makerisorphaned": true
                            },
                            "authentication": "@parameters('$authentication')",
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          }
                        },
                        "Apply_to_each_connector": {
                          "foreach": "@outputs('List_custom_connectors_of_maker')?['body/value']",
                          "actions": {
                            "Update_Custom_Connector_(Mark_as_Orphaned)": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "48bd9892-84e6-4f45-bfa8-502b5528ac46"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "UpdateRecord",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_connectors",
                                  "recordId": "@items('Apply_to_each_connector')?['admin_connectorid']",
                                  "item/admin_appisorphaned": "Yes"
                                },
                                "authentication": "@parameters('$authentication')",
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 10,
                                  "interval": "PT10S"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "List_custom_connectors_of_maker": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "3c17c6ed-c564-4ef3-b8ad-23b9fceeb862"
                          },
                          "type": "Foreach",
                          "runtimeConfiguration": {
                            "concurrency": {
                              "repetitions": 50
                            }
                          }
                        },
                        "List_custom_connectors_of_maker": {
                          "runAfter": {
                            "Apply_to_each_UI_Flow": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "f420c595-bd4e-4bf5-a9aa-f293241209c9"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "ListRecords",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_connectors",
                              "$select": "admin_connectorid",
                              "$filter": "_admin_maker_value eq @{items('Apply_to_each_maker')?['admin_makerid']}"
                            },
                            "authentication": "@parameters('$authentication')"
                          },
                          "runtimeConfiguration": {
                            "paginationPolicy": {
                              "minimumItemCount": 100000
                            }
                          }
                        },
                        "Apply_to_each_UI_Flow": {
                          "foreach": "@outputs('List_UI_Flows_of_maker')?['body/value']",
                          "actions": {
                            "Update_UI_Flow_(Mark_as_orphaned)": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "d43d52a8-e6d6-4ef7-a72a-29d201841763"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "UpdateRecord",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_rpas",
                                  "recordId": "@items('Apply_to_each_UI_Flow')?['admin_rpaid']",
                                  "item/admin_rpaisorphaned": "Yes"
                                },
                                "authentication": "@parameters('$authentication')",
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 10,
                                  "interval": "PT10S"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "List_UI_Flows_of_maker": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "bb3d9017-c8a5-4be5-9c6b-571f3d1da7c2"
                          },
                          "type": "Foreach",
                          "runtimeConfiguration": {
                            "concurrency": {
                              "repetitions": 50
                            }
                          }
                        },
                        "List_UI_Flows_of_maker": {
                          "runAfter": {
                            "Apply_to_each_bot": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "9c007250-6f52-4838-89a6-9f0d28666301"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "ListRecords",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_rpas",
                              "$select": "admin_rpaid",
                              "$filter": "_admin_rpaowner_value eq @{items('Apply_to_each_maker')?['admin_makerid']}"
                            },
                            "authentication": "@parameters('$authentication')"
                          },
                          "runtimeConfiguration": {
                            "paginationPolicy": {
                              "minimumItemCount": 100000
                            }
                          }
                        },
                        "Apply_to_each_bot": {
                          "foreach": "@outputs('List_bots_of_maker')?['body/value']",
                          "actions": {
                            "Update_bot_(Mark_as_orphaned)": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "09560b67-6e3d-47b4-ab71-20650de445b1"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "UpdateRecord",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_pvas",
                                  "recordId": "@items('Apply_to_each_bot')?['admin_pvaid']",
                                  "item/admin_pvaisorphaned": "Yes"
                                },
                                "authentication": "@parameters('$authentication')",
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 10,
                                  "interval": "PT10S"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "List_bots_of_maker": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "b3a037e0-aa06-4676-9b65-c4e6c945d94f"
                          },
                          "type": "Foreach",
                          "runtimeConfiguration": {
                            "concurrency": {
                              "repetitions": 50
                            }
                          }
                        },
                        "List_bots_of_maker": {
                          "runAfter": {
                            "Check_if_BYODL_-_Mark_all_objects_as_orphaned": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "5d2f4977-25f0-4fab-b0c8-9b0f68d40b06"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "ListRecords",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_pvas",
                              "$select": "admin_pvaid",
                              "$filter": "_admin_pvaowner_value eq @{items('Apply_to_each_maker')?['admin_makerid']}"
                            },
                            "authentication": "@parameters('$authentication')"
                          },
                          "runtimeConfiguration": {
                            "paginationPolicy": {
                              "minimumItemCount": 100000
                            }
                          }
                        },
                        "List_BPFs_of_maker": {
                          "runAfter": {
                            "Apply_to_each_connector": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "f420c595-bd4e-4bf5-a9aa-f293241209c9"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "ListRecords",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_businessprocessflowses",
                              "$select": "admin_businessprocessflowsid",
                              "$filter": "_admin_businessprocessflowowner_value eq @{items('Apply_to_each_maker')?['admin_makerid']}"
                            },
                            "authentication": "@parameters('$authentication')"
                          },
                          "runtimeConfiguration": {
                            "paginationPolicy": {
                              "minimumItemCount": 100000
                            }
                          }
                        },
                        "Apply_to_each_BPF": {
                          "foreach": "@outputs('List_BPFs_of_maker')?['body/value']",
                          "actions": {
                            "Update_BPF_(Mark_as_Orphaned)": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "0b53e053-f8f9-4aa2-a534-7009dd21c733"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps_1",
                                  "operationId": "UpdateRecord",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_businessprocessflowses",
                                  "recordId": "@items('Apply_to_each_BPF')?['admin_businessprocessflowsid']",
                                  "item/admin_businessprocessflowisorphaned": "Yes"
                                },
                                "authentication": "@parameters('$authentication')"
                              }
                            }
                          },
                          "runAfter": {
                            "List_BPFs_of_maker": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "65c419d3-14f3-47b5-987f-d956fecaa98e"
                          },
                          "type": "Foreach"
                        },
                        "Check_if_BYODL_-_Mark_all_objects_as_orphaned": {
                          "actions": {
                            "List_apps_of_maker": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "076f9f86-8841-415a-87d9-8aaceade987a"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "ListRecords",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_apps",
                                  "$select": "admin_appid",
                                  "$filter": "_admin_appowner_value eq @{items('Apply_to_each_maker')?['admin_makerid']}"
                                },
                                "authentication": "@parameters('$authentication')"
                              },
                              "runtimeConfiguration": {
                                "paginationPolicy": {
                                  "minimumItemCount": 100000
                                }
                              }
                            },
                            "Apply_to_each_app": {
                              "foreach": "@outputs('List_apps_of_maker')?['body/value']",
                              "actions": {
                                "Update_App_(Mark_as_orphaned)": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "77f1ff8b-e39f-4cf2-a9d5-b9376c6ffe39"
                                  },
                                  "type": "OpenApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connectionName": "shared_commondataserviceforapps",
                                      "operationId": "UpdateRecord",
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                    },
                                    "parameters": {
                                      "entityName": "admin_apps",
                                      "recordId": "@items('Apply_to_each_app')?['admin_appid']",
                                      "item/cr5d5_appisorphaned": "Yes"
                                    },
                                    "authentication": "@parameters('$authentication')",
                                    "retryPolicy": {
                                      "type": "exponential",
                                      "count": 10,
                                      "interval": "PT10S"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "List_apps_of_maker": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "b79a34f0-23b2-43d9-96cb-3c2d03f6a6ac"
                              },
                              "type": "Foreach",
                              "runtimeConfiguration": {
                                "concurrency": {
                                  "repetitions": 50
                                }
                              }
                            },
                            "List_flows_of_maker": {
                              "runAfter": {
                                "Apply_to_each_app": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "63df4fee-f034-4bd3-8ec2-6ad959c6340d"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "ListRecords",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_flows",
                                  "$select": "admin_flowid",
                                  "$filter": "(_admin_flowcreator_value eq @{items('Apply_to_each_maker')?['admin_makerid']} and _admin_derivedowner_value eq null) or _admin_derivedowner_value eq @{items('Apply_to_each_maker')?['admin_makerid']}"
                                },
                                "authentication": "@parameters('$authentication')"
                              },
                              "runtimeConfiguration": {
                                "paginationPolicy": {
                                  "minimumItemCount": 100000
                                }
                              }
                            },
                            "Apply_to_each_flow": {
                              "foreach": "@outputs('List_flows_of_maker')?['body/value']",
                              "actions": {
                                "Update_Flow_(Mark_as_orphaned)": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "ae6aa268-42df-4abf-8e1a-d3212ab0ab58"
                                  },
                                  "type": "OpenApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connectionName": "shared_commondataserviceforapps",
                                      "operationId": "UpdateRecord",
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                    },
                                    "parameters": {
                                      "entityName": "admin_flows",
                                      "recordId": "@items('Apply_to_each_flow')?['admin_flowid']",
                                      "item/cr5d5_flowisorphaned": "Yes"
                                    },
                                    "authentication": "@parameters('$authentication')",
                                    "retryPolicy": {
                                      "type": "exponential",
                                      "count": 10,
                                      "interval": "PT10S"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "List_flows_of_maker": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "3e239d3c-e82a-4194-8d11-22814521e68a"
                              },
                              "type": "Foreach",
                              "runtimeConfiguration": {
                                "concurrency": {
                                  "repetitions": 50
                                }
                              }
                            },
                            "List_environments_of_maker": {
                              "runAfter": {
                                "Apply_to_each_flow": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "f89c5fe3-ebb5-4cdb-ba39-95e8776311f3"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "ListRecords",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_environments",
                                  "$select": "admin_environmentid",
                                  "$filter": "_admin_maker_value eq @{items('Apply_to_each_maker')?['admin_makerid']}"
                                },
                                "authentication": "@parameters('$authentication')"
                              },
                              "runtimeConfiguration": {
                                "paginationPolicy": {
                                  "minimumItemCount": 100000
                                }
                              }
                            },
                            "Apply_to_each_environment": {
                              "foreach": "@outputs('List_environments_of_maker')?['body/value']",
                              "actions": {
                                "Update_Environment_(Mark_as_Orphaned)": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "4ade1d3a-ae73-4cea-ab79-2a04b8dfee82"
                                  },
                                  "type": "OpenApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connectionName": "shared_commondataserviceforapps",
                                      "operationId": "UpdateRecord",
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                    },
                                    "parameters": {
                                      "entityName": "admin_environments",
                                      "recordId": "@items('Apply_to_each_environment')?['admin_environmentid']",
                                      "item/admin_environmentisorphaned": "Yes"
                                    },
                                    "authentication": "@parameters('$authentication')",
                                    "retryPolicy": {
                                      "type": "exponential",
                                      "count": 10,
                                      "interval": "PT10S"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "List_environments_of_maker": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "3962d28a-ede9-46e9-91d1-31f97e603192"
                              },
                              "type": "Foreach",
                              "runtimeConfiguration": {
                                "concurrency": {
                                  "repetitions": 50
                                }
                              }
                            }
                          },
                          "runAfter": {},
                          "expression": {
                            "not": {
                              "equals": [
                                "@parameters('Inventory and Telemetry in Azure Data Storage account (admin_InventoryandTelemetryinAzureDataStorageaccount)')",
                                "@true"
                              ]
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "52eb39d3-eeff-49d7-97e5-31313c3c8153"
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "7ec95aa1-f97e-411c-a414-bc621c355011"
                      },
                      "type": "Scope"
                    }
                  },
                  "runAfter": {
                    "Get_Maker": [
                      "Succeeded"
                    ]
                  },
                  "else": {
                    "actions": {
                      "update_photo": {
                        "actions": {
                          "Get_user_photo_(V2)": {
                            "runAfter": {},
                            "metadata": {
                              "operationMetadataId": "13627757-0515-4f83-a6af-1433e23cc132"
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_office365users_1",
                                "operationId": "UserPhoto_V2",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
                              },
                              "parameters": {
                                "id": "@items('Apply_to_each_maker')?['admin_makerid']"
                              },
                              "authentication": "@parameters('$authentication')"
                            }
                          },
                          "update_if_not_null": {
                            "actions": {
                              "Upload_a_file_or_an_image": {
                                "runAfter": {},
                                "metadata": {
                                  "operationMetadataId": "4cbb8ce5-4851-4dcf-9fb8-d72e76c61404"
                                },
                                "type": "OpenApiConnection",
                                "inputs": {
                                  "host": {
                                    "connectionName": "shared_commondataserviceforapps",
                                    "operationId": "UpdateEntityFileImageFieldContent",
                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                  },
                                  "parameters": {
                                    "entityName": "admin_makers",
                                    "recordId": "@items('Apply_to_each_maker')?['admin_makerid']",
                                    "fileImageFieldName": "admin_photoobject",
                                    "item": "@body('Get_user_photo_(V2)')",
                                    "x-ms-file-name": "@{items('Apply_to_each_maker')?['admin_makerid']}_pic"
                                  },
                                  "authentication": "@parameters('$authentication')"
                                }
                              }
                            },
                            "runAfter": {
                              "Get_user_photo_(V2)": [
                                "Succeeded"
                              ]
                            },
                            "expression": {
                              "not": {
                                "equals": [
                                  "@body('Get_user_photo_(V2)')",
                                  "@null"
                                ]
                              }
                            },
                            "metadata": {
                              "operationMetadataId": "ac114f65-c049-4d49-8b94-04587e641a73"
                            },
                            "type": "If"
                          }
                        },
                        "runAfter": {
                          "update_managers": [
                            "Succeeded"
                          ]
                        },
                        "metadata": {
                          "operationMetadataId": "bd6fef1b-7d30-4b75-a969-f1af0c3d4627"
                        },
                        "type": "Scope"
                      },
                      "update_user_table_as_well": {
                        "actions": {
                          "Get_Maker_as_User": {
                            "runAfter": {},
                            "metadata": {
                              "operationMetadataId": "5851244c-0aa9-44f8-86fc-5014bcff13dd"
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_commondataserviceforapps",
                                "operationId": "ListRecords",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                              },
                              "parameters": {
                                "entityName": "admin_powerplatformusers",
                                "$select": "admin_powerplatformuserid",
                                "$filter": "admin_powerplatformuserid eq @{items('Apply_to_each_maker')?['admin_makerid']}"
                              },
                              "authentication": "@parameters('$authentication')"
                            }
                          },
                          "Update_or_Insert_Maker_as_User": {
                            "actions": {
                              "Update_Maker_as_User": {
                                "runAfter": {},
                                "metadata": {
                                  "operationMetadataId": "0d960717-00da-48f8-b0c8-7853056f2ce4"
                                },
                                "type": "OpenApiConnection",
                                "inputs": {
                                  "host": {
                                    "connectionName": "shared_commondataserviceforapps",
                                    "operationId": "UpdateRecord",
                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                  },
                                  "parameters": {
                                    "entityName": "admin_powerplatformusers",
                                    "recordId": "@items('Apply_to_each_maker')?['admin_makerid']",
                                    "item/admin_displayname": "@body('Get_Maker')?['userdisplayname']",
                                    "item/admin_company": "@body('Get_Maker')?['usercompany']",
                                    "item/admin_department": "@body('Get_Maker')?['userdepartment']",
                                    "item/admin_groupsize": 1,
                                    "item/admin_userprincipalname": "@body('Get_Maker')?['useremail']",
                                    "item/admin_userprinciplenamewithoutspecialchars": "@replace(body('Get_Maker')?['useremail'],'''','_')"
                                  },
                                  "authentication": "@parameters('$authentication')"
                                }
                              }
                            },
                            "runAfter": {
                              "Get_Maker_as_User": [
                                "Succeeded"
                              ]
                            },
                            "else": {
                              "actions": {
                                "Insert_Maker_as_User": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "db684253-0596-46ea-bf0c-ee48a5dd30e4"
                                  },
                                  "type": "OpenApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connectionName": "shared_commondataserviceforapps",
                                      "operationId": "CreateRecord",
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                    },
                                    "parameters": {
                                      "entityName": "admin_powerplatformusers",
                                      "item/admin_displayname": "@body('Get_Maker')?['userdisplayname']",
                                      "item/admin_company": "@body('Get_Maker')?['usercompany']",
                                      "item/admin_department": "@body('Get_Maker')?['userdepartment']",
                                      "item/admin_groupsize": 1,
                                      "item/admin_powerplatformuserid": "@items('Apply_to_each_maker')?['admin_makerid']",
                                      "item/admin_userprincipalname": "@body('Get_Maker')?['useremail']",
                                      "item/admin_userprinciplenamewithoutspecialchars": "@replace(body('Get_Maker')?['useremail'],'''','_')"
                                    },
                                    "authentication": "@parameters('$authentication')"
                                  }
                                }
                              }
                            },
                            "expression": {
                              "greater": [
                                "@length(outputs('Get_Maker_as_User')?['body/value'])",
                                0
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "b5a019a9-0ae8-4afb-bcbc-db2d4e4cb148"
                            },
                            "type": "If"
                          },
                          "Update_Maker_as_User_pic,_if_not_null": {
                            "actions": {
                              "Upload_pic_of_Maker_as_User": {
                                "runAfter": {},
                                "metadata": {
                                  "operationMetadataId": "bd3a1e7a-2b7c-499f-9d73-e965f70ee77e"
                                },
                                "type": "OpenApiConnection",
                                "inputs": {
                                  "host": {
                                    "connectionName": "shared_commondataserviceforapps",
                                    "operationId": "UpdateEntityFileImageFieldContent",
                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                  },
                                  "parameters": {
                                    "entityName": "admin_powerplatformusers",
                                    "recordId": "@items('Apply_to_each_maker')?['admin_makerid']",
                                    "fileImageFieldName": "admin_photoobject",
                                    "item": "@body('Get_user_photo_(V2)')",
                                    "x-ms-file-name": "@{items('Apply_to_each_maker')?['admin_makerid']}_pic"
                                  },
                                  "authentication": "@parameters('$authentication')"
                                }
                              }
                            },
                            "runAfter": {
                              "Update_or_Insert_Maker_as_User": [
                                "Succeeded"
                              ]
                            },
                            "expression": {
                              "not": {
                                "equals": [
                                  "@body('Get_user_photo_(V2)')",
                                  "@null"
                                ]
                              }
                            },
                            "metadata": {
                              "operationMetadataId": "ac114f65-c049-4d49-8b94-04587e641a73"
                            },
                            "type": "If"
                          }
                        },
                        "runAfter": {
                          "update_photo": [
                            "Succeeded"
                          ]
                        },
                        "metadata": {
                          "operationMetadataId": "1c8363f4-84fa-4f7a-aee5-85c73f6de16c"
                        },
                        "type": "Scope"
                      },
                      "update_maker_details": {
                        "actions": {
                          "Update_Maker": {
                            "runAfter": {},
                            "metadata": {
                              "operationMetadataId": "c98bea1b-eb35-4184-b0d7-4e7aa2fa13bb"
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_commondataserviceforapps_1",
                                "operationId": "UpdateRecord",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                              },
                              "parameters": {
                                "entityName": "admin_makers",
                                "recordId": "@items('Apply_to_each_maker')?['admin_makerid']",
                                "item/admin_displayname": "@body('Get_Maker')?['userdisplayname']",
                                "item/admin_accountenabled": "@body('Get_Maker')?['userisenabled']",
                                "item/admin_city": "@body('Get_Maker')?['usercity']",
                                "item/admin_company": "@body('Get_Maker')?['usercompany']",
                                "item/admin_country": "@body('Get_Maker')?['usercountry']",
                                "item/admin_department": "@body('Get_Maker')?['userdepartment']",
                                "item/admin_makerisorphaned": false,
                                "item/admin_managerprinciplename": "@body('Get_Maker')?['useremail']",
                                "item/admin_preferredlanguage": "@body('Get_Maker')?['userpreferredlanguage']",
                                "item/admin_userprincipalname": "@body('Get_Maker')?['useremail']",
                                "item/admin_userprinciplenamewithoutspecialchars": "@replace(body('Get_Maker')?['useremail'],'''','_')",
                                "item/admin_userisserviceprinciple": "@body('Get_Maker')?['userisserviceprinciple']"
                              },
                              "authentication": "@parameters('$authentication')"
                            }
                          }
                        },
                        "runAfter": {},
                        "metadata": {
                          "operationMetadataId": "4d1f88fd-daef-46c6-bc18-d29b9afad49f"
                        },
                        "type": "Scope"
                      },
                      "update_managers": {
                        "actions": {
                          "get_M1_info_if_not_null": {
                            "actions": {
                              "update_M1_and_get_M2_info_if_not_null": {
                                "actions": {
                                  "Update_Maker_Manager_M1": {
                                    "runAfter": {},
                                    "metadata": {
                                      "operationMetadataId": "5f9b14c5-4afb-4eee-bc48-aa4c5a30c11b"
                                    },
                                    "type": "OpenApiConnection",
                                    "inputs": {
                                      "host": {
                                        "connectionName": "shared_commondataserviceforapps",
                                        "operationId": "UpdateRecord",
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                      },
                                      "parameters": {
                                        "entityName": "admin_makers",
                                        "recordId": "@items('Apply_to_each_maker')?['admin_makerid']",
                                        "item/admin_makerisorphaned": false,
                                        "item/admin_managerid": "@outputs('Get_M1_manager')?['body/id']",
                                        "item/admin_managerprinciplename": "@outputs('Get_M1_manager')?['body/userPrincipalName']"
                                      },
                                      "authentication": "@parameters('$authentication')",
                                      "retryPolicy": {
                                        "type": "exponential",
                                        "count": 10,
                                        "interval": "PT10S"
                                      }
                                    }
                                  },
                                  "Get_M2_manager": {
                                    "runAfter": {
                                      "Update_Maker_Manager_M1": [
                                        "Succeeded"
                                      ]
                                    },
                                    "metadata": {
                                      "operationMetadataId": "f0fff3e6-617a-411b-aa79-827e71477622"
                                    },
                                    "type": "OpenApiConnection",
                                    "inputs": {
                                      "host": {
                                        "connectionName": "shared_office365users_1",
                                        "operationId": "Manager_V2",
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
                                      },
                                      "parameters": {
                                        "id": "@outputs('Get_M1_manager')?['body/id']",
                                        "$select": "id, userPrincipalName"
                                      },
                                      "authentication": "@parameters('$authentication')"
                                    }
                                  },
                                  "catch_no_M2": {
                                    "runAfter": {
                                      "Get_M2_manager": [
                                        "Failed"
                                      ]
                                    },
                                    "metadata": {
                                      "operationMetadataId": "37511043-7669-47aa-8ec5-d486c948ec8b"
                                    },
                                    "type": "Compose",
                                    "inputs": "catch no M2"
                                  },
                                  "update_M2_info_if_not_null": {
                                    "actions": {
                                      "Update_Maker_Manager_M2": {
                                        "runAfter": {},
                                        "metadata": {
                                          "operationMetadataId": "9153585c-413c-43ff-860d-3954410a084d"
                                        },
                                        "type": "OpenApiConnection",
                                        "inputs": {
                                          "host": {
                                            "connectionName": "shared_commondataserviceforapps",
                                            "operationId": "UpdateRecord",
                                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                          },
                                          "parameters": {
                                            "entityName": "admin_makers",
                                            "recordId": "@items('Apply_to_each_maker')?['admin_makerid']",
                                            "item/admin_m2managerprinciplename": "@outputs('Get_M2_manager')?['body/userPrincipalName']"
                                          },
                                          "authentication": "@parameters('$authentication')",
                                          "retryPolicy": {
                                            "type": "exponential",
                                            "count": 10,
                                            "interval": "PT10S"
                                          }
                                        }
                                      }
                                    },
                                    "runAfter": {
                                      "catch_no_M2": [
                                        "Succeeded",
                                        "Skipped"
                                      ]
                                    },
                                    "expression": {
                                      "not": {
                                        "equals": [
                                          "@outputs('Get_M2_manager')?['body/id']",
                                          "@null"
                                        ]
                                      }
                                    },
                                    "metadata": {
                                      "operationMetadataId": "59a82464-b3ba-41e4-8bc0-3891e483502a"
                                    },
                                    "type": "If"
                                  }
                                },
                                "runAfter": {
                                  "catch_no_M1": [
                                    "Succeeded",
                                    "Skipped"
                                  ]
                                },
                                "expression": {
                                  "not": {
                                    "equals": [
                                      "@outputs('Get_M1_manager')?['body/id']",
                                      "@null"
                                    ]
                                  }
                                },
                                "metadata": {
                                  "operationMetadataId": "562e4720-5a0f-4498-8c8f-5ce8500f9ea2"
                                },
                                "type": "If"
                              },
                              "Get_M1_manager": {
                                "runAfter": {},
                                "metadata": {
                                  "operationMetadataId": "83ff4099-e870-45ab-b06f-0ee210edd1e2"
                                },
                                "type": "OpenApiConnection",
                                "inputs": {
                                  "host": {
                                    "connectionName": "shared_office365users_1",
                                    "operationId": "Manager_V2",
                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
                                  },
                                  "parameters": {
                                    "id": "@items('Apply_to_each_maker')?['admin_makerid']",
                                    "$select": "id, userPrincipalName"
                                  },
                                  "authentication": "@parameters('$authentication')"
                                }
                              },
                              "catch_no_M1": {
                                "runAfter": {
                                  "Get_M1_manager": [
                                    "Failed"
                                  ]
                                },
                                "metadata": {
                                  "operationMetadataId": "b0cf7566-390d-4455-a8de-facf8b1b0d6f"
                                },
                                "type": "Compose",
                                "inputs": "catch no M1"
                              }
                            },
                            "runAfter": {},
                            "expression": {
                              "greater": [
                                "@length(outputs('Get_Maker')?['Body']?['usermanagerid'])",
                                0
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "c6b0b4d0-9fcc-4dee-b07d-d7efcd724277"
                            },
                            "type": "If"
                          }
                        },
                        "runAfter": {
                          "update_maker_details": [
                            "Succeeded"
                          ]
                        },
                        "metadata": {
                          "operationMetadataId": "cce0ba1d-5017-4513-b77e-2cf700c75073"
                        },
                        "type": "Scope"
                      }
                    }
                  },
                  "expression": {
                    "equals": [
                      "@outputs('Get_Maker')?['Body']?['userisorphan']",
                      "True"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "0e03ac0e-d929-4633-a489-7328e33be887"
                  },
                  "type": "If"
                },
                "Get_Maker": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "f610c4d0-eed5-4453-ad3b-43d6d3245460"
                  },
                  "type": "Workflow",
                  "inputs": {
                    "host": {
                      "workflowReferenceName": "9301f01a-cb40-ec11-8c62-00224829b4c1"
                    },
                    "body": {
                      "text": "@items('Apply_to_each_maker')?['admin_makerid']",
                      "text_1": "@items('Apply_to_each_maker')?['admin_displayname']",
                      "boolean": true
                    }
                  }
                }
              },
              "runAfter": {
                "List_Makers": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "032252cf-9686-47a9-bc4e-a154d2fb9339"
              },
              "type": "Foreach",
              "runtimeConfiguration": {
                "concurrency": {
                  "repetitions": 50
                }
              }
            }
          },
          "runAfter": {
            "Initialize_Flow_Environment_variable": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "bf74b53e-e858-49de-b356-2a9b6893ec79"
          },
          "type": "Scope"
        },
        "Initialize_FailureOccurred": {
          "runAfter": {},
          "metadata": {
            "operationMetadataId": "53dff7d9-317d-4a5a-b8e1-545a24aa4be5"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "FailureOccurred",
                "type": "boolean",
                "value": "@false"
              }
            ]
          }
        },
        "Set_FailureOccurred_true_-_new_orphans": {
          "runAfter": {
            "Find_New_Orphans_and_Update_Existing_Makers": [
              "Failed"
            ]
          },
          "metadata": {
            "operationMetadataId": "d6963e02-ece9-45d2-9548-d64f5b142682"
          },
          "type": "SetVariable",
          "inputs": {
            "name": "FailureOccurred",
            "value": "@true"
          }
        },
        "Set_FailureOccurred_true_-_old_orphan_checks": {
          "runAfter": {
            "Find_No_Longer_Orphaned": [
              "Failed"
            ]
          },
          "metadata": {
            "operationMetadataId": "d2e512fc-f510-415d-87b9-98fa7fc432d1"
          },
          "type": "SetVariable",
          "inputs": {
            "name": "FailureOccurred",
            "value": "@true"
          }
        }
      },
      "outputs": {}
    },
    "templateName": ""
  },
  "schemaVersion": "1.0.0.0"
}