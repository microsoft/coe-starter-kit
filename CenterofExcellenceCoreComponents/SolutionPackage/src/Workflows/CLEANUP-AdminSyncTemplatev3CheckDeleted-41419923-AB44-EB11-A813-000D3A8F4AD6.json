{
  "properties": {
    "connectionReferences": {
      "shared_powerplatformforadmins_1": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerPlatformforAdmins"
        },
        "api": {
          "name": "shared_powerplatformforadmins"
        }
      },
      "shared_commondataserviceforapps": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_sharedcommondataserviceforapps_98924"
        },
        "api": {
          "name": "shared_commondataserviceforapps"
        }
      },
      "shared_commondataserviceforapps_1": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_sharedcommondataserviceforapps_98924"
        },
        "api": {
          "name": "shared_commondataserviceforapps"
        }
      },
      "shared_commondataservice": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreDataverseLegacy"
        },
        "api": {
          "name": "shared_commondataservice"
        }
      },
      "shared_powerappsforadmins": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerAppsAdmin2"
        },
        "api": {
          "name": "shared_powerappsforadmins"
        }
      },
      "shared_flowmanagement": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerAutomateManagement"
        },
        "api": {
          "name": "shared_flowmanagement"
        }
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        },
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "Also Delete From CoE (admin_DeleteFromCoE)": {
          "defaultValue": "yes",
          "type": "String",
          "metadata": {
            "schemaName": "admin_DeleteFromCoE",
            "description": "when we run \"Admin | Sync Template v2 (Check Deleted)\", delete the items from CoE (yes) or just mark deleted (no)"
          }
        },
        "Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)": {
          "defaultValue": "https://flow.microsoft.com/manage/environments/",
          "type": "String",
          "metadata": {
            "schemaName": "admin_PowerAutomateEnvironmentVariable",
            "description": "REQUIRED. Environment, including geographic location, for Power Automate - Ex for commercial: https://flow.microsoft.com/manage/environments/"
          }
        },
        "Inventory and Telemetry in Azure Data Storage account (admin_InventoryandTelemetryinAzureDataStorageaccount)": {
          "defaultValue": false,
          "type": "Bool",
          "metadata": {
            "schemaName": "admin_InventoryandTelemetryinAzureDataStorageaccount",
            "description": "Have you set up data export in PPAC and is your inventory and telemetry in an Azure Data Storage folder (also referred to as Bring your own Datalake, self-serve analytics feature)"
          }
        }
      },
      "triggers": {
        "Recurrence": {
          "recurrence": {
            "frequency": "Week",
            "interval": 2,
            "schedule": {
              "weekDays": [
                "Saturday"
              ]
            }
          },
          "metadata": {
            "operationMetadataId": "1309ceff-cca9-4e22-a480-7ab3e793bddd"
          },
          "type": "Recurrence"
        }
      },
      "actions": {
        "Get_Environments": {
          "runAfter": {
            "Deletes_old_items_from_CoE_inventory": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "df9ec811-25ed-4574-a7be-c4537561ea3b"
          },
          "type": "OpenApiConnection",
          "inputs": {
            "host": {
              "connectionName": "shared_powerplatformforadmins_1",
              "operationId": "Get-AdminEnvironment",
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_powerplatformforadmins"
            },
            "parameters": {
              "api-version": "2020-09-01"
            },
            "authentication": "@parameters('$authentication')",
            "retryPolicy": {
              "type": "exponential",
              "count": 10,
              "interval": "PT10S"
            }
          },
          "runtimeConfiguration": {
            "paginationPolicy": {
              "minimumItemCount": 100000
            }
          }
        },
        "Initialize_GuidFound": {
          "runAfter": {
            "Initialize_failureOccurred": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "0a801dc1-674a-418b-b00b-18177b68d938"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "GuidFound",
                "type": "string"
              }
            ]
          }
        },
        "Initialize_failureOccurred": {
          "runAfter": {},
          "metadata": {
            "operationMetadataId": "43d91629-f6a2-4421-bf15-487cb255a233"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "failureOccurred",
                "type": "boolean",
                "value": "@false"
              }
            ]
          }
        },
        "Initialize_systemMaker": {
          "runAfter": {
            "Initialize_GuidFound": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "9d8982a2-6a67-4326-9ee9-3f1da51e5a8e"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": " systemMaker",
                "type": "string"
              }
            ]
          },
          "description": "SYSTEM maker is used to identify the owner record for Environments generated by the system, such as the default environment"
        },
        "Initialize_varDeleteFromCoE": {
          "runAfter": {
            "Initialize_variable_flowEnvironment": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "bb64281e-bb45-4630-a482-f4f748c56824"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "varDeleteFromCoE",
                "type": "string",
                "value": "@parameters('Also Delete From CoE (admin_DeleteFromCoE)')"
              }
            ]
          }
        },
        "Initialize_varNoBots": {
          "runAfter": {
            "Initialize_DeleteFromCoE": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "f1a346e2-5cd9-44ab-9d9c-0dd16a14a502"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "varNoBots",
                "type": "boolean",
                "value": "@false"
              }
            ]
          }
        },
        "Initialize_variable_flowEnvironment": {
          "runAfter": {
            "Initialize_variable_today": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "5a818d12-3acd-4dd8-903b-6f33b6204e0c"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "flowEnvironment",
                "type": "string",
                "value": "@parameters('Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)')"
              }
            ]
          },
          "description": "Environment location specific Flow URL - remember / at the end"
        },
        "Initialize_variable_today": {
          "runAfter": {
            "Initialize_systemMaker": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "1a97d296-4d56-452e-af90-bfcaee002e8b"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "today",
                "type": "string",
                "value": "@{utcNow()}"
              }
            ]
          }
        },
        "Newly_Deleted_Environments": {
          "actions": {
            "Check_if_BYODL_-_Environments": {
              "actions": {
                "List_CoE_Environments_not_marked_deleted_-_pre_new_deletes": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "b704cf19-76ae-4b56-b9fe-93a56935f39f"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_environments",
                      "$select": "admin_environmentid, admin_environmentsku, admin_environmentname, admin_environmentdeletedon",
                      "$filter": "admin_environmentdeleted eq false"
                    },
                    "authentication": "@parameters('$authentication')",
                    "retryPolicy": {
                      "type": "exponential",
                      "count": 10,
                      "interval": "PT10S"
                    }
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "For_Each_non_del_env_in_CoE": {
                  "foreach": "@outputs('List_CoE_Environments_not_marked_deleted_-_pre_new_deletes')?['body/value']",
                  "actions": {
                    "Find_env_in_tenant": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "914e313a-a008-4246-b1a7-a81966511214"
                      },
                      "type": "Query",
                      "inputs": {
                        "from": "@body('Select')",
                        "where": "@equals(item()['name'], items('For_Each_non_del_env_in_CoE')?['admin_environmentname'])"
                      }
                    },
                    "If_Not_Found,_mark_it_and_its_objects_as_deleted": {
                      "actions": {
                        "Mark_Environment_as_deleted": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "e0c9dd82-239c-4488-a786-6b3254e80ea2"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_environments",
                              "recordId": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentid']",
                              "item/admin_environmentdeleted": true,
                              "item/admin_environmentdeletedon": "@utcNow()"
                            },
                            "authentication": "@parameters('$authentication')",
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          }
                        },
                        "Call_Canvas_Helper_-_delete_all": {
                          "runAfter": {
                            "Mark_Environment_as_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "df1f53a7-a4c1-41e6-9b7b-20c741931892"
                          },
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "2e6ae3e2-8afb-eb11-94ef-002248237d7d"
                            },
                            "body": {
                              "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "boolean": false,
                              "boolean_1": "@variables('DeleteFromCoE')",
                              "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                            }
                          }
                        },
                        "check_return_-_Call_Canvas_Helper_-_delete_all": {
                          "actions": {
                            "set_failure_occurred_true_-_Call_Canvas_Helper_-_delete_all": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "b2004d1c-bbfd-4fbb-b378-2810d8c74761"
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "failureOccurred",
                                "value": "@true"
                              }
                            },
                            "Append_Failure_-_Deleted_Envts_-_Canvas": {
                              "runAfter": {
                                "set_failure_occurred_true_-_Call_Canvas_Helper_-_delete_all": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "varFailures",
                                "value": {
                                  "which loop": "deleted envts",
                                  "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                                  "obj type": "canvas"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Call_Canvas_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@outputs('Call_Canvas_Helper_-_delete_all')?['Body']?['thereturnvalue']",
                                "pass"
                              ]
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "85e0a2bf-db51-43da-a444-f3946ee744c7"
                          },
                          "type": "If"
                        },
                        "Call_Cloud_Flow_Helper_-_delete_all": {
                          "runAfter": {
                            "Mark_Environment_as_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "06f31bf3-ded6-4485-9492-cea0c0d2787a"
                          },
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "6bd20554-9bfb-eb11-94ef-002248237d7d"
                            },
                            "body": {
                              "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "boolean": false,
                              "boolean_1": "@variables('DeleteFromCoE')",
                              "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                            }
                          }
                        },
                        "check_return_-_Call_Cloud_Flow_Helper_-_delete_all": {
                          "actions": {
                            "set_failure_occurred_true_-_Call_Cloud_Flow_Helper_-_delete_all": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "d4d12add-c1bb-4180-89aa-4e3bf0760778"
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "failureOccurred",
                                "value": "@true"
                              }
                            },
                            "Append_Failure_-_Deleted_Envts_-_flows": {
                              "runAfter": {
                                "set_failure_occurred_true_-_Call_Cloud_Flow_Helper_-_delete_all": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "varFailures",
                                "value": {
                                  "which loop": "deleted envts",
                                  "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                                  "obj type": "flows"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Call_Cloud_Flow_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@outputs('Call_Cloud_Flow_Helper_-_delete_all')?['Body']?['thereturnvalue']",
                                "pass"
                              ]
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "f0c7d502-daca-440c-9f4e-b837e1748d8b"
                          },
                          "type": "If"
                        },
                        "Call_MDA_Helper_-_delete_all": {
                          "runAfter": {
                            "Mark_Environment_as_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "09ec10f1-418d-4fa8-a577-21e07a28c1e9"
                          },
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "9a470548-58fc-eb11-94ef-002248237f74"
                            },
                            "body": {
                              "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "boolean": false,
                              "boolean_1": "@variables('DeleteFromCoE')",
                              "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                            }
                          }
                        },
                        "check_return_-_Call_MDA_Helper_-_delete_all": {
                          "actions": {
                            "set_failure_occurred_true_-_Call_MDA_Helper_-_delete_all": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "b36373a8-b46d-4cc4-a6e3-e994e4672d77"
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "failureOccurred",
                                "value": "@true"
                              }
                            },
                            "Append_Failure_-_Deleted_Envts_-_MDAs": {
                              "runAfter": {
                                "set_failure_occurred_true_-_Call_MDA_Helper_-_delete_all": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "varFailures",
                                "value": {
                                  "which loop": "deleted envts",
                                  "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                                  "obj type": "MDAs"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Call_MDA_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@outputs('Call_MDA_Helper_-_delete_all')?['Body']?['thereturnvalue']",
                                "pass"
                              ]
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "ddcc53d6-a35f-4edf-b126-33e34bec0ff7"
                          },
                          "type": "If"
                        },
                        "Call_PVA_Helper_-_delete_all": {
                          "runAfter": {
                            "Mark_Environment_as_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "87153866-f090-4e51-92a6-8d47bee10319"
                          },
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "ffd82928-64fc-eb11-94ef-002248237d7d"
                            },
                            "body": {
                              "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "boolean": false,
                              "boolean_1": "@variables('DeleteFromCoE')",
                              "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                            }
                          }
                        },
                        "check_return_-_Call_PVA_Helper_-_delete_all": {
                          "actions": {
                            "set_failure_occurred_true_-_Call_PVA_Helper_-_delete_all": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "d3446123-7ec3-41cf-b67e-48a921cbae68"
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "failureOccurred",
                                "value": "@true"
                              }
                            },
                            "Append_Failure_-_Deleted_Envts_-_PVAs": {
                              "runAfter": {
                                "set_failure_occurred_true_-_Call_PVA_Helper_-_delete_all": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "varFailures",
                                "value": {
                                  "which loop": "deleted envts",
                                  "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                                  "obj type": "PVAs"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Call_PVA_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@body('Call_PVA_Helper_-_delete_all')?['thereturnvalue']",
                                "pass"
                              ]
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "9a7fced8-dcec-4d9c-826a-f1c5ebc18f9c"
                          },
                          "type": "If"
                        },
                        "Call_Custom_Connector_Helper_-_delete_all": {
                          "runAfter": {
                            "Mark_Environment_as_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "7cb47e42-d766-4da1-ad39-4d230048d52a"
                          },
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "b3f4f0d4-cb1b-ec11-b6e6-00224828c7b0"
                            },
                            "body": {
                              "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "boolean": false,
                              "boolean_1": "@variables('DeleteFromCoE')",
                              "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                            }
                          }
                        },
                        "check_return_-_Call_Custom_Connector_Helper_-_delete_all": {
                          "actions": {
                            "set_failure_occurred_true_-_Call_Custom_Connector_Helper_-_delete_all": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "b550df2c-e3c7-40c0-8a6a-81b0f272d024"
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "failureOccurred",
                                "value": "@true"
                              }
                            },
                            "Append_Failure_-_Deleted_Envts_-_Custom_Connectors": {
                              "runAfter": {
                                "set_failure_occurred_true_-_Call_Custom_Connector_Helper_-_delete_all": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "varFailures",
                                "value": {
                                  "which loop": "deleted envts",
                                  "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                                  "obj type": "custom connectors"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Call_Custom_Connector_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@outputs('Call_Custom_Connector_Helper_-_delete_all')?['Body']?['thereturnvalue']",
                                "pass"
                              ]
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "3c2776a3-5ca9-4545-b6de-f954083cfdeb"
                          },
                          "type": "If"
                        },
                        "Call_BPF_Helper_-_delete_all": {
                          "runAfter": {
                            "Mark_Environment_as_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "369d3db6-b662-4329-9bf8-f42097025139"
                          },
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "bc9de9b5-a8ed-ec11-bb3d-000d3a8fbe6e"
                            },
                            "body": {
                              "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "boolean": false,
                              "boolean_1": "@variables('DeleteFromCoE')",
                              "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                            }
                          }
                        },
                        "check_return_-_Call_BPF_Helper_-_delete_all": {
                          "actions": {
                            "set_failure_occurred_true_-_Call_BPF_Helper_-_delete_all": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "da6b90b2-3ab1-47ab-9248-23a25cf0278a"
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "failureOccurred",
                                "value": "@true"
                              }
                            },
                            "Append_Failure_-_Deleted_Envts_-_BPF": {
                              "runAfter": {
                                "set_failure_occurred_true_-_Call_BPF_Helper_-_delete_all": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "eaff0f3a-c398-4a4d-a168-1d6eb6146834"
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "varFailures",
                                "value": {
                                  "which loop": "deleted envts",
                                  "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                                  "obj type": "BPFs"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Call_BPF_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@body('Call_BPF_Helper_-_delete_all')?['thereturnvalue']",
                                "pass"
                              ]
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "fe42229a-2668-41b8-935a-119cb6c261bf"
                          },
                          "type": "If"
                        },
                        "Call_Soln_Helper_-_delete_all": {
                          "runAfter": {
                            "Mark_Environment_as_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "909277a3-c723-4eb4-a40f-23e513b6ce44"
                          },
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "04b5f2be-08f7-ec11-bb3d-000d3a10bc1d"
                            },
                            "body": {
                              "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "boolean": false,
                              "boolean_1": "@variables('DeleteFromCoE')",
                              "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                            }
                          }
                        },
                        "check_return_-_Call_Soln_Helper_-_delete_all": {
                          "actions": {
                            "set_failure_occurred_true_-_Call_Soln_Helper_-_delete_all": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "da6b90b2-3ab1-47ab-9248-23a25cf0278a"
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "failureOccurred",
                                "value": "@true"
                              }
                            },
                            "Append_Failure_-_Deleted_Envts_-_Soln": {
                              "runAfter": {
                                "set_failure_occurred_true_-_Call_Soln_Helper_-_delete_all": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "eaff0f3a-c398-4a4d-a168-1d6eb6146834"
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "varFailures",
                                "value": {
                                  "which loop": "deleted envts",
                                  "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                                  "obj type": "Solns"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Call_Soln_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@body('Call_Soln_Helper_-_delete_all')?['thereturnvalue']",
                                "pass"
                              ]
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "1f82ecd3-23d8-49cb-9f7e-7c66f06766c5"
                          },
                          "type": "If"
                        },
                        "Call_AiModel_Helper_-_delete_all": {
                          "runAfter": {
                            "Mark_Environment_as_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "9ffaab60-c528-475c-8ce3-8111ba6b6ef9"
                          },
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "37aaead3-1e31-ed11-9db3-002248226dcd"
                            },
                            "body": {
                              "text": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                              "boolean": false,
                              "boolean_1": "@variables('DeleteFromCoE')",
                              "text_1": "@items('For_Each_non_del_env_in_CoE')?['admin_environmentname']"
                            }
                          }
                        },
                        "check_return_-_Call_AiModel_Helper_-_delete_all": {
                          "actions": {
                            "set_failure_occurred_true_-_Call_AiModel_Helper_-_delete_all": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "da6b90b2-3ab1-47ab-9248-23a25cf0278a"
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "failureOccurred",
                                "value": "@true"
                              }
                            },
                            "Append_Failure_-_Deleted_Envts_-_AiModel": {
                              "runAfter": {
                                "set_failure_occurred_true_-_Call_AiModel_Helper_-_delete_all": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "eaff0f3a-c398-4a4d-a168-1d6eb6146834"
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "varFailures",
                                "value": {
                                  "which loop": "deleted envts",
                                  "envt": "@outputs('Mark_Environment_as_deleted')?['body/admin_environmentid']",
                                  "obj type": "Ai Models"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Call_AiModel_Helper_-_delete_all": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@body('Call_AiModel_Helper_-_delete_all')?['thereturnvalue']",
                                "pass"
                              ]
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "1f82ecd3-23d8-49cb-9f7e-7c66f06766c5"
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "Find_env_in_tenant": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "equals": [
                              "@length(body('Find_env_in_tenant'))",
                              0
                            ]
                          },
                          {
                            "not": {
                              "equals": [
                                "@items('For_Each_non_del_env_in_CoE')?['admin_environmentsku']",
                                "Default"
                              ]
                            }
                          }
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "555ab1fd-63cf-4650-970f-1d4ea48eb236"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "List_CoE_Environments_not_marked_deleted_-_pre_new_deletes": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "f8888611-7e1b-47f4-b50d-cf0325286930"
                  },
                  "type": "Foreach",
                  "runtimeConfiguration": {
                    "concurrency": {
                      "repetitions": 50
                    }
                  }
                }
              },
              "runAfter": {},
              "expression": {
                "not": {
                  "equals": [
                    "@parameters('Inventory and Telemetry in Azure Data Storage account (admin_InventoryandTelemetryinAzureDataStorageaccount)')",
                    "@true"
                  ]
                }
              },
              "metadata": {
                "operationMetadataId": "ac17dccd-05c7-4867-9926-ea13fc51b9ec"
              },
              "type": "If"
            }
          },
          "runAfter": {
            "Test_-_fail_check_2": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "6ddbed25-5d76-4335-9783-022f6371180f"
          },
          "type": "Scope"
        },
        "See_if_anything_failed_above": {
          "actions": {
            "list_failures": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "582938c2-168d-404d-b1e1-b86d2cbf9c68"
              },
              "type": "Compose",
              "inputs": "@variables('varFailures')"
            },
            "Terminate_Flow_with_Failure": {
              "runAfter": {
                "Update_Last_Run_Fail": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "d5921bb6-aff5-4aa0-998e-b5f3fa59ee2f"
              },
              "type": "Terminate",
              "inputs": {
                "runStatus": "Failed",
                "runError": {
                  "code": "500",
                  "message": "Flow failed in at least one scope above"
                }
              }
            },
            "Get_ID_Fail": {
              "runAfter": {
                "list_failures": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "47329bf2-8aac-400d-9778-a793b4f1180f"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "$select": "admin_coesolutionmetadataid",
                  "$filter": "admin_objectguid eq @{workflow()?['name']}",
                  "$top": 1
                },
                "authentication": "@parameters('$authentication')"
              }
            },
            "Update_Last_Run_Fail": {
              "runAfter": {
                "Get_ID_Fail": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "c63eb7cc-6101-4567-b520-a4a8881264e9"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "UpdateRecord",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "recordId": "@first(outputs('Get_ID_Fail')?['body/value'])?['admin_coesolutionmetadataid']",
                  "item/admin_lastrun": "@utcNow()",
                  "item/admin_lastrunpassed": false
                },
                "authentication": "@parameters('$authentication')"
              }
            }
          },
          "runAfter": {
            "Test_-_fail_check": [
              "Succeeded"
            ]
          },
          "else": {
            "actions": {
              "Update_last_run_as_pass": {
                "actions": {
                  "Update_Last_Run_Successful": {
                    "runAfter": {
                      "Get_ID_Pass": [
                        "Succeeded"
                      ]
                    },
                    "metadata": {
                      "operationMetadataId": "78ef70e5-7f67-4737-9a02-8533f12caa19"
                    },
                    "type": "OpenApiConnection",
                    "inputs": {
                      "host": {
                        "connectionName": "shared_commondataserviceforapps",
                        "operationId": "UpdateRecord",
                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                      },
                      "parameters": {
                        "entityName": "admin_coesolutionmetadatas",
                        "recordId": "@first(outputs('Get_ID_Pass')?['body/value'])?['admin_coesolutionmetadataid']",
                        "item/admin_lastrun": "@utcNow()",
                        "item/admin_lastrunpassed": true
                      },
                      "authentication": "@parameters('$authentication')"
                    }
                  },
                  "Get_ID_Pass": {
                    "runAfter": {},
                    "metadata": {
                      "operationMetadataId": "f4f314b6-89d3-4056-af1c-73115e7d6bd1"
                    },
                    "type": "OpenApiConnection",
                    "inputs": {
                      "host": {
                        "connectionName": "shared_commondataserviceforapps",
                        "operationId": "ListRecords",
                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                      },
                      "parameters": {
                        "entityName": "admin_coesolutionmetadatas",
                        "$select": "admin_coesolutionmetadataid",
                        "$filter": "admin_objectguid eq @{workflow()?['name']}",
                        "$top": 1
                      },
                      "authentication": "@parameters('$authentication')"
                    }
                  },
                  "Catch_-_not_ready_to_take_last_run_date": {
                    "runAfter": {
                      "Update_Last_Run_Successful": [
                        "Failed"
                      ]
                    },
                    "metadata": {
                      "operationMetadataId": "f28cfefd-b403-43e6-a73f-676ba812809a"
                    },
                    "type": "Compose",
                    "inputs": "Catch - not ready to take last run date"
                  }
                },
                "runAfter": {},
                "metadata": {
                  "operationMetadataId": "5c140442-d939-4ca4-8ec8-d1ee2bed4a81"
                },
                "type": "Scope"
              }
            }
          },
          "expression": {
            "equals": [
              "@variables('failureOccurred')",
              "@true"
            ]
          },
          "metadata": {
            "operationMetadataId": "2a766ba0-9475-45f8-ad7a-1ddc49439fd6"
          },
          "type": "If"
        },
        "Initialize_DeleteFromCoE": {
          "runAfter": {
            "Initialize_varDeleteFromCoE": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "86218be8-8f1e-486b-ac72-d181fd12591f"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "DeleteFromCoE",
                "type": "boolean",
                "value": "@if(equals(tolower(parameters('Also Delete From CoE (admin_DeleteFromCoE)')), 'yes'), true, false)"
              }
            ]
          }
        },
        "Deleted_Objects_in_Existing_Environments": {
          "actions": {
            "Apply_to_each_environment": {
              "foreach": "@outputs('List_CoE_Environments_not_marked_deleted')?['body/value']",
              "actions": {
                "Call_each_object_type_helper_for_this_environment": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "7a969d84-fb74-428a-a3d0-2f4bdfb17a58"
                  },
                  "type": "Compose",
                  "inputs": "Call each object type helper for this environment"
                },
                "Call_Custom_Connector_Helper_-_check_deleted": {
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "11cfe8d8-8e77-41af-b767-2498fea9e0ff"
                  },
                  "type": "Workflow",
                  "inputs": {
                    "host": {
                      "workflowReferenceName": "b3f4f0d4-cb1b-ec11-b6e6-00224828c7b0"
                    },
                    "body": {
                      "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                      "boolean": true,
                      "boolean_1": "@variables('DeleteFromCoE')",
                      "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                    }
                  }
                },
                "check_return_-_Call_Custom_Connector_Helper_-_check_deleted": {
                  "actions": {
                    "set_failure_occurred_true_-_Call_Custom_Connector_Helper_-_check_deleted": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "2870d86a-a09d-40fb-b608-b52379f4a195"
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "failureOccurred",
                        "value": "@true"
                      }
                    },
                    "Append_Failure_-_Custom_Connectors": {
                      "runAfter": {
                        "set_failure_occurred_true_-_Call_Custom_Connector_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "02851b83-6aca-40d5-b1dd-d894974e1375"
                      },
                      "type": "AppendToArrayVariable",
                      "inputs": {
                        "name": "varFailures",
                        "value": {
                          "which loop": "existing envts",
                          "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "obj type": "custom connectors"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Call_Custom_Connector_Helper_-_check_deleted": [
                      "Succeeded"
                    ]
                  },
                  "expression": {
                    "not": {
                      "equals": [
                        "@outputs('Call_Custom_Connector_Helper_-_check_deleted')?['Body']?['thereturnvalue']",
                        "pass"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "2b6b2a42-755c-46dc-9bb4-d1449d31872b"
                  },
                  "type": "If"
                },
                "Check_if_Teams__or_BYODL-_MDA": {
                  "actions": {
                    "Call_MDA_Helper_-_check_deleted": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "147f2b96-7c9a-41e6-840a-f35e1ea705e1"
                      },
                      "type": "Workflow",
                      "inputs": {
                        "host": {
                          "workflowReferenceName": "9a470548-58fc-eb11-94ef-002248237f74"
                        },
                        "body": {
                          "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "boolean": true,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                        }
                      }
                    },
                    "check_return_-_Call_MDA_Helper_-_check_deleted": {
                      "actions": {
                        "set_failure_occurred_true_-_Call_MDA_Helper_-_check_deleted": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "85a9ca51-9722-43f6-b14c-2c14b758127c"
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          }
                        },
                        "Append_Failure_-_MDA": {
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_MDA_Helper_-_check_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "756c9cc1-a414-49e3-88db-980e3f8f5e60"
                          },
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "which loop": "existing envts",
                              "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                              "obj type": "MDAs"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Call_MDA_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@outputs('Call_MDA_Helper_-_check_deleted')?['Body']?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "2f62ac30-624e-499f-8dc7-64a20ce0a483"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "expression": {
                    "or": [
                      {
                        "not": {
                          "equals": [
                            "@items('Apply_to_each_environment')?['admin_environmentsku']",
                            "Teams"
                          ]
                        }
                      },
                      {
                        "not": {
                          "equals": [
                            "@parameters('Inventory and Telemetry in Azure Data Storage account (admin_InventoryandTelemetryinAzureDataStorageaccount)')",
                            "@true"
                          ]
                        }
                      }
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "a9134bda-66f7-4a09-9bab-47cf59ab4cd1"
                  },
                  "type": "If"
                },
                "Check_if_Teams_-_PVA": {
                  "actions": {
                    "Call_PVA_Helper_-_check_deleted": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "77bc805d-53b8-4caf-93f9-4995956df05f"
                      },
                      "type": "Workflow",
                      "inputs": {
                        "host": {
                          "workflowReferenceName": "ffd82928-64fc-eb11-94ef-002248237d7d"
                        },
                        "body": {
                          "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "boolean": true,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                        }
                      }
                    },
                    "check_return_-_Call_PVA_Helper_-_check_deleted": {
                      "actions": {
                        "set_failure_occurred_true_-_Call_PVA_Helper_-_check_deleted": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "8bcd2d79-ec37-443a-82e5-204b2967b325"
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          }
                        },
                        "Append_Failure_-_PVA": {
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_PVA_Helper_-_check_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "408ee11c-e8cb-44ea-8957-ff9ad19b77ff"
                          },
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "which loop": "existing envts",
                              "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                              "obj type": "PVAs"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Call_PVA_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@body('Call_PVA_Helper_-_check_deleted')?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "3b7a2e8e-3de6-4818-878d-667cb41b2730"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "expression": {
                    "not": {
                      "equals": [
                        "@items('Apply_to_each_environment')?['admin_environmentsku']",
                        "Teams"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "e5c640ae-2971-4605-91e4-15796c334f5d"
                  },
                  "type": "If"
                },
                "Check_if_Teams_-_BPF": {
                  "actions": {
                    "Call_BPF_Helper_-_check_deleted": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "769325e0-d4b7-4d72-a4a1-ac58b8dbf641"
                      },
                      "type": "Workflow",
                      "inputs": {
                        "host": {
                          "workflowReferenceName": "bc9de9b5-a8ed-ec11-bb3d-000d3a8fbe6e"
                        },
                        "body": {
                          "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "boolean": true,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                        }
                      }
                    },
                    "check_return_-_Call_BPF_Helper_-_check_deleted": {
                      "actions": {
                        "set_failure_occurred_true_-_Call_BPF_Helper_-_check_deleted": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "236e463d-f6a1-430f-932f-a4e9f97b7c43"
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          }
                        },
                        "Append_Failure_-_BPF": {
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_BPF_Helper_-_check_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "02fab3be-74f1-445f-aba4-867b52418d49"
                          },
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "which loop": "existing envts",
                              "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                              "obj type": "BPFs"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Call_BPF_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@body('Call_BPF_Helper_-_check_deleted')?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "ecccadaa-46df-434d-bd65-d60b375058c9"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "expression": {
                    "not": {
                      "equals": [
                        "@items('Apply_to_each_environment')?['admin_environmentsku']",
                        "Teams"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "ed408f3e-d689-431a-809a-ffc49c2188ee"
                  },
                  "type": "If"
                },
                "Check_if_Teams_-_Solns": {
                  "actions": {
                    "Call_Soln_Helper_-_check_deleted": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "2e6af1c1-5690-4f1d-93bd-1534b24859b7"
                      },
                      "type": "Workflow",
                      "inputs": {
                        "host": {
                          "workflowReferenceName": "04b5f2be-08f7-ec11-bb3d-000d3a10bc1d"
                        },
                        "body": {
                          "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "boolean": true,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                        }
                      }
                    },
                    "check_return_-_Call_Soln_Helper_-_check_deleted": {
                      "actions": {
                        "set_failure_occurred_true_-_Call_Soln_Helper_-_check_deleted": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "236e463d-f6a1-430f-932f-a4e9f97b7c43"
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          }
                        },
                        "Append_Failure_-_Soln": {
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_Soln_Helper_-_check_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "02fab3be-74f1-445f-aba4-867b52418d49"
                          },
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "which loop": "existing envts",
                              "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                              "obj type": "Solns"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Call_Soln_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@body('Call_Soln_Helper_-_check_deleted')?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "18a4369d-4c40-4b7c-9a90-d5999e8635a7"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "expression": {
                    "and": [
                      {
                        "not": {
                          "equals": [
                            "@items('Apply_to_each_environment')?['admin_environmentsku']",
                            "Teams"
                          ]
                        }
                      },
                      {
                        "equals": [
                          "@items('Apply_to_each_environment')?['admin_hascds']",
                          "@true"
                        ]
                      }
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "8b388860-c806-4c62-9b08-80ca63ac30b3"
                  },
                  "type": "If"
                },
                "Check_if_BYODL_-_Canvas_Apps": {
                  "actions": {
                    "Call_Canvas_Helper_-_check_deleted": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "5010d1c4-babf-42c8-a935-9a9dbbd97acc"
                      },
                      "type": "Workflow",
                      "inputs": {
                        "host": {
                          "workflowReferenceName": "2e6ae3e2-8afb-eb11-94ef-002248237d7d"
                        },
                        "body": {
                          "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "boolean": true,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                        }
                      }
                    },
                    "check_return_-_Call_Canvas_Helper_-_check_deleted": {
                      "actions": {
                        "set_failure_occurred_true_-_Call_Canvas_Helper_-_check_deleted": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "645cc266-88ba-4fa1-b020-4550c29738cf"
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          }
                        },
                        "Append_Failure_-_Canvas": {
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_Canvas_Helper_-_check_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                          },
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "which loop": "existing envts",
                              "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                              "obj type": "canvas"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Call_Canvas_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@outputs('Call_Canvas_Helper_-_check_deleted')?['Body']?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "62c8a103-239a-4eb3-97cf-db4372a9aad9"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "expression": {
                    "not": {
                      "equals": [
                        "@parameters('Inventory and Telemetry in Azure Data Storage account (admin_InventoryandTelemetryinAzureDataStorageaccount)')",
                        "@true"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "ac05f08f-8339-4253-8c5f-81b1e406a1fa"
                  },
                  "type": "If"
                },
                "Check_if_BYODL_-_Flows": {
                  "actions": {
                    "Call_Cloud_Flows_Helper_-_check_deleted": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "c692c61f-9768-49d3-b9a0-03bdebe38c99"
                      },
                      "type": "Workflow",
                      "inputs": {
                        "host": {
                          "workflowReferenceName": "6bd20554-9bfb-eb11-94ef-002248237d7d"
                        },
                        "body": {
                          "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "boolean": true,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                        }
                      }
                    },
                    "check_return_-_Call_Cloud_Flows_Helper_-_check_deleted": {
                      "actions": {
                        "set_failure_occurred_true_-_Call_Cloud_Flows_Helper_-_check_deleted": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "b2869541-7cf9-4386-bc04-d131bcf15483"
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          }
                        },
                        "Append_Failure_-_Flows": {
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_Cloud_Flows_Helper_-_check_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "9c5faad1-016d-44d3-940c-2a55b94355e4"
                          },
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "which loop": "existing envts",
                              "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                              "obj type": "flows"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Call_Cloud_Flows_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@outputs('Call_Cloud_Flows_Helper_-_check_deleted')?['Body']?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "d741b453-f24e-4e36-b42e-bb017acba80b"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "expression": {
                    "not": {
                      "equals": [
                        "@parameters('Inventory and Telemetry in Azure Data Storage account (admin_InventoryandTelemetryinAzureDataStorageaccount)')",
                        "@true"
                      ]
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "8bb2c137-9126-4411-898d-c9a455069d41"
                  },
                  "type": "If"
                },
                "Check_if_Teams_-_AiModels": {
                  "actions": {
                    "Call_AiModel_Helper_-_check_deleted": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "2e6af1c1-5690-4f1d-93bd-1534b24859b7"
                      },
                      "type": "Workflow",
                      "inputs": {
                        "host": {
                          "workflowReferenceName": "37aaead3-1e31-ed11-9db3-002248226dcd"
                        },
                        "body": {
                          "text": "@items('Apply_to_each_environment')?['admin_environmentid']",
                          "boolean": true,
                          "boolean_1": "@variables('DeleteFromCoE')",
                          "text_1": "@items('Apply_to_each_environment')?['admin_environmentname']"
                        }
                      }
                    },
                    "check_return_-_Call_AiModel_Helper_-_check_deleted": {
                      "actions": {
                        "set_failure_occurred_true_-_Call_AiModel_Helper_-_check_deleted": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "236e463d-f6a1-430f-932f-a4e9f97b7c43"
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "failureOccurred",
                            "value": "@true"
                          }
                        },
                        "Append_Failure_-_AiModel": {
                          "runAfter": {
                            "set_failure_occurred_true_-_Call_AiModel_Helper_-_check_deleted": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "02fab3be-74f1-445f-aba4-867b52418d49"
                          },
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "varFailures",
                            "value": {
                              "which loop": "existing envts",
                              "envt": "@items('Apply_to_each_environment')?['admin_environmentid']",
                              "obj type": "Ai Model"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Call_AiModel_Helper_-_check_deleted": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@body('Call_AiModel_Helper_-_check_deleted')?['thereturnvalue']",
                            "pass"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "18a4369d-4c40-4b7c-9a90-d5999e8635a7"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "Call_each_object_type_helper_for_this_environment": [
                      "Succeeded"
                    ]
                  },
                  "expression": {
                    "and": [
                      {
                        "not": {
                          "equals": [
                            "@items('Apply_to_each_environment')?['admin_environmentsku']",
                            "Teams"
                          ]
                        }
                      },
                      {
                        "equals": [
                          "@items('Apply_to_each_environment')?['admin_hascds']",
                          "@true"
                        ]
                      }
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "8b388860-c806-4c62-9b08-80ca63ac30b3"
                  },
                  "type": "If"
                }
              },
              "runAfter": {
                "List_CoE_Environments_not_marked_deleted": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "1806028d-8aa4-4ac9-bb6e-81d76c6c60de"
              },
              "type": "Foreach",
              "runtimeConfiguration": {
                "concurrency": {
                  "repetitions": 50
                }
              }
            },
            "List_CoE_Environments_not_marked_deleted": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "f914913a-70ee-4c6e-8311-885e2c122032"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_environments",
                  "$select": "admin_environmentid, admin_environmentsku, admin_hascds, admin_environmentname, admin_environmentcdsmetadataname, admin_environmentdeletedon",
                  "$filter": "admin_environmentdeleted eq false and admin_excusefrominventory eq false"
                },
                "authentication": "@parameters('$authentication')",
                "retryPolicy": {
                  "type": "exponential",
                  "count": 10,
                  "interval": "PT10S"
                }
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              }
            }
          },
          "runAfter": {
            "Test_-_fail_check_1": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "d9ec4c6e-66c0-4f2a-884c-406034f46edd"
          },
          "type": "Scope"
        },
        "Deletes_old_items_from_CoE_inventory": {
          "actions": {
            "Check_if_they_want_to_delete_from_CoE": {
              "actions": {
                "Delete_Each_App": {
                  "foreach": "@outputs('List_Apps_Marked_Deleted_To_Delete')?['body/value']",
                  "actions": {
                    "Delete_App": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "54d6934e-e2e6-46c8-93b9-c869882b00e4"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_apps",
                          "recordId": "@items('Delete_Each_App')?['admin_appid']"
                        },
                        "authentication": "@parameters('$authentication')",
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "List_Apps_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "992de43a-1ac0-4f7b-8c46-98740496eaf9"
                  },
                  "type": "Foreach"
                },
                "Delete_Each_Environment": {
                  "foreach": "@outputs('List_Envts_Marked_Deleted_To_Delete')?['body/value']",
                  "actions": {
                    "Delete_Environment": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "2220c6f4-76a0-49d6-bd1f-6d50b3f5ffdb"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_environments",
                          "recordId": "@items('Delete_Each_Environment')?['admin_environmentid']"
                        },
                        "authentication": "@parameters('$authentication')",
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "List_Envts_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "20c570c3-b601-4fc2-b69f-4abdf1d6b459"
                  },
                  "type": "Foreach"
                },
                "Delete_Each_Flow": {
                  "foreach": "@outputs('List_Flows_Marked_Deleted_To_Delete')?['body/value']",
                  "actions": {
                    "Delete_Flow": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "65d87cb0-1ef5-4cde-9805-8da80102b6a7"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_flows",
                          "recordId": "@items('Delete_Each_Flow')?['admin_flowid']"
                        },
                        "authentication": "@parameters('$authentication')",
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "List_Flows_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "c87fb516-ffa5-4e82-84ad-a29974070886"
                  },
                  "type": "Foreach"
                },
                "Delete_Each_Flow_Action": {
                  "foreach": "@outputs('List_Flow_Actions_Marked_Deleted_To_Delete')?['body/value']",
                  "actions": {
                    "Delete_Flow_Action": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "75984ee3-9717-4d38-99b4-ecc07de1fae5"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_flowactiondetails",
                          "recordId": "@items('Delete_Each_Flow_Action')?['admin_flowactiondetailid']"
                        },
                        "authentication": "@parameters('$authentication')",
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "List_Flow_Actions_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "bcb382f6-cc7e-4e95-956c-06b8855e5a98"
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA": {
                  "foreach": "@outputs('List_PVAs_Marked_Deleted_To_Delete')?['body/value']",
                  "actions": {
                    "Delete_PVA": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "0b45cc2f-97a8-4ddc-bcf2-d0850204cf86"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_pvas",
                          "recordId": "@items('Delete_Each_PVA')?['admin_pvaid']"
                        },
                        "authentication": "@parameters('$authentication')",
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "List_PVAs_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "7c2652c6-ec6f-4179-b52e-5025f50ed552"
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA_Component": {
                  "foreach": "@outputs('List_PVA_Components_Marked_Deleted_To_Delete')?['body/value']",
                  "actions": {
                    "Delete_PVA_Component": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "ec5e425a-0936-4495-add5-ef1bcc04f93a"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_pvacomponents",
                          "recordId": "@items('Delete_Each_PVA_Component')?['admin_pvacomponentid']"
                        },
                        "authentication": "@parameters('$authentication')",
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "List_PVA_Components_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "3cfe3381-c3c6-40c5-bd66-b4ff1a3a300f"
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA_Component_Flow_1": {
                  "foreach": "@outputs('List_PVA_Component_Flows_with_Missing_Flow')?['body/value']",
                  "actions": {
                    "Delete_PVA_Component_Flow_1": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "bd46c763-b1a8-4e69-986b-160ad04ce2bc"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_pvacomponentflowlookups",
                          "recordId": "@items('Delete_Each_PVA_Component_Flow_1')?['admin_pvacomponentflowlookupid']"
                        },
                        "authentication": "@parameters('$authentication')",
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "List_PVA_Component_Flows_with_Missing_Flow": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "a1f8b25e-fec7-4b1f-ad8d-1870b894a439"
                  },
                  "type": "Foreach"
                },
                "Delete_Each_PVA_Component_Flow_2": {
                  "foreach": "@outputs('List_PVA_Component_Flows_with_Missing_PVA_Component')?['body/value']",
                  "actions": {
                    "Delete_PVA_Component_Flow_2": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "ef1726c2-1f6f-4aad-8c4e-7036080b96a2"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_pvacomponentflowlookups",
                          "recordId": "@items('Delete_Each_PVA_Component_Flow_2')?['admin_pvacomponentflowlookupid']"
                        },
                        "authentication": "@parameters('$authentication')",
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "List_PVA_Component_Flows_with_Missing_PVA_Component": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "4798f546-ddb7-4449-80e8-f7346d102751"
                  },
                  "type": "Foreach"
                },
                "List_Envts_Marked_Deleted_To_Delete": {
                  "runAfter": {
                    "Delete_Each_Model": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "01d667b6-6242-4f0a-b6de-5b99f83f9dbd"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_environments",
                      "$select": "admin_environmentid",
                      "$filter": "admin_environmentdeleted eq true"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "List_Flow_Actions_Marked_Deleted_To_Delete": {
                  "runAfter": {
                    "Delete_Each_Flow": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "63bf55ff-77d2-4957-b437-bddd1ac1d9f6"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_flowactiondetails",
                      "$select": "admin_flowactiondetailid",
                      "$filter": "admin_flowactiondetaildeleted eq true"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "List_Flows_Marked_Deleted_To_Delete": {
                  "runAfter": {
                    "Delete_Each_BPF": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "61b9b48f-499a-4e03-b70a-ba50a2c10df3"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_flows",
                      "$select": "admin_flowid",
                      "$filter": "admin_flowdeleted eq true"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "List_PVA_Component_Flows_with_Missing_Flow": {
                  "runAfter": {
                    "Delete_Each_PVA_Component": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "f21241d5-7052-4864-95f3-aa3fc61a6c4b"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_pvacomponentflowlookups",
                      "$select": "admin_pvacomponentflowlookupid",
                      "$filter": "_admin_flow_value eq null"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "List_PVA_Component_Flows_with_Missing_PVA_Component": {
                  "runAfter": {
                    "Delete_Each_PVA_Component_Flow_1": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "0dc70cf3-302e-4db4-9a22-8d2bdda7ea75"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_pvacomponentflowlookups",
                      "$select": "admin_pvacomponentflowlookupid",
                      "$filter": "_admin_pvacomponent_value eq null"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "List_PVA_Components_Marked_Deleted_To_Delete": {
                  "runAfter": {
                    "Delete_Each_PVA": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "2295b62f-976f-41a3-ad17-559fd89aee9d"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_pvacomponents",
                      "$select": "admin_pvacomponentid",
                      "$filter": "admin_componentdeleted eq true"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "List_PVAs_Marked_Deleted_To_Delete": {
                  "runAfter": {
                    "Delete_Each_Flow_Action": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "3da35011-b120-4432-9414-a6144b42be2a"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_pvas",
                      "$select": "admin_pvaid",
                      "$filter": "admin_pvadeleted eq true"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "List_BPFs_Marked_Deleted_To_Delete": {
                  "runAfter": {
                    "Delete_Each_App": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "28c44cda-d5b8-40b9-82f0-8676978e02b5"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps_1",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_businessprocessflowses",
                      "$select": "admin_businessprocessflowsid",
                      "$filter": "admin_businessprocessflowdeleted eq true"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "Delete_Each_BPF": {
                  "foreach": "@outputs('List_BPFs_Marked_Deleted_To_Delete')?['body/value']",
                  "actions": {
                    "Delete_BPF": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "48d1bde4-b912-4b9a-9ecc-a92a053da035"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps_1",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_businessprocessflowses",
                          "recordId": "@items('Delete_Each_BPF')?['admin_businessprocessflowsid']"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    }
                  },
                  "runAfter": {
                    "List_BPFs_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "75c73087-1dd8-4290-bc6c-9d71d433dcf1"
                  },
                  "type": "Foreach"
                },
                "List_Apps_Marked_Deleted_To_Delete": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "302736ff-0ca3-438a-9841-1f095783dad6"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_apps",
                      "$select": "admin_appid",
                      "$filter": "admin_appdeleted eq true"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "Delete_Each_Solution": {
                  "foreach": "@outputs('List_Solutions_Marked_Deleted_To_Delete')?['body/value']",
                  "actions": {
                    "Delete_Solution": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "11efa780-a23d-4003-a1aa-b3985fdb08f4"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps_1",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_solutions",
                          "recordId": "@items('Delete_Each_Solution')?['admin_solutionid']"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    }
                  },
                  "runAfter": {
                    "List_Solutions_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "65e10bdb-b655-4c6f-afa0-eaa2eec5b55e"
                  },
                  "type": "Foreach"
                },
                "List_Solutions_Marked_Deleted_To_Delete": {
                  "runAfter": {
                    "Delete_Each_PVA_Component_Flow_2": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "01d667b6-6242-4f0a-b6de-5b99f83f9dbd"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_solutions",
                      "$select": "admin_solutionid",
                      "$filter": "admin_solutiondeleted eq true"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "List_Models_Marked_Deleted_To_Delete": {
                  "runAfter": {
                    "Delete_Each_Solution": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "825642bc-9a28-41fd-8886-b34e452c83a6"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_aibuildermodels",
                      "$select": "admin_aibuildermodelid",
                      "$filter": "admin_aideleted eq true"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "Delete_Each_Model": {
                  "foreach": "@outputs('List_Models_Marked_Deleted_To_Delete')?['body/value']",
                  "actions": {
                    "Delete_Model": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "dae29cbc-1654-4798-8a5d-093657969192"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_aibuildermodels",
                          "recordId": "@items('Delete_Each_Model')?['admin_aibuildermodelid']"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    }
                  },
                  "runAfter": {
                    "List_Models_Marked_Deleted_To_Delete": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "6ab2ab5c-41a4-4eb9-8314-baa3d1302cc2"
                  },
                  "type": "Foreach"
                }
              },
              "runAfter": {},
              "expression": {
                "equals": [
                  "@variables('DeleteFromCoE')",
                  "@true"
                ]
              },
              "metadata": {
                "operationMetadataId": "8e34a6de-0863-44b0-8ef3-bd5d5ae66d7c"
              },
              "type": "If"
            }
          },
          "runAfter": {
            "Initialize_varFailures": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "2f5b781f-79ef-4856-8fd4-c3aa6372445c"
          },
          "type": "Scope",
          "description": "In the event the env var changes, we want to clean the inventory"
        },
        "Initialize_varFailures": {
          "runAfter": {
            "Initialize_varNoBots": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "9ea65c75-ed5d-4618-9000-c973f7dbc405"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "varFailures",
                "type": "array"
              }
            ]
          }
        },
        "Test_-_fail_check_1": {
          "runAfter": {
            "Newly_Deleted_Environments": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "155cc93e-8721-4401-92c2-2135b24864de"
          },
          "type": "Compose",
          "inputs": "@variables('failureOccurred')"
        },
        "Test_-_fail_check": {
          "runAfter": {
            "Deleted_Objects_in_Existing_Environments": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "e54f041d-0d4b-470d-9aef-269899cc3b4f"
          },
          "type": "Compose",
          "inputs": "@variables('failureOccurred')"
        },
        "Select": {
          "runAfter": {
            "Get_Environments": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "236d24b5-13c4-4750-af5f-d832983e5fda"
          },
          "type": "Select",
          "inputs": {
            "from": "@outputs('Get_Environments')?['body/value']",
            "select": {
              "name": "@item()?['name']"
            }
          }
        },
        "Recovered_Objects": {
          "actions": {
            "Recovered_PVAs_-_Failed": {
              "actions": {
                "set_failure_occurred_true_-_Recover_PVAs": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "b2004d1c-bbfd-4fbb-b378-2810d8c74761"
                  },
                  "type": "SetVariable",
                  "inputs": {
                    "name": "failureOccurred",
                    "value": "@true"
                  }
                },
                "Append_Failure_-_Recover__PVAs": {
                  "runAfter": {
                    "set_failure_occurred_true_-_Recover_PVAs": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                  },
                  "type": "AppendToArrayVariable",
                  "inputs": {
                    "name": "varFailures",
                    "value": {
                      "which loop": "recovered Objects",
                      "envt": "",
                      "obj type": "PVAs"
                    }
                  }
                }
              },
              "runAfter": {
                "Recovered_PVAs": [
                  "Failed"
                ]
              },
              "metadata": {
                "operationMetadataId": "221efe1e-1350-43bd-bc24-18c4c6ec327a"
              },
              "type": "Scope"
            },
            "Recovered_PVAs": {
              "actions": {
                "List_PVAs_marked_deleted": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "7946198c-0ae8-4d6c-b50d-2821bc1648f6"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps_1",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_pvas",
                      "$select": "_admin_pvaenvironment_value, admin_pvaid",
                      "$filter": "admin_pvadeleted ne false",
                      "$expand": "admin_PVAEnvironment($select=admin_environmentcdsmetadataname)"
                    },
                    "authentication": "@parameters('$authentication')"
                  }
                },
                "Apply_to_deleted_PVAs": {
                  "foreach": "@outputs('List_PVAs_marked_deleted')?['body/value']",
                  "actions": {
                    "Get_PVA_by_ID": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "8d450aa9-5a14-44a1-992e-93365441c5ad"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataservice",
                          "operationId": "GetItem_V2",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataservice"
                        },
                        "parameters": {
                          "dataset": "@items('Apply_to_deleted_PVAs')?['admin_pvaenvironment/admin_environmentcdsmetadataname']",
                          "table": "bots",
                          "id": "@items('Apply_to_deleted_PVAs')?['admin_pvaid']"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    },
                    "PVA_Not_Found": {
                      "runAfter": {
                        "Get_PVA_by_ID": [
                          "Failed"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "816b651a-e5fd-43d6-b0fd-cc146f493656"
                      },
                      "type": "Compose",
                      "inputs": "PVA Not Found"
                    },
                    "Mark_PVA_Not_Deleted": {
                      "runAfter": {
                        "PVA_Not_Found": [
                          "Skipped"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "eaa2c4db-9979-419c-ab14-7b649b0483e2"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps_1",
                          "operationId": "UpdateRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_pvas",
                          "recordId": "@items('Apply_to_deleted_PVAs')?['admin_pvaid']",
                          "item/admin_pvadeleted": false,
                          "item/admin_pvadeletedon": "@null"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    }
                  },
                  "runAfter": {
                    "List_PVAs_marked_deleted": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "5e4c8734-4cce-4fa0-ba90-4bb0579f0005"
                  },
                  "type": "Foreach",
                  "runtimeConfiguration": {
                    "concurrency": {
                      "repetitions": 50
                    }
                  }
                }
              },
              "runAfter": {
                "Skip_some_recovery_checks_if_BYODL": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "f4b43aa2-2b50-4c92-aa6a-3787b27391c5"
              },
              "type": "Scope"
            },
            "Recovered_BPFs": {
              "actions": {
                "List_BPFs_marked_deleted": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "8544e2e7-f316-49bc-9d60-914defdb66b0"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps_1",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_businessprocessflowses",
                      "$select": "_admin_businessprocessflowenvironment_value, admin_businessprocessflowsid, admin_name, admin_businessprocessflowuniquename",
                      "$filter": "admin_businessprocessflowdeleted ne false",
                      "$expand": "admin_BusinessProcessFlowEnvironment($select=admin_environmentcdsmetadataname)"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "Apply_to_deleted_BPF": {
                  "foreach": "@outputs('List_BPFs_marked_deleted')?['body/value']",
                  "actions": {
                    "Get_BPF": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "799e2293-6c7e-4b4d-8334-a53b2c247aa8"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataservice",
                          "operationId": "GetItems_V2",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataservice"
                        },
                        "parameters": {
                          "dataset": "@items('Apply_to_deleted_BPF')?['admin_businessprocessflowenvironment/admin_environmentcdsmetadataname']",
                          "table": "workflows",
                          "$filter": "workflowid eq @{items('Apply_to_deleted_BPF')?['admin_name']}"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    },
                    "list_failed_so_not_found_-_BPF": {
                      "runAfter": {
                        "Get_BPF": [
                          "Failed"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "68ba4b52-107e-4da4-bbf1-bc1662eeae87"
                      },
                      "type": "Compose",
                      "inputs": "list failed so not found"
                    },
                    "Mark_BPF_Not_Deleted": {
                      "runAfter": {
                        "list_failed_so_not_found_-_BPF": [
                          "Skipped"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "bf8e75d3-b78a-4322-9658-45c196d55b33"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps_1",
                          "operationId": "UpdateRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_businessprocessflowses",
                          "recordId": "@items('Apply_to_deleted_BPF')?['admin_businessprocessflowsid']",
                          "item/admin_businessprocessflowdeleted": false,
                          "item/admin_businessprocessflowdeletedon": "@null"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    }
                  },
                  "runAfter": {
                    "List_BPFs_marked_deleted": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "c6267c27-1c3a-45f5-b640-aac52f056edf"
                  },
                  "type": "Foreach",
                  "runtimeConfiguration": {
                    "concurrency": {
                      "repetitions": 50
                    }
                  }
                }
              },
              "runAfter": {
                "Recovered_PVAs_-_Failed": [
                  "Succeeded",
                  "Skipped"
                ]
              },
              "metadata": {
                "operationMetadataId": "f6873576-b5de-4ff2-a07e-7144faeac157"
              },
              "type": "Scope"
            },
            "Recovered_BPFs_-_Failed": {
              "actions": {
                "set_failure_occurred_true_-_Recover_BPFs": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "b2004d1c-bbfd-4fbb-b378-2810d8c74761"
                  },
                  "type": "SetVariable",
                  "inputs": {
                    "name": "failureOccurred",
                    "value": "@true"
                  }
                },
                "Append_Failure_-_Recover__BPFs": {
                  "runAfter": {
                    "set_failure_occurred_true_-_Recover_BPFs": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                  },
                  "type": "AppendToArrayVariable",
                  "inputs": {
                    "name": "varFailures",
                    "value": {
                      "which loop": "recovered Objects",
                      "envt": "",
                      "obj type": "BPFs"
                    }
                  }
                }
              },
              "runAfter": {
                "Recovered_BPFs": [
                  "Failed"
                ]
              },
              "metadata": {
                "operationMetadataId": "56f9af6a-d5fd-4bbe-b676-f23e2332383d"
              },
              "type": "Scope"
            },
            "Recovered_Solns": {
              "actions": {
                "List_Solns_marked_deleted": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "8544e2e7-f316-49bc-9d60-914defdb66b0"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps_1",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_solutions",
                      "$select": "_admin_solutionenvironment_value, admin_solutionid, admin_name",
                      "$filter": "admin_solutiondeleted ne false",
                      "$expand": "admin_SolutionEnvironment($select=admin_environmentcdsmetadataname)"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "Apply_to_deleted_Soln": {
                  "foreach": "@outputs('List_Solns_marked_deleted')?['body/value']",
                  "actions": {
                    "Get_Soln": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "799e2293-6c7e-4b4d-8334-a53b2c247aa8"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataservice",
                          "operationId": "GetItems_V2",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataservice"
                        },
                        "parameters": {
                          "dataset": "@items('Apply_to_deleted_Soln')?['admin_solutionenvironment/admin_environmentcdsmetadataname']",
                          "table": "solutions",
                          "$filter": "solutionid eq @{items('Apply_to_deleted_Soln')?['admin_solutionid']}"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    },
                    "list_failed_so_not_found_-_Solution": {
                      "runAfter": {
                        "Get_Soln": [
                          "Failed"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "68ba4b52-107e-4da4-bbf1-bc1662eeae87"
                      },
                      "type": "Compose",
                      "inputs": "list failed so not found"
                    },
                    "Mark_Soln_Not_Deleted": {
                      "runAfter": {
                        "list_failed_so_not_found_-_Solution": [
                          "Skipped"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "e148d61e-1401-4796-8768-a2e8b21a7c9c"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps_1",
                          "operationId": "UpdateRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_solutions",
                          "recordId": "@items('Apply_to_deleted_Soln')?['admin_solutionid']",
                          "item/admin_solutiondeleted": false,
                          "item/admin_solutiondeletedon": "@null"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    }
                  },
                  "runAfter": {
                    "List_Solns_marked_deleted": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "c6267c27-1c3a-45f5-b640-aac52f056edf"
                  },
                  "type": "Foreach",
                  "runtimeConfiguration": {
                    "concurrency": {
                      "repetitions": 50
                    }
                  }
                }
              },
              "runAfter": {
                "Recovered_BPFs_-_Failed": [
                  "Succeeded",
                  "Skipped"
                ]
              },
              "metadata": {
                "operationMetadataId": "f6873576-b5de-4ff2-a07e-7144faeac157"
              },
              "type": "Scope"
            },
            "Recovered_Solns_-_Failed": {
              "actions": {
                "set_failure_occurred_true_-_Recover_Solns": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "b2004d1c-bbfd-4fbb-b378-2810d8c74761"
                  },
                  "type": "SetVariable",
                  "inputs": {
                    "name": "failureOccurred",
                    "value": "@true"
                  }
                },
                "Append_Failure_-_Recover__Solns": {
                  "runAfter": {
                    "set_failure_occurred_true_-_Recover_Solns": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                  },
                  "type": "AppendToArrayVariable",
                  "inputs": {
                    "name": "varFailures",
                    "value": {
                      "which loop": "recovered Objects",
                      "envt": "",
                      "obj type": "Solns"
                    }
                  }
                }
              },
              "runAfter": {
                "Recovered_Solns": [
                  "Failed"
                ]
              },
              "metadata": {
                "operationMetadataId": "56f9af6a-d5fd-4bbe-b676-f23e2332383d"
              },
              "type": "Scope"
            },
            "Recovered_Ai_Models": {
              "actions": {
                "List_Models_marked_deleted": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "8544e2e7-f316-49bc-9d60-914defdb66b0"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps_1",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_aibuildermodels",
                      "$select": "admin_aibuildermodelid, _admin_aienvironment_value, admin_ainonuniquename",
                      "$filter": "admin_aideleted ne false",
                      "$expand": "admin_AiEnvironment($select=admin_environmentcdsmetadataname)"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "Apply_to_deleted_Model": {
                  "foreach": "@outputs('List_Models_marked_deleted')?['body/value']",
                  "actions": {
                    "Get_Model": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "799e2293-6c7e-4b4d-8334-a53b2c247aa8"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataservice",
                          "operationId": "GetItems_V2",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataservice"
                        },
                        "parameters": {
                          "dataset": "@items('Apply_to_deleted_Model')?['admin_aienvironment/admin_environmentcdsmetadataname']",
                          "table": "msdyn_aimodels",
                          "$filter": "msdyn_aimodelid eq @{items('Apply_to_deleted_Model')?['admin_ainonuniquename']}"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    },
                    "list_failed_so_not_found_-_Models": {
                      "runAfter": {
                        "Get_Model": [
                          "Failed"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "68ba4b52-107e-4da4-bbf1-bc1662eeae87"
                      },
                      "type": "Compose",
                      "inputs": "list failed so not found"
                    },
                    "Mark_Model_Not_Deleted": {
                      "runAfter": {
                        "list_failed_so_not_found_-_Models": [
                          "Skipped"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "b3e3247c-c9cd-4528-bde6-cc9445bbf8d6"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "UpdateRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_aibuildermodels",
                          "recordId": "@items('Apply_to_deleted_Model')?['admin_aibuildermodelid']",
                          "item/admin_aideleted": false,
                          "item/admin_aideletedon": "@null"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    }
                  },
                  "runAfter": {
                    "List_Models_marked_deleted": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "c6267c27-1c3a-45f5-b640-aac52f056edf"
                  },
                  "type": "Foreach",
                  "runtimeConfiguration": {
                    "concurrency": {
                      "repetitions": 50
                    }
                  }
                }
              },
              "runAfter": {
                "Recovered_Solns_-_Failed": [
                  "Succeeded",
                  "Skipped"
                ]
              },
              "metadata": {
                "operationMetadataId": "f6873576-b5de-4ff2-a07e-7144faeac157"
              },
              "type": "Scope"
            },
            "Recovered_Ai_Models_-_Failed": {
              "actions": {
                "set_failure_occurred_true_-_Recover_Ai_Models": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "b2004d1c-bbfd-4fbb-b378-2810d8c74761"
                  },
                  "type": "SetVariable",
                  "inputs": {
                    "name": "failureOccurred",
                    "value": "@true"
                  }
                },
                "Append_Failure_-_Recover__Ai_Models": {
                  "runAfter": {
                    "set_failure_occurred_true_-_Recover_Ai_Models": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                  },
                  "type": "AppendToArrayVariable",
                  "inputs": {
                    "name": "varFailures",
                    "value": {
                      "which loop": "recovered Objects",
                      "envt": "",
                      "obj type": "Ai Models"
                    }
                  }
                }
              },
              "runAfter": {
                "Recovered_Ai_Models": [
                  "Failed"
                ]
              },
              "metadata": {
                "operationMetadataId": "56f9af6a-d5fd-4bbe-b676-f23e2332383d"
              },
              "type": "Scope"
            },
            "Skip_some_recovery_checks_if_BYODL": {
              "actions": {
                "Recovered_Canvas_Apps": {
                  "actions": {
                    "List_canvas_apps_marked_deleted": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "7946198c-0ae8-4d6c-b50d-2821bc1648f6"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps_1",
                          "operationId": "ListRecords",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_apps",
                          "$select": "_admin_appenvironment_value, admin_appid",
                          "$filter": "admin_appdeleted ne false and admin_powerappstype ne 597910001\n",
                          "$expand": "admin_AppEnvironment($select=admin_environmentname)"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    },
                    "Apply_to_deleted_app": {
                      "foreach": "@outputs('List_canvas_apps_marked_deleted')?['body/value']",
                      "actions": {
                        "Get_App_as_Admin": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "19072d81-300b-4b85-b7d0-9c1ade423c5f"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_powerappsforadmins",
                              "operationId": "Get-AdminApp",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_powerappsforadmins"
                            },
                            "parameters": {
                              "environment": "@items('Apply_to_deleted_app')?['admin_appenvironment/admin_environmentname']",
                              "app": "@items('Apply_to_deleted_app')?['admin_appid']",
                              "api-version": "2016-11-01"
                            },
                            "authentication": "@parameters('$authentication')"
                          }
                        },
                        "App_Not_Found": {
                          "runAfter": {
                            "Get_App_as_Admin": [
                              "Failed"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "d9969d0d-9980-4325-a646-4ceaca5ff571"
                          },
                          "type": "Compose",
                          "inputs": "App Not Found"
                        },
                        "Mark_App_Not_Deleted": {
                          "runAfter": {
                            "App_Not_Found": [
                              "Skipped"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "04e5f3aa-4021-4cd2-9eb7-c37ad685786f"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps_1",
                              "operationId": "UpdateRecord",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_apps",
                              "recordId": "@items('Apply_to_deleted_app')?['admin_appid']",
                              "item/admin_appdeleted": false,
                              "item/admin_appdeletedon": "@null"
                            },
                            "authentication": "@parameters('$authentication')"
                          }
                        }
                      },
                      "runAfter": {
                        "List_canvas_apps_marked_deleted": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "5e4c8734-4cce-4fa0-ba90-4bb0579f0005"
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 50
                        }
                      }
                    }
                  },
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "f4b43aa2-2b50-4c92-aa6a-3787b27391c5"
                  },
                  "type": "Scope"
                },
                "Recovered_Canvas_Apps_-_Failed": {
                  "actions": {
                    "set_failure_occurred_true_-_Recover_canvas": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "b2004d1c-bbfd-4fbb-b378-2810d8c74761"
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "failureOccurred",
                        "value": "@true"
                      }
                    },
                    "Append_Failure_-_Recover_canvas": {
                      "runAfter": {
                        "set_failure_occurred_true_-_Recover_canvas": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                      },
                      "type": "AppendToArrayVariable",
                      "inputs": {
                        "name": "varFailures",
                        "value": {
                          "which loop": "recovered Objects",
                          "envt": "",
                          "obj type": "Canvas Apps"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Recovered_Canvas_Apps": [
                      "Failed"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "221efe1e-1350-43bd-bc24-18c4c6ec327a"
                  },
                  "type": "Scope"
                },
                "Recovered_Model_Driven_Apps": {
                  "actions": {
                    "List_model_driven_apps_marked_deleted": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "7946198c-0ae8-4d6c-b50d-2821bc1648f6"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps_1",
                          "operationId": "ListRecords",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_apps",
                          "$select": "_admin_appenvironment_value, admin_appid, admin_appidstring",
                          "$filter": "admin_appdeleted ne false and admin_powerappstype eq 597910001",
                          "$expand": "admin_AppEnvironment($select=admin_environmentcdsmetadataname)"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    },
                    "Apply_to_deleted_model_driven_app": {
                      "foreach": "@outputs('List_model_driven_apps_marked_deleted')?['body/value']",
                      "actions": {
                        "Get_Model_Driven_App": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "799e2293-6c7e-4b4d-8334-a53b2c247aa8"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataservice",
                              "operationId": "GetItems_V2",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataservice"
                            },
                            "parameters": {
                              "dataset": "@items('Apply_to_deleted_model_driven_app')?['admin_appenvironment/admin_environmentcdsmetadataname']",
                              "table": "appmodules",
                              "$filter": "appmoduleid eq @{items('Apply_to_deleted_model_driven_app')?['admin_appidstring']}"
                            },
                            "authentication": "@parameters('$authentication')"
                          }
                        },
                        "list_failed_so_not_found_-_Model_Driven_App": {
                          "runAfter": {
                            "Get_Model_Driven_App": [
                              "Failed"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "68ba4b52-107e-4da4-bbf1-bc1662eeae87"
                          },
                          "type": "Compose",
                          "inputs": "list failed so not found"
                        },
                        "Mark_Model_Driven_App_Not_Deleted": {
                          "runAfter": {
                            "list_failed_so_not_found_-_Model_Driven_App": [
                              "Skipped"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "04e5f3aa-4021-4cd2-9eb7-c37ad685786f"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps_1",
                              "operationId": "UpdateRecord",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_apps",
                              "recordId": "@items('Apply_to_deleted_model_driven_app')?['admin_appidstring']",
                              "item/admin_appdeleted": false,
                              "item/admin_appdeletedon": "@null"
                            },
                            "authentication": "@parameters('$authentication')"
                          }
                        }
                      },
                      "runAfter": {
                        "List_model_driven_apps_marked_deleted": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "5e4c8734-4cce-4fa0-ba90-4bb0579f0005"
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 50
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Recovered_Canvas_Apps_-_Failed": [
                      "Succeeded",
                      "Skipped"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "f4b43aa2-2b50-4c92-aa6a-3787b27391c5"
                  },
                  "type": "Scope"
                },
                "Recovered_Model_Driven_Apps_-_Failed": {
                  "actions": {
                    "set_failure_occurred_true_-_Recover_model_driven_app": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "b2004d1c-bbfd-4fbb-b378-2810d8c74761"
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "failureOccurred",
                        "value": "@true"
                      }
                    },
                    "Append_Failure_-_Recover_model_driven_app": {
                      "runAfter": {
                        "set_failure_occurred_true_-_Recover_model_driven_app": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                      },
                      "type": "AppendToArrayVariable",
                      "inputs": {
                        "name": "varFailures",
                        "value": {
                          "which loop": "recovered Objects",
                          "envt": "",
                          "obj type": "Model Driven Apps"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Recovered_Model_Driven_Apps": [
                      "Failed"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "221efe1e-1350-43bd-bc24-18c4c6ec327a"
                  },
                  "type": "Scope"
                },
                "Recovered_Cloud_Flows": {
                  "actions": {
                    "List_cloud_flows_marked_deleted": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "7946198c-0ae8-4d6c-b50d-2821bc1648f6"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps_1",
                          "operationId": "ListRecords",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_flows",
                          "$select": "_admin_flowenvironment_value, admin_flowid",
                          "$filter": "admin_flowdeleted ne false",
                          "$expand": "admin_FlowEnvironment($select=admin_environmentname)"
                        },
                        "authentication": "@parameters('$authentication')"
                      }
                    },
                    "Apply_to_deleted_cloud_flows": {
                      "foreach": "@outputs('List_cloud_flows_marked_deleted')?['body/value']",
                      "actions": {
                        "Get_Flow_as_Admin": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "6f5a3dfb-dab6-4c1e-ba33-c06187450156"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_flowmanagement",
                              "operationId": "AdminGetFlow",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_flowmanagement"
                            },
                            "parameters": {
                              "environmentName": "@items('Apply_to_deleted_cloud_flows')?['admin_flowenvironment/admin_environmentname']",
                              "flowName": "@items('Apply_to_deleted_cloud_flows')?['admin_flowid']"
                            },
                            "authentication": "@parameters('$authentication')"
                          }
                        },
                        "Flow_Not_Found": {
                          "runAfter": {
                            "Get_Flow_as_Admin": [
                              "Failed"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "490c63d6-4e47-4452-9fd8-06caae116032"
                          },
                          "type": "Compose",
                          "inputs": "Flow Not Found"
                        },
                        "Mark_Cloud_Flow_Not_Deleted": {
                          "runAfter": {
                            "Flow_Not_Found": [
                              "Skipped"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "4722a13c-53b6-432b-9aaa-64ade0feb6d5"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps_1",
                              "operationId": "UpdateRecord",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_flows",
                              "recordId": "@items('Apply_to_deleted_cloud_flows')?['admin_flowid']",
                              "item/admin_flowdeleted": false,
                              "item/admin_flowdeletedon": "@null"
                            },
                            "authentication": "@parameters('$authentication')"
                          }
                        }
                      },
                      "runAfter": {
                        "List_cloud_flows_marked_deleted": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "5e4c8734-4cce-4fa0-ba90-4bb0579f0005"
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 50
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Recovered_Model_Driven_Apps_-_Failed": [
                      "Succeeded",
                      "Skipped"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "f4b43aa2-2b50-4c92-aa6a-3787b27391c5"
                  },
                  "type": "Scope"
                },
                "Recovered_Cloud_Flows_-_Failed": {
                  "actions": {
                    "set_failure_occurred_true_-_Recover_cloud_flows": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "b2004d1c-bbfd-4fbb-b378-2810d8c74761"
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "failureOccurred",
                        "value": "@true"
                      }
                    },
                    "Append_Failure_-_Recover__cloud_flows": {
                      "runAfter": {
                        "set_failure_occurred_true_-_Recover_cloud_flows": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "078021b2-c83c-43d7-98c6-288c0b0b5640"
                      },
                      "type": "AppendToArrayVariable",
                      "inputs": {
                        "name": "varFailures",
                        "value": {
                          "which loop": "recovered Objects",
                          "envt": "",
                          "obj type": "Cloud Flows"
                        }
                      }
                    }
                  },
                  "runAfter": {
                    "Recovered_Cloud_Flows": [
                      "Failed"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "221efe1e-1350-43bd-bc24-18c4c6ec327a"
                  },
                  "type": "Scope"
                }
              },
              "runAfter": {},
              "expression": {
                "not": {
                  "equals": [
                    "@parameters('Inventory and Telemetry in Azure Data Storage account (admin_InventoryandTelemetryinAzureDataStorageaccount)')",
                    "@true"
                  ]
                }
              },
              "metadata": {
                "operationMetadataId": "a5cebd63-6798-47a5-851a-de453034e898"
              },
              "type": "If"
            }
          },
          "runAfter": {
            "Select": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "6ddbed25-5d76-4335-9783-022f6371180f"
          },
          "type": "Scope",
          "description": "For objects recreated. Do not need to do for envts as they are always full inventory"
        },
        "Test_-_fail_check_2": {
          "runAfter": {
            "Recovered_Objects": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "155cc93e-8721-4401-92c2-2135b24864de"
          },
          "type": "Compose",
          "inputs": "@variables('failureOccurred')"
        }
      },
      "outputs": {}
    },
    "templateName": null
  },
  "schemaVersion": "1.0.0.0"
}