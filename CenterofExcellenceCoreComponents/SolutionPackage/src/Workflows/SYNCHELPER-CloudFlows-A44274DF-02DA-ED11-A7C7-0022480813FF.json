{
  "properties": {
    "connectionReferences": {
      "shared_commondataserviceforapps_2": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreDataverseEnvRequest"
        },
        "api": {
          "name": "shared_commondataserviceforapps"
        }
      },
      "shared_commondataserviceforapps": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreDataverseEnvRequest"
        },
        "api": {
          "name": "shared_commondataserviceforapps"
        }
      },
      "shared_flowmanagement_1": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerAutomateManagement"
        },
        "api": {
          "name": "shared_flowmanagement"
        }
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        },
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)": {
          "defaultValue": "https://flow.microsoft.com/manage/environments/",
          "type": "String",
          "metadata": {
            "schemaName": "admin_PowerAutomateEnvironmentVariable",
            "description": "Inventory - REQUIRED. Environment, including geographic location, for Power Automate - Ex for commercial: https://flow.microsoft.com/manage/environments/"
          }
        }
      },
      "triggers": {
        "manual": {
          "metadata": {
            "operationMetadataId": "eed74da2-7465-46b8-adbe-7be35b203269"
          },
          "type": "Request",
          "kind": "Button",
          "inputs": {
            "schema": {
              "type": "object",
              "properties": {
                "text": {
                  "title": "envtid",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "Please enter your input",
                  "x-ms-content-hint": "TEXT"
                },
                "text_1": {
                  "title": "envtName",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "Please enter your input",
                  "x-ms-content-hint": "TEXT"
                },
                "text_2": {
                  "title": "flowid",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "Please enter your input",
                  "x-ms-content-hint": "TEXT"
                }
              },
              "required": [
                "text",
                "text_1",
                "text_2"
              ]
            }
          }
        }
      },
      "actions": {
        "Initialize_hasBadConnections_to_false": {
          "runAfter": {
            "Initialize_variable_FlowOwnerID": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "aee9429d-e744-40f0-adb3-f247e40e7694"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "hasBadConnections",
                "type": "boolean",
                "value": "@false"
              }
            ]
          }
        },
        "Initialize_variable_FlowOwnerID": {
          "runAfter": {},
          "metadata": {
            "operationMetadataId": "74890118-f6a1-4c4e-a69f-d69be0aabafc"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "FlowOwnerID",
                "type": "string"
              }
            ]
          }
        },
        "Inventory_this_flow": {
          "actions": {
            "Flow_does_not_exist_in_tenant": {
              "actions": {
                "See_if_flow_exists_to_mark_deleted": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "d94dd5f4-301f-42ef-9854-282061bd0e57"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "GetItem",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_flows",
                      "recordId": "@triggerBody()['text_2']"
                    },
                    "authentication": {
                      "type": "Raw",
                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                    }
                  }
                },
                "Catch_flow_does_not_exist": {
                  "runAfter": {
                    "See_if_flow_exists_to_mark_deleted": [
                      "Failed"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "256bd0e6-7aeb-4426-a7cd-73df8b2bbb6a"
                  },
                  "type": "Compose",
                  "inputs": "Catch flow does not exist"
                },
                "Flow_existed_so_mark_deleted": {
                  "runAfter": {
                    "Catch_flow_does_not_exist": [
                      "Skipped"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "13a60603-d12e-4c58-b066-a0adf6091a5f"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "UpdateRecord",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_flows",
                      "recordId": "@triggerBody()['text_2']",
                      "item/admin_flowdeleted": true,
                      "item/admin_flowdeletedon": "@utcNow()"
                    },
                    "authentication": {
                      "type": "Raw",
                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                    }
                  }
                }
              },
              "runAfter": {
                "Get_Flow_as_Admin": [
                  "Failed"
                ]
              },
              "metadata": {
                "operationMetadataId": "12fcf2ed-c856-4702-b643-a11674ebeba2"
              },
              "type": "Scope"
            },
            "Flow_exists_in_tenant": {
              "actions": {
                "Get_Flow_Owner_Information": {
                  "actions": {
                    "Maker_Check_-_Derived_Owner": {
                      "runAfter": {
                        "If_DerivedOwner_is_null,_set_to_Creator": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "c164e38c-3540-48cb-90fc-cccbbe40838c"
                      },
                      "type": "Workflow",
                      "inputs": {
                        "host": {
                          "workflowReferenceName": "9301f01a-cb40-ec11-8c62-00224829b4c1"
                        },
                        "body": {
                          "text": "@variables('FlowOwnerID')",
                          "boolean": false
                        }
                      }
                    },
                    "If_DerivedOwner_is_null,_set_to_Creator": {
                      "actions": {
                        "Set_FlowOwnerID_to_Creator": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "388cc8d7-a73b-4820-a489-8b57b2333d31"
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "FlowOwnerID",
                            "value": "@{if(equals(outputs('Get_Flow_as_Admin')?['body/properties/creator/objectId'], null), '', outputs('Get_Flow_as_Admin')?['body/properties/creator/objectId'])}"
                          }
                        }
                      },
                      "runAfter": {
                        "Set_FlowOwnerID_to_Derived_Owner": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "or": [
                          {
                            "equals": [
                              "@variables('FlowOwnerID')",
                              "@null"
                            ]
                          },
                          {
                            "equals": [
                              "@length(variables('FlowOwnerID'))",
                              0
                            ]
                          }
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "482f9b2a-b521-494b-b92a-0f2d4f9f1408"
                      },
                      "type": "If"
                    },
                    "Set_FlowOwnerID_to_Derived_Owner": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "2dfd3e4f-d0d9-47a1-bcb8-b20505d5f487"
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "FlowOwnerID",
                        "value": "@{coalesce(outputs('Get_Flow_from_Inventory')?['body/_admin_derivedowner_value'], '')}"
                      }
                    }
                  },
                  "runAfter": {
                    "Get_Basics": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "45fedf9a-3549-4613-9d74-53692c5803ec"
                  },
                  "type": "Scope",
                  "description": "We augment the products concept of owner for flow in order to re-assign owners. So this scope is needed to get the identity we will use"
                },
                "Upsert_Flow_Details": {
                  "actions": {
                    "Check_if_Orphan": {
                      "actions": {
                        "Upsert_Flow_record_(creator_not_found)": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "b386ea50-ad86-421e-b61d-65e66a333b32"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_flows",
                              "recordId": "@triggerBody()['text_2']",
                              "item/admin_displayname": "@outputs('Get_Flow_as_Admin')?['body/properties/displayName']",
                              "item/admin_flowconnections": "@outputs('Compose_edit_comma_separated_connector_list')",
                              "item/admin_flowcontainsbrokenconnections": "@variables('hasBadConnections')",
                              "item/admin_flowcreatedon": "@outputs('Get_Flow_as_Admin')?['body/properties/createdTime']",
                              "item/admin_flowcreatorupn": "@outputs('Get_Flow_as_Admin')?['body/properties/creator/userId']",
                              "item/admin_flowdeleted": false,
                              "item/admin_flowdeletedon": "@null",
                              "item/admin_flowdescription": "@body('Parse_Flow_JSON')?['properties']?['definitionSummary']?['description']",
                              "item/admin_FlowEnvironment@odata.bind": "admin_environments(@{triggerBody()['text']})",
                              "item/admin_flowenvironmentdisplayname": "@outputs('Get_Evnt_Details')?['body/admin_displayname']",
                              "item/admin_flowenvironmentid": "@triggerBody()['text_1']",
                              "item/cr5d5_flowisorphaned": "Yes",
                              "item/admin_flowispublished": true,
                              "item/admin_flowmodifiedon": "@outputs('Get_Flow_as_Admin')?['body/properties/lastModifiedTime']",
                              "item/admin_flowstate": "@outputs('Get_Flow_as_Admin')?['body/properties/state']",
                              "item/admin_flowsuspensionreason": "@body('Parse_Flow_JSON')?['properties']?['flowSuspensionReason']",
                              "item/admin_flowidstring": "@triggerBody()['text_2']",
                              "item/admin_inventoryme": false,
                              "item/admin_recordguidasstring": "@triggerBody()['text_2']",
                              "item/admin_tempconnectionstringresetcomplete": true,
                              "item/admin_templatename": "@outputs('Get_Flow_as_Admin')?['body/properties/templateName']",
                              "item/admin_workflowentityid": "@body('Parse_Flow_JSON')?['properties']?['workflowEntityId']"
                            },
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          }
                        }
                      },
                      "runAfter": {},
                      "else": {
                        "actions": {
                          "Upsert_Flow_record": {
                            "runAfter": {},
                            "metadata": {
                              "operationMetadataId": "7a9fef20-beda-49eb-b6c5-ff5c6c52486c"
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_commondataserviceforapps",
                                "operationId": "UpdateRecord",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                              },
                              "parameters": {
                                "entityName": "admin_flows",
                                "recordId": "@triggerBody()['text_2']",
                                "item/admin_displayname": "@outputs('Get_Flow_as_Admin')?['body/properties/displayName']",
                                "item/admin_city": "@body('Maker_Check_-_Derived_Owner')?['usercity']",
                                "item/admin_company": "@body('Maker_Check_-_Derived_Owner')?['usercompany']",
                                "item/admin_country": "@body('Maker_Check_-_Derived_Owner')?['usercountry']",
                                "item/admin_department": "@body('Maker_Check_-_Derived_Owner')?['userdepartment']",
                                "item/admin_DerivedOwner@odata.bind": "admin_makers(@{variables('FlowOwnerID')})",
                                "item/admin_flowconnections": "@outputs('Compose_edit_comma_separated_connector_list')",
                                "item/admin_flowcontainsbrokenconnections": "@variables('hasBadConnections')",
                                "item/admin_flowcreatedon": "@outputs('Get_Flow_as_Admin')?['body/properties/createdTime']",
                                "item/admin_flowcreatorupn": "@outputs('Get_Flow_as_Admin')?['body/properties/creator/userId']",
                                "item/admin_flowdeleted": false,
                                "item/admin_flowdeletedon": "@null",
                                "item/admin_flowdescription": "@body('Parse_Flow_JSON')?['properties']?['definitionSummary']?['description']",
                                "item/admin_FlowEnvironment@odata.bind": "admin_environments(@{triggerBody()['text']})",
                                "item/admin_flowenvironmentdisplayname": "@outputs('Get_Evnt_Details')?['body/admin_displayname']",
                                "item/admin_flowenvironmentid": "@triggerBody()['text_1']",
                                "item/cr5d5_flowisorphaned": "No",
                                "item/admin_flowispublished": true,
                                "item/admin_flowmakerdisplayname": "@body('Maker_Check_-_Derived_Owner')?['userdisplayname']",
                                "item/admin_flowmodifiedon": "@outputs('Get_Flow_as_Admin')?['body/properties/lastModifiedTime']",
                                "item/admin_flowstate": "@outputs('Get_Flow_as_Admin')?['body/properties/state']",
                                "item/admin_flowsuspensionreason": "@body('Parse_Flow_JSON')?['properties']?['flowSuspensionReason']",
                                "item/admin_flowidstring": "@triggerBody()['text_2']",
                                "item/admin_inventoryme": false,
                                "item/admin_FlowCreator@odata.bind": "admin_makers(@{variables('FlowOwnerID')})",
                                "item/admin_recordguidasstring": "@triggerBody()['text_2']",
                                "item/admin_tempconnectionstringresetcomplete": true,
                                "item/admin_templatename": "@outputs('Get_Flow_as_Admin')?['body/properties/templateName']",
                                "item/admin_workflowentityid": "@body('Parse_Flow_JSON')?['properties']?['workflowEntityId']"
                              },
                              "authentication": {
                                "type": "Raw",
                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                              },
                              "retryPolicy": {
                                "type": "exponential",
                                "count": 10,
                                "interval": "PT10S"
                              }
                            }
                          }
                        }
                      },
                      "expression": {
                        "equals": [
                          "@body('Maker_Check_-_Derived_Owner')?['userisorphan']",
                          "@true"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "b35d0e17-ee5b-492e-a12b-b0d65f1fec87"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "Prepare_for_Connection_References_Table": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "b60b7461-053a-4abb-8689-fb8b768a27bd"
                  },
                  "type": "Scope"
                },
                "Get_Basics": {
                  "actions": {
                    "Get_Connectors": {
                      "actions": {
                        "List_Connectors": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "04a4cbe3-6883-49b0-a362-9d604275e2a5"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps",
                              "operationId": "ListRecords",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_connectors",
                              "$select": "admin_displayname,admin_connectorid,admin_id,admin_name"
                            },
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          },
                          "runtimeConfiguration": {
                            "paginationPolicy": {
                              "minimumItemCount": 100000
                            }
                          }
                        },
                        "Specialty_Connectors": {
                          "actions": {
                            "List_Http": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "ee734f72-173b-4708-8fd1-e88f10195826"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "ListRecords",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_connectors",
                                  "$select": "admin_connectorid",
                                  "$filter": "admin_id eq 'Http'",
                                  "$top": 1
                                },
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                }
                              }
                            },
                            "List_HttpWebhook": {
                              "runAfter": {
                                "GUID_Http": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "7a39cd19-d939-4096-bfa4-e65155ef439b"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "ListRecords",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_connectors",
                                  "$select": "admin_connectorid",
                                  "$filter": "admin_id eq 'HttpWebhook'",
                                  "$top": 1
                                },
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                }
                              }
                            },
                            "List_HttpRequestReceived": {
                              "runAfter": {
                                "GUID_HttpWebhook": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "7f9ab01b-be8a-47b6-b309-6d861d8c66ef"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "ListRecords",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_connectors",
                                  "$select": "admin_connectorid",
                                  "$filter": "admin_id eq 'HttpRequestReceived'",
                                  "$top": 1
                                },
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                }
                              }
                            },
                            "GUID_Http": {
                              "runAfter": {
                                "List_Http": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "797a9016-a837-4227-9b1f-97a5ab9c3a45"
                              },
                              "type": "Compose",
                              "inputs": "@first(outputs('List_Http')?['body/value'])?['admin_connectorid']"
                            },
                            "GUID_HttpWebhook": {
                              "runAfter": {
                                "List_HttpWebhook": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "02224a36-f5e6-4cc3-83a6-d0eb96350a51"
                              },
                              "type": "Compose",
                              "inputs": "@first(outputs('List_HttpWebhook')?['body/value'])?['admin_connectorid']"
                            },
                            "GUID_HttpRequestReceived": {
                              "runAfter": {
                                "List_HttpRequestReceived": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "22da2648-aa52-4ba2-9d40-5c689ec1d2e6"
                              },
                              "type": "Compose",
                              "inputs": "@first(outputs('List_HttpRequestReceived')?['body/value'])?['admin_connectorid']"
                            }
                          },
                          "runAfter": {
                            "List_Connectors": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "b330093d-15a0-4eab-af9a-467e3a1e56c5"
                          },
                          "type": "Scope"
                        }
                      },
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "56473474-da9d-4b6e-b82c-a40f81b78bfe"
                      },
                      "type": "Scope"
                    },
                    "Get_Flow_from_Inventory": {
                      "runAfter": {
                        "Parse_Flow_JSON": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "cd6116f3-610e-48dd-aec4-28f018315df5"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps_2",
                          "operationId": "GetItem",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_flows",
                          "recordId": "@triggerBody()['text_2']"
                        },
                        "authentication": {
                          "type": "Raw",
                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                        }
                      }
                    },
                    "Parse_Flow_JSON": {
                      "runAfter": {
                        "Get_Connectors": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "3d58e0dc-0ecb-4b4f-9b36-1f55ee2b01bc"
                      },
                      "type": "ParseJson",
                      "inputs": {
                        "content": "@body('Get_Flow_as_Admin')",
                        "schema": {
                          "properties": {
                            "id": {
                              "type": "string"
                            },
                            "name": {
                              "type": "string"
                            },
                            "properties": {
                              "properties": {
                                "apiId": {
                                  "type": "string"
                                },
                                "connectionReferences": {
                                  "type": "array"
                                },
                                "createdTime": {
                                  "type": "string"
                                },
                                "creator": {
                                  "properties": {
                                    "objectId": {
                                      "type": "string"
                                    },
                                    "tenantId": {
                                      "type": "string"
                                    },
                                    "userId": {
                                      "type": "string"
                                    },
                                    "userType": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "definitionSummary": {
                                  "properties": {
                                    "actions": {
                                      "items": {
                                        "properties": {
                                          "kind": {
                                            "type": "string"
                                          },
                                          "type": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "type": "array"
                                    },
                                    "description": {
                                      "type": "string"
                                    },
                                    "triggers": {
                                      "items": {
                                        "properties": {
                                          "kind": {
                                            "type": "string"
                                          },
                                          "type": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "type": "object"
                                },
                                "displayName": {
                                  "type": "string"
                                },
                                "environment": {
                                  "properties": {
                                    "id": {
                                      "type": "string"
                                    },
                                    "name": {
                                      "type": "string"
                                    },
                                    "type": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "flowFailureAlertSubscribed": {
                                  "type": "boolean"
                                },
                                "flowSuspensionReason": {
                                  "type": "string"
                                },
                                "lastModifiedTime": {
                                  "type": "string"
                                },
                                "provisioningMethod": {
                                  "type": "string"
                                },
                                "referencedResources": {
                                  "type": "array"
                                },
                                "sharingType": {
                                  "type": "string"
                                },
                                "state": {
                                  "type": "string"
                                },
                                "triggerSchema": {
                                  "properties": {
                                    "properties": {
                                      "type": "object"
                                    },
                                    "type": {
                                      "type": "string"
                                    }
                                  },
                                  "type": "object"
                                },
                                "userType": {
                                  "type": "string"
                                },
                                "workflowEntityId": {
                                  "type": "string"
                                }
                              },
                              "type": "object"
                            },
                            "type": {
                              "type": "string"
                            }
                          },
                          "type": "object"
                        }
                      }
                    },
                    "Catch_-_new_to_inventory": {
                      "runAfter": {
                        "Get_Flow_from_Inventory": [
                          "Failed"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "d0e9c8f8-8cca-4a6a-a1d0-c466efa57a91"
                      },
                      "type": "Compose",
                      "inputs": "Catch - new to inventory"
                    }
                  },
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "7b69a62f-c3fd-46e9-b8d4-336f77e0df53"
                  },
                  "type": "Scope"
                },
                "Prepare_Connection_String": {
                  "actions": {
                    "Select_type": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "fe4a6a63-c900-412e-ab56-ec7a6ac89c4f"
                      },
                      "type": "Select",
                      "inputs": {
                        "from": "@body('Parse_Flow_JSON')?['properties']?['definitionSummary']?['actions']",
                        "select": "@item()?['type']"
                      }
                    },
                    "add_HTTP_Webhook": {
                      "runAfter": {
                        "add_HTTP": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "39421be2-1c60-4e91-aadd-bdfb8807fb6b"
                      },
                      "type": "Compose",
                      "inputs": "@if(contains(body('Select_type'), 'HttpWebhook'), ',HttpWebhook', '')"
                    },
                    "add_HTTP": {
                      "runAfter": {
                        "Select_triggers": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "56c398a7-bb69-414c-b192-d1fa9a946eae"
                      },
                      "type": "Compose",
                      "inputs": "@if(contains(body('Select_type'), 'Http'), ',Http', '')"
                    },
                    "check_if_connection_reference_exist": {
                      "actions": {
                        "Compose_edit_comma_separated_connector_list": {
                          "runAfter": {
                            "Select_Connector_Display_Name": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "080b7d68-d39d-46a9-ae07-afc68b2e8572"
                          },
                          "type": "Compose",
                          "inputs": "@concat(join(body('Select_Connector_Display_Name'), ','), outputs('add_HTTP_Webhook'), outputs('add_HTTP'), outputs('add_HTTP_Request'))"
                        },
                        "Parse_Connection_JSON": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "9a887e7e-0e27-4aad-8863-db267ee8cf66"
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@outputs('Get_Flow_as_Admin')?['body/properties/connectionReferences']",
                            "schema": {
                              "items": {
                                "properties": {
                                  "apiDefinition": {
                                    "properties": {
                                      "id": {
                                        "type": "string"
                                      },
                                      "name": {
                                        "type": "string"
                                      },
                                      "properties": {
                                        "properties": {
                                          "capabilities": {
                                            "items": {
                                              "type": "string"
                                            },
                                            "type": "array"
                                          },
                                          "changedTime": {
                                            "type": "string"
                                          },
                                          "connectionParameters": {
                                            "properties": {
                                              "token": {
                                                "properties": {
                                                  "oAuthSettings": {
                                                    "properties": {
                                                      "clientId": {
                                                        "type": "string"
                                                      },
                                                      "customParameters": {
                                                        "properties": {
                                                          "loginUri": {
                                                            "properties": {
                                                              "value": {
                                                                "type": "string"
                                                              }
                                                            },
                                                            "type": "object"
                                                          },
                                                          "loginUriAAD": {
                                                            "properties": {
                                                              "value": {
                                                                "type": "string"
                                                              }
                                                            },
                                                            "type": "object"
                                                          },
                                                          "resourceUri": {
                                                            "properties": {
                                                              "value": {
                                                                "type": "string"
                                                              }
                                                            },
                                                            "type": "object"
                                                          }
                                                        },
                                                        "type": "object"
                                                      },
                                                      "identityProvider": {
                                                        "type": "string"
                                                      },
                                                      "properties": {
                                                        "properties": {
                                                          "AzureActiveDirectoryResourceId": {
                                                            "type": "string"
                                                          },
                                                          "IsFirstParty": {
                                                            "type": "string"
                                                          }
                                                        },
                                                        "type": "object"
                                                      },
                                                      "redirectMode": {
                                                        "type": "string"
                                                      },
                                                      "redirectUrl": {
                                                        "type": "string"
                                                      },
                                                      "scopes": {
                                                        "type": "array"
                                                      }
                                                    },
                                                    "type": "object"
                                                  },
                                                  "type": {
                                                    "type": "string"
                                                  }
                                                },
                                                "type": "object"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "createdTime": {
                                            "type": "string"
                                          },
                                          "description": {
                                            "type": "string"
                                          },
                                          "displayName": {
                                            "type": "string"
                                          },
                                          "iconUri": {
                                            "type": "string"
                                          },
                                          "isCustomApi": {
                                            "type": "boolean"
                                          },
                                          "metadata": {
                                            "properties": {
                                              "brandColor": {
                                                "type": "string"
                                              },
                                              "source": {
                                                "type": "string"
                                              },
                                              "version": {
                                                "properties": {
                                                  "current": {
                                                    "type": "string"
                                                  },
                                                  "previous": {
                                                    "type": "string"
                                                  }
                                                },
                                                "type": "object"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "primaryRuntimeUrl": {
                                            "type": "string"
                                          },
                                          "purpose": {
                                            "type": "string"
                                          },
                                          "runtimeUrls": {
                                            "items": {
                                              "type": "string"
                                            },
                                            "type": "array"
                                          },
                                          "scopes": {
                                            "properties": {
                                              "will": {
                                                "type": "array"
                                              },
                                              "wont": {
                                                "type": "array"
                                              }
                                            },
                                            "type": "object"
                                          },
                                          "tier": {
                                            "type": "string"
                                          }
                                        },
                                        "type": "object"
                                      },
                                      "type": {
                                        "type": "string"
                                      }
                                    },
                                    "type": "object"
                                  },
                                  "connectionName": {
                                    "type": "string"
                                  },
                                  "displayName": {
                                    "type": "string"
                                  },
                                  "id": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "id"
                                ],
                                "type": "object"
                              },
                              "type": "array"
                            }
                          }
                        },
                        "Select_Connector_Display_Name": {
                          "runAfter": {
                            "Parse_Connection_JSON": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "e91c1cf9-856a-4676-a11b-a84d45f935d5"
                          },
                          "type": "Select",
                          "inputs": {
                            "from": "@body('Parse_Connection_JSON')",
                            "select": "@split(item()['id'], '/')[sub(length(split(item()['id'], '/')), 1)]"
                          }
                        }
                      },
                      "runAfter": {
                        "add_HTTP_Request": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "not": {
                          "equals": [
                            "@outputs('Get_Flow_as_Admin')?['body/properties/connectionReferences']",
                            "@null"
                          ]
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "2856e571-8957-4143-864f-3dea6c42f9c2"
                      },
                      "type": "If"
                    },
                    "Select_triggers": {
                      "runAfter": {
                        "Select_type": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "7a129d07-7d97-4ffa-ac83-2e49b1bc32d8"
                      },
                      "type": "Select",
                      "inputs": {
                        "from": "@body('Parse_Flow_JSON')?['properties']?['definitionSummary']?['triggers']",
                        "select": "@item()?['kind']"
                      }
                    },
                    "add_HTTP_Request": {
                      "runAfter": {
                        "add_HTTP_Webhook": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "7b07f2a2-f0cb-4dd9-9405-676f3479cdec"
                      },
                      "type": "Compose",
                      "inputs": "@if(contains(body('Select_triggers'), 'Http'), ',HttpRequest', '')"
                    }
                  },
                  "runAfter": {
                    "Get_Flow_Owner_Information": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "97ef54da-bd17-492e-8a6b-483969811acc"
                  },
                  "type": "Scope"
                },
                "Prepare_for_Connection_References_Table": {
                  "actions": {
                    "Get_Inventory_-_Flow_Connections": {
                      "actions": {
                        "List_Connection_References_Inventory": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "5d30b0a4-a7dd-43c1-abe8-557ae6caa55c"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_commondataserviceforapps_2",
                              "operationId": "ListRecords",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                            },
                            "parameters": {
                              "entityName": "admin_connectionreferences",
                              "$select": "_admin_flow_value, _admin_connector_value, admin_displayname, admin_connectionreferenceid",
                              "$filter": "_admin_flow_value eq '@{triggerBody()['text_2']}'"
                            },
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            }
                          }
                        },
                        "Select_Inventory": {
                          "runAfter": {
                            "List_Connection_References_Inventory": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "a8739869-13fd-4515-b665-98d908e4fbfe"
                          },
                          "type": "Select",
                          "inputs": {
                            "from": "@outputs('List_Connection_References_Inventory')?['body/value']",
                            "select": {
                              "FlowID": "@item()?['_admin_flow_value']",
                              "ConnectorID": "@item()?['_admin_connector_value']",
                              "DisplayName": "@item()?['admin_displayname']"
                            }
                          }
                        },
                        "Parse_Inventory": {
                          "runAfter": {
                            "Select_Inventory": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "e1b5f4c5-fea7-4ae5-98ce-bb4a7421875d"
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@body('Select_Inventory')",
                            "schema": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "FlowID": {
                                    "type": "string"
                                  },
                                  "ConnectorID": {
                                    "type": "string"
                                  },
                                  "DisplayName": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "FlowID",
                                  "ConnectorID",
                                  "DisplayName"
                                ]
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "c2668ca6-b427-4e0c-9677-fe5ea2950497"
                      },
                      "type": "Scope"
                    },
                    "Get_Actual_-_Flow_Connections": {
                      "actions": {
                        "Check_if_Flow_Connection_References_are_not_null": {
                          "actions": {
                            "Apply_to_each_Flow_Connection_Reference": {
                              "foreach": "@body('Filter_id_not_null')",
                              "actions": {
                                "Connecor_Name": {
                                  "runAfter": {
                                    "split_on_slash": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "2bdbfecf-4cc5-4f4b-b923-4009359b61a3"
                                  },
                                  "type": "Compose",
                                  "inputs": "@last(outputs('split_on_slash'))"
                                },
                                "ConnectorID": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "7126bffd-0070-4260-99c2-f6876f1812a4"
                                  },
                                  "type": "Compose",
                                  "inputs": "@items('Apply_to_each_Flow_Connection_Reference')?['id']"
                                },
                                "Filter_current_flow_Connector": {
                                  "runAfter": {
                                    "Connecor_Name": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "897c293f-3821-492e-b77e-c2531cb3263d"
                                  },
                                  "type": "Query",
                                  "inputs": {
                                    "from": "@outputs('List_Connectors')?['body/value']",
                                    "where": "@equals(item()?['admin_name'], outputs('Connecor_Name'))"
                                  }
                                },
                                "mark_broken_connector_or_insert_connection_reference": {
                                  "actions": {
                                    "Append_to_ActualConnectionsArray": {
                                      "runAfter": {},
                                      "metadata": {
                                        "operationMetadataId": "664cd089-00a3-4664-af43-af5a22e3be67"
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "ActualConnectionsArray",
                                        "value": {
                                          "FlowID": "@triggerBody()['text_2']",
                                          "ConnectorID": "@first(body('Filter_current_flow_Connector'))?['admin_connectorid']",
                                          "DisplayName": "@coalesce(items('Apply_to_each_Flow_Connection_Reference')?['displayName'], 'No Display Name For Connector')"
                                        }
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Filter_current_flow_Connector": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_hasBadConnections_true": {
                                        "runAfter": {},
                                        "metadata": {
                                          "operationMetadataId": "bc0b1e7a-4908-4978-a625-5d967212c901"
                                        },
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "hasBadConnections",
                                          "value": "@true"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "greater": [
                                      "@length(body('Filter_current_flow_Connector'))",
                                      0
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "e202458e-a803-4b59-9bea-3fece377334f"
                                  },
                                  "type": "If"
                                },
                                "split_on_slash": {
                                  "runAfter": {
                                    "ConnectorID": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "d5ba4b3e-2901-45d6-8c33-8128951eb6e4"
                                  },
                                  "type": "Compose",
                                  "inputs": "@split(outputs('ConnectorID'), '/')"
                                }
                              },
                              "runAfter": {
                                "Filter_id_not_null": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "f38f07cc-348e-496e-8d32-4ce233c4a8b7"
                              },
                              "type": "Foreach"
                            },
                            "Filter_id_not_null": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "6222ff27-7396-4d1d-b57e-c8459a2410a5"
                              },
                              "type": "Query",
                              "inputs": {
                                "from": "@body('Parse_Connection_JSON')",
                                "where": "@not(equals(item()?['id'], null))"
                              }
                            },
                            "If_http_append_to_array": {
                              "actions": {
                                "Append_to_ActualConnectionsArray_-_http": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "664cd089-00a3-4664-af43-af5a22e3be67"
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "ActualConnectionsArray",
                                    "value": {
                                      "FlowID": "@triggerBody()['text_2']",
                                      "ConnectorID": "@outputs('GUID_Http')",
                                      "DisplayName": "Http"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Apply_to_each_Flow_Connection_Reference": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "greater": [
                                  "@length(outputs('add_HTTP'))",
                                  0
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "22c17baa-c284-4f40-bf80-8f345d484fb6"
                              },
                              "type": "If"
                            },
                            "If_Http_Webhook_append_to_array": {
                              "actions": {
                                "Append_to_ActualConnectionsArray_-_http_webhook": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "664cd089-00a3-4664-af43-af5a22e3be67"
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "ActualConnectionsArray",
                                    "value": {
                                      "FlowID": "@triggerBody()['text_2']",
                                      "ConnectorID": "@outputs('GUID_HttpWebhook')",
                                      "DisplayName": "Http Webhook"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "If_http_append_to_array": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "greater": [
                                  "@length(outputs('add_HTTP_Webhook'))",
                                  0
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "afeea02b-a87a-4374-8877-7f62f323ce4c"
                              },
                              "type": "If"
                            },
                            "If_http_request_append_to_array": {
                              "actions": {
                                "Append_to_ActualConnectionsArray_-_http_request": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "664cd089-00a3-4664-af43-af5a22e3be67"
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "ActualConnectionsArray",
                                    "value": {
                                      "FlowID": "@triggerBody()['text_2']",
                                      "ConnectorID": "@outputs('GUID_HttpRequestReceived')",
                                      "DisplayName": "Http Request Received"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "If_Http_Webhook_append_to_array": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "greater": [
                                  "@length(outputs('Add_HTTP_Request'))",
                                  0
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "a007883b-cda0-443b-bd56-74bd294902d2"
                              },
                              "type": "If"
                            }
                          },
                          "runAfter": {},
                          "else": {
                            "actions": {
                              "Set_ActualConnectionsArray_to_empty": {
                                "runAfter": {},
                                "metadata": {
                                  "operationMetadataId": "2001b0fe-bc72-4be7-bbb5-456d2203eb6b"
                                },
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "ActualConnectionsArray",
                                  "value": []
                                }
                              }
                            }
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@outputs('Get_Flow_as_Admin')?['body/properties/connectionReferences']",
                                "@null"
                              ]
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "56abebe1-caad-475c-849a-b3c794bc007f"
                          },
                          "type": "If"
                        },
                        "Parse_Actual": {
                          "runAfter": {
                            "Check_if_Flow_Connection_References_are_not_null": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "8616a0e7-24cc-4399-bcaf-a4a4c31e337f"
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@variables('ActualConnectionsArray')",
                            "schema": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "FlowID": {
                                    "type": "string"
                                  },
                                  "ConnectorID": {
                                    "type": "string"
                                  },
                                  "DisplayName": {
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "FlowID",
                                  "ConnectorID",
                                  "DisplayName"
                                ]
                              }
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Get_Inventory_-_Flow_Connections": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "dd91af21-3195-4ec7-9c99-4dc28ab0523a"
                      },
                      "type": "Scope"
                    }
                  },
                  "runAfter": {
                    "Prepare_Connection_String": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "e0da0770-9fe9-4a45-8bab-00a5bee141be"
                  },
                  "type": "Scope"
                },
                "Populate_Connection_References_Table": {
                  "actions": {
                    "Remove_Deleted_Connections": {
                      "actions": {
                        "Connections_to_Remove": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "58f582dd-b6f9-4093-8335-9c6f9552c10e"
                          },
                          "type": "Query",
                          "inputs": {
                            "from": "@body('Parse_Inventory')",
                            "where": "@not(contains(body('Parse_Actual'), item()))"
                          }
                        },
                        "Delete_each": {
                          "foreach": "@body('Connections_to_Remove')",
                          "actions": {
                            "Find_it_to_delete": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "13dd4cf4-8f40-47da-9e90-73678a3f25ce"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "ListRecords",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_connectionreferences",
                                  "$select": "admin_connectionreferenceid",
                                  "$filter": "_admin_flow_value eq '@{items('Delete_each')?['FlowID']}' and _admin_connector_value eq '@{items('Delete_each')?['ConnectorID']}' and admin_displayname eq '@{replace(items('Delete_each')?['DisplayName'], '''', '''''')}'"
                                },
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                }
                              }
                            },
                            "Delete_it": {
                              "runAfter": {
                                "Find_it_to_delete": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "0a53aabb-70d8-45de-8f4a-16d71cf944c3"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "DeleteRecord",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_connectionreferences",
                                  "recordId": "@first(outputs('Find_it_to_delete')?['body/value'])?['admin_connectionreferenceid']"
                                },
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Connections_to_Remove": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "69d2382e-c315-4c8d-8a9f-fd5a11df1d73"
                          },
                          "type": "Foreach"
                        }
                      },
                      "runAfter": {
                        "Add_New_Connections": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "42a6b027-d576-40e4-8bde-c582d2db169e"
                      },
                      "type": "Scope"
                    },
                    "Add_New_Connections": {
                      "actions": {
                        "Connections_to_Add": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "23111389-de69-49a7-85d9-bee2bb97ba1b"
                          },
                          "type": "Query",
                          "inputs": {
                            "from": "@body('Parse_Actual')",
                            "where": "@not(contains(body('Parse_Inventory'), item()))"
                          }
                        },
                        "Apply_to_each_new_connection": {
                          "foreach": "@body('Connections_to_Add')",
                          "actions": {
                            "Add_a_new_connection": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "03632cfb-bcd4-4bef-983d-49c8a477c703"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "CreateRecord",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_connectionreferences",
                                  "item/admin_displayname": "@items('Apply_to_each_new_connection')?['DisplayName']",
                                  "item/admin_Connector@odata.bind": "admin_connectors(@{items('Apply_to_each_new_connection')?['ConnectorID']})",
                                  "item/admin_Flow@odata.bind": "admin_flows(@{items('Apply_to_each_new_connection')?['FlowID']})"
                                },
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Connections_to_Add": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "f18a11e6-cf04-4d3d-b8f8-9c80496b86db"
                          },
                          "type": "Foreach"
                        }
                      },
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "62895c7d-bd49-4621-bdbc-4be501a75bae"
                      },
                      "type": "Scope"
                    }
                  },
                  "runAfter": {
                    "Upsert_Flow_Details": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "e0da0770-9fe9-4a45-8bab-00a5bee141be"
                  },
                  "type": "Scope"
                }
              },
              "runAfter": {
                "Flow_does_not_exist_in_tenant": [
                  "Skipped"
                ]
              },
              "metadata": {
                "operationMetadataId": "618b6e97-814f-452c-910b-65040f4a8f44"
              },
              "type": "Scope"
            },
            "Ensure_Envt_Inventoried": {
              "actions": {
                "Get_Evnt_Details": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "beafe17b-c9e4-4258-a66b-955f2be67e6b"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps_2",
                      "operationId": "GetItem",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_environments",
                      "recordId": "@triggerBody()['text']",
                      "$select": "admin_displayname"
                    },
                    "authentication": {
                      "type": "Raw",
                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                    }
                  }
                },
                "Terminate_if_envt_does_not_yet_exist": {
                  "runAfter": {
                    "Get_Evnt_Details": [
                      "Failed"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "f892f3e6-adaf-49a5-a0d2-67675fb248f8"
                  },
                  "type": "Terminate",
                  "inputs": {
                    "runStatus": "Succeeded"
                  }
                }
              },
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "ea2ba143-f432-4ccc-b552-1d1e0b54cd11"
              },
              "type": "Scope",
              "description": "This is needed for BYODL case as sometimes objects are in the datalake before the envt"
            },
            "Get_Flow_as_Admin": {
              "runAfter": {
                "Ensure_Envt_Inventoried": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "661a9495-5ccd-4485-b6cf-3d7354a648bc"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_flowmanagement_1",
                  "operationId": "AdminGetFlow",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_flowmanagement"
                },
                "parameters": {
                  "environmentName": "@triggerBody()['text_1']",
                  "flowName": "@triggerBody()['text_2']"
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                }
              }
            }
          },
          "runAfter": {
            "Initialize_ActualConnectionsArray": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "0bd60414-c89a-4af8-aafd-d8c67ce3e992"
          },
          "type": "Scope"
        },
        "Initialize_ActualConnectionsArray": {
          "runAfter": {
            "Initialize_hasBadConnections_to_false": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "1f85714b-7529-407c-be12-a2d19ac31d64"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "ActualConnectionsArray",
                "type": "array"
              }
            ]
          }
        },
        "Error_Handling": {
          "actions": {
            "Terminate": {
              "runAfter": {
                "Update_Last_Run_Fail": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "9e5a2a18-dba2-47a1-96d5-3356f4348e5a"
              },
              "type": "Terminate",
              "inputs": {
                "runStatus": "Failed",
                "runError": {
                  "code": "500",
                  "message": "Get Environments Failed"
                }
              }
            },
            "Get_ID_Fail": {
              "runAfter": {
                "Create_a_new_record_-_Sync_Flow_Errors": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "47329bf2-8aac-400d-9778-a793b4f1180f"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "$select": "admin_coesolutionmetadataid",
                  "$filter": "admin_objectname eq '@{workflow()?['tags']['flowDisplayName']}'",
                  "$top": 1
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                }
              }
            },
            "Update_Last_Run_Fail": {
              "runAfter": {
                "Get_ID_Fail": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "c63eb7cc-6101-4567-b520-a4a8881264e9"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "UpdateRecord",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "recordId": "@first(outputs('Get_ID_Fail')?['body/value'])?['admin_coesolutionmetadataid']",
                  "item/admin_lastrun": "@utcNow()",
                  "item/admin_lastrunpassed": false
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                }
              }
            },
            "Respond_to_a_PowerApp_or_flow_false": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "765a5dda-0ee4-4094-b4c5-e0e4c2289c02"
              },
              "type": "Response",
              "kind": "PowerApp",
              "inputs": {
                "statusCode": 200,
                "body": {
                  "pass": "@false"
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "pass": {
                      "title": "pass",
                      "x-ms-dynamically-added": true,
                      "type": "boolean"
                    }
                  }
                }
              }
            },
            "Create_a_new_record_-_Sync_Flow_Errors": {
              "runAfter": {
                "Respond_to_a_PowerApp_or_flow_false": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "87961ff0-e261-4890-9ab9-a53f88fe0de5"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "CreateRecord",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_syncflowerrorses",
                  "item/admin_name": "@workflow()?['tags']['flowDisplayName']",
                  "item/admin_environmentname": "@outputs('Get_Evnt_Details')?['body/admin_displayname']",
                  "item/admin_flowinstanceurl": "@concat(parameters('Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)'), workflow()?['tags']['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])"
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                },
                "retryPolicy": {
                  "type": "exponential",
                  "count": 10,
                  "interval": "PT10S"
                }
              }
            }
          },
          "runAfter": {
            "Inventory_this_flow": [
              "Failed"
            ]
          },
          "metadata": {
            "operationMetadataId": "38ae684e-622d-42ea-abd2-ee571aee3a5f"
          },
          "type": "Scope"
        },
        "Update_last_run_as_pass": {
          "actions": {
            "Update_Last_Run_Successful": {
              "runAfter": {
                "Get_ID_Pass": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "78ef70e5-7f67-4737-9a02-8533f12caa19"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "UpdateRecord",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "recordId": "@first(outputs('Get_ID_Pass')?['body/value'])?['admin_coesolutionmetadataid']",
                  "item/admin_lastrun": "@utcNow()",
                  "item/admin_lastrunpassed": true
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                }
              }
            },
            "Catch_-_not_ready_to_take_last_run_date": {
              "runAfter": {
                "Update_Last_Run_Successful": [
                  "Failed"
                ]
              },
              "metadata": {
                "operationMetadataId": "f88cdefe-c402-49d7-8f4a-934475e6f741"
              },
              "type": "Compose",
              "inputs": "Catch - not ready to take last run date"
            },
            "Respond_to_a_PowerApp_or_flow_true": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "5fb23166-e1f4-4a78-8511-67da135104e6"
              },
              "type": "Response",
              "kind": "PowerApp",
              "inputs": {
                "statusCode": 200,
                "body": {
                  "pass": "@true"
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "pass": {
                      "title": "pass",
                      "x-ms-dynamically-added": true,
                      "type": "boolean"
                    }
                  }
                }
              }
            },
            "Get_ID_Pass": {
              "runAfter": {
                "Respond_to_a_PowerApp_or_flow_true": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "f4f314b6-89d3-4056-af1c-73115e7d6bd1"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "$select": "admin_coesolutionmetadataid",
                  "$filter": "admin_objectname eq '@{workflow()?['tags']['flowDisplayName']}'",
                  "$top": 1
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                }
              }
            }
          },
          "runAfter": {
            "Error_Handling": [
              "Skipped"
            ]
          },
          "metadata": {
            "operationMetadataId": "5c140442-d939-4ca4-8ec8-d1ee2bed4a81"
          },
          "type": "Scope"
        }
      }
    },
    "templateName": ""
  },
  "schemaVersion": "1.0.0.0"
}