{
  "properties": {
    "connectionReferences": {
      "shared_commondataserviceforapps": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreDataverse"
        },
        "api": {
          "name": "shared_commondataserviceforapps"
        }
      },
      "shared_flowmanagement": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerAutomateManagement"
        },
        "api": {
          "name": "shared_flowmanagement"
        }
      },
      "shared_commondataserviceforapps_1": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_sharedcommondataserviceforapps_98924"
        },
        "api": {
          "name": "shared_commondataserviceforapps"
        }
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        },
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)": {
          "defaultValue": "https://us.flow.microsoft.com/manage/environments/",
          "type": "String",
          "metadata": {
            "schemaName": "admin_PowerAutomateEnvironmentVariable",
            "description": "Environment, including geographic location, for Power Automate - Ex for commercial: https://flow.microsoft.com/manage/environments/"
          }
        }
      },
      "triggers": {
        "When_a_flow_is_added_or_modified": {
          "metadata": {
            "operationMetadataId": "a4c4488c-4118-4db4-8929-475a86c16c27"
          },
          "type": "OpenApiConnectionWebhook",
          "inputs": {
            "host": {
              "connectionName": "shared_commondataserviceforapps",
              "operationId": "SubscribeWebhookTrigger",
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
            },
            "parameters": {
              "subscriptionRequest/message": 4,
              "subscriptionRequest/entityname": "admin_flow",
              "subscriptionRequest/scope": 4,
              "subscriptionRequest/filteringattributes": "admin_flowmodifiedon",
              "subscriptionRequest/filterexpression": "admin_flowdeleted ne true"
            },
            "authentication": "@parameters('$authentication')"
          }
        }
      },
      "actions": {
        "Flow_Action_Details_-_Error_Handling": {
          "actions": {
            "Create_a_new_record_-_Sync_Flow_Errors": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "4cac75cc-0983-4450-8a2b-6c25e34e1616"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "CreateRecord",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_syncflowerrorses",
                  "item/admin_name": "Admin | Sync Template v3 (Flow Action Details)",
                  "item/admin_environmentname": "@outputs('Get_environment_for_name')?['body/admin_displayname']",
                  "item/admin_flowinstanceurl": "@concat(parameters('Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)'), workflow()?['tags']['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])"
                },
                "authentication": "@parameters('$authentication')",
                "retryPolicy": {
                  "type": "exponential",
                  "count": 10,
                  "interval": "PT10S"
                }
              }
            },
            "Terminate": {
              "runAfter": {
                "Create_a_new_record_-_Sync_Flow_Errors": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "a9f0c051-0adc-48ef-9d22-7b09995266dd"
              },
              "type": "Terminate",
              "inputs": {
                "runStatus": "Failed",
                "runError": {
                  "code": "500",
                  "message": "Flow Action Details Failed"
                }
              }
            }
          },
          "runAfter": {
            "Get_Flow_Action_Details_for_this_Flow": [
              "Failed"
            ]
          },
          "metadata": {
            "operationMetadataId": "d6b669fc-cd79-4c68-ae55-d9a9201292c0"
          },
          "type": "Scope"
        },
        "Get_Flow_Action_Details_for_this_Flow": {
          "actions": {
            "Remove_old_flow_action_details": {
              "actions": {
                "List_Existing_Flow_Action_References": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "022ea41e-b30a-4694-88a3-e5f5491ee34f"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_flowactiondetails",
                      "$select": "admin_flowactiondetailid, modifiedon",
                      "$filter": "_admin_flow_value eq '@{triggerOutputs()?['body/admin_flowid']}'"
                    },
                    "authentication": "@parameters('$authentication')"
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "Delete_old_actions": {
                  "foreach": "@outputs('List_Existing_Flow_Action_References')?['body/value']",
                  "actions": {
                    "Delete_flow_action": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "0db5bac1-e0ed-4c42-9102-0df619fa1adc"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "DeleteRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_flowactiondetails",
                          "recordId": "@items('Delete_old_actions')?['admin_flowactiondetailid']"
                        },
                        "authentication": "@parameters('$authentication')",
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    },
                    "catch": {
                      "runAfter": {
                        "Delete_flow_action": [
                          "Failed"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "5c01d77e-3ea7-43d3-818d-d558d208ddfe"
                      },
                      "type": "Compose",
                      "inputs": "catch"
                    }
                  },
                  "runAfter": {
                    "List_Existing_Flow_Action_References": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "3eaf8811-16a3-4400-bb66-49fb12bcd9ae"
                  },
                  "type": "Foreach"
                }
              },
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "d14a8013-fcda-4a49-9e82-70e16a3e90ec"
              },
              "type": "Scope"
            },
            "Get_Flow_Details": {
              "actions": {
                "Get_environment_for_name": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "d00cffe2-4e41-4822-8c27-32c5ef959218"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "GetItem",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_environments",
                      "recordId": "@triggerOutputs()?['body/_admin_flowenvironment_value']"
                    },
                    "authentication": "@parameters('$authentication')",
                    "retryPolicy": {
                      "type": "exponential",
                      "count": 10,
                      "interval": "PT10S"
                    }
                  }
                },
                "Get_Flow_as_Admin": {
                  "runAfter": {
                    "Get_environment_for_name": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "fb9a16f0-a1b1-4bcf-9f47-6a0aa3f3f1e3"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_flowmanagement",
                      "operationId": "AdminGetFlow",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_flowmanagement"
                    },
                    "parameters": {
                      "environmentName": "@outputs('Get_environment_for_name')?['body/admin_environmentname']",
                      "flowName": "@triggerOutputs()?['body/admin_flowid']"
                    },
                    "authentication": "@parameters('$authentication')",
                    "retryPolicy": {
                      "type": "exponential",
                      "count": 10,
                      "interval": "PT10S"
                    }
                  }
                },
                "Parse_trigger": {
                  "runAfter": {
                    "Get_Flow_as_Admin": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "5e2dac02-7dc6-4e5a-86ab-c19d6caab5b8"
                  },
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@outputs('Get_Flow_as_Admin')?['body/properties/definitionSummary/triggers']",
                    "schema": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string"
                          },
                          "kind": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "metadata": {
                            "type": [
                              "object",
                              "null"
                            ],
                            "properties": {
                              "operationMetadataId": {
                                "type": "string"
                              }
                            }
                          }
                        },
                        "required": [
                          "type"
                        ]
                      }
                    }
                  }
                },
                "Parse_actions": {
                  "runAfter": {
                    "Parse_trigger": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "f7f9fdef-18b6-4d88-b3e2-4830600561bd"
                  },
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@outputs('Get_Flow_as_Admin')?['body/properties/definitionSummary/actions']",
                    "schema": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "type": {
                            "type": "string"
                          },
                          "swaggerOperationId": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "metadata": {
                            "type": [
                              "object",
                              "null"
                            ],
                            "properties": {
                              "flowSystemMetadata": {
                                "type": "object",
                                "properties": {
                                  "swaggerOperationId": {
                                    "type": [
                                      "string",
                                      "null"
                                    ]
                                  }
                                }
                              }
                            }
                          },
                          "api": {
                            "type": [
                              "object",
                              "null"
                            ],
                            "properties": {
                              "name": {
                                "type": "string"
                              },
                              "id": {
                                "type": "string"
                              },
                              "type": {
                                "type": "string"
                              },
                              "properties": {
                                "type": "object",
                                "properties": {
                                  "displayName": {
                                    "type": "string"
                                  }
                                }
                              }
                            }
                          }
                        },
                        "required": [
                          "type"
                        ]
                      }
                    }
                  }
                }
              },
              "runAfter": {
                "Remove_old_flow_action_details": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "19e72818-a017-4fff-bd28-92fd0bba9e55"
              },
              "type": "Scope"
            },
            "Add_new_flow_action_details": {
              "actions": {
                "Apply_to_each_trigger": {
                  "foreach": "@body('Parse_trigger')",
                  "actions": {
                    "action_type_-_trigger": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "0bfe3936-9693-415c-b44b-56afea87a371"
                      },
                      "type": "Compose",
                      "inputs": "@if(contains(item()['Type'], 'ApiConnection'), coalesce(item()?['api']?['properties']?['displayname'], item()['Type']), item()['Type'])"
                    },
                    "opertation_-_trigger": {
                      "runAfter": {
                        "action_type_-_trigger": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "d77bb7ea-24f0-4851-9dc3-15c0066596ae"
                      },
                      "type": "Compose",
                      "inputs": "@if(contains(item()['Type'], 'ApiConnection'), coalesce(item()?['swaggerOperationId'], ''), coalesce(item()?['Kind'], ''))"
                    },
                    "Add_trigger": {
                      "runAfter": {
                        "opertation_-_trigger": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "bf385b41-f724-4dc6-ba8d-700813de52ca"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "CreateRecord",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_flowactiondetails",
                          "item/admin_actiontype": "@outputs('action_type_-_trigger')",
                          "item/admin_Flow@odata.bind": "admin_flows(@{outputs('Get_Flow_as_Admin')?['body/name']})",
                          "item/admin_flowactiondetaildeleted": false,
                          "item/admin_FlowActionDetailEnvrinment@odata.bind": "admin_environments(@{outputs('Get_environment_for_name')?['body/admin_environmentid']})",
                          "item/admin_flowdetailmodifiedon": "@utcNow()",
                          "item/cr5d5_istypetrigger": "Yes",
                          "item/admin_operation": "@outputs('opertation_-_trigger')",
                          "item/overriddencreatedon": "@utcNow()"
                        },
                        "authentication": "@parameters('$authentication')",
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    },
                    "Set_flowTrigger_to_flows_trigger": {
                      "runAfter": {
                        "Add_trigger": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "370aedf7-23b6-47d7-b51c-0b8eb93b645c"
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "flowTrigger",
                        "value": "@{if(equals(outputs('opertation_-_trigger'), ''), outputs('action_type_-_trigger'), concat(outputs('action_type_-_trigger'), ' : ', outputs('opertation_-_trigger')))}"
                      }
                    }
                  },
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "37613a0c-7e4c-47d6-a60b-fa6f2fff1bd8"
                  },
                  "type": "Foreach"
                },
                "Apply_to_each_action": {
                  "foreach": "@body('Parse_actions')",
                  "actions": {
                    "action_type_-_action": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "8de990f6-2c54-4c27-8d8b-8fb7c2defb67"
                      },
                      "type": "Compose",
                      "inputs": "@if(contains(item()['Type'], 'ApiConnection'), coalesce(item()?['api']?['properties']?['displayname'], item()['Type']), item()['Type'])"
                    },
                    "opertation_-_action": {
                      "runAfter": {
                        "action_type_-_action": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "08fdae6c-6e01-4e67-b35d-fed89cf99898"
                      },
                      "type": "Compose",
                      "inputs": "@if(contains(item()['Type'], 'ApiConnection'), coalesce(item()?['swaggerOperationId'], ''), coalesce(item()?['Kind'], ''))"
                    },
                    "If_specialty_action_flag_it,_else_add_it": {
                      "actions": {
                        "Set_SpecialtyActionsExist_to_true": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "7bc19956-eec2-451a-b593-23f941b8ab77"
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "SpecialtyActionsExist",
                            "value": "@true"
                          }
                        }
                      },
                      "runAfter": {
                        "opertation_-_action": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_Action": {
                            "runAfter": {},
                            "metadata": {
                              "operationMetadataId": "1a9427e7-e436-46bf-85be-c24c03a8c41a"
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_commondataserviceforapps",
                                "operationId": "CreateRecord",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                              },
                              "parameters": {
                                "entityName": "admin_flowactiondetails",
                                "item/admin_actiontype": "@outputs('action_type_-_action')",
                                "item/admin_Flow@odata.bind": "admin_flows(@{outputs('Get_Flow_as_Admin')?['body/name']})",
                                "item/admin_flowactiondetaildeleted": false,
                                "item/admin_FlowActionDetailEnvrinment@odata.bind": "admin_environments(@{outputs('Get_environment_for_name')?['body/admin_environmentid']})",
                                "item/admin_flowdetailmodifiedon": "@utcNow()",
                                "item/cr5d5_istypetrigger": "No",
                                "item/admin_operation": "@outputs('opertation_-_action')",
                                "item/overriddencreatedon": "@utcNow()"
                              },
                              "authentication": "@parameters('$authentication')",
                              "retryPolicy": {
                                "type": "exponential",
                                "count": 10,
                                "interval": "PT10S"
                              }
                            }
                          }
                        }
                      },
                      "expression": {
                        "or": [
                          {
                            "equals": [
                              "@outputs('action_type_-_action')",
                              "Http"
                            ]
                          },
                          {
                            "equals": [
                              "@outputs('action_type_-_action')",
                              "HttpWebhook"
                            ]
                          }
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "9284387b-7bed-4bb3-af63-81bb3658f603"
                      },
                      "type": "If"
                    }
                  },
                  "runAfter": {
                    "Apply_to_each_trigger": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "49976cd8-86a6-4804-8ec2-21d3fe6ef52a"
                  },
                  "type": "Foreach"
                },
                "Update_flow_trigger": {
                  "runAfter": {
                    "Apply_to_each_action": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "e1ab5a3f-ac99-409b-a1a4-431863a80530"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "UpdateRecord",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_flows",
                      "recordId": "@outputs('Get_Flow_as_Admin')?['body/name']",
                      "item/cr5d5_flowtrigger": "@variables('flowTrigger')"
                    },
                    "authentication": "@parameters('$authentication')",
                    "retryPolicy": {
                      "type": "exponential",
                      "count": 10,
                      "interval": "PT10S"
                    }
                  }
                }
              },
              "runAfter": {
                "Get_Flow_Details": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "0884b10e-dbbe-4d5e-91a8-0f54efc32b49"
              },
              "type": "Scope"
            },
            "Get_Specialty_Action_Details": {
              "actions": {
                "if_Specialty_Actions_Exist,_add_them": {
                  "actions": {
                    "get_flow_defn": {
                      "actions": {
                        "permissions_check": {
                          "actions": {
                            "if_need_permissions,_add_them": {
                              "actions": {
                                "Add_Permissions": {
                                  "runAfter": {
                                    "Old_Owner": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "169ea005-919b-4111-acf0-3f04f1a21008"
                                  },
                                  "type": "Workflow",
                                  "inputs": {
                                    "host": {
                                      "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                    },
                                    "body": {
                                      "text": "@outputs('Get_Flow_Runners_Azure_AD_ID')?['body/azureactivedirectoryobjectid']",
                                      "text_1": "@triggerOutputs()?['body/admin_flowid']",
                                      "text_2": "@outputs('Get_environment_for_name')?['body/admin_environmentname']",
                                      "text_3": "assign"
                                    }
                                  }
                                },
                                "Get_Flow_Runners_Azure_AD_ID": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "fad64895-d0b6-4cd3-b595-77c208eed378"
                                  },
                                  "type": "OpenApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connectionName": "shared_commondataserviceforapps_1",
                                      "operationId": "GetItem",
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                    },
                                    "parameters": {
                                      "entityName": "systemusers",
                                      "recordId": "@triggerOutputs()['body/runassystemuserid']",
                                      "$select": "azureactivedirectoryobjectid"
                                    },
                                    "authentication": "@parameters('$authentication')"
                                  }
                                },
                                "Old_Owner": {
                                  "runAfter": {
                                    "Get_Flow_Runners_Azure_AD_ID": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "a1025d01-a07f-453c-bf93-32623b5faa99"
                                  },
                                  "type": "Compose",
                                  "inputs": "@if(equals(outputs('Update_flow_trigger')?['body/_admin_derivedowner_value'], null), outputs('Update_flow_trigger')?['body/properties/creator/objectId'], outputs('Update_flow_trigger')?['body/_admin_derivedowner_value'])"
                                }
                              },
                              "runAfter": {
                                "Set_needPermissions_true": [
                                  "Succeeded",
                                  "Skipped"
                                ]
                              },
                              "expression": {
                                "equals": [
                                  "@variables('needPermissions')",
                                  "@true"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "039c93f0-dcc0-469d-ae94-3a861deaf36f"
                              },
                              "type": "If"
                            },
                            "Get_Flow_Permissions_Check": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "d270749a-ba44-4155-987b-6718face7415"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_flowmanagement",
                                  "operationId": "GetFlow",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_flowmanagement"
                                },
                                "parameters": {
                                  "environmentName": "@outputs('Get_environment_for_name')?['body/admin_environmentname']",
                                  "flowName": "@triggerOutputs()?['body/admin_flowid']"
                                },
                                "authentication": "@parameters('$authentication')",
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 10,
                                  "interval": "PT10S"
                                }
                              }
                            },
                            "Set_needPermissions_true": {
                              "runAfter": {
                                "Get_Flow_Permissions_Check": [
                                  "Failed"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "fc912a2e-0da1-40f1-8057-0a0a36eeb78d"
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "needPermissions",
                                "value": "@true"
                              }
                            }
                          },
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "061ece40-b278-4d66-a554-232fdeb702c8"
                          },
                          "type": "Scope"
                        },
                        "Get_Flow": {
                          "runAfter": {
                            "permissions_check": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "d270749a-ba44-4155-987b-6718face7415"
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_flowmanagement",
                              "operationId": "GetFlow",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_flowmanagement"
                            },
                            "parameters": {
                              "environmentName": "@outputs('Get_environment_for_name')?['body/admin_environmentname']",
                              "flowName": "@triggerOutputs()?['body/admin_flowid']"
                            },
                            "authentication": "@parameters('$authentication')",
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          }
                        },
                        "Parse_Flow_Definition": {
                          "runAfter": {
                            "Get_Flow": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "3654fffa-44e3-4be9-9beb-dc1941c796bd"
                          },
                          "type": "ParseJson",
                          "inputs": {
                            "content": "@outputs('Get_Flow')?['body/properties/definition']",
                            "schema": {
                              "type": "object",
                              "properties": {
                                "$schema": {
                                  "type": "string"
                                },
                                "contentVersion": {
                                  "type": "string"
                                },
                                "actions": {
                                  "type": "object"
                                }
                              }
                            }
                          }
                        },
                        "reset_permissions": {
                          "actions": {
                            "if_needed_permissions,_set_them_back": {
                              "actions": {
                                "Reset_Owner": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "8e3b1406-aaa4-4bea-b463-e193fbae487f"
                                  },
                                  "type": "Workflow",
                                  "inputs": {
                                    "host": {
                                      "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                    },
                                    "body": {
                                      "text": "@outputs('Old_Owner')",
                                      "text_1": "@triggerOutputs()?['body/admin_flowid']",
                                      "text_2": "@outputs('Get_environment_for_name')?['body/admin_environmentname']",
                                      "text_3": "assign"
                                    }
                                  }
                                },
                                "Remove_Admin": {
                                  "runAfter": {
                                    "Reset_Owner": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "d9852dc1-831e-4197-ac91-6c81d3dbf7f9"
                                  },
                                  "type": "Workflow",
                                  "inputs": {
                                    "host": {
                                      "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                    },
                                    "body": {
                                      "text": "@outputs('Get_Flow_Runners_Azure_AD_ID')?['body/azureactivedirectoryobjectid']",
                                      "text_1": "@triggerOutputs()?['body/admin_flowid']",
                                      "text_2": "@outputs('Get_environment_for_name')?['body/admin_environmentname']",
                                      "text_3": "removeuser"
                                    }
                                  }
                                }
                              },
                              "runAfter": {},
                              "expression": {
                                "equals": [
                                  "@variables('needPermissions')",
                                  "@true"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "1b5332bf-e75f-4450-8378-1f07a0d98c3a"
                              },
                              "type": "If"
                            }
                          },
                          "runAfter": {
                            "Parse_Flow_Definition": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "3b48d36a-f0cc-4f2c-a40f-c104649266e4"
                          },
                          "type": "Scope"
                        }
                      },
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "b365d4ec-7e89-468d-99c6-fdc770f05e3c"
                      },
                      "type": "Scope"
                    },
                    "http": {
                      "actions": {
                        "Split_on_type_Http": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "9ad4dac9-090e-47f4-9c93-607a74df3648"
                          },
                          "type": "Compose",
                          "inputs": "@split(string(body('Parse_Flow_Definition')?['actions']), '\"type\":\"Http\"')"
                        },
                        "if_it_had_an_http": {
                          "actions": {
                            "Apply_to_each_item_from_Http_split": {
                              "foreach": "@outputs('Split_on_type_Http')",
                              "actions": {
                                "Split_on_uri": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "86f8236f-cd46-4c9c-89d8-6cd78f768f96"
                                  },
                                  "type": "Compose",
                                  "inputs": "@split(item(), '\"uri\":\"')"
                                },
                                "if_had_a_uri": {
                                  "actions": {
                                    "Append_uri_to_array_variable": {
                                      "runAfter": {
                                        "split_the_uri_off": [
                                          "Succeeded"
                                        ]
                                      },
                                      "metadata": {
                                        "operationMetadataId": "3a013e23-c898-4c05-93c8-9a06a5c2dd84"
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "HTTP_URLs",
                                        "value": "@outputs('split_the_uri_off')[0]"
                                      }
                                    },
                                    "split_the_uri_off": {
                                      "runAfter": {},
                                      "metadata": {
                                        "operationMetadataId": "73a3e60e-76de-4b06-8cb6-5e685194c108"
                                      },
                                      "type": "Compose",
                                      "inputs": "@split(outputs('Split_on_uri')[1], outputs('final_delimeter'))"
                                    }
                                  },
                                  "runAfter": {
                                    "Split_on_uri": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "greater": [
                                      "@length(outputs('Split_on_uri'))",
                                      1
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "74381b78-a7bb-43d1-8fb3-ee70b1c3a01a"
                                  },
                                  "type": "If"
                                }
                              },
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "3ca93e54-37ca-41bf-a8db-b6c689cc4933"
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Split_on_type_Http": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "greater": [
                              "@length(outputs('Split_on_type_Http'))",
                              1
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "afd1619e-ca19-4f0b-980b-362288c7ad76"
                          },
                          "type": "If"
                        },
                        "Add_each_Http_Action": {
                          "foreach": "@variables('HTTP_URLs')",
                          "actions": {
                            "Add_Http_Action": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "1a9427e7-e436-46bf-85be-c24c03a8c41a"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "CreateRecord",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_flowactiondetails",
                                  "item/admin_actiontype": "Http",
                                  "item/admin_Flow@odata.bind": "admin_flows(@{outputs('Get_Flow_as_Admin')?['body/name']})",
                                  "item/admin_flowactiondetaildeleted": false,
                                  "item/admin_FlowActionDetailEnvrinment@odata.bind": "admin_environments(@{outputs('Get_environment_for_name')?['body/admin_environmentid']})",
                                  "item/admin_flowactiondetailmetadata": "@items('Add_each_Http_Action')",
                                  "item/admin_flowdetailmodifiedon": "@utcNow()",
                                  "item/cr5d5_istypetrigger": "No",
                                  "item/overriddencreatedon": "@utcNow()"
                                },
                                "authentication": "@parameters('$authentication')",
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 10,
                                  "interval": "PT10S"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "if_it_had_an_http": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "63fbfa32-b09d-4f2b-be14-61e48afed5a3"
                          },
                          "type": "Foreach"
                        }
                      },
                      "runAfter": {
                        "get_flow_defn": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "077c83c0-e3d8-4512-98da-57c9b488b4c8"
                      },
                      "type": "Scope"
                    },
                    "http_webhook": {
                      "actions": {
                        "Split_on_type_Http_webhook": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "9ad4dac9-090e-47f4-9c93-607a74df3648"
                          },
                          "type": "Compose",
                          "inputs": "@split(string(body('Parse_Flow_Definition')?['actions']), '\"type\":\"HttpWebhook\"')"
                        },
                        "if_it_had_an_http_webhook": {
                          "actions": {
                            "Apply_to_each_item_from_Httpwebhook_split": {
                              "foreach": "@outputs('Split_on_type_Http_webhook')",
                              "actions": {
                                "Split_on_uri_webhook": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "86f8236f-cd46-4c9c-89d8-6cd78f768f96"
                                  },
                                  "type": "Compose",
                                  "inputs": "@split(item(), '\"uri\":\"')"
                                },
                                "if_had_a_uri_webhook": {
                                  "actions": {
                                    "Append_uri_to_webhook_array_variable": {
                                      "runAfter": {
                                        "split_the_uri_off_webhook": [
                                          "Succeeded"
                                        ]
                                      },
                                      "metadata": {
                                        "operationMetadataId": "3a013e23-c898-4c05-93c8-9a06a5c2dd84"
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "HTTPWEBHOOK_URLs",
                                        "value": "@outputs('split_the_uri_off_webhook')[0]"
                                      }
                                    },
                                    "split_the_uri_off_webhook": {
                                      "runAfter": {},
                                      "metadata": {
                                        "operationMetadataId": "73a3e60e-76de-4b06-8cb6-5e685194c108"
                                      },
                                      "type": "Compose",
                                      "inputs": "@split(outputs('Split_on_uri_webhook')[1], outputs('final_delimeter'))"
                                    }
                                  },
                                  "runAfter": {
                                    "Split_on_uri_webhook": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "greater": [
                                      "@length(outputs('Split_on_uri_webhook'))",
                                      1
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "74381b78-a7bb-43d1-8fb3-ee70b1c3a01a"
                                  },
                                  "type": "If"
                                }
                              },
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "3ca93e54-37ca-41bf-a8db-b6c689cc4933"
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Split_on_type_Http_webhook": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "greater": [
                              "@length(outputs('Split_on_type_Http_webhook'))",
                              1
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "10bc5ce8-973a-46d0-8548-aefd06e71d9b"
                          },
                          "type": "If"
                        },
                        "Add_each_http_webhook_Action": {
                          "foreach": "@variables('HTTPWEBHOOK_URLs')",
                          "actions": {
                            "Add_HttpWebhook_Action": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "1a9427e7-e436-46bf-85be-c24c03a8c41a"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps",
                                  "operationId": "CreateRecord",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_flowactiondetails",
                                  "item/admin_actiontype": "HttpWebhook",
                                  "item/admin_Flow@odata.bind": "admin_flows(@{outputs('Get_Flow_as_Admin')?['body/name']})",
                                  "item/admin_flowactiondetaildeleted": false,
                                  "item/admin_FlowActionDetailEnvrinment@odata.bind": "admin_environments(@{outputs('Get_environment_for_name')?['body/admin_environmentid']})",
                                  "item/admin_flowactiondetailmetadata": "@items('Add_each_http_webhook_Action')",
                                  "item/admin_flowdetailmodifiedon": "@utcNow()",
                                  "item/cr5d5_istypetrigger": "No",
                                  "item/overriddencreatedon": "@utcNow()"
                                },
                                "authentication": "@parameters('$authentication')",
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 10,
                                  "interval": "PT10S"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "if_it_had_an_http_webhook": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "eeacc0f5-7168-421c-8fce-64c0a2127f5b"
                          },
                          "type": "Foreach"
                        }
                      },
                      "runAfter": {
                        "http": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "79158832-b34a-498f-9126-bcc374eb206b"
                      },
                      "type": "Scope"
                    },
                    "check_for_password": {
                      "actions": {
                        "Split_on_type_password": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "9ad4dac9-090e-47f4-9c93-607a74df3648"
                          },
                          "type": "Compose",
                          "inputs": "@split(string(body('Parse_Flow_Definition')?['actions']), '\"password\"')"
                        },
                        "if_it_had_a_password_flag_the_flow_as_having_password": {
                          "actions": {
                            "Mark_as_Contains_Plain_Text_Password_-_Yes": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "f635d9b2-b3fd-4fb2-a01d-21bbb4b59a92"
                              },
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_commondataserviceforapps_1",
                                  "operationId": "UpdateRecord",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                },
                                "parameters": {
                                  "entityName": "admin_flows",
                                  "recordId": "@triggerOutputs()?['body/admin_flowid']",
                                  "item/admin_containsplaintextpassword": true
                                },
                                "authentication": "@parameters('$authentication')"
                              }
                            }
                          },
                          "runAfter": {
                            "Split_on_type_password": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Mark_as_Contains_Plain_Text_Password_-_No": {
                                "runAfter": {},
                                "metadata": {
                                  "operationMetadataId": "8df7cff4-d25b-416b-afe6-92d1c31e3940"
                                },
                                "type": "OpenApiConnection",
                                "inputs": {
                                  "host": {
                                    "connectionName": "shared_commondataserviceforapps_1",
                                    "operationId": "UpdateRecord",
                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                  },
                                  "parameters": {
                                    "entityName": "admin_flows",
                                    "recordId": "@triggerOutputs()?['body/admin_flowid']",
                                    "item/admin_containsplaintextpassword": false
                                  },
                                  "authentication": "@parameters('$authentication')"
                                }
                              }
                            }
                          },
                          "expression": {
                            "greater": [
                              "@length(outputs('Split_on_type_password'))",
                              1
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "858b6a92-465d-4ee4-b7a3-9d7e1cb00e48"
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "http_webhook": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "29c79bf1-249e-466d-8b38-f2386bf1132e"
                      },
                      "type": "Scope"
                    }
                  },
                  "runAfter": {
                    "final_delimeter": [
                      "Succeeded"
                    ]
                  },
                  "else": {
                    "actions": {
                      "Update_flow_to_clear_specialty_flags": {
                        "runAfter": {},
                        "metadata": {
                          "operationMetadataId": "81423f7c-31c2-40bf-8d80-b30aa3b29e70"
                        },
                        "type": "OpenApiConnection",
                        "inputs": {
                          "host": {
                            "connectionName": "shared_commondataserviceforapps_1",
                            "operationId": "UpdateRecord",
                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                          },
                          "parameters": {
                            "entityName": "admin_flows",
                            "recordId": "@triggerOutputs()?['body/admin_flowid']",
                            "item/admin_containsplaintextpassword": false
                          },
                          "authentication": "@parameters('$authentication')"
                        }
                      }
                    }
                  },
                  "expression": {
                    "equals": [
                      "@variables('SpecialtyActionsExist')",
                      "@true"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "7ec7e985-e6bb-4156-86bc-58f9a2389f5c"
                  },
                  "type": "If"
                },
                "final_delimeter": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "40853fc6-f5bf-44e0-a5a0-4c14cb0ae4ba"
                  },
                  "type": "Compose",
                  "inputs": "\""
                }
              },
              "runAfter": {
                "Add_new_flow_action_details": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "48216698-c68f-48a3-93ca-2d8ce6089930"
              },
              "type": "Scope"
            }
          },
          "runAfter": {
            "Initialize_flowTrigger": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "6eacedc6-b157-469e-988e-06ae292bda43"
          },
          "type": "Scope"
        },
        "Initialize_HTTP_URLs": {
          "runAfter": {},
          "metadata": {
            "operationMetadataId": "a67d388c-76ff-4068-8416-1ecd58554e61"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "HTTP_URLs",
                "type": "array"
              }
            ]
          }
        },
        "Initialize_HTTPWEBHOOK_URLs": {
          "runAfter": {
            "Initialize_HTTP_URLs": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "dda91bdd-bbab-4691-9c76-024a9531ca14"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "HTTPWEBHOOK_URLs",
                "type": "array"
              }
            ]
          }
        },
        "Initialize_SpecialtyActionsExist_to_false": {
          "runAfter": {
            "Initialize_HTTPWEBHOOK_URLs": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "1e8ef8db-e36e-4ba6-bfd6-5f2701149dd4"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "SpecialtyActionsExist",
                "type": "boolean",
                "value": "@false"
              }
            ]
          }
        },
        "Initialize_needPermissions_false": {
          "runAfter": {
            "Initialize_SpecialtyActionsExist_to_false": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "9d362f7a-9535-4129-a29a-cd4d87b29a6d"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "needPermissions",
                "type": "boolean",
                "value": "@false"
              }
            ]
          }
        },
        "Initialize_flowTrigger": {
          "runAfter": {
            "Initialize_needPermissions_false": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "ed017fde-d279-4593-a272-44e4f6e2ec3c"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "flowTrigger",
                "type": "string"
              }
            ]
          }
        },
        "if_actions_exist_and_already_updated_this_run,_exit": {
          "actions": {
            "Updated_Already": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "f64add25-3823-45bf-a2da-a239fd7f6eaf"
              },
              "type": "Terminate",
              "inputs": {
                "runStatus": "Succeeded"
              }
            }
          },
          "runAfter": {
            "Flow_Action_Details_-_Error_Handling": [
              "Succeeded"
            ]
          },
          "expression": {
            "and": [
              {
                "greater": [
                  "@length(outputs('List_Existing_Flow_Action_References')?['body/value'])",
                  0
                ]
              },
              {
                "greaterOrEquals": [
                  "@first(outputs('List_Existing_Flow_Action_References')?['body/value'])['modifiedon']",
                  "@addHours(utcNow(), -1)"
                ]
              }
            ]
          },
          "metadata": {
            "operationMetadataId": "f6f259ad-2734-4cdf-bec4-6f9be48a28b2"
          },
          "type": "If"
        }
      },
      "outputs": {}
    }
  },
  "schemaVersion": "1.0.0.0"
}