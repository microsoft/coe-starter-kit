{
  "properties": {
    "connectionReferences": {
      "shared_commondataserviceforapps_2": {
        "api": {
          "name": "shared_commondataserviceforapps"
        },
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreDataverseEnvRequest"
        },
        "runtimeSource": "embedded"
      },
      "shared_commondataserviceforapps": {
        "api": {
          "name": "shared_commondataserviceforapps"
        },
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreDataverse"
        },
        "runtimeSource": "embedded"
      },
      "shared_flowmanagement": {
        "api": {
          "name": "shared_flowmanagement"
        },
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECorePowerAutomateManagement"
        },
        "runtimeSource": "embedded"
      },
      "shared_office365users_1": {
        "api": {
          "name": "shared_office365users"
        },
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreO365Users"
        },
        "runtimeSource": "embedded"
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        },
        "Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)": {
          "defaultValue": "https://flow.microsoft.com/manage/environments/",
          "type": "String",
          "metadata": {
            "schemaName": "admin_PowerAutomateEnvironmentVariable",
            "description": "Inventory - REQUIRED. Environment, including geographic location, for Power Automate - Ex for commercial: https://flow.microsoft.com/manage/environments/"
          }
        },
        "DelayObjectInventory (admin_DelayObjectInventory)": {
          "defaultValue": false,
          "type": "Bool",
          "metadata": {
            "schemaName": "admin_DelayObjectInventory",
            "description": "Inventory - If Yes, will run a delay step to assist with the Dataverse throttling. Things like solutions, apps, flows, will have delays in the individual envt runs. Default No."
          }
        }
      },
      "triggers": {
        "When_a_row_is_added,_modified": {
          "type": "OpenApiConnectionWebhook",
          "inputs": {
            "parameters": {
              "subscriptionRequest/message": 4,
              "subscriptionRequest/entityname": "admin_environment",
              "subscriptionRequest/scope": 4,
              "subscriptionRequest/name": "7ebb10a6-5041-eb11-a813-000d3a8f4ad6"
            },
            "host": {
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
              "operationId": "SubscribeWebhookTrigger",
              "connectionName": "shared_commondataserviceforapps_2"
            }
          },
          "metadata": {
            "operationMetadataId": "53ae3146-d23b-4077-aa5f-3b7d459c0a36"
          }
        }
      },
      "actions": {
        "Error_Handling": {
          "type": "Scope",
          "actions": {
            "Create_a_new_record_-_Sync_Flow_Errors": {
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "entityName": "admin_syncflowerrorses",
                  "item/admin_name": "@workflow()?['tags']['flowDisplayName']",
                  "item/admin_environmentname": "@triggerOutputs()?['body/admin_displayname']",
                  "item/admin_flowinstanceurl": "@concat(parameters('Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)'), workflow()?['tags']['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])"
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "operationId": "CreateRecord",
                  "connectionName": "shared_commondataserviceforapps"
                },
                "retryPolicy": {
                  "type": "exponential",
                  "count": 10,
                  "interval": "PT10S"
                }
              },
              "metadata": {
                "operationMetadataId": "87961ff0-e261-4890-9ab9-a53f88fe0de5"
              }
            },
            "Terminate": {
              "type": "Terminate",
              "inputs": {
                "runStatus": "Failed",
                "runError": {
                  "code": "500",
                  "message": "Get Environments Failed"
                }
              },
              "runAfter": {
                "Update_Last_Run_Fail_and_Clear_Last_Run_Started": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "9e5a2a18-dba2-47a1-96d5-3356f4348e5a"
              }
            },
            "Get_ID_Fail": {
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "$select": "admin_coesolutionmetadataid",
                  "$filter": "admin_objectname eq '@{workflow()?['tags']['flowDisplayName']}'",
                  "$top": 1
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "connectionName": "shared_commondataserviceforapps"
                }
              },
              "runAfter": {
                "Create_a_new_record_-_Sync_Flow_Errors": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "47329bf2-8aac-400d-9778-a793b4f1180f"
              }
            },
            "Update_Last_Run_Fail_and_Clear_Last_Run_Started": {
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "recordId": "@first(outputs('Get_ID_Fail')?['body/value'])?['admin_coesolutionmetadataid']",
                  "item/admin_lastrun": "@utcNow()",
                  "item/admin_lastrunpassed": false
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "operationId": "UpdateRecord",
                  "connectionName": "shared_commondataserviceforapps"
                }
              },
              "runAfter": {
                "Get_ID_Fail": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "c63eb7cc-6101-4567-b520-a4a8881264e9"
              }
            }
          },
          "runAfter": {
            "Update_flow_action_details": [
              "Failed"
            ]
          },
          "metadata": {
            "operationMetadataId": "38ae684e-622d-42ea-abd2-ee571aee3a5f"
          }
        },
        "Update_last_run_as_pass": {
          "type": "Scope",
          "actions": {
            "Update_Last_Run_Successful": {
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "recordId": "@first(outputs('Get_ID_Pass')?['body/value'])?['admin_coesolutionmetadataid']",
                  "item/admin_lastrun": "@utcNow()",
                  "item/admin_lastrunpassed": true
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "operationId": "UpdateRecord",
                  "connectionName": "shared_commondataserviceforapps"
                }
              },
              "runAfter": {
                "Get_ID_Pass": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "78ef70e5-7f67-4737-9a02-8533f12caa19"
              }
            },
            "Get_ID_Pass": {
              "type": "OpenApiConnection",
              "inputs": {
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "$select": "admin_coesolutionmetadataid",
                  "$filter": "admin_objectname eq '@{workflow()?['tags']['flowDisplayName']}'",
                  "$top": 1
                },
                "host": {
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "connectionName": "shared_commondataserviceforapps"
                }
              },
              "metadata": {
                "operationMetadataId": "f4f314b6-89d3-4056-af1c-73115e7d6bd1"
              }
            },
            "Catch_-_not_ready_to_take_last_run_date": {
              "type": "Compose",
              "inputs": "Catch - not ready to take last run date",
              "runAfter": {
                "Update_Last_Run_Successful": [
                  "Failed"
                ]
              },
              "metadata": {
                "operationMetadataId": "f88cdefe-c402-49d7-8f4a-934475e6f741"
              }
            }
          },
          "runAfter": {
            "Error_Handling": [
              "Skipped"
            ]
          },
          "metadata": {
            "operationMetadataId": "5c140442-d939-4ca4-8ec8-d1ee2bed4a81"
          }
        },
        "Existing_Flow_Action_Details": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "ExistingFlowActionDetails",
                "type": "array"
              }
            ]
          },
          "runAfter": {
            "Delay_Object_Inventory": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "ce258a96-0eb6-451a-9477-ce1a830bc792"
          }
        },
        "Actual_Flow_Action_Details": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "ActualFlowActionDetails",
                "type": "array"
              }
            ]
          },
          "runAfter": {
            "Existing_Flow_Action_Details": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "ce258a96-0eb6-451a-9477-ce1a830bc792"
          }
        },
        "Flows_with_Specialty_Actions": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "FlowsWithSpecialtyActions",
                "type": "array"
              }
            ]
          },
          "runAfter": {
            "Actual_Flow_Action_Details": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "41079b45-3829-4499-8f18-bc495ae3be01"
          }
        },
        "HTTP_URLs": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "HTTP_URLs",
                "type": "array"
              }
            ]
          },
          "runAfter": {
            "Flows_with_Specialty_Actions": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "f64a82fd-22c1-4b8f-878b-eda745526f2c"
          }
        },
        "HTTPWEBHOOK_URLs": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "HTTPWEBHOOK_URLs",
                "type": "array"
              }
            ]
          },
          "runAfter": {
            "HTTP_URLs": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "95c1f7b6-7fb4-40cd-a1db-a4541dc48d2a"
          }
        },
        "Initialize_needPermissions_to_false": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "needPermissions",
                "type": "boolean",
                "value": "@false"
              }
            ]
          },
          "runAfter": {
            "HTTPWEBHOOK_URLs": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "d5725a24-c684-4ced-95c7-aaa0e496de7a"
          }
        },
        "Initialize_filterString": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "filterString",
                "type": "string"
              }
            ]
          },
          "runAfter": {
            "Initialize_needPermissions_to_false": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "eea95b16-ed62-4342-b531-29c385655b82"
          }
        },
        "Update_flow_action_details": {
          "type": "Scope",
          "actions": {
            "GetCurrentInventory": {
              "type": "Scope",
              "actions": {
                "Add_existing_flow_actions_to_ExistingFlowActionDetails": {
                  "type": "Foreach",
                  "foreach": "@outputs('Flows_to_iterate')?['body/value']",
                  "actions": {
                    "List_this_flows_existing_flow_action_details": {
                      "type": "OpenApiConnection",
                      "inputs": {
                        "parameters": {
                          "entityName": "admin_flowactiondetails",
                          "$select": "_admin_flow_value, _admin_flowactiondetailenvrinment_value, admin_actiontype, admin_actioninformation, admin_operation, admin_flowactiondetailmetadata, cr5d5_istypetrigger",
                          "$filter": "_admin_flow_value eq @{items('Add_existing_flow_actions_to_ExistingFlowActionDetails')?['admin_flowid']}"
                        },
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "operationId": "ListRecords",
                          "connectionName": "shared_commondataserviceforapps_2"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "f1d26cf7-74b6-4ead-8782-4d10cc7fee19"
                      }
                    },
                    "Append_each_to_ExistingFlowActionDetails": {
                      "type": "Foreach",
                      "foreach": "@body('Select')",
                      "actions": {
                        "Append_to_ExistingFlowActionDetails": {
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "ExistingFlowActionDetails",
                            "value": "@items('Append_each_to_ExistingFlowActionDetails')"
                          },
                          "metadata": {
                            "operationMetadataId": "14c3f7a8-92b2-494f-9344-33501cbdf49c"
                          }
                        }
                      },
                      "runAfter": {
                        "Select": [
                          "Succeeded"
                        ]
                      },
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 50
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "33af4e01-a290-48e6-ae25-355428497eac"
                      }
                    },
                    "Select": {
                      "type": "Select",
                      "inputs": {
                        "from": "@outputs('List_this_flows_existing_flow_action_details')?['body/value']",
                        "select": {
                          "FlowID": "@item()?['_admin_flow_value']",
                          "EnvtID": "@item()?['_admin_flowactiondetailenvrinment_value']",
                          "ActionType": "@item()?['admin_actiontype']",
                          "ActionInformation": "@item()?['admin_actioninformation']",
                          "Operation": "@item()?['admin_operation']",
                          "Metadata": "@item()?['admin_flowactiondetailmetadata']",
                          "isTriggerType": "@item()?['cr5d5_istypetrigger']"
                        }
                      },
                      "runAfter": {
                        "List_this_flows_existing_flow_action_details": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "2f6cbad7-87eb-40d6-a943-25fc20615de2"
                      }
                    }
                  },
                  "runtimeConfiguration": {
                    "concurrency": {
                      "repetitions": 50
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "816673d5-8689-4faf-8578-beefdb0a81d5"
                  }
                },
                "Parse_ExistingFlowActionDetails": {
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@variables('ExistingFlowActionDetails')",
                    "schema": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "FlowID": {
                            "type": "string"
                          },
                          "EnvtID": {
                            "type": "string"
                          },
                          "ActionType": {
                            "type": "string"
                          },
                          "ActionInformation": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "Operation": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "Metadata": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "isTriggerType": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "FlowID",
                          "EnvtID",
                          "ActionType",
                          "isTriggerType"
                        ]
                      }
                    }
                  },
                  "runAfter": {
                    "Add_existing_flow_actions_to_ExistingFlowActionDetails": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "b2f60872-d4c5-4478-8bf1-5e05f9dabaa5"
                  }
                }
              },
              "runAfter": {
                "Get_flows_to_update": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "3db111d2-7989-48df-8e92-7bc1da03c5a3"
              }
            },
            "GetCurrentActual": {
              "type": "Scope",
              "actions": {
                "Apply_to_each_flow": {
                  "type": "Foreach",
                  "foreach": "@outputs('Flows_to_iterate')?['body/value']",
                  "actions": {
                    "Get_Flow_Details": {
                      "type": "Scope",
                      "actions": {
                        "Get_Flow_as_Admin": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "environmentName": "@items('Apply_to_each_flow')?['admin_flowenvironment/admin_environmentname']",
                              "flowName": "@items('Apply_to_each_flow')?['admin_flowid']"
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_flowmanagement",
                              "operationId": "AdminGetFlow",
                              "connectionName": "shared_flowmanagement"
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "09320ebc-038c-41e6-90fc-52608c44e244"
                          }
                        },
                        "parse_results": {
                          "type": "Scope",
                          "actions": {
                            "Parse_trigger": {
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@outputs('Get_Flow_as_Admin')?['body/properties/definitionSummary/triggers']",
                                "schema": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string"
                                      },
                                      "kind": {
                                        "type": [
                                          "string",
                                          "null"
                                        ]
                                      },
                                      "metadata": {
                                        "type": [
                                          "object",
                                          "null"
                                        ],
                                        "properties": {
                                          "operationMetadataId": {
                                            "type": "string"
                                          }
                                        }
                                      }
                                    },
                                    "required": [
                                      "type"
                                    ]
                                  }
                                }
                              },
                              "metadata": {
                                "operationMetadataId": "9f239974-f301-4f87-8886-ef5c8df8fdfe"
                              }
                            },
                            "Parse_actions": {
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@outputs('Get_Flow_as_Admin')?['body/properties/definitionSummary/actions']",
                                "schema": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "type": {
                                        "type": "string"
                                      },
                                      "swaggerOperationId": {
                                        "type": [
                                          "string",
                                          "null"
                                        ]
                                      },
                                      "metadata": {
                                        "type": [
                                          "object",
                                          "null"
                                        ],
                                        "properties": {
                                          "flowSystemMetadata": {
                                            "type": "object",
                                            "properties": {
                                              "swaggerOperationId": {
                                                "type": [
                                                  "string",
                                                  "null"
                                                ]
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "api": {
                                        "type": [
                                          "object",
                                          "null"
                                        ],
                                        "properties": {
                                          "name": {
                                            "type": "string"
                                          },
                                          "id": {
                                            "type": "string"
                                          },
                                          "type": {
                                            "type": "string"
                                          },
                                          "properties": {
                                            "type": "object",
                                            "properties": {
                                              "displayName": {
                                                "type": "string"
                                              }
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "required": [
                                      "type"
                                    ]
                                  }
                                }
                              },
                              "runAfter": {
                                "Parse_trigger": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "aac49627-a172-4238-9b49-10fb1e3e62c9"
                              }
                            }
                          },
                          "runAfter": {
                            "catch_flow_no_longer_exists": [
                              "Skipped"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "f4b0dc46-a857-4d00-8c4d-aa0c24f3c570"
                          }
                        },
                        "catch_flow_no_longer_exists": {
                          "type": "Compose",
                          "inputs": "catch flow no longer exists",
                          "runAfter": {
                            "Get_Flow_as_Admin": [
                              "Failed"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "3ddb4345-1238-4afd-95d1-ee3498b15871"
                          }
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "e5abea4a-466f-4ef4-af25-51bc06206fda"
                      }
                    },
                    "Append_new_flow_action_details": {
                      "type": "Scope",
                      "actions": {
                        "if_triggers_exist_then_add_them": {
                          "type": "If",
                          "expression": {
                            "not": {
                              "equals": [
                                "@body('Parse_trigger')",
                                "@null"
                              ]
                            }
                          },
                          "actions": {
                            "Apply_to_each_trigger": {
                              "type": "Foreach",
                              "foreach": "@body('Parse_trigger')",
                              "actions": {
                                "action_type_-_trigger": {
                                  "type": "Compose",
                                  "inputs": "@if(contains(item()['Type'], 'ApiConnection'), coalesce(item()?['api']?['properties']?['displayname'], item()['Type']), item()['Type'])",
                                  "metadata": {
                                    "operationMetadataId": "0bfe3936-9693-415c-b44b-56afea87a371"
                                  }
                                },
                                "operation_-_trigger": {
                                  "type": "Compose",
                                  "inputs": "@if(contains(item()['Type'], 'ApiConnection'), coalesce(item()?['swaggerOperationId'], ''), coalesce(item()?['Kind'], ''))",
                                  "runAfter": {
                                    "action_type_-_trigger": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "cdd78d0c-f61b-4dd2-9949-45a4b8786313"
                                  }
                                },
                                "flowTrigger": {
                                  "type": "Compose",
                                  "inputs": "@if(equals(outputs('operation_-_trigger'), ''), outputs('action_type_-_trigger'), concat(outputs('action_type_-_trigger'), ' : ', outputs('operation_-_trigger')))",
                                  "runAfter": {
                                    "operation_-_trigger": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "3a887a30-f7ce-4414-83a3-b83cc06ba8b0"
                                  }
                                },
                                "update_trigger_if_changed": {
                                  "type": "If",
                                  "expression": {
                                    "or": [
                                      {
                                        "equals": [
                                          "@items('Apply_to_each_flow')?['cr5d5_flowtrigger']",
                                          "@null"
                                        ]
                                      },
                                      {
                                        "equals": [
                                          "@length(items('Apply_to_each_flow')?['cr5d5_flowtrigger'])",
                                          0
                                        ]
                                      },
                                      {
                                        "not": {
                                          "equals": [
                                            "@items('Apply_to_each_flow')?['cr5d5_flowtrigger']",
                                            "@outputs('flowTrigger')"
                                          ]
                                        }
                                      }
                                    ]
                                  },
                                  "actions": {
                                    "Update_flow_trigger": {
                                      "type": "OpenApiConnection",
                                      "inputs": {
                                        "parameters": {
                                          "entityName": "admin_flows",
                                          "recordId": "@items('Apply_to_each_flow')?['admin_flowid']",
                                          "item/cr5d5_flowtrigger": "@outputs('flowTrigger')"
                                        },
                                        "host": {
                                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                          "operationId": "UpdateRecord",
                                          "connectionName": "shared_commondataserviceforapps_2"
                                        }
                                      },
                                      "metadata": {
                                        "operationMetadataId": "b1135c4e-c965-414e-85ed-2ca4a717492b"
                                      }
                                    }
                                  },
                                  "else": {
                                    "actions": {}
                                  },
                                  "runAfter": {
                                    "flowTrigger": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "382c157b-8959-41df-8789-5e584c5eb249"
                                  }
                                },
                                "Append_trigger_to_ActualFlowActionDetails": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "ActualFlowActionDetails",
                                    "value": {
                                      "FlowID": "@items('Apply_to_each_flow')?['admin_flowid']",
                                      "EnvtID": "@items('Apply_to_each_flow')?['_admin_flowenvironment_value']",
                                      "ActionType": "@outputs('action_type_-_trigger')",
                                      "ActionInformation": "@null",
                                      "Operation": "@if(equals(length(outputs('operation_-_trigger')), 0), null, outputs('operation_-_trigger'))",
                                      "Metadata": "@null",
                                      "isTriggerType": "Yes"
                                    }
                                  },
                                  "runAfter": {
                                    "update_trigger_if_changed": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "25040c51-df56-4f78-bc0b-c61bea488fa2"
                                  }
                                }
                              },
                              "runtimeConfiguration": {
                                "concurrency": {
                                  "repetitions": 50
                                }
                              },
                              "metadata": {
                                "operationMetadataId": "ca0535d4-7d92-4351-9414-d9ec7c4f0097"
                              }
                            }
                          },
                          "else": {
                            "actions": {}
                          },
                          "metadata": {
                            "operationMetadataId": "ed7e90db-7fea-4a61-a226-ee55bb059dce"
                          }
                        },
                        "if_actions_exist_then_add_them": {
                          "type": "If",
                          "expression": {
                            "not": {
                              "equals": [
                                "@body('Parse_actions')",
                                "@null"
                              ]
                            }
                          },
                          "actions": {
                            "Apply_to_each_action": {
                              "type": "Foreach",
                              "foreach": "@body('Parse_actions')",
                              "actions": {
                                "action_type_-_action": {
                                  "type": "Compose",
                                  "inputs": "@if(contains(item()['Type'], 'ApiConnection'), coalesce(item()?['api']?['properties']?['displayname'], item()['Type']), item()['Type'])",
                                  "metadata": {
                                    "operationMetadataId": "b8c29d5c-e43d-4b37-bfde-1cc99aa02bc8"
                                  }
                                },
                                "operation_-_action": {
                                  "type": "Compose",
                                  "inputs": "@if(contains(item()['Type'], 'ApiConnection'), coalesce(item()?['swaggerOperationId'], ''), coalesce(item()?['Kind'], ''))",
                                  "runAfter": {
                                    "action_type_-_action": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "51724b5a-6aeb-42c4-9cb2-87f600944c0b"
                                  }
                                },
                                "If_specialty_action_then_add_to_array_for_later,_else_add_it_now": {
                                  "type": "If",
                                  "expression": {
                                    "or": [
                                      {
                                        "equals": [
                                          "@outputs('action_type_-_action')",
                                          "Http"
                                        ]
                                      },
                                      {
                                        "equals": [
                                          "@outputs('action_type_-_action')",
                                          "HttpWebhook"
                                        ]
                                      }
                                    ]
                                  },
                                  "actions": {
                                    "Append_to_FlowsWithSpecialtyActions": {
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "FlowsWithSpecialtyActions",
                                        "value": {
                                          "FlowID": "@items('Apply_to_each_flow')?['admin_flowid']",
                                          "EnvtID": "@items('Apply_to_each_flow')?['_admin_flowenvironment_value']",
                                          "EnvtName": "@items('Apply_to_each_flow')?['admin_flowenvironment/admin_environmentname']",
                                          "DerivedOwner": "@coalesce(items('Apply_to_each_flow')?['_admin_derivedowner_value'], items('Apply_to_each_flow')?['_admin_flowcreator_value'])"
                                        }
                                      },
                                      "metadata": {
                                        "operationMetadataId": "b40f750a-d430-4c58-b778-8b44f7b820cf"
                                      }
                                    }
                                  },
                                  "else": {
                                    "actions": {
                                      "Append_action_to_ActualFlowActionDetails": {
                                        "type": "AppendToArrayVariable",
                                        "inputs": {
                                          "name": "ActualFlowActionDetails",
                                          "value": {
                                            "FlowID": "@items('Apply_to_each_flow')?['admin_flowid']",
                                            "EnvtID": "@items('Apply_to_each_flow')?['_admin_flowenvironment_value']",
                                            "ActionType": "@outputs('action_type_-_action')",
                                            "ActionInformation": "@null",
                                            "Operation": "@if(equals(length(outputs('operation_-_action')), 0), null, outputs('operation_-_action'))",
                                            "Metadata": "@null",
                                            "isTriggerType": "No"
                                          }
                                        },
                                        "metadata": {
                                          "operationMetadataId": "7549764c-3fe2-42da-9a27-3f6143ba0659"
                                        }
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "operation_-_action": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "fa0ee3d8-ea0d-4fa5-b5a4-4ea06d217b3c"
                                  }
                                }
                              },
                              "runtimeConfiguration": {
                                "concurrency": {
                                  "repetitions": 50
                                }
                              },
                              "metadata": {
                                "operationMetadataId": "a6f3cadc-edce-4e4a-928c-33f71369111d"
                              }
                            },
                            "Reset_the_FlowWithSpecialityActions": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "FlowsWithSpecialtyActions",
                                "value": "@variables('FlowsWithSpecialtyActionsTemp')"
                              },
                              "runAfter": {
                                "Remove_duplicates_in_FlowsWithSpecialtyActions": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "b4cf8d04-5efb-4984-b569-9dd8da1602fe"
                              }
                            },
                            "Remove_duplicates_in_FlowsWithSpecialtyActions": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "FlowsWithSpecialtyActionsTemp",
                                "value": "@union(variables('FlowsWithSpecialtyActions'), json('[]'))"
                              },
                              "runAfter": {
                                "Apply_to_each_action": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "ec317cb0-f5a5-4db2-b0fd-a5ecb2112eb5"
                              }
                            },
                            "Remove_duplicates_in_FlowsWithActions": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "FlowsWithActionsTemp",
                                "value": "@union(variables('ActualFlowActionDetails'), json('[]'))"
                              },
                              "runAfter": {
                                "Reset_the_FlowWithSpecialityActions": [
                                  "Succeeded"
                                ]
                              }
                            },
                            "Reset_the_FlowWithActions": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "ActualFlowActionDetails",
                                "value": "@variables('FlowsWithActionsTemp')"
                              },
                              "runAfter": {
                                "Remove_duplicates_in_FlowsWithActions": [
                                  "Succeeded"
                                ]
                              }
                            }
                          },
                          "else": {
                            "actions": {}
                          },
                          "runAfter": {
                            "if_triggers_exist_then_add_them": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "d4e3d35f-1710-4b1b-9401-72e39c031ff6"
                          }
                        }
                      },
                      "runAfter": {
                        "Get_Flow_Details": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "fc4799b7-9a39-4a0d-900b-0a24b419facb"
                      }
                    }
                  },
                  "runtimeConfiguration": {
                    "concurrency": {
                      "repetitions": 50
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "eda449df-e5b5-40e7-a6da-f256a9e4de0f"
                  }
                },
                "Get_Specialty_Action_Details": {
                  "type": "Scope",
                  "actions": {
                    "final_delimeter": {
                      "type": "Compose",
                      "inputs": "\"",
                      "metadata": {
                        "operationMetadataId": "40853fc6-f5bf-44e0-a5a0-4c14cb0ae4ba"
                      }
                    },
                    "Apply_to_each_flow_with_specialty_connectors": {
                      "type": "Foreach",
                      "foreach": "@variables('FlowsWithSpecialtyActions')",
                      "actions": {
                        "http": {
                          "type": "Scope",
                          "actions": {
                            "Split_on_type_Http": {
                              "type": "Compose",
                              "inputs": "@split(string(body('Parse_Flow_Definition')?['actions']), '\"type\":\"Http\"')",
                              "metadata": {
                                "operationMetadataId": "62116c2a-7b4b-4002-9ec6-8290053f6c82"
                              }
                            },
                            "if_it_had_an_http": {
                              "type": "If",
                              "expression": {
                                "greater": [
                                  "@length(outputs('Split_on_type_Http'))",
                                  1
                                ]
                              },
                              "actions": {
                                "Apply_to_each_item_from_Http_split": {
                                  "type": "Foreach",
                                  "foreach": "@outputs('Split_on_type_Http')",
                                  "actions": {
                                    "Split_on_uri": {
                                      "type": "Compose",
                                      "inputs": "@split(item(), '\"uri\":\"')",
                                      "metadata": {
                                        "operationMetadataId": "9a26ff2c-8085-4b98-b3bb-dd3fda1a1d7a"
                                      }
                                    },
                                    "if_had_a_uri": {
                                      "type": "If",
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@length(outputs('Split_on_uri'))",
                                              1
                                            ]
                                          },
                                          {
                                            "less": [
                                              "@length(variables('HTTP_URLs'))",
                                              100000
                                            ]
                                          }
                                        ]
                                      },
                                      "actions": {
                                        "split_the_uri_off": {
                                          "type": "Compose",
                                          "inputs": "@split(outputs('Split_on_uri')[1], outputs('final_delimeter'))",
                                          "metadata": {
                                            "operationMetadataId": "21d08521-6e32-4207-aa2f-6d6384d2dec9"
                                          }
                                        },
                                        "Append_uri_to_array_variable": {
                                          "type": "AppendToArrayVariable",
                                          "inputs": {
                                            "name": "HTTP_URLs",
                                            "value": "@outputs('split_the_uri_off')[0]"
                                          },
                                          "runAfter": {
                                            "split_the_uri_off": [
                                              "Succeeded"
                                            ]
                                          },
                                          "metadata": {
                                            "operationMetadataId": "7b9adf89-67d0-4ee6-9173-bf37a394ff25"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {}
                                      },
                                      "runAfter": {
                                        "Split_on_uri": [
                                          "Succeeded"
                                        ]
                                      },
                                      "metadata": {
                                        "operationMetadataId": "dde1e699-0ab8-4866-b4cf-0000c9e1e3d6"
                                      }
                                    }
                                  },
                                  "metadata": {
                                    "operationMetadataId": "e96391d7-d71a-4eb4-bb93-fb41aeb34036"
                                  }
                                }
                              },
                              "else": {
                                "actions": {}
                              },
                              "runAfter": {
                                "Split_on_type_Http": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "c97b0981-67af-4b20-bdff-8a908eb6e912"
                              }
                            },
                            "Append_each_Http_Action": {
                              "type": "Foreach",
                              "foreach": "@variables('HTTP_URLs')",
                              "actions": {
                                "Append_http_action": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "ActualFlowActionDetails",
                                    "value": {
                                      "FlowID": "@items('Apply_to_each_flow_with_specialty_connectors')?['FlowID']",
                                      "EnvtID": "@items('Apply_to_each_flow_with_specialty_connectors')?['EnvtID']",
                                      "ActionType": "Http",
                                      "ActionInformation": "@null",
                                      "Operation": "@null",
                                      "Metadata": "@items('Append_each_Http_Action')",
                                      "isTriggerType": "No"
                                    }
                                  },
                                  "metadata": {
                                    "operationMetadataId": "b5422a56-c83e-41af-837e-5eba892dd300"
                                  }
                                }
                              },
                              "runAfter": {
                                "if_it_had_an_http": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "ab7a80a3-66f1-45fd-84a9-3169239588cf"
                              }
                            }
                          },
                          "runAfter": {
                            "get_flow_defn": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "3b220df1-4194-42bc-951a-f75865e138fd"
                          }
                        },
                        "http_webhook": {
                          "type": "Scope",
                          "actions": {
                            "Split_on_type_Http_webhook": {
                              "type": "Compose",
                              "inputs": "@split(string(body('Parse_Flow_Definition')?['actions']), '\"type\":\"HttpWebhook\"')",
                              "metadata": {
                                "operationMetadataId": "7a206edf-e7a4-4088-a490-0dc7f86a6873"
                              }
                            },
                            "if_it_had_an_http_webhook": {
                              "type": "If",
                              "expression": {
                                "greater": [
                                  "@length(outputs('Split_on_type_Http_webhook'))",
                                  1
                                ]
                              },
                              "actions": {
                                "Apply_to_each_item_from_Httpwebhook_split": {
                                  "type": "Foreach",
                                  "foreach": "@outputs('Split_on_type_Http_webhook')",
                                  "actions": {
                                    "Split_on_uri_webhook": {
                                      "type": "Compose",
                                      "inputs": "@split(item(), '\"uri\":\"')",
                                      "metadata": {
                                        "operationMetadataId": "55c29f1c-3a26-492e-baa0-946bc21ab4cd"
                                      }
                                    },
                                    "if_had_a_uri_webhook": {
                                      "type": "If",
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@length(outputs('Split_on_uri_webhook'))",
                                              1
                                            ]
                                          },
                                          {
                                            "less": [
                                              "@length(variables('HTTPWEBHOOK_URLs'))",
                                              10000
                                            ]
                                          }
                                        ]
                                      },
                                      "actions": {
                                        "split_the_uri_off_webhook": {
                                          "type": "Compose",
                                          "inputs": "@split(outputs('Split_on_uri_webhook')[1], outputs('final_delimeter'))",
                                          "metadata": {
                                            "operationMetadataId": "f49659d8-8cbe-40ab-9694-14714e000750"
                                          }
                                        },
                                        "Append_uri_to_webhook_array_variable": {
                                          "type": "AppendToArrayVariable",
                                          "inputs": {
                                            "name": "HTTPWEBHOOK_URLs",
                                            "value": "@outputs('split_the_uri_off_webhook')[0]"
                                          },
                                          "runAfter": {
                                            "split_the_uri_off_webhook": [
                                              "Succeeded"
                                            ]
                                          },
                                          "metadata": {
                                            "operationMetadataId": "a724534b-13c9-49a4-878f-df78404553c2"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {}
                                      },
                                      "runAfter": {
                                        "Split_on_uri_webhook": [
                                          "Succeeded"
                                        ]
                                      },
                                      "metadata": {
                                        "operationMetadataId": "011b76ea-7363-4a7c-8ee4-498deb54e51a"
                                      }
                                    }
                                  },
                                  "metadata": {
                                    "operationMetadataId": "300a1e86-d36e-4f56-8be8-d8a23896bd0e"
                                  }
                                }
                              },
                              "else": {
                                "actions": {}
                              },
                              "runAfter": {
                                "Split_on_type_Http_webhook": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "335682b0-33f3-497e-ac63-d71ff276cd70"
                              }
                            },
                            "Append_each_http_webhook_Action": {
                              "type": "Foreach",
                              "foreach": "@variables('HTTPWEBHOOK_URLs')",
                              "actions": {
                                "Append_HttpWebhook_Action": {
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "ActualFlowActionDetails",
                                    "value": {
                                      "FlowID": "@items('Apply_to_each_flow_with_specialty_connectors')?['FlowID']",
                                      "EnvtID": "@items('Apply_to_each_flow_with_specialty_connectors')?['EnvtID']",
                                      "ActionType": "HttpWebhook",
                                      "ActionInformation": "@null",
                                      "Operation": "@null",
                                      "Metadata": "@items('Append_each_http_webhook_Action')",
                                      "isTriggerType": "No"
                                    }
                                  },
                                  "metadata": {
                                    "operationMetadataId": "13bc6735-24bb-44b8-b231-9f4d45e29202"
                                  }
                                }
                              },
                              "runAfter": {
                                "if_it_had_an_http_webhook": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "e4220f7d-c047-40f0-85bb-75d970bf2715"
                              }
                            }
                          },
                          "runAfter": {
                            "http": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "68a19e95-f376-4c9c-9bf7-7ef5163cf3b2"
                          }
                        },
                        "check_for_password": {
                          "type": "Scope",
                          "actions": {
                            "Split_on_type_password": {
                              "type": "Compose",
                              "inputs": "@split(string(body('Parse_Flow_Definition')?['actions']), '\"password\"')",
                              "metadata": {
                                "operationMetadataId": "04f097f4-15e5-4287-94a1-1f6b76853e66"
                              }
                            },
                            "if_it_had_a_password_flag_the_flow_as_having_password": {
                              "type": "If",
                              "expression": {
                                "greater": [
                                  "@length(outputs('Split_on_type_password'))",
                                  1
                                ]
                              },
                              "actions": {
                                "Mark_as_Contains_Plain_Text_Password_-_Yes": {
                                  "type": "OpenApiConnection",
                                  "inputs": {
                                    "parameters": {
                                      "entityName": "admin_flows",
                                      "recordId": "@items('Apply_to_each_flow_with_specialty_connectors')?['FlowID']",
                                      "item/admin_containsplaintextpassword": true
                                    },
                                    "host": {
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                                      "operationId": "UpdateRecord",
                                      "connectionName": "shared_commondataserviceforapps_2"
                                    }
                                  },
                                  "metadata": {
                                    "operationMetadataId": "090b023a-75be-4702-b802-7cbf36defdcd"
                                  }
                                }
                              },
                              "else": {
                                "actions": {}
                              },
                              "runAfter": {
                                "Split_on_type_password": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "362f0ad9-341b-441a-a19a-42878c5b0ced"
                              }
                            }
                          },
                          "runAfter": {
                            "http_webhook": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "737019e3-89c3-476c-8fa0-66f9f3c3538d"
                          }
                        },
                        "Reset_needPermissions_to_false": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "needPermissions",
                            "value": "@false"
                          },
                          "metadata": {
                            "operationMetadataId": "aa5da858-0b70-4f3c-9d66-1c983748f2fe"
                          }
                        },
                        "get_flow_defn": {
                          "type": "Scope",
                          "actions": {
                            "permissions_check": {
                              "type": "Scope",
                              "actions": {
                                "Set_needPermissions_true": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "needPermissions",
                                    "value": "@true"
                                  },
                                  "runAfter": {
                                    "Get_Flow_Permissions_Check": [
                                      "Failed"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "349d7cac-9354-4cac-bcbf-bf5f2113f504"
                                  }
                                },
                                "if_need_permissions,_add_them": {
                                  "type": "If",
                                  "expression": {
                                    "equals": [
                                      "@variables('needPermissions')",
                                      "@true"
                                    ]
                                  },
                                  "actions": {
                                    "Old_Owner": {
                                      "type": "Compose",
                                      "inputs": "@items('Apply_to_each_flow_with_specialty_connectors')?['DerivedOwner']",
                                      "metadata": {
                                        "operationMetadataId": "fefcdc45-9b1c-42d1-acf2-5b03a5f0ebb9"
                                      }
                                    },
                                    "Add_Permissions": {
                                      "type": "Workflow",
                                      "inputs": {
                                        "host": {
                                          "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                        },
                                        "body": {
                                          "text": "@outputs('Get_my_id')?['body/id']",
                                          "text_1": "@items('Apply_to_each_flow_with_specialty_connectors')?['FlowID']",
                                          "text_2": "@items('Apply_to_each_flow_with_specialty_connectors')?['EnvtName']",
                                          "text_3": "assign"
                                        }
                                      },
                                      "runAfter": {
                                        "Old_Owner": [
                                          "Succeeded"
                                        ]
                                      },
                                      "metadata": {
                                        "operationMetadataId": "fc9286e7-a378-4b17-aeb2-086f6cfed946"
                                      }
                                    }
                                  },
                                  "else": {
                                    "actions": {}
                                  },
                                  "runAfter": {
                                    "Set_needPermissions_true": [
                                      "Succeeded",
                                      "Skipped"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "61fb25f6-3ca5-4574-a17e-fe917e19d891"
                                  }
                                },
                                "Get_Flow_Permissions_Check": {
                                  "type": "OpenApiConnection",
                                  "inputs": {
                                    "parameters": {
                                      "environmentName": "@items('Apply_to_each_flow_with_specialty_connectors')?['EnvtName']",
                                      "flowName": "@items('Apply_to_each_flow_with_specialty_connectors')?['FlowID']"
                                    },
                                    "host": {
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_flowmanagement",
                                      "operationId": "GetFlow",
                                      "connectionName": "shared_flowmanagement"
                                    }
                                  },
                                  "metadata": {
                                    "operationMetadataId": "bb4922c2-8191-4249-b5ef-8fe33270550c"
                                  }
                                }
                              },
                              "metadata": {
                                "operationMetadataId": "0edf4a04-b093-42e4-861c-f5fe0d1d4b20"
                              }
                            },
                            "reset_permissions": {
                              "type": "Scope",
                              "actions": {
                                "if_needed_permissions,_set_them_back": {
                                  "type": "If",
                                  "expression": {
                                    "equals": [
                                      "@variables('needPermissions')",
                                      "@true"
                                    ]
                                  },
                                  "actions": {
                                    "Reset_Owner": {
                                      "type": "Workflow",
                                      "inputs": {
                                        "host": {
                                          "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                        },
                                        "body": {
                                          "text": "@outputs('Old_Owner')",
                                          "text_1": "@items('Apply_to_each_flow_with_specialty_connectors')?['FlowID']",
                                          "text_2": "@items('Apply_to_each_flow_with_specialty_connectors')?['EnvtName']",
                                          "text_3": "assign"
                                        }
                                      },
                                      "metadata": {
                                        "operationMetadataId": "b6e6f5c7-6512-4a25-9c3b-3beca0706b75"
                                      }
                                    },
                                    "Remove_Admin": {
                                      "type": "Workflow",
                                      "inputs": {
                                        "host": {
                                          "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                        },
                                        "body": {
                                          "text": "@outputs('Get_my_id')?['body/id']",
                                          "text_1": "@items('Apply_to_each_flow_with_specialty_connectors')?['FlowID']",
                                          "text_2": "@items('Apply_to_each_flow_with_specialty_connectors')?['EnvtName']",
                                          "text_3": "removeuser"
                                        }
                                      },
                                      "runAfter": {
                                        "Reset_Owner": [
                                          "Succeeded"
                                        ]
                                      },
                                      "metadata": {
                                        "operationMetadataId": "f1c8bc5f-82c2-45f3-9b47-0164d8880003"
                                      }
                                    }
                                  },
                                  "else": {
                                    "actions": {}
                                  },
                                  "metadata": {
                                    "operationMetadataId": "47777a10-1bcb-4ed3-88ef-2ec61441bd4d"
                                  }
                                }
                              },
                              "runAfter": {
                                "Parse_Flow_Definition": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "961c4b6f-01f7-47bd-96aa-1c47c301e12f"
                              }
                            },
                            "Get_Flow": {
                              "type": "OpenApiConnection",
                              "inputs": {
                                "parameters": {
                                  "environmentName": "@items('Apply_to_each_flow_with_specialty_connectors')?['EnvtName']",
                                  "flowName": "@items('Apply_to_each_flow_with_specialty_connectors')?['FlowID']"
                                },
                                "host": {
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_flowmanagement",
                                  "operationId": "GetFlow",
                                  "connectionName": "shared_flowmanagement"
                                },
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 30,
                                  "interval": "PT30S"
                                }
                              },
                              "runAfter": {
                                "permissions_check": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "d4f02954-8ca5-4f88-b4aa-2e19264088cb"
                              }
                            },
                            "Parse_Flow_Definition": {
                              "type": "ParseJson",
                              "inputs": {
                                "content": "@outputs('Get_Flow')?['body/properties/definition']",
                                "schema": {
                                  "type": "object",
                                  "properties": {
                                    "$schema": {
                                      "type": "string"
                                    },
                                    "contentVersion": {
                                      "type": "string"
                                    },
                                    "actions": {
                                      "type": "object"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Get_Flow": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "26a16bf5-52f2-4077-a2e4-dc53be0ce2d3"
                              }
                            }
                          },
                          "runAfter": {
                            "Reset_HTTP_Web_Hook_URLs": [
                              "SUCCEEDED"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "40b7f4f6-0d2b-4620-a9cc-7e7ac378f80a"
                          }
                        },
                        "Reset_HTTP_URLs": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "HTTP_URLs",
                            "value": []
                          },
                          "runAfter": {
                            "Reset_needPermissions_to_false": [
                              "Succeeded"
                            ]
                          }
                        },
                        "Reset_HTTP_Web_Hook_URLs": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "HTTPWEBHOOK_URLs",
                            "value": []
                          },
                          "runAfter": {
                            "Reset_HTTP_URLs": [
                              "SUCCEEDED"
                            ]
                          }
                        }
                      },
                      "runAfter": {
                        "final_delimeter": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "7ca74652-ae48-4ed8-8db3-ee278ea3a8a3"
                      }
                    }
                  },
                  "runAfter": {
                    "Clear_Specialty_Flags": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "342dfc6f-b51c-480b-9f60-9c1ab2650fa5"
                  }
                },
                "Clear_Specialty_Flags": {
                  "type": "Scope",
                  "actions": {
                    "Flows_to_iterate_with_specialty_flags": {
                      "type": "OpenApiConnection",
                      "inputs": {
                        "parameters": {
                          "entityName": "admin_flows",
                          "$select": "admin_flowid, _admin_flowenvironment_value, admin_flowmodifiedon, cr5d5_flowtrigger, admin_containsplaintextpassword, _admin_derivedowner_value",
                          "$filter": "admin_flowdeleted ne true and admin_inventorymyflowactiondetails eq true and _admin_flowenvironment_value eq @{triggerOutputs()?['body/admin_environmentid']} and admin_flowispublished ne false and admin_containsplaintextpassword eq true",
                          "$orderby": "admin_flowmodifiedon",
                          "$expand": "admin_FlowEnvironment($select=admin_environmentname)"
                        },
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "operationId": "ListRecords",
                          "connectionName": "shared_commondataserviceforapps_2"
                        }
                      },
                      "runtimeConfiguration": {
                        "paginationPolicy": {
                          "minimumItemCount": 100000
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "a3251373-d429-4865-b477-f353289526e6"
                      }
                    },
                    "Clear_each_flow": {
                      "type": "Foreach",
                      "foreach": "@outputs('Flows_to_iterate_with_specialty_flags')?['body/value']",
                      "actions": {
                        "Update_flow_to_clear_specialty_flags": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "entityName": "admin_flows",
                              "recordId": "@items('Clear_each_flow')?['admin_flowid']",
                              "item/admin_containsplaintextpassword": false
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "connectionName": "shared_commondataserviceforapps_2"
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "07d681de-5f58-41a9-b59f-51c8888f3e2d"
                          }
                        }
                      },
                      "runAfter": {
                        "Flows_to_iterate_with_specialty_flags": [
                          "Succeeded"
                        ]
                      },
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 50
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "81f09dd5-7a3b-4464-a262-aa1cf1d1307f"
                      }
                    }
                  },
                  "runAfter": {
                    "Apply_to_each_flow": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "27a2214d-e35d-4ac7-9b1d-b68561c2799b"
                  }
                },
                "Parse_ActualFlowActionDetails": {
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@variables('ActualFlowActionDetails')",
                    "schema": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "FlowID": {
                            "type": "string"
                          },
                          "EnvtID": {
                            "type": "string"
                          },
                          "ActionType": {
                            "type": "string"
                          },
                          "ActionInformation": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "Operation": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "Metadata": {
                            "type": [
                              "string",
                              "null"
                            ]
                          },
                          "isTriggerType": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "FlowID",
                          "EnvtID",
                          "ActionType",
                          "isTriggerType"
                        ]
                      }
                    }
                  },
                  "runAfter": {
                    "Get_Specialty_Action_Details": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "c7ce0da4-266c-446e-8133-2d8123a2f65f"
                  }
                },
                "Clear_Inventory_My_FlowActionDetails_flag": {
                  "type": "Scope",
                  "actions": {
                    "Clear_each_flows_flag": {
                      "type": "Foreach",
                      "foreach": "@outputs('Flows_to_iterate')?['body/value']",
                      "actions": {
                        "Clear_this_flows_flag": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "entityName": "admin_flows",
                              "recordId": "@items('Clear_each_flows_flag')?['admin_flowid']",
                              "item/admin_inventorymyflowactiondetails": false
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "operationId": "UpdateRecord",
                              "connectionName": "shared_commondataserviceforapps"
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "b32c71d3-4720-45c4-ba03-d003c529e347"
                          }
                        }
                      },
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 50
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "9281e977-2f7a-4e04-aaa8-8580e27141e2"
                      }
                    }
                  },
                  "runAfter": {
                    "Parse_ActualFlowActionDetails": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "7cd14ee8-ca3d-469c-a282-ccc73fb5b20a"
                  }
                }
              },
              "runAfter": {
                "Get_flows_to_update": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "5d83852b-5d9f-4ce1-b43d-c1fc317c4524"
              }
            },
            "Remove_deleted_ones_from_inventory": {
              "type": "Scope",
              "actions": {
                "RemoveFromInventory": {
                  "type": "Query",
                  "inputs": {
                    "from": "@body('Parse_ExistingFlowActionDetails')",
                    "where": "@not(contains(body('Parse_ActualFlowActionDetails'), item()))"
                  },
                  "metadata": {
                    "operationMetadataId": "4f387244-fcdd-4b6b-862b-533fb66009ad"
                  }
                },
                "Apply_to_each_identified_to_delete": {
                  "type": "Foreach",
                  "foreach": "@body('RemoveFromInventory')",
                  "actions": {
                    "Start_of_filterString_": {
                      "type": "SetVariable",
                      "inputs": {
                        "name": "filterString",
                        "value": "_admin_flow_value eq '@{items('Apply_to_each_identified_to_delete')?['FlowID']}' and _admin_flowactiondetailenvrinment_value eq '@{items('Apply_to_each_identified_to_delete')?['EnvtID']}' and admin_actiontype eq '@{items('Apply_to_each_identified_to_delete')?['ActionType']}' and cr5d5_istypetrigger eq '@{items('Apply_to_each_identified_to_delete')?['isTriggerType']}'"
                      },
                      "metadata": {
                        "operationMetadataId": "0822a765-a0d5-4264-ad03-ce625591e639"
                      }
                    },
                    "Find_it_for_ID": {
                      "type": "OpenApiConnection",
                      "inputs": {
                        "parameters": {
                          "entityName": "admin_flowactiondetails",
                          "$select": "admin_flowactiondetailid",
                          "$filter": "@variables('filterString')"
                        },
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "operationId": "ListRecords",
                          "connectionName": "shared_commondataserviceforapps_2"
                        }
                      },
                      "runAfter": {
                        "Append_metadata": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "5ac8c157-24ed-4718-8549-22acf06f47c9"
                      }
                    },
                    "Append_actioninformation": {
                      "type": "If",
                      "expression": {
                        "equals": [
                          "@equals(items('Apply_to_each_identified_to_delete')?['ActionInformation'], null)",
                          "@true"
                        ]
                      },
                      "actions": {
                        "Append_null_for_actioninformation": {
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "filterString",
                            "value": " and admin_actioninformation eq null"
                          },
                          "metadata": {
                            "operationMetadataId": "2f92e138-d570-4ead-b6a0-614b81005d7d"
                          }
                        }
                      },
                      "else": {
                        "actions": {
                          "Append_string_for_actioninformation": {
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "filterString",
                              "value": " and admin_actioninformation eq '@{items('Apply_to_each_identified_to_delete')?['ActionInformation']}'"
                            },
                            "metadata": {
                              "operationMetadataId": "0475055b-6590-4a8d-8c42-258d84d5dc18"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Start_of_filterString_": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "a4d009f5-940b-496b-8d62-a7a7c532bc7b"
                      }
                    },
                    "Append_operation": {
                      "type": "If",
                      "expression": {
                        "equals": [
                          "@equals(items('Apply_to_each_identified_to_delete')?['Operation'], null)",
                          "@true"
                        ]
                      },
                      "actions": {
                        "Append_null_for_operation": {
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "filterString",
                            "value": " and admin_operation eq null"
                          },
                          "metadata": {
                            "operationMetadataId": "7ea781ab-57e3-418c-b666-f9c21c86403f"
                          }
                        }
                      },
                      "else": {
                        "actions": {
                          "Append_string_for_operation": {
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "filterString",
                              "value": " and admin_operation eq '@{items('Apply_to_each_identified_to_delete')?['Operation']}'"
                            },
                            "metadata": {
                              "operationMetadataId": "2a99febc-731f-49fb-8374-6efd4ca4f7e6"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Append_actioninformation": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "94fac726-c642-47b3-8a2c-18e7ecad0adf"
                      }
                    },
                    "Append_metadata": {
                      "type": "If",
                      "expression": {
                        "equals": [
                          "@equals(items('Apply_to_each_identified_to_delete')?['Metadata'], null)",
                          "@true"
                        ]
                      },
                      "actions": {
                        "Append_null_for_metadata": {
                          "type": "AppendToStringVariable",
                          "inputs": {
                            "name": "filterString",
                            "value": " and admin_flowactiondetailmetadata eq null"
                          },
                          "metadata": {
                            "operationMetadataId": "9445a091-726f-48cc-a5d8-c266972deeae"
                          }
                        }
                      },
                      "else": {
                        "actions": {
                          "RemoveSpecialChars_-_metadata": {
                            "type": "Compose",
                            "inputs": "@replace(items('Apply_to_each_identified_to_delete')?['Metadata'],'''','''''')",
                            "metadata": {
                              "operationMetadataId": "05a321a8-0ec2-486d-a7ae-31786a82f728"
                            }
                          },
                          "Append_string_for_metadata": {
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "filterString",
                              "value": " and admin_flowactiondetailmetadata eq '@{outputs('RemoveSpecialChars_-_metadata')}'"
                            },
                            "runAfter": {
                              "RemoveSpecialChars_-_metadata": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "9d7c5e13-c45a-460b-bc23-7668194721ca"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Append_operation": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "800acd2d-9546-42b0-a572-b88e71c52c80"
                      }
                    },
                    "Avoid_failure_for_symultaneous_run": {
                      "type": "If",
                      "expression": {
                        "greater": [
                          "@length(outputs('Find_it_for_ID')?['body/value'])",
                          0
                        ]
                      },
                      "actions": {
                        "Delete_it": {
                          "type": "OpenApiConnection",
                          "inputs": {
                            "parameters": {
                              "entityName": "admin_flowactiondetails",
                              "recordId": "@first(outputs('Find_it_for_ID')?['body/value'])?['admin_flowactiondetailid']"
                            },
                            "host": {
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                              "operationId": "DeleteRecord",
                              "connectionName": "shared_commondataserviceforapps_2"
                            }
                          },
                          "metadata": {
                            "operationMetadataId": "8a3d4ac8-00f1-44fe-8412-14339dc0452e"
                          }
                        }
                      },
                      "else": {
                        "actions": {}
                      },
                      "runAfter": {
                        "Find_it_for_ID": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "00bf86e7-68e9-46d5-bfeb-eb2ced643997"
                      }
                    }
                  },
                  "runAfter": {
                    "RemoveFromInventory": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "54ada841-d27e-4569-82f9-2b1f522e6152"
                  }
                }
              },
              "runAfter": {
                "GetCurrentActual": [
                  "Succeeded"
                ],
                "GetCurrentInventory": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "b3e2d9f5-d726-40e6-aab7-37a18f02b8d3"
              }
            },
            "Add_new_ones_to_inventory": {
              "type": "Scope",
              "actions": {
                "AddToInventory": {
                  "type": "Query",
                  "inputs": {
                    "from": "@body('Parse_ActualFlowActionDetails')",
                    "where": "@not(contains(body('Parse_ExistingFlowActionDetails'), item()))"
                  },
                  "metadata": {
                    "operationMetadataId": "1740f542-8b96-438d-8260-f76305e13ed6"
                  }
                },
                "Add_each_new_flow_action_detail": {
                  "type": "Foreach",
                  "foreach": "@body('AddToInventory')",
                  "actions": {
                    "Add_new_flow_action_detail": {
                      "type": "OpenApiConnection",
                      "inputs": {
                        "parameters": {
                          "entityName": "admin_flowactiondetails",
                          "item/admin_actiontype": "@items('Add_each_new_flow_action_detail')?['ActionType']",
                          "item/admin_actioninformation": "@items('Add_each_new_flow_action_detail')?['ActionInformation']",
                          "item/admin_Flow@odata.bind": "admin_flows(@{items('Add_each_new_flow_action_detail')?['FlowID']})",
                          "item/admin_flowactiondetaildeleted": false,
                          "item/admin_flowactiondetaildeletedon": "@null",
                          "item/admin_FlowActionDetailEnvrinment@odata.bind": "admin_environments(@{items('Add_each_new_flow_action_detail')?['EnvtID']})",
                          "item/admin_flowactiondetailmetadata": "@items('Add_each_new_flow_action_detail')?['Metadata']",
                          "item/admin_flowdetailmodifiedon": "@utcNow()",
                          "item/cr5d5_istypetrigger": "@items('Add_each_new_flow_action_detail')?['isTriggerType']",
                          "item/admin_operation": "@items('Add_each_new_flow_action_detail')?['Operation']"
                        },
                        "host": {
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                          "operationId": "CreateRecord",
                          "connectionName": "shared_commondataserviceforapps_2"
                        }
                      },
                      "metadata": {
                        "operationMetadataId": "51b15a00-bf2f-49dd-811c-faa20788f8f2"
                      }
                    }
                  },
                  "runAfter": {
                    "AddToInventory": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "18fd4890-5fbe-45fe-bc6e-6a709bc9184a"
                  }
                }
              },
              "runAfter": {
                "Remove_deleted_ones_from_inventory": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "405801a4-4fab-4fdc-8aab-14fa9f50a9bb"
              }
            },
            "Get_identity_for_permission_updates": {
              "type": "Scope",
              "actions": {
                "Get_my_id": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "$select": "id"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users",
                      "operationId": "MyProfile_V2",
                      "connectionName": "shared_office365users_1"
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "802ef483-01a5-42cf-b740-d6605076ce3d"
                  }
                }
              },
              "metadata": {
                "operationMetadataId": "6be130ad-b77f-497e-bc19-85a6243653f8"
              }
            },
            "Get_flows_to_update": {
              "type": "Scope",
              "actions": {
                "Flows_to_iterate": {
                  "type": "OpenApiConnection",
                  "inputs": {
                    "parameters": {
                      "entityName": "admin_flows",
                      "$select": "admin_flowid, _admin_flowenvironment_value, admin_flowmodifiedon, cr5d5_flowtrigger, admin_containsplaintextpassword, _admin_derivedowner_value, _admin_flowcreator_value",
                      "$filter": "admin_flowdeleted ne true and admin_inventorymyflowactiondetails eq true and _admin_flowenvironment_value eq @{triggerOutputs()?['body/admin_environmentid']} and admin_flowispublished ne false",
                      "$orderby": "admin_flowmodifiedon",
                      "$expand": "admin_FlowEnvironment($select=admin_environmentname)"
                    },
                    "host": {
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "connectionName": "shared_commondataserviceforapps_2"
                    }
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  },
                  "metadata": {
                    "operationMetadataId": "a3251373-d429-4865-b477-f353289526e6"
                  }
                }
              },
              "runAfter": {
                "Get_identity_for_permission_updates": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "6372fb9d-ed46-453e-b146-a90c3588a6f5"
              }
            }
          },
          "runAfter": {
            "Initialize_Collection_FlowsWithActions_Temporary": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "09955f7d-25e8-498e-9385-10a046ca3a2e"
          }
        },
        "Delay_Object_Inventory": {
          "type": "If",
          "expression": {
            "equals": [
              "@parameters('DelayObjectInventory (admin_DelayObjectInventory)')",
              true
            ]
          },
          "actions": {
            "Delay_1_to_300_minutes": {
              "type": "Wait",
              "description": "To avoid throttling of the backend to the tenant user, we will randomize the start time of these flows for tenants within a 5 hour range",
              "inputs": {
                "interval": {
                  "count": "@rand(1, 300)",
                  "unit": "Minute"
                }
              },
              "metadata": {
                "operationMetadataId": "f37a4a9d-c5b4-41ed-8484-636dca60ee81"
              }
            }
          },
          "else": {
            "actions": {}
          },
          "runAfter": {},
          "metadata": {
            "operationMetadataId": "49b3d120-232d-4694-b373-a97ecde35cc4"
          }
        },
        "Initialize_Collection_FlowsWithSpecialtyActions_Temporary": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "FlowsWithSpecialtyActionsTemp",
                "type": "array",
                "value": []
              }
            ]
          },
          "runAfter": {
            "Initialize_filterString": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "1a5c8df6-c822-4275-9dd1-a4cbce5090c6"
          }
        },
        "Initialize_Collection_FlowsWithActions_Temporary": {
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "FlowsWithActionsTemp",
                "type": "array",
                "value": []
              }
            ]
          },
          "runAfter": {
            "Initialize_Collection_FlowsWithSpecialtyActions_Temporary": [
              "Succeeded"
            ]
          }
        }
      },
      "outputs": {},
      "description": "This flow gets the actions and triggers for all flows. This flow uses Get Flow as Admin to get action and trigger details for every individual flow in your tenant. Thus, it can be a very time-consuming and resource-consuming flow to run. Turning on this flow is optional, and we recommend that you do so only to perform action-level reporting or analysis, such as reporting on who's using the Send Email action of the Microsoft 365 Outlook connector."
    },
    "templateName": null
  },
  "schemaVersion": "1.0.0.0"
}