DataflowScreen As screen:
    LoadingSpinnerColor: =RGBA(0, 120, 212, 1)
    OnVisible: |-
        =UpdateContext({showPanel: false})

    HistoryPanel As Panel:
        Buttons: |-
            =Table(
                {Label: "Delete", ButtonType:'Button.ButtonType'.Primary},
                {Label: "Cancel", ButtonType:'Button.ButtonType'.Standard}
            )
        Fill: =HistoryPanel.OverlayColor
        Height: =If(Self.Visible, App.Height, 0)
        OnButtonSelect: |-
            =Switch(Self.SelectedButton.Label,
            
            "Delete", 
            If(DeleteAll.Checked = true,
            RemoveIf(DataflowRefreshHistories, true);,
            RemoveIf(DataflowRefreshHistories, StartTime >= DeleteSince.Value || 'Created On' >= DeleteSince.Value));
            
            //close panel
            UpdateContext({showPanel: false});, //end Delete
            
            "Cancel", 
            //close panel
            UpdateContext({showPanel: false}); //end Cancel
            )
        OnCloseSelect: |-
            =UpdateContext({showPanel: false})
        Subtitle: =""
        Title: ="Remove Dataflow Refresh History"
        Visible: =showPanel
        Width: =If(Self.Visible, App.Width, 0)

    conMain As groupContainer.verticalAutoLayoutContainer:
        Height: =DataflowScreen.Height
        LayoutDirection: =LayoutDirection.Vertical
        LayoutMode: =LayoutMode.Auto
        Width: =DataflowScreen.Width
        ZIndex: =1

        ActionHeader As groupContainer.verticalAutoLayoutContainer:
            Fill: =RGBA(243, 242, 241, 1)
            FillPortions: =0
            Height: =44
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingLeft: =32
            PaddingRight: =32
            ZIndex: =1

            "CommandBar As 'Fluent Command Bar (1.0.22)'.pcfdataset":
                AlignInContainer: =AlignInContainer.Center
                DisplayMode: =DisplayMode.Edit
                FillPortions: =1
                Height: =32
                Items: |-
                    =Table(
                        {
                            ItemKey: "details",
                            ItemDisplayName: "Dataflow Details",
                            ItemIconName: "info",
                            ItemEnabled: true,
                            ItemVisible: true
                        },
                        {
                            ItemKey: "history",
                            ItemDisplayName: "Clean Up History",
                            ItemIconName: "FullHistory",
                            ItemEnabled: true,
                            ItemVisible: true
                        }
                    )
                LayoutMinHeight: =200
                LayoutMinWidth: =200
                OnChange: =false
                OnSelect: |-
                    =Switch(Self.Selected.ItemKey,
                    
                    "details",    
                        //browse to see dataflows
                        Launch(theAppMakerURL & "environments/" & varCoeEnvironment & "/dataintegration"),
                    
                    "history", 
                        UpdateContext({showPanel: true});
                    )
                Theme: =AppThemeJson
                Visible: =true
                Width: =Parent.Width - Parent.PaddingLeft - Parent.PaddingRight
                X: =0
                Y: =0
                ZIndex: =4

        HeaderDivider As rectangle:
            AlignInContainer: =AlignInContainer.Stretch
            BorderColor: =RGBA(166, 166, 166, 1)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            DisabledFill: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(225, 223, 221, 1)
            FocusedBorderColor: =RGBA(0, 120, 212, 1)
            Height: =1
            HoverFill: =RGBA(225, 223, 221, 1)
            PressedFill: =RGBA(225, 223, 221, 1)
            Width: =1366
            Y: =72
            ZIndex: =2

        Header_1 As groupContainer.verticalAutoLayoutContainer:
            FillPortions: =0
            Height: =100
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutDirection: =LayoutDirection.Vertical
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingLeft: =40
            PaddingRight: =40
            PaddingTop: =32
            ZIndex: =3

            Header_1lbl As Label:
                AutoHeight: =true
                Color: =
                DisplayMode: =DisplayMode.Edit
                FontSize: =18
                FontWeight: =FontWeight.Semibold
                Height: =43
                LayoutMinHeight: =32
                LayoutMinWidth: =320
                OnChange: =false
                PaddingStart: =0  
                Text: ="CoE dataflows"
                Width: =320
                X: =35
                Y: =15
                ZIndex: =1

        BodyContainer As groupContainer.horizontalAutoLayoutContainer:
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =20
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingLeft: =40
            PaddingRight: =40
            ZIndex: =4

            "FluentDetailsList1 As 'Fluent Details List (1.0.20)'.pcfdataset":
                AlignInContainer: =AlignInContainer.Stretch
                columns_Items: |-
                    =Table(
                        {
                            ColName: "msdyn_dataflowname",
                            ColDisplayName: "Name",
                            ColWidth: 200,
                            ColSortable: true,
                            ColResizable: true
                        },
                            {
                            ColName: "msdyn_endtime",
                            ColDisplayName: "Last refresh",
                            ColWidth: 200,
                            ColSortable: true,
                            ColResizable: true
                        },
                    {
                            ColName: "msdyn_refreshstatus",
                            ColDisplayName: "Refresh status",
                            ColWidth: 125,
                            ColRowHeader: true,
                            ColResizable: true,
                            ColSortable: true,
                            ColCellType: "tag",
                            ColTagColorColumn:  "theLastRunPassedTagColor",
                            ColTagBorderColorColumn: "theLastRunPassedTagBorderColor"
                        }
                        )
                Compact: =false
                DisplayMode: =DisplayMode.Edit
                FillPortions: =1
                Height: =200
                Items: =coeAddedDataflows
                LayoutMinHeight: =200
                LayoutMinWidth: =200
                OnChange: |-
                    =Switch(Self.EventColumn,
                    "open", Launch(theAppMakerURL & "environments/" & varCoeEnvironment & "/dataintegration"))
                SelectionType: ='PowerCAT.FluentDetailsList.SelectionType'.None
                Theme: =AppThemeJson
                Width: =200
                X: =0
                Y: =0
                ZIndex: =1

                open1 As pcfDataField.textualColumn:
                    FieldDisplayName: ="open"
                    FieldName: ="open"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =1
                    ZIndex: =3

                msdyn_refreshstatus1 As pcfDataField.textualColumn:
                    FieldDisplayName: ="msdyn_refreshstatus"
                    FieldName: ="msdyn_refreshstatus"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =2
                    ZIndex: =4

                msdyn_endtime1 As pcfDataField.textualColumn:
                    FieldDisplayName: ="msdyn_endtime"
                    FieldName: ="msdyn_endtime"
                    FieldType: ="d"
                    FieldVariantName: ="textualColumn"
                    Order: =3
                    ZIndex: =5

                msdyn_dataflowname1 As pcfDataField.textualColumn:
                    FieldDisplayName: ="msdyn_dataflowname"
                    FieldName: ="msdyn_dataflowname"
                    FieldType: ="s"
                    FieldVariantName: ="textualColumn"
                    Order: =4
                    ZIndex: =6

    Dialog_1 As Dialog:
        Buttons: =
        ContentWidth: =Dialog_1.DialogWidth
        ContentX: = Dialog_1.Width/2-Dialog_1.DialogWidth/2
        ContentY: = Dialog_1.Height/2-Dialog_1.DialogHeight/2+DialogHeaderContainer.Height + Label3_1.Height
        Description: ="You have currently configured your CoE kit to receive inventory information via cloud flows (sync flows). There's no dataflows to monitor for this option. If you want to change your setup to use the Data Export feature for inventory, open the Setup Wizard and configure the data source there."
        Fill: =Dialog_1.OverlayColor
        Height: =If(Self.Visible, App.Height, 0)
        OnButtonSelect: =
        OnCloseSelect: =true
        SubTitle: ="You have currently configured your CoE kit to receive inventory information via cloud flows (sync flows). There's no dataflows to monitor for this option. If you want to change your setup to use the Data Export feature for inventory, open the Setup Wizard and configure the data source there."
        Title: ="No dataflows required"
        Visible: =theInventorySelection = "no"
        Width: =If(Self.Visible, App.Width, 0)
        ZIndex: =2

    HistoryPanelContentContainer As groupContainer.verticalAutoLayoutContainer:
        Height: =HistoryPanel.ContentHeight
        LayoutAlignItems: =LayoutAlignItems.Stretch
        LayoutDirection: =LayoutDirection.Vertical
        LayoutMode: =LayoutMode.Auto
        PaddingLeft: =20
        PaddingRight: =20
        PaddingTop: =10
        Visible: =HistoryPanel.Visible
        Width: =HistoryPanel.ContentWidth - 20
        X: =HistoryPanel.ContentX
        Y: =HistoryPanel.ContentY
        ZIndex: =4

        DeleteAllHistory As Label:
            Color: =
            DisplayMode: =DisplayMode.Edit
            Height: =32
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            OnChange: =false
            Text: ="Delete All History"
            Width: =320
            X: =0
            Y: =0
            ZIndex: =1

        DeleteAll As Toggle:
            DisplayMode: =DisplayMode.Edit
            HandleOffFillColor: =
            HandleOnFillColor: =
            Height: =32
            LayoutMinHeight: =32
            LayoutMinWidth: =160
            OffFillColor: =
            OffHoverFillColor: =
            OffText: ="No do not delete all"
            OnCheck: =false
            OnFillColor: =
            OnHoverFillColor: =
            OnText: ="Yes delete all"
            OnUncheck: =false
            TextColor: =
            Width: =160
            X: =0
            Y: =0
            ZIndex: =2

        DeleteAll_Buffer As Label:
            Color: =
            DisplayMode: =DisplayMode.Edit
            Height: =15
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            OnChange: =false
            Text: =""
            Visible: =true
            Width: =320
            X: =0
            Y: =0
            ZIndex: =3

        DeleteSinceRecords As Label:
            Color: =
            DisplayMode: =DisplayMode.Edit
            Height: =32
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            OnChange: =false
            OnSelect: =false
            Text: ="Delete Records Newer Than"
            Visible: =DeleteAll.Checked = false
            Width: =320
            X: =0
            Y: =0
            ZIndex: =4

        "DeleteSince As 'Date picker'":
            DisplayMode: =DisplayMode.Edit
            FillColor: =
            Height: =32
            IconFill: =
            LayoutMinHeight: =32
            LayoutMinWidth: =210
            TextColor: =
            Value: =Today()-3
            Visible: =DeleteAll.Checked = false
            Width: =210
            X: =0
            Y: =0
            ZIndex: =5

        DeleteSince_Buffer As Label:
            Color: =
            DisplayMode: =DisplayMode.Edit
            Height: =15
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            OnChange: =false
            OnSelect: =false
            Text: =""
            Visible: =DeleteAll.Checked = false
            Width: =320
            X: =0
            Y: =0
            ZIndex: =6

        ViewHistory_Buffer As Label:
            Color: =
            DisplayMode: =DisplayMode.Edit
            Height: =15
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            OnChange: =false
            OnSelect: =false
            Text: =""
            Visible: =true
            Width: =320
            X: =0
            Y: =0
            ZIndex: =7

        ViewHistory As Label:
            Color: =
            DisplayMode: =DisplayMode.Edit
            Height: =32
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            OnChange: =false
            Text: |-
                ="History:"
            Visible: =true
            Width: =320
            X: =0
            Y: =0
            ZIndex: =8

        History As gallery.BrowseLayout_Vertical_TwoTextOneImageVariant_pcfCore:
            '#CopilotOverlayLabel': ="Filtered"
            BorderColor: =RGBA(166, 166, 166, 1)
            DelayItemLoading: =true
            FocusedBorderColor: =RGBA(0, 120, 212, 1)
            FocusedBorderThickness: =2
            Items: =SortByColumns(DataflowRefreshHistories, "msdyn_starttime", SortOrder.Descending)
            Layout: =Layout.Vertical
            LayoutMinHeight: =287
            LayoutMinWidth: =320
            LoadingSpinner: =LoadingSpinner.Data
            TemplatePadding: =0
            TemplateSize: =48
            ZIndex: =9

            Rectangle2 As rectangle:
                BorderColor: =RGBA(166, 166, 166, 1)
                DisabledFill: =RGBA(0,0,0,0)
                Fill: =RGBA(0,0,0,0)
                FocusedBorderColor: =RGBA(0, 120, 212, 1)
                Height: =Parent.TemplateHeight
                HoverFill: =RGBA(0,0,0,0)
                OnSelect: =Select(Parent)
                PressedFill: =RGBA(0,0,0,0)
                TabIndex: =0
                Width: =Parent.TemplateWidth
                ZIndex: =1

            Title2 As Label:
                Color: =
                DisplayMode: =DisplayMode.Edit
                FontSize: =10.5
                FontWeight: =FontWeight.Semibold
                Height: =24
                OnChange: =false
                OnSelect: =Select(Parent)
                TabIndex: =-1
                Text: =ThisItem.DataflowName
                VerticalAlignment: =VerticalAlign.Top
                Width: =Parent.TemplateWidth - Self.X - 8
                X: =12
                Y: =((Parent.TemplateHeight - 36) / 2) - 4
                ZIndex: =3

            Subtitle2 As Label:
                Color: =
                DisplayMode: =DisplayMode.Edit
                FontSize: =9
                FontWeight: =FontWeight.Normal
                Height: =24
                OnChange: =false
                OnSelect: =Select(Parent)
                TabIndex: =-1
                Text: =ThisItem.StartTime
                VerticalAlignment: =VerticalAlign.Top
                Width: =Title2.Width
                X: =Title2.X
                Y: =Title2.Y + Title2.Height - 6
                ZIndex: =4

