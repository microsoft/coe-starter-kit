HomeScreen As screen:
    OnVisible: |-
        =Set(ReadyToGo, false);
        
        Set( Style, {
            Primary:"#70daef",
            Secondary:"#8fcad6",
            Tertiary:"#ededed",
            PrimaryTextColor:"#000000",
            Logo:"http://pngimg.com/uploads/microsoft/microsoft_PNG16.png"
        });
        
        //get app maker url
        Set(EnvVarDefnID, LookUp('Environment Variable Definitions', 'Schema Name'="admin_PowerAppEnvironmentVariable").'Environment Variable Definition');
        Set(theAppMakerURL, First(Filter('Environment Variable Values', 'Environment Variable Definition'.'Environment Variable Definition'=GUID(EnvVarDefnID))).Value);
        If(IsBlank(theAppMakerURL), Set(theAppMakerURL, LookUp('Environment Variable Definitions', 'Environment Variable Definition'=GUID(EnvVarDefnID)).'Default Value'));
        
        //create navigation collection
        ClearCollect(
            appFilter,
            { Title: "Permissions", id: 0, launch: ""},
            { Title: "Maker Portal", id: 1, launch: ""},
            { Title: "Delete", id: 2, launch: ""},
            { Title: "eMail Maker", id: 0, launch: ""});
        
        UpdateContext({showAddUsers:false, showPermissions:true, showArchive:false, showDelete:false, showMakerPortal: false, showEmail: false});
        UpdateContext({showCantShowThat: false, CantShowThatText: ""});
        
        //get user and app
        Set(myUserProfile, Office365Users.MyProfileV2());
        If(IsBlank(First([@PowerBIIntegration].Data).admin_appid), 
           Set(selectedAppID, "003014e9-8875-428f-bb17-0139bc168acc");
           Set(envName, "12ca3475-c509-e18d-9dfa-dd949c00a21d");
        , 
           Set(selectedAppID, GUID(First([@PowerBIIntegration].Data).admin_appid));
           Set(envName, First([@PowerBIIntegration].Data).admin_environmentname);
        );
        Set(selectedApp, PowerAppsforAdmins.GetAdminApp(envName, selectedAppID));
        
        ClearCollect(appRoles, PowerAppsforAdmins.GetAdminAppRoleAssignment(envName, selectedAppID).value );
           If(CountIf(appRoles, properties.principal.id = myUserProfile.id)>0,
             Set(iHaveAccess, true)
           );
        
        Set(ReadyToGo, true);

    galTabs As gallery.galleryHorizontal:
        AccessibleLabel: ="Navigation"
        BorderColor: =RGBA(166, 166, 166, 1)
        DisabledBorderColor: =galTabs.BorderColor
        DisabledFill: =galTabs.Fill
        DisplayMode: =Edit
        Height: =58
        HoverBorderColor: =galTabs.BorderColor
        HoverFill: =galTabs.Fill
        Items: =SortByColumns(appFilter, "id")
        LoadingSpinnerColor: =galTabs.BorderColor
        OnSelect: |-
            =Switch(ThisItem.Title,
            "Permissions", UpdateContext({showPermissions:true, showArchive:false, showDelete: false, showMakerPortal:false, showEmail: false}),
            "Archive", UpdateContext({showPermissions:false, showArchive:true, showDelete: false, showMakerPortal:false, showEmail: false}),
            "Delete", UpdateContext({showPermissions:false, showArchive:false, showDelete: true, showMakerPortal:false, showEmail: false}),
            "Maker Portal", UpdateContext({showPermissions:false, showArchive:false, showDelete: false, showMakerPortal:true, showEmail: false}),
            "eMail Maker", UpdateContext({showPermissions:false, showArchive:false, showDelete: false, showMakerPortal:false, showEmail: true}),
            UpdateContext({showPermissions:true, showArchive:false, showDelete: false}));
        PressedBorderColor: =galTabs.BorderColor
        PressedFill: =galTabs.Fill
        ShowScrollbar: =false
        TabIndex: =1
        TemplateSize: =234
        Width: =1136
        ZIndex: =1

        Label3_2 As label:
            Align: =Center
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            Color: =RGBA(51, 51, 51, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            FocusedBorderColor: =Label3_2.BorderColor
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            Height: =39
            HoverBorderColor: =Label3_2.BorderColor
            HoverColor: =Label3_2.Color
            HoverFill: =Label3_2.Fill
            OnSelect: =Select(Parent)
            PaddingLeft: =0
            PressedBorderColor: =Label3_2.BorderColor
            PressedColor: =Label3_2.Color
            PressedFill: =Label3_2.Fill
            Size: =18
            Text: =ThisItem.Title
            Width: =197
            Y: =5
            ZIndex: =1

        rectUnderline_1 As rectangle:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            DisabledFill: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(0, 134, 208, 1)
            FocusedBorderColor: =rectUnderline_1.BorderColor
            FocusedBorderThickness: =4
            Height: =4
            HoverFill: =RGBA(105, 121, 126, 1)
            OnSelect: =Select(Parent)
            PressedFill: =RGBA(105, 121, 126, 1)
            Visible: =ThisItem.IsSelected
            Width: =Label3_2.Width
            Y: =44
            ZIndex: =2

    grpPermissions As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =19

        galAppRoles As gallery.galleryVertical:
            AccessibleLabel: ="Existing permissions for this app"
            BorderColor: =RGBA(204, 204, 204, 1)
            BorderStyle: =Solid
            BorderThickness: =1
            DisabledBorderColor: =galAppRoles.BorderColor
            DisabledFill: =galAppRoles.Fill
            Fill: =RGBA(255, 255, 255, 1)
            Height: =506
            HoverBorderColor: =galAppRoles.BorderColor
            HoverFill: =galAppRoles.Fill
            Items: =appRoles
            Layout: =Layout.Vertical
            LoadingSpinnerColor: =galAppRoles.BorderColor
            PressedBorderColor: =galAppRoles.BorderColor
            PressedFill: =galAppRoles.Fill
            TabIndex: =2
            TemplateSize: =86
            Visible: =showPermissions
            Width: =1136
            Y: =58
            ZIndex: =2

            lblUserName As label:
                BorderColor: =RGBA(218,218,218,1.00)
                BorderStyle: =BorderStyle.None
                Color: =RGBA(47,41,43,1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                FocusedBorderColor: =lblUserName.BorderColor
                Font: =Font.'Segoe UI'
                Height: =86
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverColor: =RGBA(4,45,81,1.00)
                HoverFill: =RGBA(0, 0, 0, 0)
                OnSelect: =Select(Parent)
                PressedBorderColor: =RGBA(0, 0, 0, 0)
                PressedColor: =RGBA(4,45,81,1.00)
                PressedFill: =RGBA(0, 0, 0, 0)
                Size: =18
                Text: |-
                    =If(ThisItem.properties.principal.type = "Tenant", "Entire Org",
                    If(ThisItem.properties.principal.type = "Group", "Group: " & ThisItem.properties.principal.displayName,
                    ThisItem.properties.principal.displayName))
                Width: =492
                X: =98
                ZIndex: =2

            imgUserProfile As image:
                BorderColor: =ColorFade(imgUserProfile.Fill,-20%)
                DisabledBorderColor: =RGBA(159, 167, 165, 1)
                DisabledFill: =RGBA(193, 193, 193, 0.95)
                Fill: =RGBA(244, 244, 244, 1)
                FocusedBorderColor: =imgUserProfile.BorderColor
                Height: =60
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverFill: =RGBA(0, 0, 0, 0)
                Image: |-
                    =If(ThisItem.properties.principal.type <> "User", SampleImage,
                    If(CountRows(Filter('Power Platform Users', 'Power Platform User'=GUID(ThisItem.properties.principal.id))) = 0, SampleImage, 
                    LookUp('Power Platform Users', 'Power Platform User'=GUID(ThisItem.properties.principal.id)).PhotoObject))
                ImagePosition: =ImagePosition.Fill
                OnSelect: =Select(Parent)
                PaddingBottom: =imgUserProfile.PaddingTop
                PaddingLeft: =imgUserProfile.PaddingTop
                PaddingRight: =imgUserProfile.PaddingTop
                PaddingTop: =10
                PressedBorderColor: =RGBA(0, 0, 0, 0)
                PressedFill: =RGBA(0, 0, 0, 0)
                Width: =64
                X: =14
                Y: =13
                ZIndex: =4

            lblRole As label:
                BorderColor: =RGBA(218,218,218,1.00)
                BorderStyle: =BorderStyle.None
                Color: =RGBA(47,41,43,1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                FocusedBorderColor: =lblRole.BorderColor
                Font: =Font.'Segoe UI'
                Height: =86
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverColor: =RGBA(4,45,81,1.00)
                HoverFill: =RGBA(0, 0, 0, 0)
                OnSelect: =Select(Parent)
                PressedBorderColor: =RGBA(0, 0, 0, 0)
                PressedColor: =RGBA(4,45,81,1.00)
                PressedFill: =RGBA(0, 0, 0, 0)
                Size: =18
                Text: |-
                    ="Role: "&ThisItem.properties.roleName
                Width: =295
                X: =590
                ZIndex: =5

            btnMakeOwner As button:
                BorderColor: =RGBA(0, 0, 0, 0)
                BorderStyle: =BorderStyle.None
                Color: =RGBA(0, 0, 0, 1)
                DisabledBorderColor: =RGBA(0, 0, 0, 0)
                Fill: =ColorValue(Style.Primary)
                FocusedBorderColor: =btnMakeOwner.BorderColor
                Font: =Font.'Segoe UI'
                FontWeight: =Semibold
                Height: =41
                HoverBorderColor: =RGBA(0, 0, 0, 0)
                HoverFill: =ColorValue(Style.Secondary)
                OnSelect: |-
                    =//call helper to reassign
                    UpdateContext({theHelperReturnString:'HELPER-ObjectOperations'.Run(ThisItem.name, selectedAppID, envName, "assign", "app").thereturnstring});
                    If(theHelperReturnString="pass",
                    
                    ClearCollect(
                        appRoles,
                        PowerAppsforAdmins.GetAdminAppRoleAssignment(
                            envName,
                            selectedAppID
                        ).value);, 
                    
                    //else show error message
                    UpdateContext({showCantShowThat: true, CantShowThatText: theHelperReturnString}));
                PaddingBottom: =10
                PaddingLeft: =10
                PaddingRight: =10
                PaddingTop: =10
                PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -50%)
                PressedColor: =RGBA(255, 255, 255, 1)
                PressedFill: =ColorFade(btnMakeOwner.Fill, -30%)
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Size: =20
                Text: ="Make Owner"
                Visible: =If(ThisItem.properties.roleName = "Owner", false, true)
                Width: =226
                X: =885
                Y: =22
                ZIndex: =8

        btnGrantAccessToApp As button:
            BorderColor: =ColorFade(btnGrantAccessToApp.Fill, -15%)
            BorderStyle: =BorderStyle.None
            Color: =RGBA(0, 0, 0, 1)
            Fill: =ColorValue(Style.Primary)
            FocusedBorderColor: =btnGrantAccessToApp.BorderColor
            Font: =Font.'Segoe UI'
            Height: =48
            HoverBorderColor: =ColorFade(btnGrantAccessToApp.BorderColor, 20%)
            HoverFill: =ColorValue(Style.Secondary)
            OnSelect: |-
                =If(iHaveAccess ,
                   PowerAppsforAdmins.EditAdminAppRoleAssignment(envName, GUID(selectedAppID), 
                   {  
                       delete: Table({ id: myUserProfile.id }) 
                   });
                   Set(iHaveAccess, false);
                ,
                   PowerAppsforAdmins.EditAdminAppRoleAssignment(envName, GUID(selectedAppID),
                   {
                       put: Table(
                          {
                            properties: {
                                principal: {
                                    id: myUserProfile.id,
                                    displayName: myUserProfile.displayName,
                                    email: myUserProfile.mail,
                                    type: "User",
                                    tenantId: ""
                                },
                                roleName: "CanEdit",
                                NotifyShareTargetOption: GUID(Blank()),
                                capabilities: Table({
                                    Value: ""
                                })
                            }
                          }
                      )
                   });
                   Set(iHaveAccess, true)
                
                );
                 ClearCollect(appRoles, PowerAppsforAdmins.GetAdminAppRoleAssignment(envName, selectedAppID).value)
            PressedBorderColor: =btnGrantAccessToApp.Fill
            PressedColor: =RGBA(255, 255, 255, 1)
            PressedFill: =ColorFade(btnMakeOwner.Fill, -30%)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =20
            TabIndex: =2
            Text: |-
                =If(iHaveAccess,
                "Remove My Access",
                "Grant Myself Access"
                )
            Visible: =showPermissions
            Width: =323
            X: =469
            Y: =579
            ZIndex: =3

        lblNoAccess As label:
            Align: =Right
            FocusedBorderColor: =lblNoAccess.BorderColor
            Font: =Font.'Segoe UI'
            Height: =61
            HoverBorderColor: =lblNoAccess.BorderColor
            HoverColor: =lblNoAccess.Color
            HoverFill: =lblNoAccess.Fill
            PressedBorderColor: =lblNoAccess.BorderColor
            PressedColor: =lblNoAccess.Color
            PressedFill: =lblNoAccess.Fill
            Size: =20
            TabIndex: =2
            Text: |-
                =If(iHaveAccess,
                "You can manage this app ✔ ",
                "You have no access to this app ❌ "
                )
            Visible: =showPermissions
            Width: =469
            Y: =572
            ZIndex: =4

        btnGrantAccessToApp_1 As button:
            BorderColor: =ColorFade(btnGrantAccessToApp_1.Fill, -15%)
            BorderStyle: =BorderStyle.None
            Color: =RGBA(0, 0, 0, 1)
            Fill: =ColorValue(Style.Primary)
            FocusedBorderColor: =btnGrantAccessToApp_1.BorderColor
            Font: =Font.'Segoe UI'
            Height: =48
            HoverBorderColor: =ColorFade(btnGrantAccessToApp_1.BorderColor, 20%)
            HoverFill: =ColorValue(Style.Secondary)
            OnSelect: |-
                =UpdateContext({showAddUsers: true})
            PressedBorderColor: =btnGrantAccessToApp_1.Fill
            PressedColor: =RGBA(255, 255, 255, 1)
            PressedFill: =ColorFade(btnMakeOwner.Fill, -30%)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =20
            TabIndex: =2
            Text: ="Add New Users"
            Visible: =showPermissions
            Width: =323
            X: =798
            Y: =579
            ZIndex: =5

    grpAddNewUser As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =21

        bkgPopUp As rectangle:
            DisabledFill: =bkgPopUp.Fill
            Fill: =RGBA(0, 0, 0, 0.35)
            FocusedBorderColor: =bkgPopUp.BorderColor
            Height: =640
            HoverFill: =bkgPopUp.Fill
            PressedFill: =bkgPopUp.Fill
            TabIndex: =4
            Visible: =showAddUsers
            Width: =1136
            ZIndex: =14

        bkgAddNewUsers As rectangle:
            DisabledFill: =bkgAddNewUsers.Fill
            Fill: =RGBA(244, 244, 244, 1)  
            FocusedBorderColor: =bkgAddNewUsers.BorderColor
            Height: =582
            HoverFill: =bkgAddNewUsers.Fill
            PressedFill: =bkgAddNewUsers.Fill
            TabIndex: =4
            Visible: =showAddUsers
            Width: =1053
            X: =38
            Y: =18
            ZIndex: =15

        lblAddNewUsers As label:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            FocusedBorderColor: =lblAddNewUsers.BorderColor
            FocusedBorderThickness: =4
            Font: =Font.'Segoe UI'
            FontWeight: =Bold
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverColor: =RGBA(0,0,0,1.00)
            HoverFill: =RGBA(0, 0, 0, 0)
            PaddingLeft: =0
            PressedBorderColor: =RGBA(0, 0, 0, 0)
            PressedColor: =RGBA(0,0,0,1.00)
            PressedFill: =RGBA(0, 0, 0, 0)
            Size: =20
            TabIndex: =4
            Text: ="Add New Users"
            Visible: =showAddUsers
            Width: =266
            X: =46
            Y: =18
            ZIndex: =16

        txtSearchUser As text:
            AccessibleLabel: ="Search for a user by name"
            Align: =Center
            BorderColor: =RGBA(220,220,220,1)
            BorderThickness: =1
            Color: =Black
            Default: =""
            DisabledBorderColor: =RGBA(159, 167, 165, 1)
            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70%)
            DisabledFill: =ColorFade(RGBA(159, 167, 165, 1), 50%)
            DisplayMode: =If(false,DisplayMode.View,DisplayMode.Edit)
            FocusedBorderColor: =txtSearchUser.BorderColor
            FocusedBorderThickness: =1
            Font: =Font.'Segoe UI'
            FontWeight: =Lighter
            Height: =50
            HintText: ="Type a name or an email address"
            HoverBorderColor: =RGBA(159,159,159,1)
            HoverColor: =Black
            HoverFill: =White
            OnSelect: =
            PressedBorderColor: =txtSearchUser.HoverBorderColor
            PressedColor: =txtSearchUser.Color
            PressedFill: =txtSearchUser.Fill
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Reset: =clearSearchField
            Size: =20
            TabIndex: =4
            Tooltip: ="Search people input field"
            Visible: =showAddUsers
            Width: =1012
            X: =61
            Y: =106
            ZIndex: =17

        galSearchPeopleresult As gallery.galleryVertical:
            AccessibleLabel: ="Search result"
            BorderColor: =RGBA(233, 232, 233, 1)
            BorderStyle: =BorderStyle.None
            DisabledBorderColor: =galSearchPeopleresult.BorderColor
            DisabledFill: =galSearchPeopleresult.Fill
            Height: =277
            HoverBorderColor: =galSearchPeopleresult.BorderColor
            HoverFill: =galSearchPeopleresult.Fill
            Items: =If(Len(txtSearchUser.Text) > 3,searchResultsCol)
            Layout: =Layout.Vertical
            LoadingSpinnerColor: =galSearchPeopleresult.BorderColor
            OnSelect: =
            PressedBorderColor: =galSearchPeopleresult.BorderColor
            PressedFill: =galSearchPeopleresult.Fill
            TabIndex: =4
            TemplateFill: =If(ThisItem.IsSelected, ColorValue(Style.Primary), White)
            TemplateSize: =96
            Visible: =showAddUsers
            Width: =1012
            X: =59
            Y: =164
            ZIndex: =18

            imgSearchProfilePic As image:
                AccessibleLabel: ="Profile picture"
                ApplyEXIFOrientation: =false
                BorderColor: =RGBA(101, 128, 187, 1)
                DisabledBorderColor: =RGBA(159, 167, 165, 1)
                DisabledFill: =RGBA(193, 193, 193, 0.95)
                Fill: =RGBA(230, 230, 230, 1)
                FocusedBorderColor: =imgSearchProfilePic.BorderColor
                Height: =80
                HoverBorderColor: =ColorFade(imgSearchProfilePic.BorderColor, 20%)
                HoverFill: =ColorFade(imgSearchProfilePic.Fill, 20%)
                Image: |-
                    =If(!IsBlank(ThisItem.UserPrincipalName), Office365Users.UserPhotoV2(ThisItem.UserPrincipalName))  //If(IsBlank(TextBox_hiddenImageState.Text),'preload - user',"data:image/jpeg;base64," & TextBox_hiddenImageState.Text)
                ImagePosition: =ImagePosition.Fill
                PressedBorderColor: =ColorFade(imgSearchProfilePic.BorderColor, -20%)
                PressedFill: =ColorFade(imgSearchProfilePic.Fill, -20%)
                RadiusBottomLeft: =40
                RadiusBottomRight: =40
                RadiusTopLeft: =40
                RadiusTopRight: =40
                TabIndex: =0
                Width: =80
                X: =6
                Y: =9
                ZIndex: =5

            lblSearchEmail As label:
                FocusedBorderColor: =lblSearchEmail.BorderColor
                Font: =Font.'Segoe UI'
                Height: =41
                HoverBorderColor: =lblSearchEmail.BorderColor
                HoverColor: =lblSearchEmail.Color
                HoverFill: =lblSearchEmail.Fill
                OnSelect: =Select(Parent)
                PressedBorderColor: =lblSearchEmail.BorderColor
                PressedColor: =lblSearchEmail.Color
                PressedFill: =lblSearchEmail.Fill
                Size: =18
                Text: =ThisItem.UserPrincipalName
                Width: =902
                X: =100
                Y: =47
                ZIndex: =9

            lblSearchName As label:
                FocusedBorderColor: =lblSearchName.BorderColor
                Font: =Font.'Segoe UI'
                FontWeight: =Bold
                Height: =48
                HoverBorderColor: =lblSearchName.BorderColor
                HoverColor: =lblSearchName.Color
                HoverFill: =lblSearchName.Fill
                OnSelect: =Select(Parent)
                PressedBorderColor: =lblSearchName.BorderColor
                PressedColor: =lblSearchName.Color
                PressedFill: =lblSearchName.Fill
                Size: =20
                Text: =ThisItem.GivenName & " " & ThisItem.Surname
                Width: =902
                X: =100
                Y: =9
                ZIndex: =10

        iSearch As icon.Search:
            BorderColor: =RGBA(101, 128, 187, 1)
            Color: =RGBA(220,220,220,1)
            DisabledBorderColor: =RGBA(159, 167, 165, 1)
            DisabledColor: =RGBA(193, 193, 193, 0.95)
            DisabledFill: =iSearch.Fill
            FocusedBorderColor: =iSearch.BorderColor
            Height: =50
            HoverBorderColor: =ColorFade(iSearch.BorderColor, 20%)
            HoverColor: =ColorFade(iSearch.Color, 20%)
            HoverFill: =iSearch.Fill
            Icon: =Icon.Search
            PaddingBottom: =5
            PaddingLeft: =5
            PaddingRight: =5
            PaddingTop: =5
            PressedBorderColor: =ColorFade(iSearch.BorderColor, -20%)
            PressedColor: =ColorFade(iSearch.Color, -20%)
            PressedFill: =iSearch.Fill
            TabIndex: =4
            Visible: =showAddUsers
            Width: =50
            X: =73
            Y: =106
            ZIndex: =20

        lblFetchingData As label:
            BorderColor: =RGBA(101, 128, 187, 1)
            Color: =RGBA(47,41,43,1)
            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70%)
            FocusedBorderColor: =lblFetchingData.BorderColor
            Font: =Font.Arial
            Height: =35
            HoverBorderColor: =lblFetchingData.BorderColor
            HoverColor: =lblFetchingData.Color
            HoverFill: =lblFetchingData.Fill
            PressedBorderColor: =lblFetchingData.BorderColor
            PressedColor: =lblFetchingData.Color
            PressedFill: =lblFetchingData.Fill
            Size: =18
            TabIndex: =4
            Text: =searchStatus
            Visible: =false
            Width: =300
            X: =61
            Y: =156
            ZIndex: =22

        imgClearInput As image:
            AccessibleLabel: ="Clear search input"
            ApplyEXIFOrientation: =false
            BorderColor: =RGBA(101, 128, 187, 1)
            DisabledBorderColor: =RGBA(159, 167, 165, 1)
            DisabledFill: =RGBA(193, 193, 193, 0.95)
            FocusedBorderColor: =imgClearInput.BorderColor
            Height: =txtSearchUser.Height
            HoverBorderColor: =ColorFade(imgClearInput.BorderColor, 20%)
            HoverFill: =ColorFade(imgClearInput.Fill, 20%)
            Image: =closedark
            OnSelect: |-
                =UpdateContext({clearSearchField:false});UpdateContext({clearSearchField:true})
            PaddingBottom: =15
            PaddingLeft: =15
            PaddingRight: =15
            PaddingTop: =15
            PressedBorderColor: =ColorFade(imgClearInput.BorderColor, -20%)
            PressedFill: =ColorFade(imgClearInput.Fill, -20%)
            TabIndex: =4
            Visible: =showAddUsers
            Width: =txtSearchUser.Height
            X: =992
            Y: =106
            ZIndex: =23

        tmrSearch As timer:
            BorderColor: =RGBA(0, 0, 0, 1)
            DisabledBorderColor: =RGBA(56, 56, 56, 1)
            DisabledColor: =RGBA(186, 186, 186, 1)
            DisabledFill: =RGBA(119, 119, 119, 1)
            DisplayMode: =If(false,DisplayMode.View,DisplayMode.Edit)
            Duration: =300
            Fill: =RGBA(69, 69, 69, 1)
            FocusedBorderColor: =tmrSearch.BorderColor
            HoverBorderColor: =ColorFade(tmrSearch.BorderColor, 20%)
            HoverColor: =tmrSearch.Color
            HoverFill: =ColorFade(tmrSearch.Fill, 20%)
            OnTimerEnd: |-
                =If(
                    Len(txtSearchUser.Text) = searchTextCount,
                    ClearCollect(
                        searchResultsCol,       
                            Office365Users.SearchUser({searchTerm: PlainText(txtSearchUser.Text)})
                        
                    );
                    If(
                        IsEmpty(searchResultsCol),
                        UpdateContext({searchStatus: "No match found"}),
                        UpdateContext({searchStatus: "Match found"})
                    )
                )
            OnTimerStart: |-
                =UpdateContext({searchStatus:"Searching...",searchTextCount:Len(txtSearchUser.Text)})
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            PressedBorderColor: =ColorFade(tmrSearch.BorderColor, -20%)
            PressedColor: =tmrSearch.Color
            PressedFill: =ColorFade(tmrSearch.Fill, -20%)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Repeat: =Len(txtSearchUser.Text)> 2 && Len(txtSearchUser.Text) <> searchTextCount
            Size: =11
            Start: =Len(txtSearchUser.Text) > 2
            TabIndex: =4
            Text: |-
                =Text(Time(0, 0, tmrSearch.Value/1000), "hh:mm:ss")
            Visible: =false
            Width: =150
            X: =251
            Y: =209
            ZIndex: =24

        lblSelectedUserRole As label:
            FocusedBorderColor: =lblSelectedUserRole.BorderColor
            Font: =Font.'Segoe UI'
            FontWeight: =Bold
            Height: =65
            HoverBorderColor: =lblSelectedUserRole.BorderColor
            HoverColor: =lblSelectedUserRole.Color
            HoverFill: =lblSelectedUserRole.Fill
            PressedBorderColor: =lblSelectedUserRole.BorderColor
            PressedColor: =lblSelectedUserRole.Color
            PressedFill: =lblSelectedUserRole.Fill
            Size: =18
            TabIndex: =4
            Text: |-
                ="Selected User Role:"
            Visible: =showAddUsers
            Width: =257
            X: =74
            Y: =420
            ZIndex: =26

        lblNote As label:
            FocusedBorderColor: =lblNote.BorderColor
            Font: =Font.'Segoe UI'
            Height: =65
            HoverBorderColor: =lblNote.BorderColor
            HoverColor: =lblNote.Color
            HoverFill: =lblNote.Fill
            PressedBorderColor: =lblNote.BorderColor
            PressedColor: =lblNote.Color
            PressedFill: =lblNote.Fill
            Size: =18
            TabIndex: =4
            Text: |-
                ="Note: You can make them an app owner after you've added them as a user."
            Visible: =showAddUsers
            Width: =995
            X: =74
            Y: =477
            ZIndex: =28

        btnAddUser As button:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            Color: =RGBA(0, 0, 0, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            DisplayMode: =If( IsEmpty(galSearchPeopleresult.Selected), DisplayMode.Disabled, DisplayMode.Edit)
            Fill: =ColorValue(Style.Primary)
            FocusedBorderColor: =btnAddUser.BorderColor
            Font: =Font.'Segoe UI'
            FontWeight: =Semibold
            Height: =41
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverFill: =ColorValue(Style.Secondary)
            OnSelect: |
                =UpdateContext({UpdatePermissionsPassed: 'HELPER-ObjectOperations'.Run(galSearchPeopleresult.Selected.Id, selectedAppID, envName, If(drpSearchUserRole.SelectedText.Value = "CanView", "addviewer", "addeditor"), "app").thereturnstring});
                
                
                //update app if succeess
                If(UpdatePermissionsPassed = "pass",
                  Refresh('Power Platform Users');
                  ClearCollect(appRoles, PowerAppsforAdmins.GetAdminAppRoleAssignment(envName, selectedAppID).value);,
                
                //else show error message
                UpdateContext({showCantShowThat: true, CantShowThatText: UpdatePermissionsPassed}));
                
                //close dialog
                UpdateContext({showAddUsers: false})
            PaddingBottom: =10
            PaddingLeft: =10
            PaddingRight: =10
            PaddingTop: =10
            PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -50%)
            PressedColor: =RGBA(255, 255, 255, 1)
            PressedFill: =ColorFade(btnAddUser.Fill, -30%)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =18
            TabIndex: =4
            Text: ="Add User"
            Visible: =showAddUsers
            Width: =173
            X: =707
            Y: =538
            ZIndex: =29

        btnCancelAddUser As button:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            Color: =RGBA(0, 0, 0, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            Fill: =ColorValue(Style.Tertiary)
            FocusedBorderColor: =btnCancelAddUser.BorderColor
            Font: =Font.'Segoe UI'
            FontWeight: =Semibold
            Height: =41
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverFill: =ColorValue(Style.Secondary)
            OnSelect: |-
                =UpdateContext({showAddUsers: false})
            PaddingBottom: =10
            PaddingLeft: =10
            PaddingRight: =10
            PaddingTop: =10
            PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -50%)
            PressedColor: =RGBA(255, 255, 255, 1)
            PressedFill: =ColorFade(btnCancelAddUser.Fill, -30%)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =18
            TabIndex: =4
            Text: ="Cancel"
            Visible: =showAddUsers
            Width: =173
            X: =900
            Y: =538
            ZIndex: =30

        drpSearchUserRole As dropdown:
            AccessibleLabel: ="User Role"
            BorderColor: =RGBA(116, 116, 116, 1)
            ChevronBackground: =RGBA(202, 202, 202, 1)
            ChevronHoverBackground: =RGBA(116, 116, 116, 1)
            FocusedBorderColor: =drpSearchUserRole.BorderColor
            Font: =Font.'Segoe UI'
            HoverBorderColor: =ColorFade(drpSearchUserRole.BorderColor, 15%)
            HoverFill: =RGBA(237, 237, 237, 1)
            Items: =["CanView", "CanEdit"]
            PressedBorderColor: =drpSearchUserRole.HoverBorderColor
            PressedFill: =RGBA(116, 116, 116, 1)
            SelectionFill: =RGBA(219, 219, 219, 1)
            Size: =18
            TabIndex: =4
            Visible: =showAddUsers
            X: =331
            Y: =433
            ZIndex: =31

    grpDelete As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =25

        Label1_1 As label:
            FocusedBorderColor: =Label1_1.BorderColor
            Font: =Font.'Segoe UI'
            Height: =133
            HoverBorderColor: =Label1_1.BorderColor
            HoverColor: =Label1_1.Color
            HoverFill: =Label1_1.Fill
            PressedBorderColor: =Label1_1.BorderColor
            PressedColor: =Label1_1.Color
            PressedFill: =Label1_1.Fill
            Size: =20
            Text: ="Are you sure you wish to delete this app? Warning this action is permanent!"
            VerticalAlign: =VerticalAlign.Top
            Visible: =showDelete
            Width: =854
            X: =114
            Y: =184
            ZIndex: =6

        btnDeleteApp As button:
            BorderColor: =ColorFade(btnDeleteApp.Fill, -15%)
            BorderStyle: =BorderStyle.None
            Color: =RGBA(0, 0, 0, 1)
            Fill: =ColorValue(Style.Primary)
            FocusedBorderColor: =btnDeleteApp.BorderColor
            Font: =Font.'Segoe UI'
            Height: =48
            HoverBorderColor: =ColorFade(btnDeleteApp.BorderColor, 20%)
            HoverFill: =ColorValue(Style.Secondary)
            OnSelect: |-
                =UpdateContext({DeleteAppPassed: 'HELPER-ObjectOperations'.Run("none", selectedAppID, envName, "delete", "app").thereturnstring});
                
                //update app if succeess
                If(DeleteAppPassed = "pass",
                    UpdateContext({showCantShowThat: true, CantShowThatText: "Deleted"});,
                    UpdateContext({showCantShowThat: true, CantShowThatText: DeleteAppPassed});)
            PressedBorderColor: =btnDeleteApp.Fill
            PressedColor: =RGBA(255, 255, 255, 1)
            PressedFill: =ColorFade(btnMakeOwner.Fill, -30%)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =20
            Text: ="Delete App"
            Visible: =showDelete
            Width: =323
            X: =108
            Y: =561
            ZIndex: =7

    grpMakerPortal As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =27

        Label1_2 As label:
            FocusedBorderColor: =Label1_2.BorderColor
            Font: =Font.'Segoe UI'
            Height: =133
            HoverBorderColor: =Label1_2.BorderColor
            HoverColor: =Label1_2.Color
            HoverFill: =Label1_2.Fill
            OnSelect: |-
                =Launch("https://make.powerapps.com/environments/" & envName & "/apps/" & selectedAppID & "/details")
            PressedBorderColor: =Label1_2.BorderColor
            PressedColor: =Label1_2.Color
            PressedFill: =Label1_2.Fill
            Size: =20
            Text: |-
                ="The Maker Portal can give you further app insights like analytics, versions and app details. Grant yourself ownership first and then navigate to the Maker Portal from here. 
                
                Note: The Maker Portal will open in a new browser window."
            VerticalAlign: =VerticalAlign.Top
            Visible: =showMakerPortal
            Width: =854
            X: =112
            Y: =184
            ZIndex: =8

        btnLaunchMakerPortal As button:
            BorderColor: =ColorFade(btnLaunchMakerPortal.Fill, -15%)
            BorderStyle: =BorderStyle.None
            Color: =RGBA(0, 0, 0, 1)
            Fill: =ColorValue(Style.Primary)
            FocusedBorderColor: =btnLaunchMakerPortal.BorderColor
            Font: =Font.'Segoe UI'
            Height: =48
            HoverBorderColor: =ColorFade(btnLaunchMakerPortal.BorderColor, 20%)
            HoverFill: =ColorValue(Style.Secondary)
            OnSelect: =Launch(theAppMakerURL & "environments/" & envName & "/apps/" & selectedAppID & "/details")
            PressedBorderColor: =btnLaunchMakerPortal.Fill
            PressedColor: =RGBA(255, 255, 255, 1)
            PressedFill: =ColorFade(btnMakeOwner.Fill, -30%)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =20
            TabIndex: =-1
            Text: ="Launch Maker Portal"
            Visible: =showMakerPortal
            Width: =323
            X: =106
            Y: =561
            ZIndex: =9

    grpEmailMaker As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =32

        lblEmailTo_1 As label:
            Align: =Left
            BorderColor: =RGBA(0, 0, 0, 1)
            Color: =Black
            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70%)
            FocusedBorderColor: =lblEmailTo_1.BorderColor
            Font: =Font.'Segoe UI'
            FontWeight: =Normal
            Height: =205
            HoverBorderColor: =lblEmailTo_1.BorderColor
            HoverColor: =lblEmailTo_1.Color
            HoverFill: =lblEmailTo_1.Fill
            OnSelect: =
            PaddingRight: =7.03
            PaddingTop: =7.03
            PressedBorderColor: =lblEmailTo_1.BorderColor
            PressedColor: =lblEmailTo_1.Color
            PressedFill: =lblEmailTo_1.Fill
            Size: =18
            Text: |-
                ="To: " & LookUp(appRoles,properties.roleName = "Owner").properties.principal.email
            Tooltip: ="Confirmation dialog content"
            VerticalAlign: =VerticalAlign.Top
            Visible: =showEmail
            Width: =1096
            X: =20
            Y: =78
            ZIndex: =10

        txtMailMessage_1 As text:
            AccessibleLabel: ="eMail message"
            BorderColor: =RGBA(226,214,228,1.00)
            BorderThickness: =1
            Default: =
            DisabledBorderColor: =RGBA(154, 154, 154, 1)
            DisabledColor: =RGBA(136, 136, 136, 1)
            DisabledFill: =RGBA(154, 154, 154, 1)
            FocusedBorderColor: =txtMailMessage_1.BorderColor
            FocusedBorderThickness: =2
            Font: =Font.'Segoe UI'
            Height: =303
            HintText: ="Message"
            HoverBorderColor: =RGBA(102, 102, 102, 1)
            HoverColor: =RGBA(0,0,0,1.00)
            HoverFill: =RGBA(255, 255, 255, 1)
            Mode: =TextMode.MultiLine
            PressedBorderColor: =RGBA(102, 102, 102, 1)
            PressedColor: =RGBA(102, 102, 102, 1)
            PressedFill: =RGBA(255, 255, 255, 1)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =16
            Visible: =showEmail
            Width: =1084
            X: =32
            Y: =247
            ZIndex: =11

        txtMailSubject_1 As text:
            AccessibleLabel: ="eMail subject"
            BorderColor: =RGBA(226,214,228,1.00)
            BorderThickness: =1
            Default: |-
                ="Question regarding your Power Apps app: " & selectedApp.properties.displayName
            DisabledBorderColor: =RGBA(154, 154, 154, 1)
            DisabledColor: =RGBA(136, 136, 136, 1)
            DisabledFill: =RGBA(154, 154, 154, 1)
            FocusedBorderColor: =txtMailSubject_1.BorderColor
            FocusedBorderThickness: =2
            Font: =Font.'Segoe UI'
            Height: =54
            HintText: ="Subject"
            HoverBorderColor: =RGBA(102, 102, 102, 1)
            HoverColor: =RGBA(0,0,0,1.00)
            HoverFill: =RGBA(255, 255, 255, 1)
            Mode: =TextMode.MultiLine
            PressedBorderColor: =RGBA(102, 102, 102, 1)
            PressedColor: =RGBA(102, 102, 102, 1)
            PressedFill: =RGBA(255, 255, 255, 1)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Size: =16
            Visible: =showEmail
            Width: =1084
            X: =32
            Y: =171
            ZIndex: =12

        btnConfirmEmail_1 As button:
            BorderColor: =RGBA(0, 0, 0, 0)
            BorderStyle: =BorderStyle.None
            Color: =RGBA(0, 0, 0, 1)
            DisabledBorderColor: =RGBA(0, 0, 0, 0)
            Fill: =ColorValue(Style.Primary)
            FocusedBorderColor: =btnConfirmEmail_1.BorderColor
            Font: =Font.'Segoe UI'
            Height: =46
            HoverBorderColor: =RGBA(0, 0, 0, 0)
            HoverFill: =ColorValue(Style.Secondary)
            OnSelect: |-
                =Office365Outlook.SendEmailV2(LookUp(appRoles,properties.roleName = "Owner").properties.principal.email, txtMailSubject_1.Text, txtMailMessage_1.Text);
                Notify("The app maker has been emailed.");
            PressedBorderColor: =ColorFade(RGBA(0, 120, 212, 1), -50%)
            PressedColor: =RGBA(255, 255, 255, 1)
            PressedFill: =ColorFade(btnMakeOwner.Fill, -30%)
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            Text: ="Send Email"
            Visible: =showEmail
            Width: =323
            X: =793
            Y: =581
            ZIndex: =13

    cant_do_that_Dialog As group:
        Height: =5
        Width: =5
        X: =80
        Y: =80
        ZIndex: =35

        bg_cant_do_that As rectangle:
            DisabledFill: =bg_cant_do_that.Fill
            Fill: =RGBA(238, 204, 204, 1)
            Height: =If(Self.Visible, 60, 0)
            HoverFill: =bg_cant_do_that.Fill
            PressedFill: =bg_cant_do_that.Fill
            Visible: =showCantShowThat
            Width: =If(Self.Visible, Parent.Width, 0)
            ZIndex: =32

        lbl_cant_do_that As label:
            Align: =Center
            Color: =RGBA(51, 51, 51, 1)
            Height: =bg_cant_do_that.Height
            Text: =CantShowThatText
            Visible: =showCantShowThat
            Width: =bg_cant_do_that.Width
            X: =bg_cant_do_that.X
            Y: =bg_cant_do_that.Y
            ZIndex: =33

        x_cant_do_that As icon.Cancel:
            Color: =RGBA(51, 51, 51, 1)
            DisabledFill: =x_cant_do_that.Fill
            Height: =bg_cant_do_that.Height
            HoverBorderColor: =ColorFade(x_cant_do_that.BorderColor, 20%)
            HoverColor: =ColorFade(x_cant_do_that.Color, 20%)
            HoverFill: =x_cant_do_that.Fill
            Icon: =Icon.Cancel
            OnSelect: |-
                =UpdateContext({showCantShowThat: false})
            PaddingBottom: =15
            PaddingLeft: =15
            PaddingRight: =15
            PaddingTop: =15
            PressedBorderColor: =ColorFade(x_cant_do_that.BorderColor, -20%)
            PressedColor: =ColorFade(x_cant_do_that.Color, -20%)
            PressedFill: =x_cant_do_that.Fill
            Visible: =showCantShowThat
            Width: =Self.Height
            X: =If(Self.Visible, Parent.Width-Self.Width-5, 0)
            Y: =bg_cant_do_that.Y
            ZIndex: =34

