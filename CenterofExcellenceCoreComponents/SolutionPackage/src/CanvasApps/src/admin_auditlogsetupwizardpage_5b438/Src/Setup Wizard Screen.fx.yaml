"'Setup Wizard Screen' As screen":
    LoadingSpinnerColor: =RGBA(0, 120, 212, 1)
    OnVisible: |-
        =Set(ShowLoader, false);
        Set(ShowLoaderText, "");

    conMain As groupContainer.verticalAutoLayoutContainer:
        Height: =Parent.Height
        LayoutDirection: =LayoutDirection.Vertical
        LayoutMode: =LayoutMode.Auto
        Width: =Parent.Width
        X: =0+0
        Y: =0+0
        ZIndex: =1

        conMainHeader As groupContainer.horizontalAutoLayoutContainer:
            FillPortions: =0
            Height: =100
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingLeft: =24
            PaddingRight: =Self.PaddingLeft
            ZIndex: =1

            conMainHeaderLeft As groupContainer.horizontalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.SetByContainer
                Height: =100
                LayoutDirection: =LayoutDirection.Vertical
                LayoutJustifyContent: =LayoutJustifyContent.Center
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                ZIndex: =3

                lblMainHeader As Label:
                    AlignInContainer: =AlignInContainer.Stretch
                    Alignment: =Align.Left
                    DisplayMode: =DisplayMode.Edit
                    FontSize: =20
                    FontWeight: =FontWeight.Semibold
                    Height: =40
                    LayoutMinHeight: =32
                    LayoutMinWidth: =320
                    OnChange: =false
                    Text: ="Center of Excellence Setup Wizard - Collect audit log data"
                    Width: =512
                    X: =0
                    Y: =0
                    ZIndex: =1

                lblMainSubheading As Label:
                    AlignInContainer: =AlignInContainer.Stretch
                    Alignment: =Align.Left
                    DisplayMode: =DisplayMode.Edit
                    Height: =24
                    LayoutMinHeight: =32
                    LayoutMinWidth: =320
                    OnChange: =false
                    Text: ="A setup wizard provides a guided step by step experience to configure the Audit Log components of the CoE Starter Kit."
                    VerticalAlignment: ="middle"
                    Width: =320
                    X: =40
                    Y: =40
                    ZIndex: =2

            "FluentIcon As 'Fluent Icon (1.0.20)'":
                DisplayMode: =DisplayMode.Edit
                FontColor: =AppTheme.palette.themePrimary
                FontSize: =18
                Height: =48
                HoverFontColor: =AppTheme.palette.themePrimary
                HoverIconColor: =AppTheme.palette.themePrimary
                IconColor: =AppTheme.palette.themePrimary
                IconName: ="Unknown"
                IconType: ='PowerCAT.Icon.IconType'.ActionButton
                LayoutMinHeight: =200
                LayoutMinWidth: =200
                OnChange: |-
                    =UpdateContext({showHelp: true})
                Text: ="Help"
                TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
                Tooltip: ="Help and Documentation"
                Width: =100
                X: =40
                Y: =40
                ZIndex: =4

        Rectangle2 As rectangle:
            AlignInContainer: =AlignInContainer.Stretch
            BorderColor: =RGBA(166, 166, 166, 1)
            BorderStyle: =BorderStyle.None
            BorderThickness: =2
            DisabledFill: =RGBA(166, 166, 166, 1)
            Fill: =ColorValue(AppTheme.palette.neutralLight)
            FocusedBorderColor: =RGBA(0, 120, 212, 1)
            Height: =1
            HoverFill: =RGBA(0, 120, 212, 1)
            PressedFill: =RGBA(0, 120, 212, 1)
            ZIndex: =2

        conMainBody As groupContainer.horizontalAutoLayoutContainer:
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            ZIndex: =3

            conMainSteps As groupContainer.verticalAutoLayoutContainer:
                FillPortions: =0
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                PaddingLeft: =conMainHeader.PaddingLeft
                PaddingRight: =Self.PaddingLeft
                PaddingTop: =24
                Width: =280
                ZIndex: =1

                "SubwayNav1 As 'SubwayNav (1.0.20) Preview'.pcfdataset":
                    DisplayMode: =DisplayMode.Disabled
                    Height: =200
                    Items: |-
                        =AddColumns(
                            colSetupSteps,
                            ItemState,
                            If(
                                ItemKey=configStep,"Current",
                                ItemKey exactin colStepsCompleted.Value,"Completed",
                                ""
                            )
                        )
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    Theme: =AppThemeJson
                    Width: =200
                    WizardCompleteorError: ='PowerCAT.SubwayNav.WizardCompleteorError'.None
                    X: =0
                    Y: =0
                    ZIndex: =3

            Rectangle2_1 As rectangle:
                AlignInContainer: =AlignInContainer.Stretch
                BorderColor: =RGBA(166, 166, 166, 1)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                DisabledFill: =RGBA(166, 166, 166, 1)
                Fill: =ColorValue(AppTheme.palette.neutralLight)
                FocusedBorderColor: =RGBA(0, 120, 212, 1)
                Height: =1
                HoverFill: =RGBA(0, 120, 212, 1)
                PressedFill: =RGBA(0, 120, 212, 1)
                Width: =1
                ZIndex: =2

            conMainDetails As groupContainer.verticalAutoLayoutContainer:
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                PaddingRight: =Self.PaddingLeft
                PaddingTop: =16
                ZIndex: =3

                lblStepName As Label:
                    Alignment: =Align.Left
                    DisplayMode: =DisplayMode.Edit
                    FontSize: =16
                    FontWeight: =FontWeight.Semibold
                    Height: =40
                    LayoutMinHeight: =32
                    LayoutMinWidth: =640
                    OnChange: =false
                    PaddingStart: =24
                    Text: =LookUp(colSetupSteps, ItemKey = configStep).ItemLabel
                    Width: =640
                    X: =0
                    Y: =0
                    ZIndex: =1

                lblStepDescription As htmlViewer:
                    AlignInContainer: =AlignInContainer.Stretch
                    AutoHeight: =true
                    Font: =Font.'Segoe UI'
                    HtmlText: =LookUp(colSetupSteps, ItemKey = configStep).ItemDescription
                    LayoutMinWidth: =100
                    PaddingLeft: =24
                    Width: =640
                    X: =40
                    Y: =40
                    ZIndex: =2

                conContentAll As groupContainer.horizontalAutoLayoutContainer:
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    PaddingLeft: =24
                    PaddingRight: =Self.PaddingLeft
                    PaddingTop: =24
                    ZIndex: =4

                    conContentPre As groupContainer.verticalAutoLayoutContainer:
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Visible: =configStep=1
                        ZIndex: =1

                        conByodlWarning As groupContainer.horizontalAutoLayoutContainer:
                            DropShadow: =DropShadow.Light
                            Fill: =RGBA(238, 204, 204, 1)
                            FillPortions: =0
                            Height: =45
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            PaddingLeft: =7
                            RadiusBottomLeft: =4
                            RadiusBottomRight: =4
                            RadiusTopLeft: =4
                            RadiusTopRight: =4
                            Visible: =isBYODL
                            ZIndex: =1

                            lblByodlWarning As Label:
                                AlignInContainer: =AlignInContainer.Stretch
                                Alignment: =Align.Justify
                                Color: =RGBA(0, 0, 0, 1)
                                DisplayMode: =DisplayMode.Edit
                                FontSize: =11
                                Height: =32
                                LayoutMinHeight: =32
                                LayoutMinWidth: =320
                                OnChange: =false
                                Text: ="Your inventory type is BYODL, so Audit Logs are not needed."
                                Width: =520
                                X: =0
                                Y: =0
                                ZIndex: =1

                            "iconByodlWarning As 'Fluent Icon (1.0.20)'":
                                DisplayMode: =DisplayMode.Edit
                                FontColor: |-
                                    ="#000000"
                                Height: =45
                                IconName: ="OpenInNewTab"
                                LayoutMinHeight: =200
                                LayoutMinWidth: =200
                                OnChange: |-
                                    =Launch("https://learn.microsoft.com/power-platform/guidance/coe/faq-dataexport#will-i-still-need-to-install-the-audit-log-solution-to-get-app-usage")
                                Theme: =
                                Width: =45
                                X: =0
                                Y: =0
                                ZIndex: =2

                        "dlRequirements As 'Fluent Details List (1.0.20)'.pcfdataset":
                            AlignInContainer: =AlignInContainer.Stretch
                            columns_Items: |-
                                =Table(
                                    {
                                        ColName: "Value",
                                        ColDisplayName: "Requirement",
                                        ColCellType:"text",
                                        ColWidth: 512,
                                        ColImageWidth: 60,
                                        ColImagePadding: 8,
                                        ColVerticalAlign: "Top"
                                    },
                                    {
                                        ColName: "Link",
                                        ColDisplayName: "Documentation",
                                        ColCellType:"clickableimage",
                                        ColWidth: 100,
                                        ColImageWidth: 15,
                                        ColImagePadding: 2,
                                        ColVerticalAlign: "Top"
                                    }
                                )
                            DisplayMode: =DisplayMode.Edit
                            FillPortions: =1
                            Height: =200
                            Items: =col_req
                            LayoutMinHeight: =200
                            LayoutMinWidth: =200
                            OnChange: |-
                                =If(Self.EventName="CellAction",
                                If(Self.EventColumn="Link", Launch(LookUp(col_req, Key = Self.EventRowKey).URL, {}, LaunchTarget.New)
                                ))
                            RecordKey: ="Key"
                            SelectionType: ='PowerCAT.FluentDetailsList.SelectionType'.None
                            Width: =200
                            X: =0
                            Y: =0
                            ZIndex: =3

                            Value4 As pcfDataField.textualColumn:
                                FieldDisplayName: ="Value"
                                FieldName: ="Value"
                                FieldType: ="s"
                                FieldVariantName: ="textualColumn"
                                Order: =1
                                ZIndex: =40

                            Link1 As pcfDataField.textualColumn:
                                FieldDisplayName: ="Link"
                                FieldName: ="Link"
                                FieldType: ="s"
                                FieldVariantName: ="textualColumn"
                                Order: =4
                                ZIndex: =43

                            URL1 As pcfDataField.textualColumn:
                                FieldDisplayName: ="URL"
                                FieldName: ="URL"
                                FieldType: ="s"
                                FieldVariantName: ="textualColumn"
                                Order: =5
                                ZIndex: =44

                    conContentDocs As groupContainer.verticalAutoLayoutContainer:
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Visible: =configStep=2
                        ZIndex: =2

                        galDocs As gallery.galleryVertical:
                            '#CopilotOverlayLabel': ="Filtered"
                            BorderColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderColor: =RGBA(0, 120, 212, 1)
                            FocusedBorderThickness: =2
                            Items: |-
                                =Table(
                                    {
                                        header: "Documentation",
                                        url: "https://learn.microsoft.com/power-platform/guidance/coe/setup-auditlog-http#create-an-azure-ad-app-registration-for-the-office-365-management-api",
                                        description: "Use these steps to set up an Azure AD app registration for an HTTP call in a Power Automate flow to connect to the audit log. You will need a Global Admin to set up the app registration. Don't continue until you have the Client ID and Client Secret from the app registration ready.",
                                        icon: '10330-icon-eBooks-Intune'
                                    }
                                )
                            Layout: =Layout.Vertical
                            LayoutMinHeight: =287
                            LayoutMinWidth: =320
                            TemplateSize: =If(Self.Layout = Layout.Horizontal, Min(280, Self.Width - 60), Min(280, Self.Height - 60))
                            WrapCount: =3
                            ZIndex: =2

                            "Elevation3_1 As 'Fluent Elevation (1.0.20)'":
                                Depth: ='PowerCAT.Elevation.Depth'.Depth4
                                DisplayMode: =DisplayMode.Edit
                                Height: =conDocs.Height
                                HoverDepth: ='PowerCAT.Elevation.HoverDepth'.Depth8
                                Width: =conDocs.Width
                                X: =0+0
                                Y: =0+0
                                ZIndex: =1

                            conDocs As groupContainer.verticalAutoLayoutContainer:
                                Height: =Parent.TemplateHeight-20
                                LayoutDirection: =LayoutDirection.Vertical
                                LayoutMode: =LayoutMode.Auto
                                Width: =Parent.TemplateWidth-20
                                X: =0+0
                                Y: =0+0
                                ZIndex: =2

                                conDocsHeader As groupContainer.horizontalAutoLayoutContainer:
                                    AlignInContainer: =AlignInContainer.SetByContainer
                                    FillPortions: =0
                                    Height: =48
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    ZIndex: =1

                                    Image1_1 As image:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledFill: =RGBA(0, 0, 0, 0)
                                        Height: =48
                                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                                        HoverFill: =RGBA(0, 0, 0, 0)
                                        Image: =ThisItem.icon
                                        PaddingBottom: =10
                                        PaddingLeft: =10
                                        PaddingRight: =10
                                        PaddingTop: =10
                                        PressedBorderColor: =RGBA(0, 0, 0, 0)
                                        PressedFill: =RGBA(0, 0, 0, 0)
                                        Width: =48
                                        ZIndex: =1

                                    Label2_1 As Label:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        DisplayMode: =DisplayMode.Edit
                                        FontWeight: =FontWeight.Semibold
                                        Height: =32
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =100
                                        OnChange: =false
                                        PaddingStart: =12
                                        Text: =ThisItem.header
                                        Width: =galDocs.TemplateWidth - Image1_1.Width - 20
                                        X: =0
                                        Y: =0
                                        ZIndex: =2

                                    "Icon7_3 As 'Fluent Icon (1.0.20)'":
                                        DisplayMode: =DisplayMode.Edit
                                        Height: =48
                                        IconName: ="OpenInNewWindow"
                                        IconSize: =20
                                        LayoutMinHeight: =200
                                        LayoutMinWidth: =200
                                        OnChange: =Launch(ThisItem.url, {}, LaunchTarget.New)
                                        Theme: =AppThemeJson
                                        Tooltip: ="launch"
                                        Width: =40
                                        X: =0
                                        Y: =0
                                        ZIndex: =4

                                Rectangle2_13 As rectangle:
                                    BorderColor: =RGBA(166, 166, 166, 1)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    DisabledFill: =RGBA(166, 166, 166, 1)
                                    Fill: =ColorValue(AppTheme.palette.neutralLight)
                                    FocusedBorderColor: =RGBA(0, 120, 212, 1)
                                    Height: =1
                                    HoverFill: =RGBA(0, 120, 212, 1)
                                    PressedFill: =RGBA(0, 120, 212, 1)
                                    Width: =1
                                    ZIndex: =2

                                conAppsBody_1 As groupContainer.verticalAutoLayoutContainer:
                                    LayoutDirection: =LayoutDirection.Vertical
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    PaddingBottom: =Self.PaddingTop
                                    PaddingLeft: =16
                                    PaddingRight: =Self.PaddingLeft
                                    PaddingTop: =12
                                    ZIndex: =3

                                    Label4_1 As Label:
                                        AlignInContainer: =AlignInContainer.Start
                                        DisplayMode: =DisplayMode.Edit
                                        FillPortions: =1
                                        Height: =32
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =100
                                        OnChange: =false
                                        Text: =ThisItem.description
                                        VerticalAlignment: =VerticalAlign.Top
                                        Width: =galDocs.TemplateWidth - 50
                                        X: =0
                                        Y: =0
                                        ZIndex: =1

                                    Button2_1 As Button:
                                        AlignInContainer: =AlignInContainer.End
                                        ButtonType: ='Button.ButtonType'.Standard
                                        DisplayMode: =DisplayMode.Edit
                                        Height: =32
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =96
                                        OnChange: =false
                                        OnSelect: =Launch(ThisItem.url)
                                        Text: ="Learn more"
                                        TextColor: =ColorValue(AppTheme.palette.themePrimary)
                                        Width: =96
                                        X: =0
                                        Y: =0
                                        ZIndex: =2

                    conContentVariables As groupContainer.verticalAutoLayoutContainer:
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Visible: =configStep=3
                        ZIndex: =3

                        conVariables As groupContainer.verticalAutoLayoutContainer:
                            LayoutDirection: =LayoutDirection.Vertical
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            LayoutOverflowY: =LayoutOverflow.Scroll
                            ZIndex: =4

                            conVarRegionCloud As groupContainer.horizontalAutoLayoutContainer:
                                FillPortions: =0
                                Height: =96
                                LayoutGap: =100
                                LayoutMinHeight: =100
                                LayoutMinWidth: =250
                                LayoutMode: =LayoutMode.Auto
                                PaddingLeft: =10
                                PaddingRight: =12
                                ZIndex: =1

                                conVarRegionCloudText As groupContainer.verticalAutoLayoutContainer:
                                    LayoutDirection: =LayoutDirection.Vertical
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    PaddingRight: =12
                                    PaddingTop: =8
                                    X: =40
                                    Y: =40
                                    ZIndex: =3

                                    lblVarRegionCloud As Label:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        DisplayMode: =DisplayMode.Edit
                                        FontWeight: =FontWeight.Semibold
                                        Height: =32
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =320
                                        OnChange: =false
                                        Text: ="Power Platform Region/Cloud"
                                        Width: =320
                                        X: =0
                                        Y: =0
                                        ZIndex: =1

                                    lblVarRegionCloudDescription As Label:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        DisplayMode: =DisplayMode.Edit
                                        Height: =64
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =320
                                        OnChange: =false
                                        PaddingEnd: =12
                                        Text: ="Power Platform is available in commercial regions, like United States and Europe, and Power Apps US Government regions. Select the region of your Power Platform tenant."
                                        VerticalAlignment: =VerticalAlign.Top
                                        Width: =320
                                        X: =0
                                        Y: =0
                                        ZIndex: =2

                                "cmbVarRegionCloud As 'Combo box'.pcfdataset":
                                    AlignInContainer: =AlignInContainer.Center
                                    DefaultSelectedItems: =myRegionCloud
                                    DisplayMode: =DisplayMode.Edit
                                    Height: =32
                                    Items: =colRegionClouds
                                    LayoutMinHeight: =32
                                    LayoutMinWidth: =320
                                    OnChange: =Set(myRegionCloud,Self.Selected)
                                    Width: =416
                                    X: =0
                                    Y: =0
                                    ZIndex: =4

                                    region1 As pcfDataField.textualColumn:
                                        FieldDisplayName: ="region"
                                        FieldName: ="region"
                                        FieldType: ="s"
                                        FieldVariantName: ="textualColumn"
                                        Order: =1
                                        ZIndex: =11

                            Rectangle2_7 As rectangle:
                                AlignInContainer: =AlignInContainer.Stretch
                                BorderColor: =RGBA(166, 166, 166, 1)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                DisabledFill: =RGBA(166, 166, 166, 1)
                                Fill: =ColorValue(AppTheme.palette.neutralLight)
                                FocusedBorderColor: =RGBA(0, 120, 212, 1)
                                Height: =1
                                HoverFill: =RGBA(0, 120, 212, 1)
                                PressedFill: =RGBA(0, 120, 212, 1)
                                ZIndex: =2

                            Rectangle2_4 As rectangle:
                                AlignInContainer: =AlignInContainer.Stretch
                                BorderColor: =RGBA(166, 166, 166, 1)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                DisabledFill: =RGBA(166, 166, 166, 1)
                                Fill: =ColorValue(AppTheme.palette.neutralLight)
                                FocusedBorderColor: =RGBA(0, 120, 212, 1)
                                Height: =1
                                HoverFill: =RGBA(0, 120, 212, 1)
                                PressedFill: =RGBA(0, 120, 212, 1)
                                ZIndex: =3

                            Rectangle2_6 As rectangle:
                                AlignInContainer: =AlignInContainer.Stretch
                                BorderColor: =RGBA(166, 166, 166, 1)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                DisabledFill: =RGBA(166, 166, 166, 1)
                                Fill: =ColorValue(AppTheme.palette.neutralLight)
                                FocusedBorderColor: =RGBA(0, 120, 212, 1)
                                Height: =1
                                HoverFill: =RGBA(0, 120, 212, 1)
                                PressedFill: =RGBA(0, 120, 212, 1)
                                Visible: =false
                                ZIndex: =4

                            conVarRegionCloud_1 As groupContainer.horizontalAutoLayoutContainer:
                                FillPortions: =0
                                Height: =96
                                LayoutGap: =100
                                LayoutMinHeight: =100
                                LayoutMinWidth: =250
                                LayoutMode: =LayoutMode.Auto
                                PaddingLeft: =10
                                PaddingRight: =12
                                ZIndex: =5

                                conVarRegionCloudText_1 As groupContainer.verticalAutoLayoutContainer:
                                    LayoutDirection: =LayoutDirection.Vertical
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    PaddingRight: =12
                                    PaddingTop: =8
                                    X: =40
                                    Y: =40
                                    ZIndex: =3

                                    lblVarRegionCloud_1 As Label:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        DisplayMode: =DisplayMode.Edit
                                        FontWeight: =FontWeight.Semibold
                                        Height: =32
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =320
                                        OnChange: =false
                                        Text: ="App Registration Secret"
                                        Width: =320
                                        X: =0
                                        Y: =0
                                        ZIndex: =1

                                    lblVarRegionCloudDescription_1 As Label:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        DisplayMode: =DisplayMode.Edit
                                        Height: =64
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =320
                                        OnChange: =false
                                        PaddingEnd: =12
                                        Text: ="You can store the client secret either in plain text or in Azure Key Vault. Select where your secret is stored and then update the required values."
                                        VerticalAlignment: =VerticalAlign.Top
                                        Width: =320
                                        X: =0
                                        Y: =0
                                        ZIndex: =2

                                "cmbVarRegionCloud_1 As 'Combo box'.pcfdataset":
                                    AlignInContainer: =AlignInContainer.Center
                                    DefaultSelectedItems: =[mySecret]
                                    DisplayMode: =DisplayMode.Edit
                                    Height: =32
                                    Items: =["Azure Key Vault","Plain Text"]
                                    LayoutMinHeight: =32
                                    LayoutMinWidth: =320
                                    OnChange: =Set(mySecret,Self.Selected.Value)
                                    Width: =416
                                    X: =0
                                    Y: =0
                                    ZIndex: =4

                                    Value1 As pcfDataField.textualColumn:
                                        FieldDisplayName: ="Value"
                                        FieldName: ="Value"
                                        FieldType: ="s"
                                        FieldVariantName: ="textualColumn"
                                        Order: =1
                                        ZIndex: =45

                            Rectangle2_10 As rectangle:
                                AlignInContainer: =AlignInContainer.Stretch
                                BorderColor: =RGBA(166, 166, 166, 1)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                DisabledFill: =RGBA(166, 166, 166, 1)
                                Fill: =ColorValue(AppTheme.palette.neutralLight)
                                FocusedBorderColor: =RGBA(0, 120, 212, 1)
                                Height: =1
                                HoverFill: =RGBA(0, 120, 212, 1)
                                PressedFill: =RGBA(0, 120, 212, 1)
                                Visible: =false
                                ZIndex: =6

                            galMandatoryEnvVars As gallery.galleryVertical:
                                '#CopilotOverlayLabel': ="Filtered"
                                BorderColor: =RGBA(166, 166, 166, 1)
                                FocusedBorderThickness: =2
                                Height: =200
                                Items: |-
                                    =If(mySecret = "Azure Key Vault",
                                        Filter('Environment Variable Definitions', 'Display Name' = "Audit Logs - ClientID" || 'Display Name' = "Audit Logs - Client Azure Secret"),
                                        Filter('Environment Variable Definitions', 'Display Name' = "Audit Logs - ClientID" || 'Display Name' = "Audit Logs - Client Secret"))
                                Layout: =Layout.Vertical
                                LayoutMinHeight: =287
                                LayoutMinWidth: =320
                                TemplateFill: =ColorValue(AppTheme.palette.white)
                                TemplatePadding: =10
                                TemplateSize: =If(Self.Layout = Layout.Horizontal, Min(60, Self.Width - 60), Min(80, Self.Height - 60))
                                Width: =conContentVariables.Width
                                ZIndex: =7

                                lblEnvVarTitle As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(51, 51, 51, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    OnSelect: =Select(Parent)
                                    Size: =10
                                    Text: =ThisItem.'Display Name'
                                    Width: =346
                                    ZIndex: =2

                                txtEnvVarValue As text:
                                    BorderColor: =RGBA(128, 128, 128, 1)
                                    Color: =RGBA(51, 51, 51, 1)
                                    Default: =LookUp('Environment Variable Values', 'Environment Variable Definition'.'Environment Variable Definition' = ThisItem.'Environment Variable Definition').Value
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    DisabledFill: =RGBA(244, 244, 244, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    HintText: =""
                                    HoverBorderColor: =ColorFade(RGBA(105, 121, 126, 1), -30%)
                                    HoverColor: =RGBA(51, 51, 51, 1)
                                    HoverFill: =RGBA(255, 255, 255, 1)
                                    OnSelect: =Select(Parent)
                                    PressedBorderColor: =RGBA(105, 121, 126, 1)
                                    PressedColor: =RGBA(51, 51, 51, 1)
                                    PressedFill: =RGBA(255, 255, 255, 1)
                                    RadiusBottomLeft: =0
                                    RadiusBottomRight: =0
                                    RadiusTopLeft: =0
                                    RadiusTopRight: =0
                                    Size: =10
                                    Visible: =Not("Client Azure Secret" in ThisItem.'Display Name')
                                    Width: =416
                                    X: =galMandatoryEnvVars.Width - txtEnvVarValue.Width - galMandatoryEnvVars.TemplatePadding - 10
                                    Y: =galMandatoryEnvVars.TemplateHeight / 2 - txtEnvVarValue.Height / 2
                                    ZIndex: =3

                                lblEnvVarDescription As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(51, 51, 51, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    OnSelect: =Select(Parent)
                                    Size: =10
                                    Text: =Substitute(ThisItem.Description, "REQUIRED. ", "")
                                    VerticalAlign: =VerticalAlign.Top
                                    Width: =600
                                    Y: =40
                                    ZIndex: =4

                                Rectangle4_3 As rectangle:
                                    BorderColor: =RGBA(166, 166, 166, 1)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    DisabledFill: =RGBA(166, 166, 166, 1)
                                    Fill: =ColorValue(AppTheme.palette.neutralLight)
                                    FocusedBorderColor: =RGBA(0, 120, 212, 1)
                                    Height: =1
                                    HoverFill: =ColorValue(AppTheme.palette.neutralLight)
                                    OnSelect: =Select(Parent)
                                    PressedFill: =ColorValue(AppTheme.palette.neutralLight)
                                    Width: =galMandatoryEnvVars.TemplateWidth
                                    ZIndex: =5

                                lblEnvVarSchema As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(51, 51, 51, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    Height: =0
                                    OnSelect: =Select(Parent)
                                    Size: =10
                                    Text: =ThisItem.'Schema Name'
                                    VerticalAlign: =VerticalAlign.Top
                                    Width: =0
                                    X: =1
                                    Y: =lblEnvVarTitle.Height
                                    ZIndex: =6

                                btnConfigureSecret As Button:
                                    DisplayMode: =DisplayMode.Edit
                                    Height: =32
                                    OnChange: =false
                                    OnSelect: |-
                                        =UpdateContext({showSecretConfig:true})
                                    Text: ="Configure Secret"
                                    Visible: ="Client Azure Secret" in ThisItem.'Display Name' 
                                    Width: =416
                                    X: =galMandatoryEnvVars.Width - txtEnvVarValue.Width - galMandatoryEnvVars.TemplatePadding - 20
                                    Y: =galMandatoryEnvVars.TemplateHeight / 2 - txtEnvVarValue.Height / 2
                                    ZIndex: =7

                    conContentSubscription As groupContainer.verticalAutoLayoutContainer:
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutGap: =20
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Visible: =configStep=4
                        ZIndex: =4

                        btnRefresh As Button:
                            DisplayMode: =DisplayMode.Edit
                            Height: =32
                            LayoutMinHeight: =32
                            LayoutMinWidth: =96
                            OnChange: =false
                            OnSelect: =Refresh('Setup Wizard State metadata')
                            Text: ="Refresh"
                            Width: =96
                            X: =0
                            Y: =0
                            ZIndex: =1

                        lblSubscriptionResponse As Label:
                            AlignInContainer: =AlignInContainer.Stretch
                            DisplayMode: =DisplayMode.Edit
                            FontWeight: =FontWeight.Semibold
                            Height: =32
                            LayoutMinHeight: =32
                            LayoutMinWidth: =320
                            OnChange: =false
                            Text: =Last(Filter('Setup Wizard State metadata', 'Last Completed Step' = 10 && Name = "Audit Log")).'Response state'
                            Width: =320
                            X: =0
                            Y: =0
                            ZIndex: =2

                    conContentFlows As groupContainer.verticalAutoLayoutContainer:
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Visible: =configStep=5
                        ZIndex: =5

                        galEnvRequestFlows As gallery.galleryVertical:
                            '#CopilotOverlayLabel': ="Filtered"
                            BorderColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderColor: =RGBA(0, 120, 212, 1)
                            FocusedBorderThickness: =2
                            Items: =Filter(FlowsWithMetadata, theName <> "Admin | Audit Logs | Office 365 Management API Subscription")
                            Layout: =Layout.Vertical
                            LayoutMinHeight: =287
                            LayoutMinWidth: =320
                            TemplateSize: |
                                =48
                            ZIndex: =1

                            conInventoryFlows_1 As groupContainer.horizontalAutoLayoutContainer:
                                Height: =Parent.TemplateHeight
                                LayoutMode: =LayoutMode.Auto
                                Width: =Parent.TemplateWidth
                                X: =0+0
                                Y: =0+0
                                ZIndex: =1

                                "icoInventoryFlow_1 As 'Fluent Icon (1.0.20)'":
                                    DisplayMode: =DisplayMode.Edit
                                    Height: =48
                                    IconName: ="Flow"
                                    LayoutMinHeight: =200
                                    LayoutMinWidth: =200
                                    Theme: =AppThemeJson
                                    Tooltip: =""
                                    Width: =40
                                    X: =0
                                    Y: =0
                                    ZIndex: =1

                                lblInventoryFlow_1 As Label:
                                    AlignInContainer: =AlignInContainer.Stretch
                                    DisplayMode: =DisplayMode.Edit
                                    FillPortions: =1
                                    Height: =32
                                    LayoutMinHeight: =32
                                    LayoutMinWidth: =100
                                    OnChange: =false
                                    Text: =ThisItem.theName
                                    Width: =320
                                    X: =0
                                    Y: =0
                                    ZIndex: =2

                                togInventoryFlow_1 As Toggle:
                                    AlignInContainer: =AlignInContainer.Center
                                    Checked: |-
                                        =And(
                                            ThisItem.thePublishedState = [@'Component State'].Published,
                                            !ThisItem.theIsErrorState,
                                            Text(ThisItem.theState) = "Activated"
                                        )
                                    DisplayMode: =DisplayMode.Edit
                                    Height: =32
                                    LayoutMinHeight: =32
                                    LayoutMinWidth: =160
                                    OnCheck: |-
                                        =IfError(Patch(
                                            Processes,
                                            LookUp(Processes, WorkflowIdUnique = ThisItem.theGUID), 
                                            {
                                                Status: 'Status (Processes)'.Activated
                                            }
                                        ),Notify("Failed to turn on this flow. Open the Power Automate details page and turn on the flow there.", NotificationType.Error));
                                        
                                        /* UpdateContext({flowPass: 'CommandCenterApp>SetCoEFlowsState'.Run(coeEnv, true, ThisItem.theGUID).return = "pass"});
                                        If(flowPass, 
                                            UpdateIf(FlowsWithMetadata, theGUID=ThisItem.theGUID, {theState: 'Status (Processes)'.Activated}), 
                                            UpdateIf(FlowsWithMetadata, theGUID=ThisItem.theGUID, {theIsErrorState: true}));
                                        If(flowPass, Notify("This flow has been turned on successfully", Success), Notify("Failed to turn on this flow. Open the Power Automate details page and turn on the flow there.", Error)) */
                                    OnUncheck: =false
                                    Width: =100
                                    X: =0
                                    Y: =0
                                    ZIndex: =3

                            Rectangle2_14 As rectangle:
                                BorderColor: =RGBA(166, 166, 166, 1)
                                BorderStyle: =BorderStyle.None
                                BorderThickness: =2
                                DisabledFill: =RGBA(166, 166, 166, 1)
                                Fill: =ColorValue(AppTheme.palette.neutralLight)
                                FocusedBorderColor: =RGBA(0, 120, 212, 1)
                                Height: =1
                                HoverFill: =RGBA(0, 120, 212, 1)
                                PressedFill: =RGBA(0, 120, 212, 1)
                                Width: =Parent.TemplateWidth
                                Y: =47
                                ZIndex: =2

                    conContentOlder As groupContainer.verticalAutoLayoutContainer:
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Visible: =configStep=6
                        ZIndex: =6

                        galDocs_2 As gallery.galleryVertical:
                            '#CopilotOverlayLabel': ="Filtered"
                            BorderColor: =RGBA(166, 166, 166, 1)
                            FocusedBorderColor: =RGBA(0, 120, 212, 1)
                            FocusedBorderThickness: =2
                            Items: |-
                                =Table(
                                    {
                                        header: "Documentation",
                                        url: "https://learn.microsoft.com/en-us/power-platform/guidance/coe/setup-auditlog-http#how-to-get-older-data",
                                        description: "(Optional) Use these steps to load historic data into the CoE Starter Kit tables manually using one of the flows provided in the solution",
                                        icon: '10330-icon-eBooks-Intune'
                                    }
                                )
                            Layout: =Layout.Vertical
                            LayoutMinHeight: =287
                            LayoutMinWidth: =320
                            TemplateSize: =If(Self.Layout = Layout.Horizontal, Min(280, Self.Width - 60), Min(280, Self.Height - 60))
                            WrapCount: =3
                            ZIndex: =2

                            "Elevation3_2 As 'Fluent Elevation (1.0.20)'":
                                Depth: ='PowerCAT.Elevation.Depth'.Depth4
                                DisplayMode: =DisplayMode.Edit
                                Height: =conDocs_2.Height
                                HoverDepth: ='PowerCAT.Elevation.HoverDepth'.Depth8
                                Width: =conDocs_2.Width
                                X: =0+0
                                Y: =0+0
                                ZIndex: =1

                            conDocs_2 As groupContainer.verticalAutoLayoutContainer:
                                Height: =Parent.TemplateHeight-20
                                LayoutDirection: =LayoutDirection.Vertical
                                LayoutMode: =LayoutMode.Auto
                                Width: =Parent.TemplateWidth-20
                                X: =0+0
                                Y: =0+0
                                ZIndex: =2

                                conDocsHeader_2 As groupContainer.horizontalAutoLayoutContainer:
                                    AlignInContainer: =AlignInContainer.SetByContainer
                                    FillPortions: =0
                                    Height: =48
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    ZIndex: =1

                                    Image1_2 As image:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledFill: =RGBA(0, 0, 0, 0)
                                        Height: =48
                                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                                        HoverFill: =RGBA(0, 0, 0, 0)
                                        Image: =ThisItem.icon
                                        PaddingBottom: =10
                                        PaddingLeft: =10
                                        PaddingRight: =10
                                        PaddingTop: =10
                                        PressedBorderColor: =RGBA(0, 0, 0, 0)
                                        PressedFill: =RGBA(0, 0, 0, 0)
                                        Width: =48
                                        ZIndex: =1

                                    Label2_2 As Label:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        DisplayMode: =DisplayMode.Edit
                                        FontWeight: =FontWeight.Semibold
                                        Height: =32
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =100
                                        OnChange: =false
                                        PaddingStart: =12
                                        Text: =ThisItem.header
                                        Width: =galDocs_2.TemplateWidth - Image1_2.Width - 20
                                        X: =0
                                        Y: =0
                                        ZIndex: =2

                                    "Icon7_4 As 'Fluent Icon (1.0.20)'":
                                        DisplayMode: =DisplayMode.Edit
                                        Height: =48
                                        IconName: ="OpenInNewWindow"
                                        IconSize: =20
                                        LayoutMinHeight: =200
                                        LayoutMinWidth: =200
                                        OnChange: =Launch(ThisItem.url, {}, LaunchTarget.New)
                                        Theme: =AppThemeJson
                                        Tooltip: ="launch"
                                        Width: =40
                                        X: =0
                                        Y: =0
                                        ZIndex: =4

                                Rectangle2_15 As rectangle:
                                    BorderColor: =RGBA(166, 166, 166, 1)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    DisabledFill: =RGBA(166, 166, 166, 1)
                                    Fill: =ColorValue(AppTheme.palette.neutralLight)
                                    FocusedBorderColor: =RGBA(0, 120, 212, 1)
                                    Height: =1
                                    HoverFill: =RGBA(0, 120, 212, 1)
                                    PressedFill: =RGBA(0, 120, 212, 1)
                                    Width: =1
                                    ZIndex: =2

                                conAppsBody_2 As groupContainer.verticalAutoLayoutContainer:
                                    LayoutDirection: =LayoutDirection.Vertical
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    PaddingBottom: =Self.PaddingTop
                                    PaddingLeft: =16
                                    PaddingRight: =Self.PaddingLeft
                                    PaddingTop: =12
                                    ZIndex: =3

                                    Label4_2 As Label:
                                        AlignInContainer: =AlignInContainer.Start
                                        DisplayMode: =DisplayMode.Edit
                                        FillPortions: =1
                                        Height: =32
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =100
                                        OnChange: =false
                                        Text: =ThisItem.description
                                        VerticalAlignment: =VerticalAlign.Top
                                        Width: =galDocs_2.TemplateWidth - 50
                                        X: =0
                                        Y: =0
                                        ZIndex: =1

                                    Button2_3 As Button:
                                        AlignInContainer: =AlignInContainer.End
                                        ButtonType: ='Button.ButtonType'.Standard
                                        DisplayMode: =DisplayMode.Edit
                                        Height: =32
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =96
                                        OnChange: =false
                                        OnSelect: =Launch(ThisItem.url)
                                        Text: ="Learn more"
                                        TextColor: =ColorValue(AppTheme.palette.themePrimary)
                                        Width: =96
                                        X: =0
                                        Y: =0
                                        ZIndex: =2

                Rectangle2_2 As rectangle:
                    AlignInContainer: =AlignInContainer.Stretch
                    BorderColor: =RGBA(166, 166, 166, 1)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    DisabledFill: =RGBA(166, 166, 166, 1)
                    Fill: =ColorValue(AppTheme.palette.neutralLight)
                    FocusedBorderColor: =RGBA(0, 120, 212, 1)
                    Height: =1
                    HoverFill: =RGBA(0, 120, 212, 1)
                    PressedFill: =RGBA(0, 120, 212, 1)
                    ZIndex: =5

                conMainNav As groupContainer.horizontalAutoLayoutContainer:
                    FillPortions: =0
                    Height: =80
                    LayoutGap: =24
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    PaddingLeft: =conContentAll.PaddingLeft
                    ZIndex: =6

                    btnBack As Button:
                        AlignInContainer: =AlignInContainer.Center
                        BorderColor: =ColorValue(AppTheme.palette.neutralPrimary)
                        BorderStyle: =BorderStyle.Solid
                        BorderThickness: =1
                        ButtonType: ='Button.ButtonType'.Standard
                        DisplayMode: |-
                            =If(
                                configStep=1,
                                DisplayMode.Disabled,
                                DisplayMode.Edit
                            )
                        Height: =32
                        LayoutMinHeight: =32
                        LayoutMinWidth: =96
                        OnChange: =false
                        OnSelect: |-
                            =If(
                                configStep>1,
                                With(
                                    {
                                        nextConfigStep: configStep-1
                                    },
                            
                                    // Go to the next step.
                                    Set(configStep,nextConfigStep)
                                )
                            )
                        Text: ="Back"
                        Width: =72
                        X: =40
                        Y: =40
                        ZIndex: =1

                    btnNext As Button:
                        AlignInContainer: =AlignInContainer.Center
                        ButtonType: ='Button.ButtonType'.Primary
                        DisplayMode: =DisplayMode.Edit
                        Height: =32
                        LayoutMinHeight: =32
                        LayoutMinWidth: =96
                        OnChange: =false
                        OnSelect: |-
                            =With(
                                {
                                    nextConfigStep: configStep + 1,
                                    maxConfigStep: Max(
                                        colSetupSteps,
                                        Value(ItemKey)
                                    )
                                },
                                If(
                                    configStep < maxConfigStep,
                                    // Perform different actions depending on what the next step is.
                                    Switch(
                                        nextConfigStep,
                                        4,
                                        Set(ShowLoader, true);
                                        Set(ShowLoaderText, "Saving environment variables...");
                                        
                                        //delete old copies of the secrets
                                        If(mySecret = "Plain Text", RemoveIf('Environment Variable Values', 'Environment Variable Definition'.'Environment Variable Definition'=GUID(AzureSecretEnvVarDefnID)));
                                        RemoveIf('Environment Variable Values', 'Environment Variable Definition'.'Environment Variable Definition'=GUID(PlainTextEnvVarDefnID));
                            
                                        Clear(colMandatoryEnvVars);
                                        ForAll(
                                            galMandatoryEnvVars.AllItems,
                                            If(Not(ThisRecord.lblEnvVarSchema.Text = "Audit Logs - Client Azure Secret"),
                                            Collect(
                                                colMandatoryEnvVars,
                                                {
                                                    'Schema Name': ThisRecord.lblEnvVarSchema.Text,
                                                    Value: ThisRecord.txtEnvVarValue.Text
                                                }
                                            )
                                        ));
                                        ForAll(
                                            colMandatoryEnvVars As aPatch,
                                            Patch(
                                                [@'Environment Variable Values'],
                                                Defaults([@'Environment Variable Values']),
                                                {
                                                    'Schema Name': aPatch.'Schema Name',
                                                    Value: aPatch.Value
                                                }
                                            )
                                        );
                            
                                        Refresh('Environment Variable Values');
                                        Set(ShowLoader, true);
                                        Set(ShowLoaderText, "Starting subscription...");
                            
                                        UpdateIf(
                                            Filter(
                                                Processes,
                                                'Process Name' = "Admin | Audit Logs | Office 365 Management API Subscription"
                                            ),
                                            Status = 'Status (Processes)'.Draft,
                                            {Status: 'Status (Processes)'.Activated}
                                        );
                                        UpdateIf(
                                            Filter(
                                                Processes,
                                                'Process Name' = "Audit Log Wizard>Start Audit Log subscription"
                                            ),
                                            Status = 'Status (Processes)'.Draft,
                                            {Status: 'Status (Processes)'.Activated}
                                        );
                                        Patch(
                                            'Setup Wizard State metadata',
                                            Defaults('Setup Wizard State metadata'),
                                            {
                                                Name: "Audit Log",
                                                'Last Completed Step': 10,
                                                'Solution Name': "CenterofExcellenceCoreComponents",
                                                'Solution Version': coESolutionVersion
                                            }
                                        );
                                        Refresh('Setup Wizard State metadata');
                                    );
                                    Set(ShowLoader, false);
                                    Set(ShowLoaderText, "");
                            
                                    // Complete the current step.
                            If(
                                        !(configStep exactin colStepsCompleted.Value),
                                        Collect(
                                            colStepsCompleted,
                                            configStep
                                        )
                                    );
                                    // Go to the next step.
                            Set(
                                        configStep,
                                        nextConfigStep
                                    )
                                )
                            )
                        Text: ="Next"
                        Visible: =configStep<>Max(colSetupSteps,Value(ItemKey))
                        Width: =72
                        X: =0
                        Y: =0
                        ZIndex: =2

                    btnFinish As Button:
                        AlignInContainer: =AlignInContainer.Center
                        ButtonType: ='Button.ButtonType'.Primary
                        DisplayMode: =DisplayMode.Edit
                        Height: =32
                        LayoutMinHeight: =32
                        LayoutMinWidth: =96
                        OnChange: =false
                        OnSelect: =Navigate('More features')
                        Text: ="Done"
                        Visible: |-
                            =//configStep=Max(colSetupSteps,Value(ItemKey))
                            false
                            //hiding for now until we are back in the regular setup wizard
                        Width: =72
                        X: =0
                        Y: =0
                        ZIndex: =3

    panHelp As Panel:
        Buttons: =Blank()
        Fill: =panHelp.OverlayColor
        Height: =If(Self.Visible, App.Height, 0)
        OnButtonSelect: =
        OnCloseSelect: |-
            =UpdateContext({showHelp: false})
        Subtitle: ="Explore these links to documentation and filing issues."
        Title: ="Help"
        Visible: =showHelp
        Width: =If(Self.Visible, App.Width, 0)
        ZIndex: =2

    conHelpPanel As groupContainer.verticalAutoLayoutContainer:
        Height: =panHelp.ContentHeight-40
        LayoutDirection: =LayoutDirection.Vertical
        LayoutMode: =LayoutMode.Auto
        PaddingLeft: =20
        Visible: =panHelp.Visible
        Width: =panHelp.ContentWidth-20
        X: =panHelp.ContentX
        Y: =panHelp.ContentY+20
        ZIndex: =3

        galLinks As gallery.galleryVertical:
            '#CopilotOverlayLabel': ="Filtered"
            BorderColor: =RGBA(166, 166, 166, 1)
            FocusedBorderColor: =RGBA(0, 120, 212, 1)
            FocusedBorderThickness: =2
            Height: =panHelp.ContentHeight
            Items: |-
                =Table(
                    {
                        value: "Documentation",
                        url: "https://aka.ms/coestarterkit"
                    },
                    {
                        value: "Power Platform guidance",
                        url: "https://learn.microsoft.com/en-us/power-platform/guidance/"
                    },
                    {
                        value: "Walkthrough Videos",
                        url: "https://aka.ms/coekitvideos"
                    },
                    {
                        value: "Latest release",
                        url: "https://github.com/microsoft/coe-starter-kit/releases/latest"
                    },
                    {
                        value: "Raise an issue, question or feature ask",
                        url: "https://github.com/microsoft/coe-starter-kit/issues/new/choose"
                    },
                    {
                        value: "Office hours",
                        url: "https://aka.ms/coeofficehours"
                    }
                )
            Layout: =Layout.Vertical
            LayoutMinHeight: =287
            LayoutMinWidth: =320
            TemplateSize: =40
            Visible: =showHelp
            Width: =panHelp.ContentWidth - 10
            X: =panHelp.ContentX
            Y: =panHelp.ContentY + 10
            ZIndex: =1

            btnHelpLink As Button:
                Alignment: =Align.Left
                ButtonType: ='Button.ButtonType'.Standard
                DisplayMode: =DisplayMode.Edit
                Height: =32
                OnChange: =false
                OnSelect: =Launch(ThisItem.url)
                Text: =ThisItem.value
                TextColor: =ColorValue(AppTheme.palette.themePrimary)
                Width: =galLinks.TemplateWidth
                X: =0
                Y: =0
                ZIndex: =1

    dialogCantProceed As Dialog:
        Buttons: =Blank()
        ContentWidth: =dialogCantProceed.DialogWidth
        ContentX: = dialogCantProceed.Width/2-dialogCantProceed.DialogWidth/2
        ContentY: = dialogCantProceed.Height/2-dialogCantProceed.DialogHeight/2+DialogHeaderContainer.Height + Label3_1.Height
        DialogHeight: =450
        DialogWidth: =800
        Fill: =dialogCantProceed.OverlayColor
        Height: =If(Self.Visible, App.Height, 0)
        OnButtonSelect: =
        OnCloseSelect: =false
        SubTitle: ="Finish the Initial Setup first before proceeding. Use the 'Initial Setup' page to set up the inventory (core) components. Check out the documentation and video below to learn more about this feature."
        Title: ="Missing prerequisite"
        Visible: =IsBlank(LookUp('CoE Solution Metadata', RerunOnUpgrade = 'RerunOnUpgrade (CoE Solution Metadata)'.Yes && CoESolutionArea = "Inventory" && "Solution Metadata" in ObjectName).LastRun)
        Width: =If(Self.Visible, App.Width, 0)
        ZIndex: =4

    galDocs_1 As gallery.galleryVertical:
        '#CopilotOverlayLabel': ="Filtered"
        BorderColor: =RGBA(166, 166, 166, 1)
        FocusedBorderColor: =RGBA(0, 120, 212, 1)
        FocusedBorderThickness: =2
        Height: =dialogCantProceed.ContentHeight - 60
        Items: |-
            =Table(
                {
                    header: "Documentation",
                    url: "https://learn.microsoft.com/power-platform/guidance/coe/env-mgmt",
                    description: "Learn how to use the Environment Request management solution.",
                    icon: '10330-icon-eBooks-Intune'
                },
                {
                    header: "Video walkthrough",
                    url: "https://www.youtube.com/watch?v=16mspbGz1zA&list=PLi9EhCY4z99W5kzaPK1np6sv6AzMQDsXG",
                    description: "Watch this video for a walkthrough of the Environment and DLP request management solution.",
                    icon: youtube
                },
                {
                    header: "Environment strategy guidance",
                    url: "https://learn.microsoft.com/power-platform/guidance/adoption/environment-strategy",
                    description: "Check our guidance for planning your Environment strategy.",
                    icon: '10330-icon-eBooks-Intune'
                }
            )
        Layout: =Layout.Vertical
        ShowScrollbar: =false
        TemplateSize: =220
        Visible: =IsBlank(LookUp('CoE Solution Metadata', RerunOnUpgrade = 'RerunOnUpgrade (CoE Solution Metadata)'.Yes && CoESolutionArea = "Inventory" && "Solution Metadata" in ObjectName).LastRun)
        Width: =dialogCantProceed.ContentWidth
        WrapCount: =3
        X: =dialogCantProceed.ContentX + 10
        Y: =dialogCantProceed.ContentY + 80
        ZIndex: =5

        "Elevation3_3 As 'Fluent Elevation (1.0.20)'":
            Depth: ='PowerCAT.Elevation.Depth'.Depth4
            DisplayMode: =DisplayMode.Edit
            Height: =conDocs_1.Height
            HoverDepth: ='PowerCAT.Elevation.HoverDepth'.Depth8
            Width: =conDocs_1.Width
            X: =0+0
            Y: =0+0
            ZIndex: =1

        conDocs_1 As groupContainer.verticalAutoLayoutContainer:
            Height: =Parent.TemplateHeight-20
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutDirection: =LayoutDirection.Vertical
            LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
            LayoutMode: =LayoutMode.Auto
            Width: =Parent.TemplateWidth-20
            X: =0+0
            Y: =0+0
            ZIndex: =2

            conDocsHeader_1 As groupContainer.horizontalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.SetByContainer
                FillPortions: =0
                Height: =48
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                ZIndex: =1

                Image1_3 As image:
                    BorderColor: =RGBA(0, 0, 0, 0)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                    DisabledFill: =RGBA(0, 0, 0, 0)
                    Height: =48
                    HoverBorderColor: =RGBA(0, 0, 0, 0)
                    HoverFill: =RGBA(0, 0, 0, 0)
                    Image: =ThisItem.icon
                    PaddingBottom: =10
                    PaddingLeft: =10
                    PaddingRight: =10
                    PaddingTop: =10
                    PressedBorderColor: =RGBA(0, 0, 0, 0)
                    PressedFill: =RGBA(0, 0, 0, 0)
                    Width: =48
                    ZIndex: =1

                Label2_3 As Label:
                    AlignInContainer: =AlignInContainer.Stretch
                    DisplayMode: =DisplayMode.Edit
                    FontWeight: =FontWeight.Semibold
                    Height: =32
                    LayoutMinHeight: =32
                    LayoutMinWidth: =100
                    OnChange: =false
                    PaddingStart: =12
                    Text: =ThisItem.header
                    Width: =galDocs_1.TemplateWidth - Image1_3.Width - 20
                    X: =0
                    Y: =0
                    ZIndex: =2

                "Icon7_7 As 'Fluent Icon (1.0.20)'":
                    DisplayMode: =DisplayMode.Edit
                    Height: =48
                    IconName: ="OpenInNewWindow"
                    IconSize: =20
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    OnChange: =Launch(ThisItem.url, {}, LaunchTarget.New)
                    Theme: =AppThemeJson
                    Tooltip: ="launch"
                    Width: =40
                    X: =0
                    Y: =0
                    ZIndex: =4

            Rectangle2_17 As rectangle:
                BorderColor: =RGBA(166, 166, 166, 1)
                BorderStyle: =BorderStyle.None
                BorderThickness: =2
                DisabledFill: =RGBA(166, 166, 166, 1)
                Fill: =ColorValue(AppTheme.palette.neutralLight)
                FocusedBorderColor: =RGBA(0, 120, 212, 1)
                Height: =1
                HoverFill: =RGBA(0, 120, 212, 1)
                PressedFill: =RGBA(0, 120, 212, 1)
                Width: =1
                ZIndex: =2

            conAppsBody_3 As groupContainer.verticalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.SetByContainer
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                PaddingBottom: =Self.PaddingTop
                PaddingLeft: =16
                PaddingRight: =Self.PaddingLeft
                PaddingTop: =12
                ZIndex: =3

                Label4_3 As Label:
                    AlignInContainer: =AlignInContainer.Start
                    DisplayMode: =DisplayMode.Edit
                    FillPortions: =1
                    Height: =32
                    LayoutMinHeight: =32
                    LayoutMinWidth: =100
                    OnChange: =false
                    Text: =ThisItem.description
                    VerticalAlignment: =VerticalAlign.Top
                    Width: =galDocs_1.TemplateWidth - 50
                    X: =0
                    Y: =0
                    ZIndex: =1

                Button2_2 As Button:
                    AlignInContainer: =AlignInContainer.End
                    ButtonType: ='Button.ButtonType'.Standard
                    DisplayMode: =DisplayMode.Edit
                    Height: =32
                    LayoutMinHeight: =32
                    LayoutMinWidth: =96
                    OnChange: =false
                    OnSelect: =Launch(ThisItem.url)
                    Text: ="Learn more"
                    TextColor: =ColorValue(AppTheme.palette.themePrimary)
                    Width: =96
                    X: =0
                    Y: =0
                    ZIndex: =2

    panConfigureSecret As Panel:
        Buttons: |-
            =Table({Label: "Cancel", ButtonType:'Button.ButtonType'.Standard, Visible:true, Enabled:true } ,{Label: "Save secret", ButtonType:'Button.ButtonType'.Primary, Visible:true, Enabled:true })
        Fill: =panConfigureSecret.OverlayColor
        Height: =If(Self.Visible, App.Height, 0)
        OnButtonSelect: |-
            =Switch(
                Self.SelectedButton.Label,
                "Cancel",UpdateContext({showSecretConfig:false}),
                
                "Save secret",
                Set(ShowLoader, true);
                Set(ShowLoaderText, "Saving environment variables...");
                //delete old copies of the secrets
                RemoveIf('Environment Variable Values', 'Environment Variable Definition'.'Environment Variable Definition'=GUID(AzureSecretEnvVarDefnID));
                RemoveIf('Environment Variable Values', 'Environment Variable Definition'.'Environment Variable Definition'=GUID(PlainTextEnvVarDefnID));
                //update secret
                Patch(
                [@'Environment Variable Values'],
                Defaults([@'Environment Variable Values']),
                {
                    'Environment Variable Definition': LookUp(
                        [@'Environment Variable Definitions'],
                        'Schema Name' = "admin_AuditLogsClientAzureSecret"
                    ),
                    'Schema Name': "admin_AuditLogsClientAzureSecret",
                    Value: "/subscriptions/" & cmSubscription.Selected.subscriptionId & "/resourcegroups/" & cmResourceGroup.Selected.name & "/providers/microsoft.keyvault/vaults/" & cmKeyVault.Selected.name & "/secrets/" & txtSecret.Value
                }
                );
                Refresh('Environment Variable Values');
                Set(ShowLoader, false);
                Set(ShowLoaderText, "");
                Notify("Audig Logs - Client Azure Secret environment variable has been updated.", NotificationType.Success);
                UpdateContext({showSecretConfig:false})
            )
        OnCloseSelect: |
            =UpdateContext({showSecretConfig:false});
        Subtitle: ="The Azure Key Vault reference for the application client secret "
        Title: ="Configure Secret"
        Visible: =showSecretConfig
        Width: =If(Self.Visible, App.Width, 0)
        ZIndex: =6

    conConfigureSecret As groupContainer.verticalAutoLayoutContainer:
        Height: =panConfigureSecret.ContentHeight
        LayoutDirection: =LayoutDirection.Vertical
        LayoutGap: =10
        LayoutMode: =LayoutMode.Auto
        PaddingLeft: =20
        PaddingRight: =5
        PaddingTop: =20
        Visible: =showSecretConfig
        Width: =panConfigureSecret.ContentWidth-30
        X: =panConfigureSecret.ContentX
        Y: =panConfigureSecret.ContentY
        ZIndex: =7

        lblSubscription As Label:
            DisplayMode: =DisplayMode.Edit
            FontWeight: =FontWeight.Semibold
            Height: =32
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            OnChange: =false
            Text: ="Subscription"
            Width: =320
            X: =0
            Y: =0
            ZIndex: =3

        "cmSubscription As 'Combo box'.pcfdataset":
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Items: =Sort(AzureResourceManager.SubscriptionsList().value, displayName)
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            Width: =320
            X: =0
            Y: =0
            ZIndex: =4

            displayName1 As pcfDataField.textualColumn:
                FieldDisplayName: ="displayName"
                FieldName: ="displayName"
                FieldType: ="s"
                FieldVariantName: ="textualColumn"
                Order: =1
                ZIndex: =46

        lblResourceGroup As Label:
            DisplayMode: =DisplayMode.Edit
            FontWeight: =FontWeight.Semibold
            Height: =32
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            OnChange: =false
            Text: ="Resource Group"
            Width: =320
            X: =0
            Y: =0
            ZIndex: =5

        "cmResourceGroup As 'Combo box'.pcfdataset":
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Items: =IfError(Sort(AzureResourceManager.ResourceGroupsList(cmSubscription.Selected.subscriptionId).value, name), Blank())
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            Width: =320
            X: =0
            Y: =0
            ZIndex: =6

            name1 As pcfDataField.textualColumn:
                FieldDisplayName: ="name"
                FieldName: ="name"
                FieldType: ="s"
                FieldVariantName: ="textualColumn"
                Order: =1
                ZIndex: =47

        lblKeyVault As Label:
            DisplayMode: =DisplayMode.Edit
            FontWeight: =FontWeight.Semibold
            Height: =32
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            OnChange: =false
            Text: |-
                ="Key Vault
                "
            Width: =320
            X: =0
            Y: =0
            ZIndex: =7

        "cmKeyVault As 'Combo box'.pcfdataset":
            DisplayMode: =DisplayMode.Edit
            Height: =32
            Items: =IfError(Sort(Filter(AzureResourceManager.ResourceGroupsListResources(cmSubscription.Selected.subscriptionId, cmResourceGroup.Selected.name).value, type = "Microsoft.KeyVault/vaults"), name), Blank())
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            Width: =320
            X: =0
            Y: =0
            ZIndex: =8

            name1_1 As pcfDataField.textualColumn:
                FieldDisplayName: ="name"
                FieldName: ="name"
                FieldType: ="s"
                FieldVariantName: ="textualColumn"
                Order: =1
                ZIndex: =47

        lblSecret As Label:
            DisplayMode: =DisplayMode.Edit
            FontWeight: =FontWeight.Semibold
            Height: =32
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            OnChange: =false
            Text: ="Secret Name"
            Width: =320
            X: =0
            Y: =0
            ZIndex: =9

        "txtSecret As 'Text box'":
            DisplayMode: =DisplayMode.Edit
            Height: =32
            LayoutMinHeight: =32
            LayoutMinWidth: =320
            Placeholder: ="Enter Secret Name"
            Value: =""
            Width: =320
            X: =0
            Y: =0
            ZIndex: =10

    "Spinner1 As 'Fluent Spinner (1.0.20) Preview'":
        BackgroundColor: |-
            ="#ffffff"
        DisplayMode: =DisplayMode.Edit
        Height: =If(Self.Visible, App.Height, 0)
        Label: =ShowLoaderText
        Theme: =AppThemeJson
        Visible: =ShowLoader
        Width: =If(Self.Visible, App.Width, 0)
        X: =0
        Y: =0
        ZIndex: =8

