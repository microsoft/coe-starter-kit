App As appinfo:
    BackEnabled: =true
    Formulas: =
    OnStart: |
        =Concurrent(
            Set(
                AppTheme,
                {
                    palette: {
                        themePrimary: ColorValue("#0078d4"),
                        themeLighterAlt: ColorValue("#eff6fc"),
                        themeLighter: ColorValue("#deecf9"),
                        themeLight: ColorValue("#c7e0f4"),
                        themeTertiary: ColorValue("#71afe5"),
                        themeSecondary: ColorValue("#2b88d8"),
                        themeDarkAlt: ColorValue("#106ebe"),
                        themeDark: ColorValue("#005a9e"),
                        themeDarker: ColorValue("#004578"),
                        neutralLighterAlt: ColorValue("#faf9f8"),
                        neutralLighter: ColorValue("#f3f2f1"),
                        neutralLight: ColorValue("#edebe9"),
                        neutralQuaternaryAlt: ColorValue("#e1dfdd"),
                        neutralQuaternary: ColorValue("#d0d0d0"),
                        neutralTertiaryAlt: ColorValue("#c8c6c4"),
                        neutralTertiary: ColorValue("#a19f9d"),
                        neutralSecondary: ColorValue("#605e5c"),
                        neutralPrimaryAlt: ColorValue("#3b3a39"),
                        neutralPrimary: ColorValue("#323130"),
                        neutralDark: ColorValue("#201f1e"),
                        black: ColorValue("#000000"),
                        white: ColorValue("#ffffff")
                    }
                }
            ),
            Set(
                Style,
                {
                    Primary: "#70daef",
                    Secondary: "#8fcad6",
                    Tertiary: "#ededed",
                    PrimaryTextColor: "#000000",
                    Logo: "http://pngimg.com/uploads/microsoft/microsoft_PNG16.png"
                }
            );
            Set(
                boolPhotosForbidden,
                If(
                    txtPhotosForbidden = "yes",
                    true,
                    false
                )
            ),
            ClearCollect(
                colOrphanedFlows,
                Filter(
                    Flows,
                    'Flow is Orphaned' = "Yes" And 'Flow Deleted' = 'Flow Deleted (Flows)'.No And 'Flow is Published' <> 'Flow is Published (Flows)'.No
                )
            ),
            Set(
                EnvVarDefnID,
                LookUp(
                    'Environment Variable Definitions',
                    'Schema Name' = "admin_PowerAutomateEnvironmentVariable"
                ).'Environment Variable Definition'
            ),
            ClearCollect(
                vEnvironments,
                Filter(
                    Environments,
                    'Environment Deleted' = 'Environment Deleted (Environments)'.No
                )
            );
            
        );
        Concurrent(
            Set(
                AppThemeJson,
                JSON(AppTheme)
            ),
            Set(
                theFlowURL,
                First(
                    Filter(
                        'Environment Variable Values',
                        'Environment Variable Definition'.'Environment Variable Definition' = GUID(EnvVarDefnID)
                    )
                ).Value
            ),
            Set(
                txtPhotosForbidden,
                First(
                    Filter(
                        'Environment Variable Values',
                        'Environment Variable Definition'.'Environment Variable Definition' = GUID(EnvVarDefnID)
                    )
                ).Value
            ),
            If(
                IsBlank(theAppMakerURL),
                Set(
                    theAppMakerURL,
                    LookUp(
                        'Environment Variable Definitions',
                        'Environment Variable Definition' = GUID(EnvVarDefnID)
                    ).'Default Value'
                )
            )
        );
        If(
            IsBlank(txtPhotosForbidden),
            Set(
                txtPhotosForbidden,
                LookUp(
                    'Environment Variable Definitions',
                    'Environment Variable Definition' = GUID(EnvVarDefnID)
                ).'Default Value'
            )
        );
        Clear(EnvCheckedFlows);
        Clear(MakerCheckedFlows);
        Clear(OrphanedCheckedFlows);
        Set(
            selectedTab,
            "Environment"
        );
        Concurrent(
            Set(
                gblInitalsColors,
                [
                    {
                        Id: 1,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Blue
                    },
                    {
                        Id: 2,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.DarkBlue
                    },
                    {
                        Id: 3,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Burgundy
                    },
                    {
                        Id: 4,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.CoolGray
                    },
                    {
                        Id: 5,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Cyan
                    },
                    {
                        Id: 6,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.WarmGray
                    },
                    {
                        Id: 7,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Violet
                    },
                    {
                        Id: 8,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Teal
                    },
                    {
                        Id: 9,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Rust
                    },
                    {
                        Id: 10,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Purple
                    },
                    {
                        Id: 11,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Pink
                    },
                    {
                        Id: 12,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Orange
                    },
                    {
                        Id: 13,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Magenta
                    },
                    {
                        Id: 14,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.LightRed
                    },
                    {
                        Id: 15,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.LightPink
                    }
                ]
            ),
            ClearCollect(
                colMakers,
                ShowColumns(
                    AddColumns(
                        Filter(
                            Makers,
                            'Number of Flows' > 0
                        ),
                        MakerImage,
                        If(
                            boolPhotosForbidden,
                            Substitute(
                                JSON(
                                    PersonPlaceholder,
                                    JSONFormat.IncludeBinaryData
                                ),
                                """",
                                ""
                            ),
                            Substitute(
                                JSON(
                                    If(
                                        !IsBlankOrError(ThisRecord.PhotoObject.Value),
                                        ThisRecord.PhotoObject.Value,
                                        PersonPlaceholder
                                    ),
                                    JSONFormat.IncludeBinaryData
                                ),
                                """",
                                ""
                            )
                        ),
                        WarningImage,
                        If(
                            IsBlankOrError(ThisRecord.'Number Of UI Flows (State)'),
                            false,
                            true
                        ),
                        UserImage,
                        IfError(
                            Office365Users.UserPhotoMetadata(ThisRecord.'Record GUID as String').HasPhoto,
                            false,
                            Substitute(
                                JSON(
                                    Office365Users.UserPhotoV2(ThisRecord.'Record GUID as String'),
                                    JSONFormat.IgnoreBinaryData
                                ),
                                """",
                                ""
                            )
                        )
                    ),
                    'Display Name',
                    MakerImage,
                    Maker,
                    Environments,
                    'Record GUID as String',
                    UserImage
                )
            )
        );
        ClearCollect(
            colMakersAdded,
            AddColumns(
                colMakers,
                RecordKey,
                admin_recordguidasstring
            )
        );
        ClearCollect(
            colMakersAddedCols,
            ForAll(
                Sequence(CountRows(colMakersAdded)),
                Patch(
                    Last(
                        FirstN(
                            colMakersAdded,
                            Value
                        )
                    ),
                    {RowNumber: Value}
                )
            )
        );
    StartScreen: =HomeScreen
    Theme: =PowerAppsTheme

    Host As hostControl.DefaultHostControlVariant:
        OnCancel: =false
        OnEdit: =false
        OnNew: =false
        OnSave: =false
        OnView: =false

