HomeScreen As screen:
    LoadingSpinnerColor: =RGBA(0, 120, 212, 1)
    OnVisible: |+
        =UpdateContext({var_ShowSpinner: false,showAddUsers:false,ctxUpdatesInProgress:false});
        ClearCollect(
            colEnvironments,
            Filter(
                Environments,
                'Environment Deleted' = 'Environment Deleted (Environments)'.No And 'Number Of Flows' > 0
            )
        );
        
        UpdateContext(
            {
                ctxSortAsc: true
            }
        );
        ClearCollect(
            colMakers,
            ShowColumns(
                AddColumns(
                    Filter(
                        Makers,
                        'Number of Flows' > 0
                    ),
                    MakerImage,
                    If(
                        boolPhotosForbidden,
                        Substitute(
                            JSON(
                                PersonPlaceholder,
                                JSONFormat.IncludeBinaryData
                            ),
                            """",
                            ""
                        ),
                        Substitute(
                            JSON(
                                If(
                                    !IsBlankOrError(ThisRecord.PhotoObject.Value),
                                    ThisRecord.PhotoObject.Value,
                                    PersonPlaceholder
                                ),
                                JSONFormat.IncludeBinaryData
                            ),
                            """",
                            ""
                        )
                    ),
                    
                    WarningImage,
                    If(
                        IsBlankOrError(ThisRecord.'Number Of UI Flows (State)'),
                        false,
                        true
                    )
                ),
                'Display Name',
                MakerImage,
                Maker,
                Environments,
                'Record GUID as String'
            )
        );
        
        ClearCollect(
            colMakersAdded,
            AddColumns(
                colMakers,
                RecordKey,
                admin_recordguidasstring
            )
        );
        
        Select(btnOrphanedFlows);
        Set(
            WorkflowEntityId,
            If(
                IsBlank(ctxFlowToUpdate),
                First(
                    Filter(
                        Flows,
                        'Flow Deleted' = 'Flow Deleted (Flows)'.No
                    )
                ).WorkflowEntityId,
                LookUp(
                    Flows,
                    //Flow = GUID(gloSelectedRecordID)
                    Flow = GUID(ctxFlowToUpdate.FlowName)
                ).WorkflowEntityId
            )
        );
        

    SpinnerDeleteFlows As Spinner:
        AccessibleLabel: ="Deleting Flows"
        BasePaletteColor: =
        DisplayMode: =DisplayMode.Edit
        Font: =""
        FontColor: =
        FontItalic: =false
        FontStrikethrough: =false
        FontUnderline: =false
        FontWeight: =""
        Height: =Parent.Height
        Label: =ctx_DeleteMsg
        Visible: =ctxDeleteSpinner
        Width: =Parent.Width
        X: =0
        Y: =0
        ZIndex: =1

    Hidden_UpdateTable_Flow As Button:
        BorderColor: =
        ButtonType: ='Button.ButtonType'.Standard
        DisabledBorderColor: =
        DisabledFillColor: =
        DisabledTextColor: =
        DisplayMode: =DisplayMode.Edit
        FillColor: =
        Height: =0
        HoverBorderColor: =
        HoverFillColor: =
        HoverTextColor: =
        OnChange: =false
        OnSelect: |
            =UpdateContext({var_ShowShimmer: true});
            If(
                (selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1),
                UpdateContext(
                    {
                        ctxFlowToUpdate: Switch(
                            selectedTab,
                            "Environment",
                            First(EnvCheckedFlows),
                            "Owner",
                            First(MakerCheckedFlows),
                            "Orphaned flows",
                            First(OrphanedCheckedFlows)
                        )
                    }
                );
                
            );
            
            ClearCollect(
                temproleAssignmentsCollection,
                PowerAutomateforAdmins.GetAdminFlowOwnerRole(
                    ctxFlowToUpdate.EnvName,
                    ctxFlowToUpdate.FlowName
                ).value
            );
            ClearCollect(
                roleAssignmentsCollection,
                AddColumns(
                    temproleAssignmentsCollection,
                    RowKey,
                    properties.principal.id,
                    Name,
                        //tenant
                    If(
                        properties.principal.type = "Tenant",
                        "Entire Org",
                        //group
                        If(
                            properties.principal.type = "Group",
                            If(
                                IsError(Office365Groups.ListGroups({'$filter': "id eq " & "'" & properties.principal.id & "'"}).value),
                                "Unknown Group",
                                "Group: " & First(Office365Groups.ListGroups({'$filter': "id eq " & "'" & properties.principal.id & "'"}).value).displayName
                            ),
                        //user
                            If(
                                !IsError(Office365Users.UserProfile(properties.principal.id).DisplayName),
                                Office365Users.UserProfile(properties.principal.id).DisplayName,
                        //orphan
                                If(
                                    CountRows(
                                        Filter(
                                            'Power Platform Users',
                                            'Record GUID as String' = name
                                        )
                                    ) > 0,
                                    LookUp(
                                        'Power Platform Users',
                                        'Record GUID as String' = name
                                    ).'Display Name',
                                    "Unknown user"
                                )
                            )
                        )
                    ),
                    Image,
                    If(
                        !IsBlank(properties.principal.id),
                        If(
                            properties.principal.type <> "User",
                            Substitute(
                                JSON(
                                    PersonPlaceholder,
                                    JSONFormat.IncludeBinaryData
                                ),
                                """",
                                ""
                            ),
                            If(
                                IfError(
                                    Office365Users.UserPhotoMetadata(properties.principal.id).HasPhoto,
                                    false
                                ),
                                Substitute(
                                    JSON(
                                        Office365Users.UserPhotoV2(properties.principal.id),
                                        JSONFormat.IncludeBinaryData
                                    ),
                                    """",
                                    ""
                                ),
                                If(
                                    !IsBlankOrError(
                                        First(
                                            Search(
                                                'Power Platform Users',
                                                ThisRecord.properties.principal.id,
                                                'Record GUID as String'
                                            )
                                        ).PhotoObject
                                    ),
                                    Substitute(
                                        JSON(
                                            First(
                                                Search(
                                                    'Power Platform Users',
                                                    ThisRecord.properties.principal.id,
                                                    'Record GUID as String'
                                                )
                                            ).PhotoObject,
                                            JSONFormat.IncludeBinaryData
                                        ),
                                        """",
                                        ""
                                    ),
                                    Substitute(
                                        JSON(
                                            PersonPlaceholder,
                                            JSONFormat.IncludeBinaryData
                                        ),
                                        """",
                                        ""
                                    )
                                )
                            )
                        )
                    ),
                    Email,
                        //tenant
                    If(
                        properties.principal.type = "Tenant",
                        "",
                        //group
                        If(
                            properties.principal.type = "Group",
                            If(
                                IsError(Office365Groups.ListGroups({'$filter': "id eq " & "'" & properties.principal.id & "'"}).value),
                                "Unknown Group",
                                First(Office365Groups.ListGroups({'$filter': "id eq " & "'" & properties.principal.id & "'"}).value).mail
                            ),
                        //user
                            If(
                                !IsError(Office365Users.UserProfile(properties.principal.id).UserPrincipalName),
                                Office365Users.UserProfile(properties.principal.id).UserPrincipalName,
                        //orphan
                                If(
                                    CountRows(
                                        Filter(
                                            'Power Platform Users',
                                            'Record GUID as String' = name
                                        )
                                    ) > 0,
                                    LookUp(
                                        'Power Platform Users',
                                        'Record GUID as String' = name
                                    ).'User Principal Name',
                                    ""
                                )
                            )
                        )
                    ),
                    Role,
                    properties.roleName,
                    UserType,
                    If(
                        properties.principal.type = "User",
                        IfError(
                            Office365Users.UserProfileV2(properties.principal.id).userType,
                            Blank()
                        )
                    )
                )
            );
            UpdateContext({var_ShowShimmer: false});
        PressedBorderColor: =
        PressedFillColor: =
        PressedTextColor: =
        Text: ="Non"
        TextColor: =
        Visible: =false
        Width: =0
        X: =40
        Y: =40
        ZIndex: =2

    MainHomeScreenContainer As groupContainer.horizontalAutoLayoutContainer:
        DropShadow: =DropShadow.Light
        Height: =Parent.Height
        LayoutMode: =LayoutMode.Auto
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Width: =Parent.Width
        ZIndex: =3

        LeftHomeScreenContainer As groupContainer.verticalAutoLayoutContainer:
            BorderStyle: =BorderStyle.None
            Fill: =RGBA(122, 138, 143, 0.12)
            FillPortions: =2
            LayoutDirection: =LayoutDirection.Vertical
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingBottom: =App.ActiveScreen.Width * 0.01
            PaddingLeft: =App.ActiveScreen.Width * 0.01
            PaddingRight: =App.ActiveScreen.Width * 0.01
            RadiusBottomLeft: =4
            RadiusBottomRight: =4
            RadiusTopLeft: =4
            RadiusTopRight: =4
            ZIndex: =1

            ActionHomeScreenContainer As groupContainer.horizontalAutoLayoutContainer:
                BorderStyle: =BorderStyle.None
                FillPortions: =0
                Height: =50
                LayoutMinHeight: =50
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                ZIndex: =1

                "cbActions As 'Fluent Command Bar (1.1.29)'.pcfdataset":
                    AccessibilityLabel: ="Flows Command Bar"
                    AlignInContainer: =AlignInContainer.Stretch
                    DisplayMode: =DisplayMode.Edit
                    FillPortions: =1
                    Height: =200
                    Items: |-
                        =Table(
                            {
                                ItemKey: "addpermissions",
                                ItemDisplayName: "Manage permissions",
                                ItemIconName: "PeopleAdd",
                                ItemEnabled: Switch(
                                    selectedTab,
                                    "Environment",
                                    !IsEmpty(galEnvFlows.AllItems) && (CountRows(EnvCheckedFlows) > 0),
                                    "Owner",
                                    !IsEmpty(galFlowsMaker.AllItems) && (CountRows(MakerCheckedFlows) > 0),
                                    "Orphaned flows",
                                    !IsEmpty(galOrphanedFlows.AllItems) && (CountRows(OrphanedCheckedFlows) > 0)
                                ),
                                ItemVisible: Switch(
                                    selectedTab,
                                    "Environment",
                                    true,
                                    "Owner",
                                    true,
                                    "Orphaned flows",
                                    true
                                )
                            },
                            {
                                ItemKey: "deleteorphanedflow",
                                ItemDisplayName: "Delete Selected",
                                ItemIconName: "Delete",
                                ItemVisible: Switch(
                                    selectedTab,
                                    "Environment",
                                    false,
                                    "Owner",
                                    false,
                                    "Orphaned flows",
                                    true
                                ),
                                ItemEnabled: Switch(
                                    selectedTab,
                                    "Environment",
                                    false,
                                    "Owner",
                                    false,
                                    "Orphaned flows",
                                    (CountRows(OrphanedCheckedFlows) > 0)
                                )
                            },
                            {
                                ItemKey: "flowdetails",
                                ItemDisplayName: "Flow Details",
                                ItemIconName: "Info",
                                ItemVisible: Switch(
                                    selectedTab,
                                    "Environment",
                                    false,
                                    "Owner",
                                    false,
                                    "Orphaned flows",
                                    (CountRows(OrphanedCheckedFlows) = 1)
                                ),
                                ItemEnabled: Switch(
                                    selectedTab,
                                    "Environment",
                                    false,
                                    "Owner",
                                    false,
                                    "Orphaned flows",
                                    (CountRows(OrphanedCheckedFlows) = 1)
                                )
                            },
                            {
                                ItemKey: "refresh",
                                ItemDisplayName: "Refresh",
                                ItemIconName: "Refresh"
                            }
                        )
                    LayoutMinHeight: =30
                    LayoutMinWidth: =200
                    OnSelect: |-
                        =Switch(
                            Self.Selected.ItemKey,
                            "addpermissions",
                            Clear(roleAssignmentsCollection);
                            UpdateContext({galleryRefreshed: false});
                            UpdateContext(
                                {
                                    ctxFlowsToUpdate: Switch(
                                        selectedTab,
                                        "Environment",
                                        EnvCheckedFlows,
                                        "Owner",
                                        MakerCheckedFlows,
                                        "Orphaned flows",
                                        OrphanedCheckedFlows
                                    )
                                }
                            );
                            If(
                                (selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1),
                                Select(Hidden_UpdateTable_Flow);
                                UpdateContext({var_pivotkey: "tabMembers"});
                                ,
                                UpdateContext({var_pivotkey: "tabAddUser"});
                            );
                            UpdateContext(
                                {showAddUsers: true
                                    //var_pivotkey: "tabMembers"
                        }
                            );
                            ,
                            "deleteorphanedflow",
                            UpdateContext({showDeleteSelected: true}),
                            "flowdetails",
                            Launch(
                                theFlowURL & LookUp(
                                    Flows,
                                    (FlowIDString = galOrphanedFlows.Selected.FlowIDString)
                                ).'Flow Environment ID' & "/flows/" & galOrphanedFlows.Selected.FlowIDString & "/details"
                            );
                            ,
                            "refresh",
                            Refresh('Power Platform Users');
                            Refresh(Makers);
                            Refresh(Flows);
                            UpdateContext({galleryRefreshed: true});
                            Reset(chkSelectAll);
                            Reset(chkSelectAllFlow);
                            Reset(chkSelectAllOrphanedFlows);
                            Clear(EnvCheckedFlows);
                            Clear(MakerCheckedFlows);
                            Clear(OrphanedCheckedFlows);
                            
                        )
                    Theme: =AppThemeJson
                    Width: =500
                    X: =0
                    Y: =0
                    ZIndex: =1

                "txtSearchFlows As 'Text input'":
                    Align: ='TextInputCanvas.Align'.Start
                    AlignInContainer: =AlignInContainer.Center
                    BasePaletteColor: =RGBA(122,138,143,0.13)
                    DelayOutput: =true
                    DisplayMode: |-
                        =If(
                            !ctxUpdatesInProgress,
                            DisplayMode.Edit,
                            DisplayMode.Disabled
                        )
                    FontColor: =
                    Height: =32
                    LayoutMinHeight: =32
                    LayoutMinWidth: =206
                    OnChange: |
                        =UpdateContext({galleryRefreshed: true});
                        Reset(chkSelectAll);
                        Reset(chkSelectAllFlow);
                        Reset(chkSelectAllOrphanedFlows);
                        Clear(EnvCheckedFlows);
                        Clear(MakerCheckedFlows);
                        Clear(OrphanedCheckedFlows);
                    Placeholder: ="Search flows.."
                    Type: ='TextInputCanvas.Type'.Search
                    Width: =206
                    X: =1135
                    Y: =0
                    ZIndex: =2

            DetailsHomeScreenContainer As groupContainer.verticalAutoLayoutContainer:
                DropShadow: =DropShadow.Light
                Fill: =RGBA(255, 255, 255, 1)
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                ZIndex: =2

                conMainHome As groupContainer.verticalAutoLayoutContainer:
                    Height: =Parent.Height
                    LayoutAlignItems: =LayoutAlignItems.Stretch
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutGap: =5
                    LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    Width: =Parent.Width
                    X: =0   
                    Y: =0   
                    ZIndex: =1

                    c_Header As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =120
                        LayoutAlignItems: =LayoutAlignItems.Stretch
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        PaddingBottom: =20
                        PaddingLeft: =20
                        PaddingRight: =20
                        PaddingTop: =20
                        ZIndex: =2

                        Label1 As Label:
                            AutoHeight: =true
                            Color: =
                            DisplayMode: =DisplayMode.Edit
                            FontSize: =16
                            FontWeight: =FontWeight.Semibold
                            Height: =43
                            LayoutMinHeight: =32
                            LayoutMinWidth: =320
                            OnChange: =false
                            PaddingStart: =0  
                            Text: ="Admin - Flow Permission Center"
                            Width: =320
                            X: =35
                            Y: =15
                            ZIndex: =1

                        lblTitle_5 As Label:
                            AlignInContainer: =AlignInContainer.Stretch
                            AutoHeight: =true
                            Color: =    
                            DisplayMode: =DisplayMode.View
                            FontSize: =11
                            FontWeight: =FontWeight.Normal
                            Height: =80
                            LayoutMinHeight: =80
                            LayoutMinWidth: =320
                            OnChange: =false
                            Text: ="As a global admin, environment admin or business application admin this app can be used to re-assign flow owner roles or add new users to a flow."
                            VerticalAlignment: =VerticalAlign.Top
                            Width: =840
                            Wrap: =true
                            X: =0
                            Y: =0
                            ZIndex: =5

                    conFlows As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutGap: |
                            =//5
                            16
                        LayoutMinHeight: =50
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        PaddingBottom: =20
                        PaddingLeft: =20
                        PaddingRight: =20
                        PaddingTop: =20
                        RadiusBottomLeft: =4
                        RadiusBottomRight: =4
                        RadiusTopLeft: =4
                        RadiusTopRight: =4
                        Width: =Parent.Width
                        ZIndex: =8

                        conTabs_1 As groupContainer.horizontalAutoLayoutContainer:
                            FillPortions: =0
                            Height: =50
                            LayoutGap: =8
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            PaddingLeft: =2
                            ZIndex: =1

                            Container5_1 As groupContainer.horizontalAutoLayoutContainer:
                                AlignInContainer: =AlignInContainer.Center
                                BorderColor: =RGBA(199, 199, 199,1)
                                BorderThickness: =1
                                Fill: |-
                                    =If(
                                        selectedTab = "Environment",
                                        RGBA(
                                            116,
                                            39,
                                            116,
                                            1
                                        ),
                                        RGBA(
                                            0,
                                            0,
                                            0,
                                            0
                                        )
                                    )
                                FillPortions: =0
                                Height: =32
                                LayoutGap: =5
                                LayoutMinHeight: =100
                                LayoutMinWidth: =250
                                LayoutMode: =LayoutMode.Auto
                                PaddingLeft: =5
                                RadiusBottomLeft: =16
                                RadiusBottomRight: =16
                                RadiusTopLeft: =16
                                RadiusTopRight: =16
                                Width: =130
                                ZIndex: =1

                                "Icon3_1 As 'Fluent Icon (1.1.29)'":
                                    DisplayMode: |-
                                        =If(
                                            !ctxUpdatesInProgress,
                                            DisplayMode.Edit,
                                            DisplayMode.Disabled
                                        )
                                    FillColor: =
                                    FontColor: |-
                                        =If(selectedTab="Environment","#ffffff","#000000")
                                    FontSize: =14
                                    Height: =32
                                    HoverFillColor: =""
                                    HoverFontColor: =""
                                    IconColor: =
                                    IconName: ="MapLayers"
                                    IconType: ='PowerCAT.Icon.IconType'.ActionButton
                                    LayoutMinHeight: =200
                                    LayoutMinWidth: =200
                                    OnChange: |
                                        =Set(
                                            selectedTab,
                                            "Environment"
                                        );
                                        UpdateContext({showAddUsers: false});
                                    Text: ="Environments"
                                    TextAlignment: ='PowerCAT.Icon.TextAlignment'.Left
                                    Tooltip: =""
                                    Width: =32
                                    X: =0
                                    Y: =0
                                    ZIndex: =1

                            Container5_2 As groupContainer.horizontalAutoLayoutContainer:
                                AlignInContainer: =AlignInContainer.Center
                                BorderColor: =RGBA(199, 199, 199,1)
                                BorderThickness: =1
                                Fill: |-
                                    =If(
                                        selectedTab = "Owner",
                                        RGBA(
                                            116,
                                            39,
                                            116,
                                            1
                                        ),
                                        RGBA(
                                            0,
                                            0,
                                            0,
                                            0
                                        )
                                    )
                                FillPortions: =0
                                Height: =32
                                LayoutGap: =5
                                LayoutMinHeight: =100
                                LayoutMinWidth: =250
                                LayoutMode: =LayoutMode.Auto
                                PaddingLeft: =5
                                RadiusBottomLeft: =16
                                RadiusBottomRight: =16
                                RadiusTopLeft: =16
                                RadiusTopRight: =16
                                Width: |-
                                    =//130
                                    90
                                ZIndex: =2

                                "Icon3_2 As 'Fluent Icon (1.1.29)'":
                                    DisplayMode: |-
                                        =If(
                                            !ctxUpdatesInProgress,
                                            DisplayMode.Edit,
                                            DisplayMode.Disabled
                                        )
                                    FillColor: =
                                    FontColor: |-
                                        =If(selectedTab="Owner","#ffffff","#000000")
                                    FontSize: =14
                                    Height: =32
                                    IconColor: =
                                    IconName: ="ContactList"
                                    IconType: ='PowerCAT.Icon.IconType'.ActionButton
                                    LayoutMinHeight: =200
                                    LayoutMinWidth: =200
                                    OnChange: |
                                        =Set(
                                            selectedTab,
                                            "Owner"
                                        );
                                        UpdateContext({showAddUsers: false});
                                    Text: ="Owner"
                                    TextAlignment: ='PowerCAT.Icon.TextAlignment'.Left
                                    Tooltip: =""
                                    Width: =32
                                    X: =0
                                    Y: =0
                                    ZIndex: =1

                            Container5_3 As groupContainer.horizontalAutoLayoutContainer:
                                AlignInContainer: =AlignInContainer.Center
                                BorderColor: =RGBA(199, 199, 199,1)
                                BorderThickness: =1
                                Fill: |-
                                    =If(
                                        selectedTab = "Orphaned flows",
                                        RGBA(
                                            116,
                                            39,
                                            116,
                                            1
                                        ),
                                        RGBA(
                                            0,
                                            0,
                                            0,
                                            0
                                        )
                                    )
                                FillPortions: =0
                                Height: =32
                                LayoutGap: =5
                                LayoutMinHeight: =100
                                LayoutMinWidth: =250
                                LayoutMode: =LayoutMode.Auto
                                PaddingLeft: =5
                                RadiusBottomLeft: =16
                                RadiusBottomRight: =16
                                RadiusTopLeft: =16
                                RadiusTopRight: =16
                                Width: =150
                                ZIndex: =3

                                "Icon3_3 As 'Fluent Icon (1.1.29)'":
                                    DisplayMode: |-
                                        =If(
                                            !ctxUpdatesInProgress,
                                            DisplayMode.Edit,
                                            DisplayMode.Disabled
                                        )
                                    FillColor: =
                                    FillPortions: =1
                                    FontColor: |-
                                        =If(selectedTab="Orphaned flows","#ffffff","#000000")
                                    FontSize: =14
                                    Height: =32
                                    IconColor: =
                                    IconName: ="RemoveLink"
                                    IconType: ='PowerCAT.Icon.IconType'.ActionButton
                                    LayoutMinHeight: =200
                                    LayoutMinWidth: =200
                                    OnChange: |
                                        =Set(
                                            selectedTab,
                                            "Orphaned flows"
                                        );
                                        UpdateContext({showAddUsers: false});
                                    Text: ="Orphaned flows"
                                    TextAlignment: ='PowerCAT.Icon.TextAlignment'.Left
                                    Tooltip: =""
                                    Width: |-
                                        =//32
                                        60
                                    X: =0
                                    Y: =0
                                    ZIndex: =1

                        conEnvironmentFlows As groupContainer.horizontalAutoLayoutContainer:
                            LayoutGap: =10
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            PaddingTop: =10
                            RadiusBottomLeft: =4
                            RadiusBottomRight: =4
                            RadiusTopLeft: =4
                            RadiusTopRight: =4
                            Visible: |
                                =(selectedTab = "Environment")
                            ZIndex: =3

                            conLeft As groupContainer.verticalAutoLayoutContainer:
                                BorderStyle: =BorderStyle.None
                                LayoutDirection: =LayoutDirection.Vertical
                                LayoutGap: =5
                                LayoutMinHeight: =100
                                LayoutMinWidth: |-
                                    =//Parent.Width
                                    250
                                LayoutMode: =LayoutMode.Auto
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                Width: |
                                    =//Parent.Width*0.2
                                    Parent.Width*0.2
                                ZIndex: =1

                                conSortEnvs As groupContainer.horizontalAutoLayoutContainer:
                                    AlignInContainer: =AlignInContainer.Start
                                    Fill: |-
                                        =//RGBA(0, 0, 0, 0)
                                        RGBA(245, 245, 245, 1)
                                    FillPortions: =0
                                    Height: =35
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    Width: |-
                                        =//500
                                        Parent.Width
                                    ZIndex: =1

                                    "iconSort As 'Fluent Icon (1.1.29)'":
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FillColor: =
                                        Height: =Parent.Height
                                        HoverFillColor: |-
                                            ="#0000000"
                                        IconColor: =""
                                        IconName: ="Sort"
                                        LayoutMinHeight: =200
                                        LayoutMinWidth: =200
                                        OnChange: |-
                                            =UpdateContext({ctxSortAsc:!ctxSortAsc})
                                        Theme: =AppThemeJson
                                        Tooltip: ="Sort Environments"
                                        Width: =30
                                        X: =0
                                        Y: =0
                                        ZIndex: =1

                                    "txtSrchEnvironments As 'Text input'":
                                        AccessibleLabel: ="Search Environments"
                                        BasePaletteColor: =
                                        DelayOutput: =true
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FontColor: =
                                        Height: =Parent.Height
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =320
                                        OnChange: |+
                                            =//false
                                            Reset(chkSelectAll);
                                            Clear(EnvCheckedFlows);
                                            
                                        Placeholder: ="Search environments"
                                        Type: ='TextInputCanvas.Type'.Search
                                        Width: =Parent.Width-iconSort.Width-5
                                        X: =0
                                        Y: =0
                                        ZIndex: =2

                                galEnvironments As gallery.galleryVertical:
                                    '#CopilotOverlayLabel': ="Filtered"
                                    AlignInContainer: =AlignInContainer.Start
                                    BorderColor: |
                                        =//ColorValue(Style.Tertiary)
                                    BorderStyle: =BorderStyle.None
                                    DisabledBorderColor: =galEnvironments.BorderColor
                                    DisabledFill: =galEnvironments.Fill
                                    Fill: =RGBA(255, 255, 255, 1)
                                    Height: =845
                                    HoverBorderColor: =galEnvironments.BorderColor
                                    HoverFill: =galEnvironments.Fill
                                    Items: |-
                                        =SortByColumns(
                                            Filter(
                                                vEnvironments,
                                                txtSrchEnvironments.Value in 'Display Name' && 'Number Of Flows' > 0
                                            ),
                                            "admin_displayname",
                                            If(
                                                ctxSortAsc,
                                                SortOrder.Ascending,
                                                SortOrder.Descending
                                            )
                                        )
                                    Layout: =Layout.Vertical
                                    LayoutMinHeight: =287
                                    LayoutMinWidth: =320
                                    LoadingSpinnerColor: =galEnvironments.BorderColor
                                    OnSelect: |
                                        =Clear(EnvCheckedFlows);
                                        Reset(chkSelectAll);
                                    PressedBorderColor: =galEnvironments.BorderColor
                                    PressedFill: =galEnvironments.Fill
                                    Selectable: =!ctxUpdatesInProgress
                                    ShowScrollbar: =false
                                    TemplateFill: =If(ThisItem.IsSelected, ColorValue(Style.Tertiary), Color.White)
                                    TemplatePadding: |-
                                        =//5
                                        0
                                    TemplateSize: =35
                                    Width: |
                                        =//390
                                        Parent.Width
                                    X: =62
                                    ZIndex: =5

                                    lblDisplayName As Label:
                                        AutoHeight: =false
                                        Color: =
                                        DisplayMode: =DisplayMode.Edit
                                        Height: =38
                                        OnChange: =false
                                        OnSelect: |-
                                            =//Select(Parent)
                                            Select(galEnvironments);
                                        PaddingBottom: =5
                                        PaddingEnd: =5
                                        PaddingStart: =5
                                        PaddingTop: =5
                                        Text: =ThisItem.'Display Name'
                                        VerticalAlignment: =VerticalAlign.Middle
                                        Width: =Parent.TemplateWidth-iconEnvironment.Width
                                        Wrap: =true
                                        X: |-
                                            =//35
                                            iconEnvironment.X+iconEnvironment.Width
                                        Y: =0
                                        ZIndex: =1

                                    "iconEnvironment As 'Fluent Icon (1.1.29)'":
                                        DisplayMode: =DisplayMode.Edit
                                        Height: =Parent.TemplateHeight
                                        IconName: ="MapLayers"
                                        OnChange: |-
                                            =//Select(Parent)
                                            Select(galEnvironments)
                                        Theme: =AppThemeJson
                                        Tooltip: ="Environment"
                                        Width: =30
                                        X: =0
                                        Y: =0
                                        ZIndex: =4

                            conEnvFlowsPaging As groupContainer.verticalAutoLayoutContainer:
                                AlignInContainer: =AlignInContainer.SetByContainer
                                FillPortions: =4
                                Height: =Parent.Height
                                LayoutDirection: =LayoutDirection.Vertical
                                LayoutMinHeight: =100
                                LayoutMinWidth: =200
                                LayoutMode: =LayoutMode.Auto
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                Visible: =(selectedTab = "Environment")
                                Width: =Parent.Width*0.8
                                ZIndex: =2

                                Container7 As groupContainer.horizontalAutoLayoutContainer:
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =1
                                    Fill: =RGBA(122, 138, 143, 0.12)
                                    FillPortions: =0
                                    Height: =35
                                    LayoutGap: =5
                                    LayoutMinHeight: =35
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    PaddingLeft: =5
                                    RadiusBottomLeft: =4
                                    RadiusBottomRight: =4
                                    RadiusTopLeft: =4
                                    RadiusTopRight: =4
                                    Width: =Parent.Width
                                    ZIndex: =1

                                    chkSelectAll As checkbox:
                                        AlignInContainer: =AlignInContainer.Start
                                        BorderColor: =ColorValue(Style.Primary)
                                        CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                        CheckboxSize: =25
                                        Color: =RGBA(0, 0, 0, 1)
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FocusedBorderColor: =chkSelectAll.BorderColor
                                        FocusedBorderThickness: =0
                                        Font: =Font.Arial
                                        Height: =Parent.Height
                                        HoverBorderColor: =ColorFade(chkSelectAll.BorderColor, 30%)
                                        HoverColor: =RGBA(0, 18, 107, 1)
                                        HoverFill: =ColorFade(chkSelectAll.Fill, 30%)
                                        OnCheck: |+
                                            =Clear(EnvCheckedFlows);
                                            ForAll(
                                                galEnvFlows.AllItems,
                                                If(
                                                    !isSolutionFlow,
                                                    Collect(
                                                        EnvCheckedFlows,
                                                        {
                                                            FlowName: Flow,
                                                            FlowOwner: DerivedOwner,
                                                            FlowIsOrphaned: 'Flow is Orphaned',
                                                            Environment: 'Flow Environment'.Environment,
                                                            EnvName: 'Flow Environment'.Name
                                                        }
                                                    )
                                                )
                                            );
                                            
                                            
                                            
                                        OnUncheck: |
                                            =Clear(EnvCheckedFlows);
                                        PaddingLeft: =5
                                        PressedBorderColor: =ColorFade(chkSelectAll.BorderColor, -30%)
                                        PressedColor: =ColorValue(Style.Primary)
                                        PressedFill: =ColorFade(chkSelectAll.Fill, -30%)
                                        Size: =13
                                        Text: =""
                                        Width: =35
                                        X: =17
                                        Y: =0   
                                        ZIndex: =1

                                    lblAppDisplayName As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =2.5
                                        FocusedBorderColor: =lblAppDisplayName.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =Parent.Height
                                        HoverBorderColor: =lblAppDisplayName.BorderColor
                                        HoverColor: =lblAppDisplayName.Color
                                        HoverFill: =lblAppDisplayName.Fill
                                        LayoutMinWidth: |
                                            =100
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =lblAppDisplayName.BorderColor
                                        PressedColor: =lblAppDisplayName.Color
                                        PressedFill: =lblAppDisplayName.Fill
                                        Size: =10
                                        Text: ="Flow display name"
                                        Width: |-
                                            =//390
                                            500
                                        Wrap: =false
                                        X: =33
                                        ZIndex: =2

                                    lblAppCurrentOwner As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =1
                                        FocusedBorderColor: =lblAppCurrentOwner.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =Parent.Height
                                        HoverBorderColor: =lblAppCurrentOwner.BorderColor
                                        HoverColor: =lblAppCurrentOwner.Color
                                        HoverFill: =lblAppCurrentOwner.Fill
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =lblAppCurrentOwner.BorderColor
                                        PressedColor: =lblAppCurrentOwner.Color
                                        PressedFill: =lblAppCurrentOwner.Fill
                                        Size: =10
                                        Text: ="Owner"
                                        Width: =190
                                        Wrap: =false
                                        X: =401
                                        ZIndex: =3

                                    lblAppIdName As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =1.5
                                        FocusedBorderColor: =lblAppIdName.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =Parent.Height
                                        HoverBorderColor: =lblAppIdName.BorderColor
                                        HoverColor: =lblAppIdName.Color
                                        HoverFill: =lblAppIdName.Fill
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =lblAppIdName.BorderColor
                                        PressedColor: =lblAppIdName.Color
                                        PressedFill: =lblAppIdName.Fill
                                        Size: =11
                                        Text: ="Flow id"
                                        Width: =300
                                        Wrap: =false
                                        X: =571
                                        ZIndex: =4

                                galEnvFlows As gallery.galleryVertical:
                                    '#CopilotOverlayLabel': ="Filtered"
                                    BorderColor: =ColorValue(Style.Tertiary)
                                    BorderStyle: =BorderStyle.None
                                    DisabledBorderColor: =galEnvFlows.BorderColor
                                    DisabledFill: =galEnvFlows.Fill
                                    Fill: |-
                                        =//RGBA(255, 255, 255, 1)
                                        RGBA(0, 0, 0, 0)
                                    Height: =845
                                    HoverBorderColor: =galEnvFlows.BorderColor
                                    HoverFill: =galEnvFlows.Fill
                                    Items: |-
                                        =SortByColumns(
                                            Filter(
                                                Filter(
                                                    Flows,
                                                    'Flow Environment'.'Record GUID as String' = Text(galEnvironments.Selected.'Record GUID as String') And 'Flow Deleted' = 'Flow Deleted (Flows)'.No And 'Flow is Published' <> 'Flow is Published (Flows)'.No
                                                ),
                                                txtSearchFlows.Value in 'Display Name' || txtSearchFlows.Value in 'Flow Maker Display Name' || txtSearchFlows.Value in FlowIDString
                                            ),
                                            "admin_displayname"
                                        )
                                    Layout: =Layout.Vertical
                                    LayoutMinHeight: =287
                                    LayoutMinWidth: =320
                                    LoadingSpinnerColor: =galEnvFlows.BorderColor
                                    OnSelect: |
                                        =Set(
                                            SelectedFlow,
                                            galEnvFlows.Selected
                                        );
                                        Set(
                                            FlowDerivedOwner,
                                            LookUp(
                                                Flows,
                                                Flow = SelectedFlow.Flow
                                            ).DerivedOwner.Maker
                                        );
                                        If(
                                            IsBlank(FlowDerivedOwner),
                                            Set(
                                                FlowDerivedOwner,
                                                LookUp(
                                                    Flows,
                                                    Flow = SelectedFlow.Flow
                                                ).'Flow Creator UPN'
                                            )
                                        );
                                        If(
                                            IsBlankOrError(galEnvFlows.Selected.WorkflowEntityId),
                                            Navigate(FlowDetailsScreen),
                                            Navigate(FlowDetailsScreen_Solutions)
                                        );
                                    PressedBorderColor: =galEnvFlows.BorderColor
                                    PressedFill: =galEnvFlows.Fill
                                    Selectable: =!ctxUpdatesInProgress
                                    TemplateFill: =If(ThisItem.IsSelected, ColorValue(Style.Tertiary), Color.White)
                                    TemplateSize: |-
                                        =//86
                                        //50  
                                        35
                                    Width: =1426
                                    X: =479
                                    Y: =229
                                    ZIndex: =3

                                    Container6 As groupContainer.horizontalAutoLayoutContainer:
                                        Height: =35
                                        LayoutGap: =5
                                        LayoutMode: =LayoutMode.Auto
                                        RadiusBottomLeft: =4
                                        RadiusBottomRight: =4
                                        RadiusTopLeft: =4
                                        RadiusTopRight: =4
                                        Width: =Parent.Width
                                        ZIndex: =11

                                        Container9 As groupContainer.manualLayoutContainer:
                                            AlignInContainer: =AlignInContainer.Start
                                            FillPortions: =0
                                            Height: =35  
                                            LayoutMinHeight: =35
                                            LayoutMinWidth: =250
                                            RadiusBottomLeft: =4
                                            RadiusBottomRight: =4
                                            RadiusTopLeft: =4
                                            RadiusTopRight: =4
                                            Width: =35
                                            ZIndex: =1

                                            "InfoButtonCanvas1 As 'Information button'":
                                                BasePaletteColor: =
                                                Content: ="Flows in Solutions can only be deleted or assigned new owners. They cannot have other permission types edited programmatically"
                                                DisplayMode: =DisplayMode.Edit
                                                FontColor: =
                                                Height: =35
                                                IconSize: ='InfoButtonCanvas.IconSize'.Large
                                                Visible: =If(IsBlankOrError(ThisItem.WorkflowEntityId), false, true)
                                                Width: =35
                                                X: =0
                                                Y: =0
                                                ZIndex: =1

                                            chkSelectFlow As checkbox:
                                                BorderColor: =ColorValue(Style.Primary)
                                                CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                                CheckboxSize: |-
                                                    =//40
                                                    25
                                                Color: =RGBA(0, 0, 0, 1)
                                                Default: |-
                                                    =chkSelectAll.Value || !IsBlankOrError(
                                                        LookUp(
                                                            EnvCheckedFlows,
                                                            FlowName = ThisItem.Flow
                                                        )
                                                    )
                                                DisplayMode: |-
                                                    =If(
                                                        !ctxUpdatesInProgress,
                                                        DisplayMode.Edit,
                                                        DisplayMode.Disabled
                                                    )
                                                FocusedBorderColor: =chkSelectFlow.BorderColor
                                                FocusedBorderThickness: =0
                                                Height: =35
                                                HoverBorderColor: =ColorFade(chkSelectFlow.BorderColor, 30%)
                                                HoverColor: =RGBA(0, 18, 107, 1)
                                                HoverFill: =ColorFade(chkSelectFlow.Fill, 30%)
                                                OnCheck: |
                                                    =Collect(
                                                        EnvCheckedFlows,
                                                        {
                                                            FlowName: ThisItem.Flow,
                                                            FlowOwner: ThisItem.DerivedOwner,
                                                            FlowIsOrphaned: ThisItem.'Flow is Orphaned',
                                                            Environment: ThisItem.'Flow Environment'.Environment,
                                                            EnvName: ThisItem.'Flow Environment'.Name
                                                        }
                                                    );
                                                    Clear(roleAssignmentsCollection);
                                                    UpdateContext({galleryRefreshed: false});
                                                    UpdateContext(
                                                        {
                                                            ctxFlowsToUpdate: Switch(
                                                                selectedTab,
                                                                "Environment",
                                                                EnvCheckedFlows,
                                                                "Owner",
                                                                MakerCheckedFlows,
                                                                "Orphaned flows",
                                                                OrphanedCheckedFlows
                                                            )
                                                        }
                                                    );
                                                    If(
                                                        ((selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1)),
                                                        Select(Hidden_UpdateTable_Flow);
                                                        UpdateContext({var_pivotkey: "tabMembers"});
                                                        ,
                                                        UpdateContext({var_pivotkey: "tabAddUser"});
                                                        
                                                    );
                                                OnUncheck: |
                                                    =Remove(
                                                        EnvCheckedFlows,
                                                        LookUp(
                                                            EnvCheckedFlows,
                                                            FlowName = ThisItem.Flow
                                                        )
                                                    );
                                                    Clear(roleAssignmentsCollection);
                                                    UpdateContext({galleryRefreshed: false});
                                                    UpdateContext(
                                                        {
                                                            ctxFlowsToUpdate: Switch(
                                                                selectedTab,
                                                                "Environment",
                                                                EnvCheckedFlows,
                                                                "Owner",
                                                                MakerCheckedFlows,
                                                                "Orphaned flows",
                                                                OrphanedCheckedFlows
                                                            )
                                                        }
                                                    );
                                                    If(
                                                        ((selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1)),
                                                        Select(Hidden_UpdateTable_Flow);
                                                        UpdateContext({var_pivotkey: "tabMembers"});
                                                        ,
                                                        UpdateContext({var_pivotkey: "tabAddUser"});
                                                        
                                                    );
                                                PaddingLeft: =5
                                                PressedBorderColor: =ColorFade(chkSelectFlow.BorderColor, -30%)
                                                PressedColor: =ColorValue(Style.Primary)
                                                PressedFill: =ColorFade(chkSelectFlow.Fill, -30%)
                                                Size: =13
                                                Text: =""
                                                Visible: =If(IsBlankOrError(ThisItem.WorkflowEntityId), true, false)
                                                Width: =35
                                                ZIndex: =2

                                        Container5 As groupContainer.manualLayoutContainer:
                                            FillPortions: =2.5
                                            Height: =35  
                                            LayoutMinHeight: =35  
                                            LayoutMinWidth: =0
                                            RadiusBottomLeft: =4
                                            RadiusBottomRight: =4
                                            RadiusTopLeft: =4
                                            RadiusTopRight: =4
                                            ZIndex: =4

                                            LinkCanvas1 As Link:
                                                Align: ='LinkCanvas.Align'.Start
                                                AutoHeight: =false
                                                BasePaletteColor: |-
                                                    =If(
                                                        ThisItem.IsSelected = true,
                                                        RGBA(
                                                            116,
                                                            39,
                                                            116,
                                                            1
                                                        ),
                                                        RGBA(
                                                            47,
                                                            41,
                                                            43,
                                                            1
                                                        )
                                                    )
                                                DisplayMode: =DisplayMode.Edit
                                                Font: =Font.'Segoe UI'
                                                FontSize: =14
                                                FontUnderline: =If(ThisItem.IsSelected=true,true,false)
                                                FontWeight: =FontWeight.Normal
                                                Height: =35
                                                Text: =ThisItem.'Display Name'
                                                URL: =""
                                                VerticalAlign: ='LinkCanvas.VerticalAlign'.Middle
                                                Width: =Parent.Width
                                                Wrap: =false
                                                X: =0
                                                Y: =0
                                                ZIndex: =1

                                            ButtonCanvas1_2 As Button:
                                                Appearance: ='ButtonCanvas.Appearance'.Transparent
                                                BasePaletteColor: |-
                                                    =//RGBA(66, 66, 66,1)
                                                    RGBA(
                                                        116,
                                                        39,
                                                        116,
                                                        1
                                                    )
                                                DisplayMode: =DisplayMode.Edit
                                                Font: =Font.'Segoe UI'
                                                FontColor: |-
                                                    =If(
                                                        ThisItem.IsSelected = true,
                                                        RGBA(
                                                            116,
                                                            39,
                                                            116,
                                                            1
                                                        ),
                                                        RGBA(
                                                            116,
                                                            39,
                                                            116,
                                                            1
                                                        )
                                                    )
                                                FontSize: =10
                                                FontUnderline: =true
                                                FontWeight: =FontWeight.Normal
                                                Height: =35
                                                OnSelect: =Select(galEnvFlows)
                                                Text: =""
                                                Width: =Parent.Width
                                                X: =0
                                                Y: =0
                                                ZIndex: =2

                                        lblOwner As label:
                                            BorderColor: =RGBA(218,218,218,1.00)
                                            BorderStyle: =BorderStyle.None
                                            Color: =RGBA(47,41,43,1)
                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                            FillPortions: =1
                                            FocusedBorderColor: =lblOwner.BorderColor
                                            Font: =Font.'Segoe UI'
                                            Height: =35
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverColor: =RGBA(4,45,81,1.00)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            LayoutMinHeight: =35
                                            OnSelect: =Select(galEnvFlows)
                                            PaddingBottom: =0
                                            PaddingLeft: =0
                                            PaddingRight: =0
                                            PaddingTop: =0
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedColor: =RGBA(4,45,81,1.00)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Size: =10
                                            Text: =ThisItem.DerivedOwner.'Display Name'
                                            ZIndex: =5

                                        lblFlowID As label:
                                            BorderColor: =RGBA(218,218,218,1.00)
                                            BorderStyle: =BorderStyle.None
                                            Color: =RGBA(47,41,43,1)
                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                            FillPortions: =1.5
                                            FocusedBorderColor: =lblFlowID.BorderColor
                                            Font: =Font.'Segoe UI'
                                            Height: =35
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverColor: =RGBA(4,45,81,1.00)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            LayoutMinHeight: =35
                                            OnSelect: =Select(galEnvFlows)
                                            PaddingBottom: =0
                                            PaddingLeft: =0
                                            PaddingRight: =0
                                            PaddingTop: =0
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedColor: =RGBA(4,45,81,1.00)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Size: =10
                                            Text: =ThisItem.Flow
                                            Tooltip: =ThisItem.Flow
                                            Width: =314
                                            Wrap: =false
                                            ZIndex: =6

                        conOwnerFlows As groupContainer.horizontalAutoLayoutContainer:
                            LayoutGap: =10
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            PaddingTop: =10
                            RadiusBottomLeft: =4
                            RadiusBottomRight: =4
                            RadiusTopLeft: =4
                            RadiusTopRight: =4
                            Visible: =(selectedTab= "Owner")
                            ZIndex: =4

                            conLeftOwners As groupContainer.verticalAutoLayoutContainer:
                                LayoutDirection: =LayoutDirection.Vertical
                                LayoutGap: =5
                                LayoutMinHeight: =100
                                LayoutMinWidth: =250
                                LayoutMode: =LayoutMode.Auto
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                Width: =270
                                ZIndex: =2

                                conSortOwners As groupContainer.horizontalAutoLayoutContainer:
                                    AlignInContainer: =AlignInContainer.Start
                                    Fill: |-
                                        =//RGBA(0, 0, 0, 0)
                                        RGBA(245, 245, 245, 1)
                                    FillPortions: =0
                                    Height: =35
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    Width: =Parent.Width
                                    ZIndex: =1

                                    "iconSortOwners As 'Fluent Icon (1.1.29)'":
                                        AlignInContainer: =AlignInContainer.Center
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        Height: =32
                                        IconName: ="Sort"
                                        IconType: ='PowerCAT.Icon.IconType'.IconButon
                                        LayoutMinHeight: =200
                                        LayoutMinWidth: =200
                                        OnChange: |-
                                            =UpdateContext({ctxSortAsc:!ctxSortAsc})
                                        Text: =""
                                        TextAlignment: ='PowerCAT.Icon.TextAlignment'.Center
                                        Theme: =AppThemeJson
                                        Tooltip: ="Sort"
                                        Width: =30
                                        X: =0
                                        Y: =0
                                        ZIndex: =1

                                    "txtSrchOwners As 'Text input'":
                                        AccessibleLabel: ="Search owners"
                                        AlignInContainer: =AlignInContainer.Center
                                        BasePaletteColor: =
                                        DelayOutput: =true
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FontColor: =
                                        Height: =32
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =320
                                        OnChange: |-
                                            =//false
                                            Reset(chkSelectAllFlow);
                                            Clear(MakerCheckedFlows);
                                        Placeholder: ="Search owners"
                                        Type: ='TextInputCanvas.Type'.Search
                                        Visible: =true
                                        Width: |-
                                            =//Parent.Width-iconSortOwners.Width-10
                                            Parent.Width-iconSortOwners.Width-10    
                                        X: =0
                                        Y: =0
                                        ZIndex: =2

                                galMakers As gallery.galleryVertical:
                                    '#CopilotOverlayLabel': ="Filtered"
                                    AlignInContainer: =AlignInContainer.Start
                                    BorderColor: |
                                        =//ColorValue(Style.Tertiary)
                                    BorderStyle: =BorderStyle.None
                                    DisabledBorderColor: =galMakers.BorderColor
                                    DisabledFill: =galMakers.Fill
                                    Fill: =RGBA(255, 255, 255, 1)
                                    Height: =845
                                    HoverBorderColor: =galMakers.BorderColor
                                    HoverFill: =galMakers.Fill
                                    Items: |-
                                        =SortByColumns(
                                            Filter(
                                                colMakersAddedCols,
                                                txtSrchOwners.Value in admin_displayname
                                            ),
                                            "admin_displayname",
                                            If(
                                                ctxSortAsc,
                                                SortOrder.Ascending,
                                                SortOrder.Descending
                                            )
                                        )
                                    Layout: =Layout.Vertical
                                    LayoutMinHeight: =287
                                    LayoutMinWidth: =320
                                    LoadingSpinnerColor: =galMakers.BorderColor
                                    OnSelect: |
                                        =Reset(chkSelectAllFlow);
                                        If(
                                            CountRows(MakerCheckedFlows) > 0,
                                            Clear(MakerCheckedFlows);
                                            
                                        );
                                    PressedBorderColor: =galMakers.BorderColor
                                    PressedFill: =galMakers.Fill
                                    Selectable: =!ctxUpdatesInProgress
                                    ShowScrollbar: =false
                                    TemplateFill: =If(ThisItem.IsSelected, ColorValue(Style.Tertiary), Color.White)
                                    TemplatePadding: =0
                                    TemplateSize: =35
                                    Width: =Parent.Width
                                    X: =62
                                    ZIndex: =4

                                    Container4 As groupContainer.horizontalAutoLayoutContainer:
                                        Fill: |
                                            =RGBA(0, 0, 0, 0)
                                            //If(ThisItem.IsSelected, ColorValue(Style.Tertiary), Color.White)
                                        Height: |
                                            =40
                                        LayoutGap: =5
                                        LayoutMode: =LayoutMode.Auto
                                        RadiusBottomLeft: =4
                                        RadiusBottomRight: =4
                                        RadiusTopLeft: =4
                                        RadiusTopRight: =4
                                        Width: =250
                                        ZIndex: =6

                                        "Persona2 As 'Fluent Persona (1.1.29) Preview'":
                                            AlignInContainer: =AlignInContainer.Center
                                            DisplayMode: =DisplayMode.Edit
                                            Height: =35
                                            HidePersonaDetails: =true
                                            ImageInitials: |+
                                                =Upper(
                                                    Concatenate(
                                                        Left(
                                                            First(Split(ThisItem.admin_displayname, " ")).Value,
                                                            1
                                                        ),
                                                        Left(
                                                            Last(Split(ThisItem.admin_displayname, " ")).Value,
                                                            1
                                                        )
                                                    )
                                                )
                                                
                                            ImageUrl: |-
                                                =/*IfError(
                                                    Office365Users.UserPhotoMetadata(ThisItem.admin_recordguidasstring).HasPhoto,
                                                    false,
                                                    Substitute(
                                                        JSON(
                                                            Office365Users.UserPhotoV2(ThisItem.admin_recordguidasstring),
                                                            JSONFormat.IgnoreBinaryData
                                                        ),
                                                        """",
                                                        ""
                                                    )
                                                )*/
                                                ThisItem.UserImage
                                            LayoutMinHeight: =200
                                            LayoutMinWidth: =200
                                            PersonaInitialsColor: =LookUp(gblInitalsColors,Id=Mod(ThisItem.RowNumber,15)).Color
                                            PersonaSize: ='PowerCAT.Persona.PersonaSize'.Size32
                                            Presence: ='PowerCAT.Persona.Presence'.None
                                            Text: =ThisItem.admin_displayname
                                            Theme: =AppThemeJson
                                            Width: |-
                                                =//35
                                                32
                                            X: =0
                                            Y: =0
                                            ZIndex: =2

                                        lblMakerDisplayName As Label:
                                            Color: =RGBA(0, 0, 0, 0)    
                                            DisplayMode: =DisplayMode.Edit
                                            Height: =galMakers.TemplateHeight
                                            LayoutMinHeight: =32
                                            LayoutMinWidth: =320
                                            OnChange: =false
                                            OnSelect: |
                                                =Reset(chkSelectAllFlow);
                                                If(
                                                    CountRows(MakerCheckedFlows) > 0,
                                                    Clear(MakerCheckedFlows);
                                                    
                                                );
                                            Text: =ThisItem.admin_displayname
                                            Width: =202
                                            X: =48
                                            Y: =0
                                            ZIndex: =4

                            conOwnerFlowsPaging As groupContainer.verticalAutoLayoutContainer:
                                AlignInContainer: =AlignInContainer.SetByContainer
                                FillPortions: =5
                                Height: =Parent.Height
                                LayoutDirection: =LayoutDirection.Vertical
                                LayoutGap: =2
                                LayoutMinHeight: =100
                                LayoutMinWidth: =20
                                LayoutMode: =LayoutMode.Auto
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                ZIndex: =3

                                Container6_1 As groupContainer.horizontalAutoLayoutContainer:
                                    Fill: =RGBA(122, 138, 143, 0.12)
                                    FillPortions: =0
                                    Height: =35
                                    LayoutGap: =5
                                    LayoutMinHeight: =50
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    PaddingLeft: =5
                                    RadiusBottomLeft: =4
                                    RadiusBottomRight: =4
                                    RadiusTopLeft: =4
                                    RadiusTopRight: =4
                                    Width: =Parent.Width
                                    ZIndex: =1

                                    chkSelectAllFlow As checkbox:
                                        AlignInContainer: =AlignInContainer.Start
                                        BorderColor: =ColorValue(Style.Primary)
                                        CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                        CheckboxSize: |-
                                            =//40
                                            25
                                        Color: =RGBA(0, 0, 0, 1)
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FocusedBorderColor: =chkSelectAllFlow.BorderColor
                                        FocusedBorderThickness: =0
                                        Font: =Font.Arial
                                        Height: =Parent.Height
                                        HoverBorderColor: =ColorFade(chkSelectAllFlow.BorderColor, 30%)
                                        HoverColor: =RGBA(0, 18, 107, 1)
                                        HoverFill: =ColorFade(chkSelectAllFlow.Fill, 30%)
                                        OnCheck: |
                                            =Clear(MakerCheckedFlows);
                                            ForAll(
                                                galFlowsMaker.AllItems,
                                                If(
                                                    !isSolutionFlow,
                                                    Collect(
                                                        MakerCheckedFlows,
                                                        {
                                                            FlowName: Flow,
                                                            FlowOwner: DerivedOwner,
                                                            FlowIsOrphaned: 'Flow is Orphaned',
                                                            Environment: 'Flow Environment'.Environment,
                                                            EnvName: 'Flow Environment'.Name
                                                        }
                                                    )
                                                )
                                            );
                                        OnUncheck: =Clear(MakerCheckedFlows)
                                        PaddingLeft: =5
                                        PressedBorderColor: =ColorFade(chkSelectAllFlow.BorderColor, -30%)
                                        PressedColor: =ColorValue(Style.Primary)
                                        PressedFill: =ColorFade(chkSelectAllFlow.Fill, -30%)
                                        Size: =13
                                        Text: =""
                                        Width: =35
                                        X: =17
                                        ZIndex: =1

                                    lblAppDisplayName_1 As label:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =1.7
                                        FocusedBorderColor: =lblAppDisplayName_1.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =Parent.Height
                                        HoverBorderColor: =lblAppDisplayName_1.BorderColor
                                        HoverColor: =lblAppDisplayName_1.Color
                                        HoverFill: =lblAppDisplayName_1.Fill
                                        LayoutMinWidth: =250
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =lblAppDisplayName_1.BorderColor
                                        PressedColor: =lblAppDisplayName_1.Color
                                        PressedFill: =lblAppDisplayName_1.Fill
                                        Size: =10
                                        Text: ="Flow display name"
                                        Width: =151
                                        X: =33
                                        ZIndex: =2

                                    lblFlowEnvironment As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =1
                                        FocusedBorderColor: =lblFlowEnvironment.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =Parent.Height
                                        HoverBorderColor: =lblFlowEnvironment.BorderColor
                                        HoverColor: =lblFlowEnvironment.Color
                                        HoverFill: =lblFlowEnvironment.Fill
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =lblFlowEnvironment.BorderColor
                                        PressedColor: =lblFlowEnvironment.Color
                                        PressedFill: =lblFlowEnvironment.Fill
                                        Size: =10
                                        Text: ="Environment"
                                        Width: =151
                                        X: =360
                                        ZIndex: =3

                                    lblFlowIdName As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =1
                                        FocusedBorderColor: =lblFlowIdName.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =Parent.Height
                                        HoverBorderColor: =lblFlowIdName.BorderColor
                                        HoverColor: =lblFlowIdName.Color
                                        HoverFill: =lblFlowIdName.Fill
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =lblFlowIdName.BorderColor
                                        PressedColor: =lblFlowIdName.Color
                                        PressedFill: =lblFlowIdName.Fill
                                        Size: =11
                                        Text: ="Flow id"
                                        Width: =151
                                        X: =681
                                        ZIndex: =4

                                galFlowsMaker As gallery.galleryVertical:
                                    '#CopilotOverlayLabel': ="Filtered"
                                    BorderColor: =ColorValue(Style.Tertiary)
                                    BorderStyle: =BorderStyle.None
                                    DisabledBorderColor: =galFlowsMaker.BorderColor
                                    DisabledFill: =galFlowsMaker.Fill
                                    Fill: =RGBA(255, 255, 255, 1)
                                    Height: =845
                                    HoverBorderColor: =galFlowsMaker.BorderColor
                                    HoverFill: =galFlowsMaker.Fill
                                    Items: |-
                                        =SortByColumns(
                                            Filter(
                                                Filter(
                                                    Flows,
                                                    ((Maker.Maker = galMakers.Selected.admin_makerid And 'Flow Deleted' = 'Flow Deleted (Flows)'.No And (DerivedOwner.Maker) = GUID()) || ((DerivedOwner.Maker = galMakers.Selected.admin_makerid And 'Flow Deleted' = 'Flow Deleted (Flows)'.No)) And 'Flow is Published' <> 'Flow is Published (Flows)'.No)
                                                ),
                                                txtSearchFlows.Value in 'Display Name' || txtSearchFlows.Value in 'Flow Maker Display Name' || txtSearchFlows.Value in FlowIDString || txtSearchFlows.Value in 'Flow Environment Display Name'
                                            ),
                                            "admin_displayname"
                                        )
                                    Layout: =Layout.Vertical
                                    LayoutMinHeight: =287
                                    LayoutMinWidth: =320
                                    LoadingSpinnerColor: =galFlowsMaker.BorderColor
                                    OnSelect: |-
                                        =//select the flow
                                        Set(SelectedFlow, galFlowsMaker.Selected);
                                        
                                        //set the owner
                                        Set(FlowDerivedOwner, LookUp(Flows, Flow=SelectedFlow.Flow).DerivedOwner.Maker);
                                        If(IsBlank(FlowDerivedOwner), Set(FlowDerivedOwner, LookUp(Flows, Flow=SelectedFlow.Flow).'Flow Creator UPN'));
                                        
                                        //navigate
                                        If(IsBlankOrError(ThisItem.WorkflowEntityId), Navigate(FlowDetailsScreen), Navigate(FlowDetailsScreen_Solutions))
                                    PressedBorderColor: =galFlowsMaker.BorderColor
                                    PressedFill: =galFlowsMaker.Fill
                                    Selectable: =!ctxUpdatesInProgress
                                    TemplateSize: =35
                                    Width: =1380
                                    X: =483
                                    Y: =235
                                    ZIndex: =3

                                    Container2 As groupContainer.horizontalAutoLayoutContainer:
                                        BorderStyle: =BorderStyle.None
                                        Fill: |-
                                            =//RGBA(0, 0, 0, 0)
                                            If(ThisItem.IsSelected, ColorValue(Style.Tertiary), Color.White)
                                        Height: =35
                                        LayoutGap: =5
                                        LayoutMode: =LayoutMode.Auto
                                        RadiusBottomLeft: =4
                                        RadiusBottomRight: =4
                                        RadiusTopLeft: =4
                                        RadiusTopRight: =4
                                        Width: =Parent.Width
                                        ZIndex: =9

                                        "InfoButtonCanvas1_1 As 'Information button'":
                                            BasePaletteColor: =
                                            Content: ="Flows in Solutions can only be deleted or assigned new owners. They cannot have other permission types edited programmatically"
                                            DisplayMode: =DisplayMode.Edit
                                            FontColor: =
                                            Height: =35
                                            IconSize: ='InfoButtonCanvas.IconSize'.Large
                                            LayoutMinHeight: =32
                                            LayoutMinWidth: =32
                                            Visible: =If(IsBlankOrError(ThisItem.WorkflowEntityId), false, true)
                                            Width: =35
                                            X: =0
                                            Y: =0
                                            ZIndex: =1

                                        chkSelectFlowOwner As checkbox:
                                            AlignInContainer: =AlignInContainer.Start
                                            BorderColor: =ColorValue(Style.Primary)
                                            CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                            CheckboxSize: =25
                                            Color: =RGBA(0, 0, 0, 1)
                                            Default: |-
                                                =chkSelectAllFlow.Value || !IsBlankOrError(
                                                    LookUp(
                                                        MakerCheckedFlows,
                                                        FlowName = ThisItem.Flow
                                                    )
                                                )
                                            DisplayMode: |-
                                                =If(
                                                    !ctxUpdatesInProgress,
                                                    DisplayMode.Edit,
                                                    DisplayMode.Disabled
                                                )
                                            FocusedBorderColor: =chkSelectFlowOwner.BorderColor
                                            FocusedBorderThickness: =0
                                            Height: =35
                                            HoverBorderColor: =ColorFade(chkSelectFlowOwner.BorderColor, 30%)
                                            HoverColor: =RGBA(0, 18, 107, 1)
                                            HoverFill: =ColorFade(chkSelectFlowOwner.Fill, 30%)
                                            LayoutMinHeight: =35
                                            OnCheck: |
                                                =Collect(
                                                    MakerCheckedFlows,
                                                    {
                                                        FlowName: ThisItem.Flow,
                                                        FlowOwner: ThisItem.DerivedOwner,
                                                        FlowIsOrphaned: ThisItem.'Flow is Orphaned',
                                                        Environment: ThisItem.'Flow Environment'.Environment,
                                                        EnvName: ThisItem.'Flow Environment'.Name
                                                    }
                                                );
                                                Clear(roleAssignmentsCollection);
                                                UpdateContext({galleryRefreshed: false});
                                                UpdateContext(
                                                    {
                                                        ctxFlowsToUpdate: Switch(
                                                            selectedTab,
                                                            "Environment",
                                                            EnvCheckedFlows,
                                                            "Owner",
                                                            MakerCheckedFlows,
                                                            "Orphaned flows",
                                                            OrphanedCheckedFlows
                                                        )
                                                    }
                                                );
                                                If(
                                                    ((selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1)),
                                                    Select(Hidden_UpdateTable_Flow);
                                                    UpdateContext({var_pivotkey: "tabMembers"});
                                                    ,
                                                    UpdateContext({var_pivotkey: "tabAddUser"});
                                                    
                                                );
                                            OnUncheck: |
                                                =Remove(
                                                    MakerCheckedFlows,
                                                    LookUp(
                                                        MakerCheckedFlows,
                                                        FlowName = ThisItem.Flow
                                                    )
                                                );
                                                Clear(roleAssignmentsCollection);
                                                UpdateContext({galleryRefreshed: false});
                                                UpdateContext(
                                                    {
                                                        ctxFlowsToUpdate: Switch(
                                                            selectedTab,
                                                            "Environment",
                                                            EnvCheckedFlows,
                                                            "Owner",
                                                            MakerCheckedFlows,
                                                            "Orphaned flows",
                                                            OrphanedCheckedFlows
                                                        )
                                                    }
                                                );
                                                If(
                                                    ((selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1)),
                                                    Select(Hidden_UpdateTable_Flow);
                                                    UpdateContext({var_pivotkey: "tabMembers"});
                                                    ,
                                                    UpdateContext({var_pivotkey: "tabAddUser"});
                                                    
                                                );
                                            PaddingLeft: =5
                                            PressedBorderColor: =ColorFade(chkSelectFlowOwner.BorderColor, -30%)
                                            PressedColor: =ColorValue(Style.Primary)
                                            PressedFill: =ColorFade(chkSelectFlowOwner.Fill, -30%)
                                            Size: =13
                                            Text: =""
                                            Visible: =If(IsBlankOrError(ThisItem.WorkflowEntityId), true, false)
                                            Width: =35
                                            ZIndex: =2

                                        Container5_4 As groupContainer.manualLayoutContainer:
                                            FillPortions: =1.7
                                            Height: =35  
                                            LayoutMinHeight: =35  
                                            LayoutMinWidth: =250
                                            RadiusBottomLeft: =4
                                            RadiusBottomRight: =4
                                            RadiusTopLeft: =4
                                            RadiusTopRight: =4
                                            X: =0   
                                            ZIndex: =3

                                            LinkCanvas1_1 As Link:
                                                Align: ='LinkCanvas.Align'.Start
                                                AutoHeight: =false
                                                BasePaletteColor: |-
                                                    =If(
                                                        ThisItem.IsSelected = true,
                                                        RGBA(
                                                            116,
                                                            39,
                                                            116,
                                                            1
                                                        ),
                                                        RGBA(
                                                            47,
                                                            41,
                                                            43,
                                                            1
                                                        )
                                                    )
                                                DisplayMode: =DisplayMode.Edit
                                                Font: =Font.'Segoe UI'
                                                FontSize: =14
                                                FontUnderline: =If(ThisItem.IsSelected=true,true,false)
                                                FontWeight: =FontWeight.Normal
                                                Height: =35
                                                Text: =ThisItem.'Display Name'
                                                URL: =""
                                                Width: =Parent.Width
                                                Wrap: =false
                                                X: =0
                                                Y: =0
                                                ZIndex: =1

                                            ButtonCanvas1_3 As Button:
                                                Appearance: ='ButtonCanvas.Appearance'.Transparent
                                                BasePaletteColor: =RGBA(66, 66, 66,1)
                                                DisplayMode: =DisplayMode.Edit
                                                Font: =Font.'Segoe UI'
                                                FontColor: =RGBA(66, 66, 66,1)
                                                FontSize: =10
                                                FontUnderline: =true
                                                FontWeight: =FontWeight.Normal
                                                Height: =35
                                                OnSelect: =Select(galFlowsMaker)
                                                Text: =""
                                                Width: =Parent.Width
                                                X: =0
                                                Y: =0
                                                ZIndex: =2

                                        lblEnvironment As label:
                                            BorderColor: =RGBA(218,218,218,1.00)
                                            BorderStyle: =BorderStyle.None
                                            Color: =RGBA(47,41,43,1)
                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                            FillPortions: =1
                                            FocusedBorderColor: =lblEnvironment.BorderColor
                                            Font: =Font.'Segoe UI'
                                            Height: =35
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverColor: =RGBA(4,45,81,1.00)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            LayoutMinHeight: =35
                                            OnSelect: =Select(galFlowsMaker)
                                            PaddingBottom: =0
                                            PaddingLeft: =0
                                            PaddingRight: =0
                                            PaddingTop: =0
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedColor: =RGBA(4,45,81,1.00)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Size: =10
                                            Text: =ThisItem.'Flow Environment'.'Display Name'
                                            Tooltip: =ThisItem.'Flow Environment'.'Display Name'
                                            Width: =295
                                            Wrap: =false
                                            ZIndex: =5

                                        lblFlowAppID As label:
                                            BorderColor: =RGBA(218,218,218,1.00)
                                            BorderStyle: =BorderStyle.None
                                            Color: =RGBA(47,41,43,1)
                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                            FillPortions: =1
                                            FocusedBorderColor: =lblFlowAppID.BorderColor
                                            Font: =Font.'Segoe UI'
                                            Height: =35
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverColor: =RGBA(4,45,81,1.00)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            LayoutMinHeight: =35
                                            PaddingBottom: =0
                                            PaddingLeft: =0
                                            PaddingRight: =0
                                            PaddingTop: =0
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedColor: =RGBA(4,45,81,1.00)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Size: =10
                                            Text: =ThisItem.Flow
                                            Tooltip: =ThisItem.Flow
                                            Width: =261
                                            Wrap: =false
                                            ZIndex: =6

                        conOrphanedFlows As groupContainer.horizontalAutoLayoutContainer:
                            LayoutDirection: =LayoutDirection.Vertical
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            PaddingBottom: =5
                            PaddingTop: =10
                            Visible: =selectedTab = "Orphaned flows"
                            Width: =Parent.Width
                            ZIndex: =5

                            Container6_2 As groupContainer.horizontalAutoLayoutContainer:
                                Fill: =RGBA(122, 138, 143, 0.12)
                                FillPortions: =0
                                Height: =35
                                LayoutGap: =5
                                LayoutMinHeight: =50
                                LayoutMinWidth: =250
                                LayoutMode: =LayoutMode.Auto
                                PaddingLeft: =5
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                Width: =Parent.Width
                                ZIndex: =1

                                chkSelectAllOrphanedFlows As checkbox:
                                    BorderColor: =ColorValue(Style.Primary)
                                    CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                    CheckboxSize: |-
                                        =//40
                                        25
                                    Color: =RGBA(0, 0, 0, 1)
                                    DisplayMode: |-
                                        =If(
                                            !ctxUpdatesInProgress,
                                            DisplayMode.Edit,
                                            DisplayMode.Disabled
                                        )
                                    FocusedBorderColor: =chkSelectAllOrphanedFlows.BorderColor
                                    FocusedBorderThickness: =0   
                                    Font: =Font.Arial
                                    Height: =Parent.Height
                                    HoverBorderColor: =ColorFade(chkSelectAllOrphanedFlows.BorderColor, 30%)
                                    HoverColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =ColorFade(chkSelectAllOrphanedFlows.Fill, 30%)
                                    OnCheck: |-
                                        =Clear(OrphanedCheckedFlows);
                                        ForAll(
                                            galOrphanedFlows.AllItems,
                                            Collect(
                                                OrphanedCheckedFlows,
                                                {
                                                    FlowName: Flow,
                                                    EnvName: 'Flow Environment'.Name,
                                                    Environment: 'Flow Environment'.Environment
                                                }
                                            )
                                        )
                                    OnUncheck: =Clear(OrphanedCheckedFlows)
                                    PressedBorderColor: =ColorFade(chkSelectAllOrphanedFlows.BorderColor, -30%)
                                    PressedColor: =ColorValue(Style.Primary)
                                    PressedFill: =ColorFade(chkSelectAllOrphanedFlows.Fill, -30%)
                                    Size: =13
                                    Text: =""
                                    Width: =35
                                    X: =5
                                    ZIndex: =5

                                lblAppTitle_7 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(128, 128, 128, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FillPortions: =1
                                    FocusedBorderColor: =lblAppTitle_7.BorderColor
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height
                                    HoverBorderColor: =lblAppTitle_7.BorderColor
                                    HoverColor: =lblAppTitle_7.Color
                                    HoverFill: =lblAppTitle_7.Fill
                                    LayoutMinWidth: =250
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    PressedBorderColor: =lblAppTitle_7.BorderColor
                                    PressedColor: =lblAppTitle_7.Color
                                    PressedFill: =lblAppTitle_7.Fill
                                    Size: =10
                                    Text: ="Flow display name"
                                    Width: =151
                                    X: =54
                                    ZIndex: =6

                                lblAppTitle_14 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(128, 128, 128, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FillPortions: =1
                                    FocusedBorderColor: =lblAppTitle_14.BorderColor
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height
                                    HoverBorderColor: =lblAppTitle_14.BorderColor
                                    HoverColor: =lblAppTitle_14.Color
                                    HoverFill: =lblAppTitle_14.Fill
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    PressedBorderColor: =lblAppTitle_14.BorderColor
                                    PressedColor: =lblAppTitle_14.Color
                                    PressedFill: =lblAppTitle_14.Fill
                                    Size: =11
                                    Text: ="Last launch date"
                                    Width: =151
                                    X: =263
                                    ZIndex: =7

                                lblAppTitle_8 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(128, 128, 128, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FillPortions: =1
                                    FocusedBorderColor: =lblAppTitle_8.BorderColor
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height
                                    HoverBorderColor: =lblAppTitle_8.BorderColor
                                    HoverColor: =lblAppTitle_8.Color
                                    HoverFill: =lblAppTitle_8.Fill
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    PressedBorderColor: =lblAppTitle_8.BorderColor
                                    PressedColor: =lblAppTitle_8.Color
                                    PressedFill: =lblAppTitle_8.Fill
                                    Size: =11
                                    Text: ="Number of editors"
                                    Width: =151
                                    X: =617
                                    ZIndex: =8

                                lblAppTitle_5 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(128, 128, 128, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FillPortions: =1
                                    FocusedBorderColor: =lblAppTitle_5.BorderColor
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height
                                    HoverBorderColor: =lblAppTitle_5.BorderColor
                                    HoverColor: =lblAppTitle_5.Color
                                    HoverFill: =lblAppTitle_5.Fill
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    PressedBorderColor: =lblAppTitle_5.BorderColor
                                    PressedColor: =lblAppTitle_5.Color
                                    PressedFill: =lblAppTitle_5.Fill
                                    Size: =11
                                    Text: ="Environment"
                                    Width: =151
                                    X: =787
                                    ZIndex: =9

                            galOrphanedFlows As gallery.galleryVertical:
                                '#CopilotOverlayLabel': ="Filtered"
                                BorderColor: =ColorValue(Style.Tertiary)
                                BorderStyle: =BorderStyle.None
                                DisabledBorderColor: =galOrphanedFlows.BorderColor
                                DisabledFill: =galOrphanedFlows.Fill
                                Fill: =RGBA(255, 255, 255, 1)
                                Height: =845
                                HoverBorderColor: =galOrphanedFlows.BorderColor
                                HoverFill: =galOrphanedFlows.Fill
                                Items: |-
                                    =SortByColumns(
                                        Filter(
                                            Filter(
                                                Flows,
                                                'Flow is Orphaned' = "Yes" And 'Flow Deleted' = 'Flow Deleted (Flows)'.No And 'Flow is Published' <> 'Flow is Published (Flows)'.No
                                            ),
                                            txtSearchFlows.Value in 'Display Name' || txtSearchFlows.Value in FlowIDString || txtSearchFlows.Value in 'Flow Environment Display Name'
                                        ),
                                        "admin_displayname"
                                    )
                                Layout: =Layout.Vertical
                                LayoutMinHeight: =287
                                LayoutMinWidth: =320
                                LoadingSpinnerColor: =galOrphanedFlows.BorderColor
                                OnSelect: |
                                    =Set(
                                        SelectedFlow,
                                        galOrphanedFlows.Selected
                                    );
                                    Set(
                                        FlowDerivedOwner,
                                        LookUp(
                                            Flows,
                                            Flow = SelectedFlow.Flow
                                        ).DerivedOwner.Maker
                                    );
                                    If(
                                        IsBlank(FlowDerivedOwner),
                                        Set(
                                            FlowDerivedOwner,
                                            LookUp(
                                                Flows,
                                                Flow = SelectedFlow.Flow
                                            ).'Flow Creator UPN'
                                        )
                                    );
                                    If(
                                        IsBlankOrError(galOrphanedFlows.Selected.WorkflowEntityId),
                                        Navigate(FlowDetailsScreen),
                                        Navigate(FlowDetailsScreen_Solutions)
                                    );
                                PressedBorderColor: =galOrphanedFlows.BorderColor
                                PressedFill: =galOrphanedFlows.Fill
                                TemplateSize: =35
                                Width: =1780
                                X: =88
                                Y: =234
                                ZIndex: =3

                                Container3 As groupContainer.horizontalAutoLayoutContainer:
                                    BorderStyle: =BorderStyle.None
                                    Height: =35
                                    LayoutGap: =5
                                    LayoutMode: =LayoutMode.Auto
                                    RadiusBottomLeft: =4
                                    RadiusBottomRight: =4
                                    RadiusTopLeft: =4
                                    RadiusTopRight: =4
                                    Width: =Parent.Width
                                    ZIndex: =11

                                    chkSelectOrphanedApp As checkbox:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        BorderColor: =ColorValue(Style.Primary)
                                        CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                        CheckboxSize: =25
                                        Color: =RGBA(0, 0, 0, 1)
                                        Default: |-
                                            =chkSelectAllOrphanedFlows.Value || !IsBlankOrError(
                                                LookUp(
                                                    OrphanedCheckedFlows,
                                                    FlowName = ThisItem.Flow
                                                )
                                            )
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FocusedBorderColor: =chkSelectOrphanedApp.BorderColor
                                        FocusedBorderThickness: =0
                                        Height: =35
                                        HoverBorderColor: =ColorFade(chkSelectOrphanedApp.BorderColor, 30%)
                                        HoverColor: =RGBA(0, 18, 107, 1)
                                        HoverFill: =ColorFade(chkSelectOrphanedApp.Fill, 30%)
                                        LayoutMinHeight: =35
                                        OnCheck: |
                                            =Collect(
                                                OrphanedCheckedFlows,
                                                {
                                                    FlowName: ThisItem.Flow,
                                                    FlowOwner: ThisItem.DerivedOwner,
                                                    FlowIsOrphaned: ThisItem.'Flow is Orphaned',
                                                    Environment: ThisItem.'Flow Environment'.Environment,
                                                    EnvName: ThisItem.'Flow Environment'.Name
                                                }
                                            );
                                            Clear(roleAssignmentsCollection);
                                            UpdateContext({galleryRefreshed: false});
                                            UpdateContext(
                                                {
                                                    ctxFlowsToUpdate: Switch(
                                                        selectedTab,
                                                        "Environment",
                                                        EnvCheckedFlows,
                                                        "Owner",
                                                        MakerCheckedFlows,
                                                        "Orphaned flows",
                                                        OrphanedCheckedFlows
                                                    )
                                                }
                                            );
                                            If(
                                                ((selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1)),
                                                Select(Hidden_UpdateTable_Flow);
                                                UpdateContext({var_pivotkey: "tabMembers"});
                                                ,
                                                UpdateContext({var_pivotkey: "tabAddUser"});
                                                
                                            );
                                        OnUncheck: |
                                            =Remove(
                                                OrphanedCheckedFlows,
                                                LookUp(
                                                    OrphanedCheckedFlows,
                                                    FlowName = ThisItem.Flow
                                                )
                                            );
                                            Clear(roleAssignmentsCollection);
                                            UpdateContext({galleryRefreshed: false});
                                            UpdateContext(
                                                {
                                                    ctxFlowsToUpdate: Switch(
                                                        selectedTab,
                                                        "Environment",
                                                        EnvCheckedFlows,
                                                        "Owner",
                                                        MakerCheckedFlows,
                                                        "Orphaned flows",
                                                        OrphanedCheckedFlows
                                                    )
                                                }
                                            );
                                            If(
                                                ((selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1)),
                                                Select(Hidden_UpdateTable_Flow);
                                                UpdateContext({var_pivotkey: "tabMembers"});
                                                ,
                                                UpdateContext({var_pivotkey: "tabAddUser"});
                                                
                                            );
                                        PressedBorderColor: =ColorFade(chkSelectOrphanedApp.BorderColor, -30%)
                                        PressedColor: =ColorValue(Style.Primary)
                                        PressedFill: =ColorFade(chkSelectOrphanedApp.Fill, -30%)
                                        Size: =13
                                        Text: =""
                                        Width: =35
                                        ZIndex: =1

                                    Container5_5 As groupContainer.manualLayoutContainer:
                                        AlignInContainer: =AlignInContainer.Center
                                        Height: =35  
                                        LayoutMinHeight: =35  
                                        LayoutMinWidth: =250
                                        RadiusBottomLeft: =4
                                        RadiusBottomRight: =4
                                        RadiusTopLeft: =4
                                        RadiusTopRight: =4
                                        X: =40
                                        Y: =40
                                        ZIndex: =2

                                        LinkCanvas1_2 As Link:
                                            AutoHeight: =false
                                            BasePaletteColor: |-
                                                =If(
                                                    ThisItem.IsSelected = true,
                                                    RGBA(
                                                        116,
                                                        39,
                                                        116,
                                                        1
                                                    ),
                                                    RGBA(
                                                        47,
                                                        41,
                                                        43,
                                                        1
                                                    )
                                                )
                                            DisplayMode: =DisplayMode.View
                                            Font: =Font.'Segoe UI'
                                            FontSize: =14
                                            FontUnderline: =If(ThisItem.IsSelected=true,true,false)
                                            FontWeight: =FontWeight.Normal
                                            Height: =35
                                            Text: =ThisItem.'Display Name'
                                            URL: =""
                                            VerticalAlign: ='LinkCanvas.VerticalAlign'.Middle
                                            Width: =Parent.Width
                                            X: =0
                                            Y: =0
                                            ZIndex: =1

                                        ButtonCanvas1_4 As Button:
                                            Appearance: ='ButtonCanvas.Appearance'.Transparent
                                            BasePaletteColor: =RGBA(66, 66, 66,1)
                                            DisplayMode: =DisplayMode.Edit
                                            Font: =Font.'Segoe UI'
                                            FontColor: =RGBA(66, 66, 66,1)
                                            FontSize: =10
                                            FontUnderline: =true
                                            FontWeight: =FontWeight.Normal
                                            Height: =35
                                            OnSelect: =Select(galOrphanedFlows)
                                            Text: =""
                                            Width: =Parent.Width
                                            X: =0
                                            Y: =0
                                            ZIndex: =2

                                    lblLastLaunched_1 As label:
                                        AlignInContainer: =AlignInContainer.Start
                                        BorderColor: =RGBA(218,218,218,1.00)
                                        BorderStyle: =BorderStyle.None
                                        Color: =RGBA(47,41,43,1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                        FillPortions: =1
                                        FocusedBorderColor: =lblLastLaunched_1.BorderColor
                                        Font: =Font.'Segoe UI'
                                        Height: =35
                                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                                        HoverColor: =RGBA(4,45,81,1.00)
                                        HoverFill: =RGBA(0, 0, 0, 0)
                                        OnSelect: =Select(galOrphanedFlows)
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =RGBA(0, 0, 0, 0)
                                        PressedColor: =RGBA(4,45,81,1.00)
                                        PressedFill: =RGBA(0, 0, 0, 0)
                                        Size: =11
                                        Text: =Text(ThisItem.'Flow Modified On',"[$-en-US]dd-mmm-yyyy")
                                        Tooltip: =Text(ThisItem.'Flow Modified On',"[$-en-US]dd-mmm-yyyy")
                                        Width: =127
                                        ZIndex: =4

                                    lblOwner_3 As label:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        BorderColor: =RGBA(218,218,218,1.00)
                                        BorderStyle: =BorderStyle.None
                                        Color: =RGBA(47,41,43,1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                        FillPortions: =1
                                        FocusedBorderColor: =lblOwner_3.BorderColor
                                        Font: =Font.'Segoe UI'
                                        Height: =50
                                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                                        HoverColor: =RGBA(4,45,81,1.00)
                                        HoverFill: =RGBA(0, 0, 0, 0)
                                        LayoutMinHeight: =35
                                        OnSelect: =Select(galOrphanedFlows)
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =RGBA(0, 0, 0, 0)
                                        PressedColor: =RGBA(4,45,81,1.00)
                                        PressedFill: =RGBA(0, 0, 0, 0)
                                        Size: =10
                                        Text: |-
                                            =/*If(
                                                !IsBlankOrError(ThisItem.'Flow Environment'),
                                                CountRows(
                                                    PowerAutomateforAdmins.GetAdminFlowOwnerRole(
                                                        ThisItem.'Flow Environment'.Name,
                                                        ThisItem.Flow
                                                    ).value
                                                )
                                            )*/
                                            IfError(
                                                CountRows(
                                                    PowerAutomateforAdmins.GetAdminFlowOwnerRole(
                                                        ThisItem.'Flow Environment'.Name,
                                                        ThisItem.Flow
                                                    ).value
                                                ),
                                                Blank()
                                            )
                                        Width: =1
                                        ZIndex: =5

                                    lblFlowID_3 As label:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        BorderColor: =RGBA(218,218,218,1.00)
                                        BorderStyle: =BorderStyle.None
                                        Color: =RGBA(47,41,43,1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                        FillPortions: =1
                                        FocusedBorderColor: =lblFlowID_3.BorderColor
                                        Font: =Font.'Segoe UI'
                                        Height: =35
                                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                                        HoverColor: =RGBA(4,45,81,1.00)
                                        HoverFill: =RGBA(0, 0, 0, 0)
                                        LayoutMinHeight: =35
                                        OnSelect: =Select(galOrphanedFlows)
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =RGBA(0, 0, 0, 0)
                                        PressedColor: =RGBA(4,45,81,1.00)
                                        PressedFill: =RGBA(0, 0, 0, 0)
                                        Size: =10
                                        Text: =ThisItem.'Flow Environment'.'Display Name'
                                        Tooltip: =ThisItem.'Flow Environment'.'Display Name'
                                        Width: =280
                                        ZIndex: =6

                    btnOrphanedFlows As Button:
                        AccessibleLabel: ="Button to Refresh Orphaned Flows"
                        BasePaletteColor: =
                        DisplayMode: =DisplayMode.Edit
                        FontColor: =
                        Height: =32
                        LayoutMinHeight: =32
                        LayoutMinWidth: =96
                        OnSelect: |-
                            =ClearCollect(
                                colOrphanedFlows,
                                SortByColumns(
                                    AddColumns(
                                        Filter(
                                            Filter(
                                                Flows,
                                                'Flow is Orphaned' = "Yes" And 'Flow Deleted' = 'Flow Deleted (Flows)'.No And 'Flow is Published' <> 'Flow is Published (Flows)'.No
                                            ),
                                            txtSearchFlows.Value in 'Display Name' || txtSearchFlows.Value in FlowIDString
                                        ),
                                        LastLaunchedOn,
                                        Text(
                                            ThisRecord.'Flow Modified On',
                                            "[$-en-US]dd-mmm-yyyy"
                                        ),
                                        EditorCount,
                                        IfError(
                                            CountRows(
                                                PowerAutomateforAdmins.GetAdminFlowOwnerRole(
                                                    ThisRecord.'Flow Environment'.Name,
                                                    ThisRecord.Flow
                                                ).value
                                            ),
                                            Blank()
                                        ),
                                        FlowEnvironmentName,
                                        ThisRecord.'Flow Environment'.'Display Name',
                                        WarningIcon,
                                        If(
                                            IsBlankOrError(ThisRecord.WorkflowEntityId),
                                            Blank(),
                                            "icon:Warning"
                                        ),
                                        WarningMessage,
                                        If(
                                            IsBlankOrError(ThisRecord.WorkflowEntityId),
                                            Blank(),
                                            "Flows in Solutions can only be deleted or assigned new owners. They cannot have other permission types edited programmatically"
                                        )
                                    ),
                                    "admin_displayname"
                                )
                            )
                        Visible: =false
                        Width: =96
                        X: =0
                        Y: =0
                        ZIndex: =9

        conAddPermissions As groupContainer.verticalAutoLayoutContainer:
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =8
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingBottom: =10
            PaddingLeft: =10
            PaddingRight: =10
            PaddingTop: =10
            RadiusBottomLeft: =4
            RadiusBottomRight: =4
            RadiusTopLeft: =4
            RadiusTopRight: =4
            Visible: =showAddUsers
            ZIndex: =2

            spinnerPerm As Spinner:
                BasePaletteColor: =
                DisplayMode: =DisplayMode.Edit
                FontColor: =
                Height: =Parent.Height
                Label: =var_Spinnerlabel
                LayoutMinHeight: =200
                LayoutMinWidth: =200
                Visible: |
                    =var_ShowSpinner
                Width: =Parent.Width
                X: =0
                Y: =0
                ZIndex: =1

            SubtitleContainer As groupContainer.horizontalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.SetByContainer
                FillPortions: =0
                Height: |
                    =//32
                    36
                LayoutGap: =5
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Width: |-
                    =//500
                    Parent.Width-20
                X: |-
                    =//40
                    0
                Y: |-
                    =//40
                    0
                ZIndex: =2

                "icoBackPrev As 'Fluent Icon (1.1.29)'":
                    DisplayMode: =DisplayMode.Edit
                    FontSize: =18
                    Height: =32
                    IconName: ="Back"
                    IconSize: =18
                    IconType: ='PowerCAT.Icon.IconType'.IconButon
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    OnChange: |+
                        =UpdateContext({var_pivotkey: "tabMembers"});
                        
                    Theme: =AppThemeJson
                    Tooltip: ="Back"
                    Visible: |-
                        =If(
                            var_pivotkey = "tabAddUser" && ((selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1)),
                            true,
                            false
                        )
                    Width: =32
                    X: =40
                    Y: =40
                    ZIndex: =1

                lblPanelSubtitle As Label:
                    Alignment: =Align.Justify
                    Color: =
                    DisplayMode: =DisplayMode.Edit
                    FillPortions: =1
                    FontSize: =12
                    FontWeight: =FontWeight.Semibold
                    Height: =32
                    LayoutMinHeight: =32
                    LayoutMinWidth: =320
                    OnChange: =false
                    PaddingStart: =If(!icoBackPrev.Visible,5,0)
                    Text: |-
                        =/*If(
                            var_pivotkey = "tabAddUser",
                            "Grant permission to a user",
                            If(
                                var_pivotkey = "tabAddGroup",
                                "Grant permission to a group",
                                "List of members"
                            )
                        )*/
                        If(
                            var_pivotkey = "tabAddUser",
                            "Grant permission to a user",
                            "List of members"
                        )
                    Width: =Parent.Width - Parent.PaddingLeft-70
                    X: =0
                    Y: =0
                    ZIndex: =2

                "icoBackPrev_3 As 'Fluent Icon (1.1.29)'":
                    AlignInContainer: =AlignInContainer.Center
                    DisplayMode: =DisplayMode.Edit
                    FontSize: =18
                    Height: =32
                    IconName: ="Cancel"
                    IconSize: =18
                    IconType: ='PowerCAT.Icon.IconType'.IconButon
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    OnChange: |+
                        =UpdateContext({showAddUsers: false});
                        
                    Theme: =AppThemeJson
                    Tooltip: ="Close"
                    Visible: =true
                    Width: =32
                    X: =40
                    Y: =40
                    ZIndex: =3

            MainContainer1 As groupContainer.verticalAutoLayoutContainer:
                BorderStyle: =BorderStyle.None
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                ZIndex: =3

                "AddEditUserCommandBar As 'Fluent Command Bar (1.1.29)'.pcfdataset":
                    DisplayMode: =DisplayMode.Edit
                    Height: =40
                    Items: |-
                        =Table(
                            {
                                ItemKey: "addedituser",
                                ItemDisplayName: If(
                                    !IsBlank(SelectedUserID) && PermissionsDetailsList.Selected.Role <> "Owner",
                                    "Change Permission",
                                    "Add"
                                ),
                                ItemIconName: "AddFriend",
                                ItemEnabled: If(
                                    (CountRows(EnvCheckedFlows) > 0 || CountRows(MakerCheckedFlows) > 0 || CountRows(OrphanedCheckedFlows) > 0) && (PermissionsDetailsList.Selected.Role <> "Owner"),
                                    true,
                                    false
                                )
                            },
                            {
                                ItemKey: "removeuser",
                                ItemDisplayName: "Remove",
                                ItemIconName: "UserRemove",
                                ItemEnabled: If(
                                    (!IsBlank(SelectedUserID) && PermissionsDetailsList.Selected.Role <> "Owner"),
                                    true,
                                    false
                                )
                            }
                        )
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    OnSelect: |-
                        =Switch(
                            Self.Selected.ItemKey,
                            "addedituser",
                            If(
                                IsBlank(SelectedUserID) || PermissionsDetailsList.Selected.Role = "Owner",
                                ClearCollect(
                                    DefaultUserCollection,
                                    User()
                                );
                                ClearCollect(
                                    DefaultUserCollection,
                                    Blank()
                                );
                                ,
                                ClearCollect(
                                    DefaultUserTempCollection,
                                    Office365Users.UserProfile(SelectedUserID)
                                );
                                ClearCollect(
                                    DefaultUserCollection,
                                    AddColumns(
                                        DefaultUserTempCollection,
                                        PersonaKey,
                                        Mail,
                                        PersonaRole,
                                        JobTitle,
                                        PersonaName,
                                        DisplayName,
                                        PersonaImgUrl,
                                //Get base64 image data
                                        Substitute(
                                            JSON(
                                                Office365Users.UserPhotoV2(SelectedUserID),
                                                JSONFormat.IncludeBinaryData
                                            ),
                                            """",
                                            ""
                                        )
                                    )
                                );
                            );
                            UpdateContext({var_pivotkey: "tabAddUser"});
                            ,
                            "removeuser",
                            UpdateContext(
                                {
                                    var_Spinnerlabel: "Removing User...",
                                    var_ShowSpinner: true,
                                    ctxUpdatesInProgress: true
                                }
                            );
                            
                        //call helper to remove permissions
                        UpdateContext(
                                {
                                    var_ResponseMessage: 'HELPER-ObjectOperations'.Run(
                                        SelectedUserID,
                                        First(ctxFlowsToUpdate).FlowName,
                                        First(ctxFlowsToUpdate).EnvName,
                                        "removeuser",
                                        "flow"
                                    ).thereturnstring
                                }
                            );
                            If(
                                var_ResponseMessage <> "pass",
                                Notify(
                                    var_ResponseMessage,
                                    NotificationType.Error
                                );
                                UpdateContext({var_ShowSpinner: false});
                                ,
                                Notify(
                                    "Permission removed successfully. ",
                                    NotificationType.Success
                                );
                                UpdateContext(
                                    {
                                        var_ShowSpinner: false,
                                        var_ShowShimmer: true
                                    }
                                );
                                If(
                                    (selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1),
                                    Select(Hidden_UpdateTable_Flow);
                                );
                                Refresh('Power Platform Users');
                                Refresh(Makers);
                                Refresh(Flows);
                                UpdateContext({galleryRefreshed: true});
                                Reset(chkSelectAll);
                                Reset(chkSelectAllFlow);
                                Reset(chkSelectAllOrphanedFlows);
                            );
                            UpdateContext({ctxUpdatesInProgress: false});
                            
                        )
                    Theme: =AppThemeJson
                    Visible: |-
                        =//PermissionsDetailsList.Visible
                        If(
                            var_pivotkey = "tabAddUser",
                            false,
                            true
                        )
                    Width: =Parent.Width
                    X: =0
                    Y: |-
                        =//Parent.Height - Self.Height - 5
                        //pagingContainer.Y+pagingContainer.Height+5
                        //Parent.Height - Self.Height+10
                        Parent.Height - Self.Height+5
                    ZIndex: =1

                Rectangle2 As rectangle:
                    AlignInContainer: =AlignInContainer.Stretch
                    BorderColor: =RGBA(166, 166, 166, 1)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    DisabledFill: =RGBA(166, 166, 166, 1)
                    Fill: =RGBA(122, 138, 143, 0.12)
                    FocusedBorderColor: =RGBA(0, 120, 212, 1)
                    Height: =1
                    HoverFill: =RGBA(0, 120, 212, 1)
                    PressedFill: =RGBA(0, 120, 212, 1)
                    ZIndex: =2

                "PermissionsDetailsList As 'Fluent Details List (1.1.29)'.pcfdataset":
                    AlternateRowColor: =
                    columns_Items: |-
                        =Table(
                            {
                                ColName: "UserType",
                                ColDisplayName: "UserType",
                                ColIsBold: true,
                                ColWidth: 50
                            },
                            {
                                ColName: "Image",
                                ColDisplayName: "",
                                ColImageWidth: 37,
                                ColWidth: 40,
                                ColPaddingTop: 5,
                                ColCellType: "image"
                            },
                            {
                                ColName: "Name",
                                ColDisplayName: "Name",
                                ColWidth: Self.Width - Parent.PaddingLeft - Parent.PaddingRight - 100,
                                ColIsBold: true,
                                ColSortable: true
                            },
                            {
                                ColName: "Role",
                                ColDisplayName: "Role",
                                ColIsBold: false,
                                ColSortable: true,
                                ColSubTextRow: true,
                                ColShowAsSubTextOf: "Name"
                            },
                            {
                                ColName: "Email",
                                ColDisplayName: "Email",
                                ColIsBold: false,
                                ColSortable: true,
                                ColSubTextRow: false,
                                ColShowAsSubTextOf: "Name"
                            }
                        )
                    Compact: =true
                    CurrentSortColumn: =ctxSortCol
                    CurrentSortDirection: |-
                        =If(ctxSortAsc,
                            'PowerCAT.FluentDetailsList.CurrentSortDirection'.Ascending,
                            'PowerCAT.FluentDetailsList.CurrentSortDirection'.Descending) 
                    DisplayMode: =DisplayMode.Edit
                    FillPortions: =1
                    HeaderVisible: =false
                    Height: =100
                    InputEvent: =varGridEvent
                    Items: =SortByColumns(roleAssignmentsCollection,ctxSortCol,If(ctxSortAsc,SortOrder.Ascending,SortOrder.Descending))
                    LargeDatasetPaging: =false
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    OnChange: |
                        =/* Runs when selected row changes and control property 'Raise OnRowSelection event' is true */
                        If(
                            Self.EventName = "OnRowSelectionChange",
                            If(
                                !IsBlank(Self.EventRowKey),
                                UpdateContext({SelectedUserID: PermissionsDetailsList.Selected.RowKey}),
                                UpdateContext({SelectedUserID: Blank()})
                            );
                            
                        );
                        If(
                            Self.EventName = "Sort",
                            UpdateContext(
                                {
                                    ctxSortCol: Self.SortEventColumn,
                                    ctxSortAsc: If(
                                        Self.SortEventDirection = 'PowerCAT.FluentDetailsList.SortEventDirection'.Ascending,
                                        true,
                                        false
                                    )
                                }
                            )
                        );
                    PageSize: =14
                    RaiseOnRowSelectionChangeEvent: =true
                    RecordKey: =""
                    SelectionAlwaysVisible: =true
                    SelectionType: =If(Self.Selected.Role <> "Owner",'PowerCAT.FluentDetailsList.SelectionType'.Single)
                    SelectRowsOnFocus: =false
                    Theme: =AppThemeJson
                    Visible: |-
                        =If(
                            var_pivotkey = "tabMembers" && !var_ShowShimmer && ((selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1)),
                            true,
                            false
                        )
                    Width: |-
                        =//Parent.Width - Parent.PaddingLeft/1.4
                        Parent.Width
                    X: =0
                    Y: =5
                    ZIndex: =3

                    Name1_4 As pcfDataField.textualColumn:
                        FieldDisplayName: ="Name"
                        FieldName: ="Name"
                        FieldType: ="s"
                        FieldVariantName: ="textualColumn"
                        Order: =3
                        ZIndex: =7

                    Role1_5 As pcfDataField.textualColumn:
                        FieldDisplayName: ="Role"
                        FieldName: ="Role"
                        FieldType: ="s"
                        FieldVariantName: ="textualColumn"
                        Order: =4
                        ZIndex: =8

                    Image1_4 As pcfDataField.textualColumn:
                        FieldDisplayName: ="Image"
                        FieldName: ="Image"
                        FieldType: ="s"
                        FieldVariantName: ="textualColumn"
                        Order: =3
                        ZIndex: =9

                    Email1_4 As pcfDataField.textualColumn:
                        FieldDisplayName: ="Email"
                        FieldName: ="Email"
                        FieldType: ="s"
                        FieldVariantName: ="textualColumn"
                        Order: =4
                        ZIndex: =12

                    UserType1 As pcfDataField.textualColumn:
                        FieldDisplayName: ="UserType"
                        FieldName: ="UserType"
                        FieldType: ="s"
                        FieldVariantName: ="textualColumn"
                        Order: =5
                        ZIndex: =57

                pagingContainer As groupContainer.horizontalAutoLayoutContainer:
                    AlignInContainer: =AlignInContainer.SetByContainer
                    BorderColor: =RGBA(0, 0, 0, 0)
                    BorderStyle: =BorderStyle.None
                    FillPortions: =0
                    Height: =35
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    RadiusBottomLeft: =4
                    RadiusBottomRight: =4
                    RadiusTopLeft: =4
                    RadiusTopRight: =4
                    Visible: =PermissionsDetailsList.Visible
                    Width: =PermissionsDetailsList.Width
                    X: |-
                        =//4.285714285714278
                        //0
                        PermissionsDetailsList.Width + PermissionsDetailsList.X - Self.Width
                    Y: =PermissionsDetailsList.Y + PermissionsDetailsList.Height
                    ZIndex: =4

                    "icoFirst As 'Fluent Icon (1.1.29)'":
                        AlignInContainer: =AlignInContainer.Stretch
                        DisplayMode: =If(PermissionsDetailsList.HasPreviousPage,DisplayMode.Edit,DisplayMode.Disabled)
                        Height: =25
                        IconName: ="Previous"
                        LayoutMinHeight: =35
                        LayoutMinWidth: =200
                        OnChange: =Set(varGridEvent,"LoadFirstPage" & Text(Rand()));
                        Theme: =AppThemeJson
                        Tooltip: ="First Page"
                        Width: =35
                        X: =0
                        Y: =0
                        ZIndex: =1

                    "icoBack As 'Fluent Icon (1.1.29)'":
                        DisplayMode: |-
                            =If(
                                PermissionsDetailsList.HasPreviousPage,
                                DisplayMode.Edit,
                                DisplayMode.Disabled
                            )
                        Height: =35
                        IconName: ="Back"
                        LayoutMinHeight: =200
                        LayoutMinWidth: =200
                        OnChange: =Set(varGridEvent,"LoadPreviousPage" & Text(Rand()));
                        Theme: =AppThemeJson
                        Tooltip: ="Previous"
                        Width: =35
                        X: =icoFirst.X+icoFirst.Width
                        Y: =0
                        ZIndex: =2

                    lblPageCount As label:
                        Align: =Align.Center
                        AlignInContainer: =AlignInContainer.Stretch
                        BorderColor: =RGBA(0, 0,0,0)
                        BorderThickness: =1
                        Color: =//ColorValue(AppTheme.palette.neutralPrimary)
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        FillPortions: =1
                        FocusedBorderThickness: =1
                        Font: =Font.'Segoe UI'
                        Height: =24
                        LayoutMinHeight: =24
                        Size: =8
                        Text: ="Page " & PermissionsDetailsList.PageNumber
                        Visible: =PermissionsDetailsList.Visible
                        Width: |-
                            =35  
                            //Parent.Width-icoFirst.Width-icoBack.Width-icoNext.Width-20
                        X: =icoBack.X+icoBack.Width
                        ZIndex: =3

                    "icoNext As 'Fluent Icon (1.1.29)'":
                        DisplayMode: |-
                            =If(
                                PermissionsDetailsList.HasNextPage,
                                DisplayMode.Edit,
                                DisplayMode.Disabled
                            )
                        Height: =35
                        IconName: ="Forward"
                        LayoutMinHeight: =200
                        LayoutMinWidth: =200
                        OnChange: =Set(varGridEvent,"LoadNextPage" & Text(Rand()));
                        Theme: =AppThemeJson
                        Tooltip: ="Next Page"
                        Width: =35
                        X: =lblPageCount.X + lblPageCount.Width
                        Y: =0
                        ZIndex: =4

                    "icoFirst_4 As 'Fluent Icon (1.1.29)'":
                        AlignInContainer: =AlignInContainer.Stretch
                        DisplayMode: =If(PermissionsDetailsList.HasPreviousPage,DisplayMode.Edit,DisplayMode.Disabled)
                        Height: =25
                        IconName: ="Next"
                        LayoutMinHeight: =35
                        LayoutMinWidth: =200
                        OnChange: =Set(varGridEvent,"LoadFirstPage" & Text(Rand()));
                        Theme: =AppThemeJson
                        Tooltip: ="First Page"
                        Width: =35
                        X: =0
                        Y: =0
                        ZIndex: =5

                "PermissionsDetailsListShimmer As 'Fluent Shimmer (1.1.29) Preview'.pcfdataset":
                    DisplayMode: =DisplayMode.Edit
                    Height: =PermissionsDetailsList.Height
                    Items: |-
                        =Table({
                                ItemWidth: "14",
                                ItemHeight: 12,
                                ItemType: "line"
                            },
                            {
                                ItemWidth: "5",
                                ItemHeight: 10,
                                ItemType: "gap"
                            },
                            {
                                ItemWidth: "120",
                                ItemHeight: 5,
                                ItemType: "line"
                            }
                        )
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    RowCount: =3
                    SpacebetweenShimmer: ='PowerCAT.Shimmer.SpacebetweenShimmer'.'0px'
                    Theme: =AppThemeJson
                    Visible: |-
                        =If(
                            var_pivotkey = "tabMembers" && var_ShowShimmer && ((selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1)),
                            true,
                            false
                        )
                    Width: =PermissionsDetailsList.Width
                    X: |-
                        =//PermissionsDetailsList.X
                        0
                    Y: =PermissionsDetailsList.Y
                    ZIndex: =5

                AddUsersContainer As groupContainer.verticalAutoLayoutContainer:
                    AlignInContainer: =AlignInContainer.SetByContainer
                    Height: =Parent.Height
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutGap: =5
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    PaddingBottom: =10
                    PaddingLeft: =10
                    PaddingRight: =10
                    PaddingTop: =10
                    Visible: |
                        =If(var_pivotkey = "tabAddUser",true,false)
                    Width: =Parent.Width
                    ZIndex: =6

                    lblAddUsers_4 As Label:
                        AlignInContainer: =AlignInContainer.Stretch
                        AutoHeight: =true
                        Color: =
                        DisplayMode: =DisplayMode.Edit
                        FontSize: =11
                        FontWeight: =FontWeight.Semibold
                        Height: =30
                        LayoutMinHeight: =35
                        LayoutMinWidth: =320
                        OnChange: =false
                        Text: ="Select user"
                        Width: =Parent.Width - Parent.PaddingLeft * 2
                        X: =24
                        Y: =102
                        ZIndex: =1

                    "PeoplePicker As 'Fluent PeoplePicker (1.1.29) Preview'.pcfdataset":
                        AlignInContainer: =AlignInContainer.Stretch
                        DisplayMode: =DisplayMode.Edit
                        Error: =false
                        Height: =50
                        Items: =DefaultUserCollection
                        LayoutMinHeight: =200
                        LayoutMinWidth: =200
                        MaxPeople: =1
                        OnBlur: =false
                        OnFocus: =false
                        OnSearch: |
                            =IfError(
                                Office365Users.SearchUserV2(
                                    {
                                        searchTerm: Self.SearchText,
                                        top: 500
                                    }
                                ),
                                Error(FirstError)
                            );
                            ClearCollect(
                                UserCollection,
                                AddColumns(
                                    Office365Users.SearchUserV2(
                                        {
                                            searchTerm: Self.SearchText,
                                            top: 500
                                        }
                                    ).value,
                                    SuggestionImgUrl,
                                    Substitute(
                                        JSON(
                                            Office365Users.UserPhotoV2(Id),
                                            JSONFormat.IncludeBinaryData
                                        ),
                                        """",
                                        ""
                                    ),
                                    SuggestionKey,
                                    Id,
                                    SuggestionName,
                                    DisplayName,
                                    SuggestionRole,
                                    JobTitle
                                )
                            );
                        ShowSecondaryText: =true
                        Suggestions_Items: =UserCollection
                        Theme: =AppThemeJson
                        Width: =320
                        X: =20
                        Y: =0
                        ZIndex: =2

                        DisplayName5_1 As pcfDataField.textualColumn:
                            FieldDisplayName: ="DisplayName"
                            FieldName: ="DisplayName"
                            FieldType: ="s"
                            FieldVariantName: ="textualColumn"
                            Order: =3
                            ZIndex: =55

                        Email2_1 As pcfDataField.textualColumn:
                            FieldDisplayName: ="Email"
                            FieldName: ="Email"
                            FieldType: ="s"
                            FieldVariantName: ="textualColumn"
                            Order: =2
                            ZIndex: =56

                    lblSelectedUserRole_2 As Label:
                        AlignInContainer: =AlignInContainer.Stretch
                        AutoHeight: =false
                        Color: =
                        DisplayMode: =DisplayMode.Edit
                        FontSize: =11
                        FontWeight: =FontWeight.Semibold
                        Height: =35
                        LayoutMinHeight: =35
                        LayoutMinWidth: =320
                        OnChange: =false
                        Text: ="Select user role"
                        Width: |
                            =Parent.Width - Parent.PaddingLeft * 2
                        X: =24
                        Y: =88
                        ZIndex: =3

                    ddUserRole As Dropdown.pcfdataset:
                        AlignInContainer: =AlignInContainer.Stretch
                        DefaultSelectedItems: =["Can View"]
                        DisplayMode: =DisplayMode.Edit
                        Height: =32
                        Items: |-
                            =If(
                                selectedTab = "Orphaned flows",
                                [
                                    "Can View",
                                    "Can Edit",
                                    "Owner"
                                ],
                                [
                                    "Can View",
                                    "Can Edit"
                                ]
                            )
                        LayoutMinHeight: =32
                        LayoutMinWidth: =320
                        Width: =320
                        X: =0
                        Y: =0
                        ZIndex: =4

                    PanelFooterContainer_2 As groupContainer.manualLayoutContainer:
                        AlignInContainer: =AlignInContainer.Start
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        Width: =Parent.Width - Parent.PaddingLeft * 2
                        ZIndex: =6

                        icoFooterDivider_2 As rectangle:
                            BorderColor: =//ColorValue(AppTheme.palette.neutralLight)
                            BorderThickness: =0.1
                            DisabledFill: =RGBA(166, 166, 166, 1)
                            Fill: =RGBA(0, 120, 212, 1)
                            FocusedBorderColor: =RGBA(0, 120, 212, 1)
                            Height: =0.1
                            HoverFill: =RGBA(0, 120, 212, 1)
                            PressedFill: =RGBA(0, 120, 212, 1)
                            Width: =Parent.Width
                            Y: =btnAddUser.Y - 10
                            ZIndex: =2

                        btnAddUser As Button:
                            BasePaletteColor: =
                            DisplayMode: |-
                                =//If(!false && !IsBlank(ddSelectedRole_2.Selected.Key),DisplayMode.Edit,DisplayMode.Disabled)
                                /*IfError(
                                    CountRows(PeoplePicker.SelectedPeople) <= 0,
                                    DisplayMode.Edit,
                                    DisplayMode.Disabled
                                )*/
                                If(
                                    !IsBlank(ddUserRole.Selected.Value) && !IsBlankOrError(First(PeoplePicker.SelectedPeople)),
                                    DisplayMode.Edit,
                                    DisplayMode.Disabled
                                )
                            Font: ="'Segoe UI', 'Open Sans', sans-serif"
                            FontColor: =
                            FontSize: =12
                            FontWeight: =FontWeight.Normal
                            Height: =32
                            OnSelect: |
                                =UpdateContext(
                                    {
                                        ctxFlowsToUpdate: Switch(
                                            selectedTab,
                                            "Environment",
                                            EnvCheckedFlows,
                                            "Owner",
                                            MakerCheckedFlows,
                                            "Orphaned flows",
                                            OrphanedCheckedFlows
                                        ),
                                        ctxUpdatesInProgress: true
                                    }
                                );
                                If(
                                    CountRows(ctxFlowsToUpdate) <= 0,
                                    Notify(
                                        "Please select any flow(s) to update",
                                        NotificationType.Error
                                    )
                                );
                                UpdateContext(
                                    {
                                        var_Spinnerlabel: "Assigning Permission...",
                                        var_ShowSpinner: true,
                                        var_RoleAssignment: ddUserRole.Selected.Value
                                    }
                                );
                                Set(
                                    var_selectedUser,
                                    First(PeoplePicker.SelectedPeople).PersonaKey
                                );
                                Set(
                                    var_selectedUserID,
                                    Office365Users.UserProfileV2(var_selectedUser).id
                                );
                                Set(
                                    var_selectedUserName,
                                    Office365Users.UserProfileV2(var_selectedUser).displayName
                                );
                                //make permissions changes
                                If(
                                    CountRows(ctxFlowsToUpdate) > 0,
                                    UpdateContext(
                                        {
                                            var_Spinnerlabel: "Assigning Permission...",
                                            var_ShowSpinner: true,
                                            var_RoleAssignment: ddUserRole.Selected.Value
                                        }
                                    );
                                    ForAll(
                                        ctxFlowsToUpdate,
                                    //if viewer or editor
                                        If(
                                            var_RoleAssignment = "Can View" || var_RoleAssignment = "Can Edit",
                                            If(
                                                'HELPER-ObjectOperations'.Run(
                                                    var_selectedUserID,
                                                    FlowName,
                                                    EnvName,
                                                    If(
                                                        var_RoleAssignment = "Can View",
                                                        "addviewer",
                                                        "addeditor"
                                                    ),
                                                    "flow"
                                                ).thereturnstring <> "pass",
                                                Collect(
                                                    failedToSet,
                                                    FlowName
                                                )
                                            )
                                        );
                                    //if owner
                                If(
                                            var_RoleAssignment = "Owner",
                                            If(
                                                'HELPER-ObjectOperations'.Run(
                                                    var_selectedUserID,
                                                    FlowName,
                                                    EnvName,
                                                    "assign",
                                                    "flow"
                                                ).thereturnstring <> "pass",
                                                Collect(
                                                    failedToSet,
                                                    FlowName
                                                ),
                                                 /* Code for resetting IsOrphaned Flag to false.*/
                                                If(
                                                    ThisRecord.FlowIsOrphaned = "Yes",
                                                    Patch(
                                                        Flows,
                                                        LookUp(
                                                            Flows,
                                                            Flow = FlowName
                                                        ),
                                                        {'Flow is Orphaned': "No"}
                                                    )
                                                );
                                            );
                                        )
                                    );
                                    
                                //see if all permission changes passed
                                If(
                                        CountRows(failedToSet) < 1,
                                        Notify(
                                            "Permissions granted to " & var_selectedUserName,
                                            NotificationType.Success
                                        );
                                        ClearCollect(
                                            DefaultUserCollection,
                                            User()
                                        );
                                        ClearCollect(
                                            DefaultUserCollection,
                                            Blank()
                                        );
                                        Refresh('Power Platform Users');
                                        Refresh(Makers);
                                        Refresh(Flows);
                                        UpdateContext({galleryRefreshed: true});
                                        Reset(chkSelectAll);
                                        Reset(chkSelectAllFlow);
                                        Reset(chkSelectAllOrphanedFlows);
                                        If(
                                            (selectedTab = "Environment" && CountRows(EnvCheckedFlows) = 1) || (selectedTab = "Owner" && CountRows(MakerCheckedFlows) = 1) || (selectedTab = "Orphaned flows" && CountRows(OrphanedCheckedFlows) = 1),
                                            Select(Hidden_UpdateTable_Flow);
                                        );
                                        ,
                                        UpdateContext({CantShowThatText: "Changing permissions failed for some flows, try to set via product UX"});
                                        Notify(
                                            CantShowThatText,
                                            NotificationType.Error
                                        );
                                    );
                                    
                                );
                                UpdateContext({var_ShowSpinner: false});
                                UpdateContext({ctxUpdatesInProgress: false});
                                Clear(failedToSet);
                            Text: =If(IsBlank(SelectedUserID),"Add User","Update permission")
                            Width: =If(Self.Text="Update permission",126,80)
                            X: =0
                            Y: =Parent.Height - Self.Height -10
                            ZIndex: =3

    dialogDeleteApps As Dialog:
        Buttons: |-
            =Table(
                {
                    Label: "Yes",
                    ButtonType: 'Button.ButtonType'.Primary,
                    HasBorder: true
                },
                {
                    Label: "No",
                    ButtonType: 'Button.ButtonType'.Standard,
                    HasBorder: true
                }
            )
        DialogHeight: =250
        DialogWidth: =400
        Fill: =dialogDeleteApps.OverlayColor
        Height: =App.Height
        OnButtonSelect: |
            =Switch(
                Self.SelectedButton.Label,
                "Yes",
                //delete apps
                UpdateContext(
                    {
                        ctx_DeleteMsg: "Deleting Flow..",
                        ctxDeleteSpinner: true
                    }
                );
                ForAll(
                    OrphanedCheckedFlows,
                    If(
                        'HELPER-ObjectOperations'.Run(
                            "none",
                            ThisRecord.FlowName,
                            ThisRecord.Environment,
                            "delete",
                            "flow"
                        ).thereturnstring <> "pass",
                        Collect(
                            failedToSet,
                            ThisRecord.FlowName
                        )
                    )
                );
                
            //see if all deletions worked
            If(
                    CountRows(failedToSet) > 0,
                    Notify(
                        "Deleting some flows failed, try to delete via product UX",
                        NotificationType.Error,
                        1000
                    );
                    ,
                    Refresh(Flows);
                );
                UpdateContext(
                    {
                        showDeleteSelected: false,
                        ctxDeleteSpinner: false
                    }
                );
                //Select(btnOrphanedFlows);
            Reset(chkSelectAllOrphanedFlows);
                Clear(OrphanedCheckedFlows);
                Clear(failedToSet);
                ,
                "No",
                UpdateContext(
                    {
                        showDeleteSelected: false,
                        ctxDeleteSpinner: false
                    }
                );
                
            );
        OnCloseSelect: |
            =UpdateContext({showDeleteSelected: false});
        SubTitle: ="    Are you sure you want to delete the selected Flow(s)?"
        Title: =""
        Visible: =showDeleteSelected
        Width: =App.Width
        ZIndex: =4

