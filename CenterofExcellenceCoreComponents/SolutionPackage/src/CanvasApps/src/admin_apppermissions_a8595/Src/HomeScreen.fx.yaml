HomeScreen As screen:
    Fill: |-
        =RGBA(
            255,
            255,
            255,
            1
        )
    LoadingSpinnerColor: =RGBA(0, 120, 212, 1)
    OnVisible: |
        =UpdateContext(
            {
                ctxSortAsc: true,
                showAddUsers: false,
                showEmailPanel: false,
                ctxUpdatesInProgress: false,
                ctxLoadSpinner: false,
                ctxSpinnerLabel: ""
            }
        );
        ClearCollect(
            DefaultUserCollection,
            User()
        );
        ClearCollect(
            DefaultUserCollection,
            Blank()
        );
        Concurrent(
            Set(
                gblInitalsColors,
                [
                    {
                        Id: 1,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Blue
                    },
                    {
                        Id: 2,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.DarkBlue
                    },
                    {
                        Id: 3,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Burgundy
                    },
                    {
                        Id: 4,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.CoolGray
                    },
                    {
                        Id: 5,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Cyan
                    },
                    {
                        Id: 6,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.WarmGray
                    },
                    {
                        Id: 7,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Violet
                    },
                    {
                        Id: 8,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Teal
                    },
                    {
                        Id: 9,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Rust
                    },
                    {
                        Id: 10,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Purple
                    },
                    {
                        Id: 11,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Pink
                    },
                    {
                        Id: 12,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Orange
                    },
                    {
                        Id: 13,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.Magenta
                    },
                    {
                        Id: 14,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.LightRed
                    },
                    {
                        Id: 15,
                        Color: 'PowerCAT.Persona.PersonaInitialsColor'.LightPink
                    }
                ]
            ),
            ClearCollect(
                colMakers,
                ShowColumns(
                    AddColumns(
                        Filter(
                            Makers,
                            'Number of Flows' > 0
                        ),
                        MakerImage,
                        If(
                            boolPhotosForbidden,
                            Substitute(
                                JSON(
                                    PersonPlaceholder,
                                    JSONFormat.IncludeBinaryData
                                ),
                                """",
                                ""
                            ),
                            Substitute(
                                JSON(
                                    If(
                                        !IsBlankOrError(ThisRecord.PhotoObject.Value),
                                        ThisRecord.PhotoObject.Value,
                                        PersonPlaceholder
                                    ),
                                    JSONFormat.IncludeBinaryData
                                ),
                                """",
                                ""
                            )
                        ),
                        WarningImage,
                        If(
                            IsBlankOrError(ThisRecord.'Number Of UI Flows (State)'),
                            false,
                            true
                        ),
                        UserImage,
                        IfError(
                            Office365Users.UserPhotoMetadata(ThisRecord.'Record GUID as String').HasPhoto,
                            false,
                            Substitute(
                                JSON(
                                    Office365Users.UserPhotoV2(ThisRecord.'Record GUID as String'),
                                    JSONFormat.IgnoreBinaryData
                                ),
                                """",
                                ""
                            )
                        )
                    ),
                    'Display Name',
                    MakerImage,
                    Maker,
                    Environments,
                    'Record GUID as String',
                    UserImage
                )
            )
        );
        ClearCollect(
            colMakersAdded,
            AddColumns(
                colMakers,
                RecordKey,
                admin_recordguidasstring
            )
        );
        ClearCollect(
            colMakersAddedCols,
            ForAll(
                Sequence(CountRows(colMakersAdded)),
                Patch(
                    Last(
                        FirstN(
                            colMakersAdded,
                            Value
                        )
                    ),
                    {RowNumber: Value}
                )
            )
        );

    dialogDeleteFlows As Dialog:
        Buttons: |-
            =Table(
                {
                    Label: "Yes",
                    ButtonType: 'Button.ButtonType'.Primary,
                    HasBorder: true
                },
                {
                    Label: "No",
                    ButtonType: 'Button.ButtonType'.Standard,
                    HasBorder: true
                }
            )
        DialogHeight: =250
        DialogWidth: =400
        Fill: =dialogDeleteFlows.OverlayColor
        Height: =If(Self.Visible, App.Height, 0)
        OnButtonSelect: |-
            =//delete apps
            Switch(
                Self.SelectedButton.Label,
                "Yes",
                UpdateContext(
                    {
                        ctxLoadSpinner: true,
                        ctxSpinnerLabel: "Deleting.."
                    }
                );
                ForAll(
                    OrphanedCheckedApps,
                    If(
                        'HELPER-ObjectOperations'.Run(
                            "none",
                            ThisRecord.AppName,
                            ThisRecord.Environment,
                            "delete",
                            "app"
                        ).thereturnstring <> "pass",
                        Collect(
                            failedToSet,
                            ThisRecord.AppName
                        )
                    )
                );
                
            //see if all deletions worked
            If(
                    CountRows(failedToSet) < 1,
                    Refresh('PowerApps Apps'),
                    Notify(
                        "Deleting some apps failed, try to delete via product UX",
                        NotificationType.Error
                    );
                );
                UpdateContext(
                    {
                        showDeleteSelected: false,
                        ctxLoadSpinner: false
                    }
                );
                Clear(failedToSet),
                "No",
                UpdateContext({showDeleteSelected: false});
                
            )
        OnCloseSelect: |
            =UpdateContext({showDeleteSelected: false});
        SubTitle: ="Are you sure you want to delete the selected App(s)?"
        Title: ="Delete"
        Visible: =showDeleteSelected
        Width: =If(Self.Visible, App.Width, 0)

    Hidden_UpdateTable_App As Button:
        BorderColor: =
        ButtonType: ='Button.ButtonType'.Standard
        DisabledBorderColor: =
        DisabledFillColor: =
        DisabledTextColor: =
        DisplayMode: =DisplayMode.Edit
        FillColor: =
        Height: =0
        HoverBorderColor: =
        HoverFillColor: =
        HoverTextColor: =
        OnChange: =false
        OnSelect: |
            =If(
                ((selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1)),
                UpdateContext(
                    {
                        ctxAppSelected: Switch(
                            selectedTab,
                            "Environment",
                            First(EnvCheckedApps),
                            "Owner",
                            First(EnvCheckedOwnerApps),
                            "Orphaned apps",
                            First(OrphanedCheckedApps)
                        )
                    }
                );
                Clear(temproleAssignmentsCollection);
                ClearCollect(
                    temproleAssignmentsCollection,
                    PowerAppsforAdmins.GetAdminAppRoleAssignment(
                        ctxAppSelected.EnvName,
                        ctxAppSelected.AppName
                    ).value
                );
                ClearCollect(
                    roleAssignmentsCollection,
                    AddColumns(
                        temproleAssignmentsCollection,
                        RowKey,
                        properties.principal.id,
                        Name,
                        //tenant
                        If(
                            properties.principal.type = "Tenant",
                            "Entire Org",
                        //group
                            If(
                                properties.principal.type = "Group",
                                If(
                                    IsError(Office365Groups.ListGroups({'$filter': "id eq " & "'" & properties.principal.id & "'"}).value),
                                    "Unknown Group",
                                    "Group: " & First(Office365Groups.ListGroups({'$filter': "id eq " & "'" & properties.principal.id & "'"}).value).displayName
                                ),
                        //service principal
                                If(
                                    properties.principal.type = "ServicePrincipal",
                                    properties.principal.displayName,
                        //user
                                    If(
                                        !IsError(Office365Users.UserProfile(properties.principal.id).DisplayName),
                                        Office365Users.UserProfile(properties.principal.id).DisplayName,
                        //orphan
                                        If(
                                            CountRows(
                                                Filter(
                                                    'Power Platform Users',
                                                    'Record GUID as String' = name
                                                )
                                            ) > 0,
                                            LookUp(
                                                'Power Platform Users',
                                                'Record GUID as String' = name
                                            ).'Display Name',
                                            "Unknown user"
                                        )
                                    )
                                )
                            )
                        ),
                        Image,
                        If(
                            !IsBlank(properties.principal.id),
                            If(
                                properties.principal.type <> "User",
                                Substitute(
                                    JSON(
                                        PersonPlaceholder,
                                        JSONFormat.IncludeBinaryData
                                    ),
                                    """",
                                    ""
                                ),
                                If(
                                    IfError(
                                        Office365Users.UserPhotoMetadata(properties.principal.id).HasPhoto,
                                        false
                                    ),
                                    Substitute(
                                        JSON(
                                            Office365Users.UserPhotoV2(properties.principal.id),
                                            JSONFormat.IncludeBinaryData
                                        ),
                                        """",
                                        ""
                                    ),
                                    If(
                                        !IsBlankOrError(
                                            First(
                                                Search(
                                                    'Power Platform Users',
                                                    ThisRecord.properties.principal.id,
                                                    'Record GUID as String'
                                                )
                                            ).PhotoObject
                                        ),
                                        Substitute(
                                            JSON(
                                                First(
                                                    Search(
                                                        'Power Platform Users',
                                                        ThisRecord.properties.principal.id,
                                                        'Record GUID as String'
                                                    )
                                                ).PhotoObject,
                                                JSONFormat.IncludeBinaryData
                                            ),
                                            """",
                                            ""
                                        ),
                                        Substitute(
                                            JSON(
                                                PersonPlaceholder,
                                                JSONFormat.IncludeBinaryData
                                            ),
                                            """",
                                            ""
                                        )
                                    )
                                )
                            )
                        ),
                        Email,
                        properties.principal.email,
                        Role,
                        properties.roleName,
                        Type,
                        If(
                            properties.principal.type = "Tenant",
                            "Tenant",
                            If(
                                properties.principal.type = "Group",
                                "Group",
                                "User"
                            )
                        ),
                        UserType,
                        If(
                            properties.principal.type = "User",
                            IfError(
                                Office365Users.UserProfileV2(properties.principal.id).userType,
                                Blank()
                            );
                            ,
                            If(
                                properties.principal.type = "Group",
                                properties.principal.type,
                                Blank()
                            );
                        )
                    )
                );
                UpdateContext({var_ShowShimmer: false});
                
            );
        PressedBorderColor: =
        PressedFillColor: =
        PressedTextColor: =
        Text: ="load apps"
        TextColor: =
        Visible: =false
        Width: =0
        X: =0
        Y: =0
        ZIndex: =1

    MainHomeScreenContainer As groupContainer.horizontalAutoLayoutContainer:
        DropShadow: =DropShadow.Light
        Height: =Parent.Height
        LayoutMode: =LayoutMode.Auto
        RadiusBottomLeft: =4
        RadiusBottomRight: =4
        RadiusTopLeft: =4
        RadiusTopRight: =4
        Width: =Parent.Width
        ZIndex: =2

        LeftHomeScreenContainer As groupContainer.verticalAutoLayoutContainer:
            Fill: =RGBA(122, 138, 143, 0.12)
            FillPortions: =2
            LayoutDirection: =LayoutDirection.Vertical
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingBottom: =App.ActiveScreen.Width * 0.01
            PaddingLeft: =App.ActiveScreen.Width * 0.01
            PaddingRight: =App.ActiveScreen.Width * 0.01
            RadiusBottomLeft: =4
            RadiusBottomRight: =4
            RadiusTopLeft: =4
            RadiusTopRight: =4
            ZIndex: =1

            ActionHomeScreenContainer As groupContainer.horizontalAutoLayoutContainer:
                FillPortions: =0
                Height: =50
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                ZIndex: =1

                "cbEnvironmentActions As 'Fluent Command Bar (1.1.29)'.pcfdataset":
                    AccessibilityLabel: ="Command Bar"
                    AlignInContainer: =AlignInContainer.Stretch
                    DisplayMode: |-
                        =/*If(
                            !IsEmpty(galApps.AllItems) && CountRows(EnvCheckedApps) > 0,
                            DisplayMode.Edit,
                            DisplayMode.Disabled
                        )*/
                    FillPortions: =1
                    Height: =200
                    Items: |-
                        =Table(
                            {
                                ItemKey: "addpermissions",
                                ItemDisplayName: "Manage permissions",
                                ItemIconName: "PeopleAdd",
                                ItemEnabled: Switch(
                                    selectedTab,
                                    "Environment",
                                    !IsEmpty(galApps.AllItems) && (CountRows(EnvCheckedApps) > 0),
                                    "Owner",
                                    !IsEmpty(galOwnerApps.AllItems) && (CountRows(EnvCheckedOwnerApps) > 0),
                                    "Orphaned apps",
                                    !IsEmpty(galOrphanedApps.AllItems) && (CountRows(OrphanedCheckedApps) > 0)
                                ),
                                ItemVisible: Switch(
                                    selectedTab,
                                    "Environment",
                                    true,
                                    "Owner",
                                    true,
                                    "Orphaned apps",
                                    true
                                )
                            },
                            {
                                ItemKey: "deleteorphanedapp",
                                ItemDisplayName: "Delete selected",
                                ItemIconName: "Delete",
                                ItemVisible: Switch(
                                    selectedTab,
                                    "Environment",
                                    false,
                                    "Owner",
                                    false,
                                    "Orphaned apps",
                                    true
                                ),
                                ItemEnabled: Switch(
                                    selectedTab,
                                    "Environment",
                                    false,
                                    "Owner",
                                    false,
                                    "Orphaned apps",
                                    CountRows(OrphanedCheckedApps) > 0
                                )
                            },
                            {
                                ItemKey: "refresh",
                                ItemDisplayName: "Refresh",
                                ItemIconName: "Refresh"
                            }
                        )
                    LayoutMinHeight: =30
                    LayoutMinWidth: =200
                    OnSelect: |-
                        =Switch(
                            Self.Selected.ItemKey,
                            "addpermissions",
                            Clear(roleAssignmentsCollection);
                            UpdateContext(
                                {
                                    var_pivotkey: "tabMembers",
                                    var_ShowShimmer: true,
                                    var_ShowSpinner: false,
                                    ctxSortCol: "Name",
                                    ctxSortAsc: true,
                                    galleryRefreshed: false
                                }
                            );
                            Concurrent(
                        //get app details
                                Set(
                                    gloSelectedRecordID,
                                    Switch(
                                        selectedTab,
                                        "Environment",
                                        GUID(First(EnvCheckedApps).AppName),
                                        "Owner",
                                        GUID(First(EnvCheckedOwnerApps).AppName),
                                        "Orphaned apps",
                                        GUID(First(OrphanedCheckedApps).AppName)
                                    )
                                ),
                                Set(
                                    gloEnvironmentName,
                                    Switch(
                                        selectedTab,
                                        "Environment",
                                        First(EnvCheckedApps).Environment,
                                        "Owner",
                                        First(EnvCheckedOwnerApps).Environment,
                                        "Orphaned apps",
                                        First(OrphanedCheckedApps).Environment
                                    )
                                ),
                                Set(
                                    gloSelectedAppID,
                                    Switch(
                                        selectedTab,
                                        "Environment",
                                        GUID(First(EnvCheckedApps).AppName),
                                        "Owner",
                                        First(EnvCheckedOwnerApps).AppName,
                                        "Orphaned apps",
                                        First(OrphanedCheckedApps).AppName
                                    )
                                )
                            );
                            
                        //get permissions
                        If(
                                (selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1),
                                //CheckIfSingleSelection(),
                                Select(Hidden_UpdateTable_App);
                            );
                            UpdateContext({var_ShowShimmer: false});
                            UpdateContext({showAddUsers: true});
                            ,
                            "deleteorphanedapp",
                            UpdateContext({showDeleteSelected: true}),
                            "appdetails",
                            Launch(
                                theAppMakerURL & "environments/" & LookUp(
                                    'PowerApps Apps',
                                    (AppIDString = galOrphanedApps.Selected.AppIDString)
                                ).'App Environment ID' & "/apps/" & galOrphanedApps.Selected.AppIDString & "/details"
                            );
                            ,
                            "refresh",
                            Refresh('Power Platform Users');
                            Refresh(Makers);
                            Refresh('PowerApps Apps');
                            UpdateContext({galleryRefreshed: true});
                            Reset(chkSelectAll);
                            Reset(chkSelectAllMakerApps);
                            Reset(chkSelectAllOrphanedApps);
                            Clear(EnvCheckedApps);
                            Clear(EnvCheckedOwnerApps);
                            Clear(OrphanedCheckedApps);
                            
                        )
                    Theme: =AppThemeJson
                    Visible: |-
                        =//(pivotAppsNav.Selected.ItemKey="Environment")
                        true
                    Width: |-
                        =//200
                        500
                    X: |-
                        =//40
                        0
                    Y: |-
                        =//40
                        0
                    ZIndex: =1

                "txtSearchApps As 'Text input'":
                    Align: ='TextInputCanvas.Align'.Start
                    AlignInContainer: =AlignInContainer.Center
                    Appearance: ="FilledDarker"
                    BasePaletteColor: =RGBA(122,138,143,0.13)
                    BorderColor: =""
                    BorderStyle: =""
                    DelayOutput: =true
                    DisabledBorderColor: =""
                    DisplayMode: |-
                        =If(
                            !ctxUpdatesInProgress,
                            DisplayMode.Edit,
                            DisplayMode.Disabled
                        )
                    FocusedBorderColor: =""
                    FontColor: =
                    Height: =32
                    HoverBorderColor: =""
                    LayoutMinHeight: =32
                    LayoutMinWidth: =320
                    OnChange: |
                        =UpdateContext({galleryRefreshed: true});
                        Reset(chkSelectAll);
                        Reset(chkSelectAllMakerApps);
                        Reset(chkSelectAllOrphanedApps);
                        Clear([@EnvCheckedApps]);
                        Clear([@EnvCheckedOwnerApps]);
                        Clear([@OrphanedCheckedApps]);
                    Placeholder: ="Search apps.."
                    PressedBorderColor: =""
                    Type: ='TextInputCanvas.Type'.Search
                    Width: =206
                    X: =1135
                    Y: =0
                    ZIndex: =4

            DetailsHomeScreenContainer As groupContainer.verticalAutoLayoutContainer:
                DropShadow: =DropShadow.Light
                Fill: =RGBA(255, 255, 255, 1)
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                ZIndex: =2

                conMainHome As groupContainer.verticalAutoLayoutContainer:
                    DropShadow: =DropShadow.Light
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    RadiusBottomLeft: =4
                    RadiusBottomRight: =4
                    RadiusTopLeft: =4
                    RadiusTopRight: =4
                    ZIndex: =1

                    conHeader As groupContainer.verticalAutoLayoutContainer:
                        Fill: |
                            =RGBA(0, 0, 0, 0)
                        FillPortions: =0
                        Height: |-
                            =//150
                            120
                        LayoutAlignItems: =LayoutAlignItems.Stretch
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        PaddingLeft: =40
                        PaddingRight: =40
                        PaddingTop: =32
                        ZIndex: =1

                        lblApp As Label:
                            AutoHeight: =true
                            Color: =
                            DisplayMode: =DisplayMode.Edit
                            FontSize: =16
                            FontWeight: =FontWeight.Semibold
                            Height: =43
                            LayoutMinHeight: =32
                            LayoutMinWidth: =320
                            OnChange: =false
                            PaddingStart: =0  
                            Text: ="Admin - App Permission Center"
                            Width: =320
                            X: =35
                            Y: =15
                            ZIndex: =1

                        lblTitle As Label:
                            AutoHeight: =false
                            Color: =    
                            DisplayMode: =DisplayMode.View
                            FontSize: =11
                            FontWeight: =FontWeight.Normal
                            Height: =80
                            LayoutMinHeight: =80
                            LayoutMinWidth: =320
                            OnChange: =false
                            Text: ="As a global admin, environment admin or business application admin this app can be used to re-assign app owner roles or add new users to an app."
                            VerticalAlignment: =VerticalAlign.Top
                            Width: =840
                            Wrap: =true
                            X: =0
                            Y: =0
                            ZIndex: =2

                    conApps As groupContainer.horizontalAutoLayoutContainer:
                        LayoutDirection: =LayoutDirection.Vertical
                        LayoutGap: |-
                            =//5
                            16
                        LayoutMinHeight: =50
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        PaddingBottom: =20
                        PaddingLeft: =20
                        PaddingRight: =20
                        PaddingTop: =20
                        RadiusBottomLeft: =4
                        RadiusBottomRight: =4
                        RadiusTopLeft: =4
                        RadiusTopRight: =4
                        Width: =Parent.Width
                        ZIndex: =2

                        conTabs_1 As groupContainer.horizontalAutoLayoutContainer:
                            FillPortions: =0
                            Height: =50
                            LayoutGap: =8
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            PaddingLeft: =2
                            ZIndex: =1

                            Container5_1 As groupContainer.horizontalAutoLayoutContainer:
                                AlignInContainer: =AlignInContainer.Center
                                BorderColor: =RGBA(199, 199, 199,1)
                                BorderThickness: =1
                                Fill: |
                                    =If(
                                        selectedTab = "Environment",
                                        RGBA(
                                            116,
                                            39,
                                            116,
                                            1
                                        ),
                                        RGBA(
                                            0,
                                            0,
                                            0,
                                            0
                                        )
                                    )
                                FillPortions: =0
                                Height: =32
                                LayoutGap: =5
                                LayoutMinHeight: =100
                                LayoutMinWidth: =250
                                LayoutMode: =LayoutMode.Auto
                                PaddingLeft: =5
                                RadiusBottomLeft: =16
                                RadiusBottomRight: =16
                                RadiusTopLeft: =16
                                RadiusTopRight: =16
                                Width: =130
                                ZIndex: =1

                                "Icon3_1 As 'Fluent Icon (1.1.29)'":
                                    DisplayMode: |-
                                        =If(
                                            !ctxUpdatesInProgress,
                                            DisplayMode.Edit,
                                            DisplayMode.Disabled
                                        )
                                    FillColor: =
                                    FontColor: |-
                                        =If(selectedTab="Environment","#ffffff","#000000")
                                    FontSize: =14
                                    Height: =32
                                    HoverFillColor: =""
                                    HoverFontColor: =""
                                    IconColor: =
                                    IconName: ="MapLayers"
                                    IconType: ='PowerCAT.Icon.IconType'.ActionButton
                                    LayoutMinHeight: =200
                                    LayoutMinWidth: =200
                                    OnChange: |
                                        =Set(
                                            selectedTab,
                                            "Environment"
                                        );
                                        //Clear(EnvCheckedOwnerApps);
                                        Clear(OrphanedCheckedApps);
                                        Clear(EnvCheckedOwnerApps);
                                        Reset(chkSelectAllMakerApps);
                                        Reset(chkSelectAllOrphanedApps);
                                        UpdateContext({showAddUsers: false});
                                    Text: ="Environments"
                                    TextAlignment: ='PowerCAT.Icon.TextAlignment'.Left
                                    Tooltip: =""
                                    Width: =32
                                    X: =0
                                    Y: =0
                                    ZIndex: =1

                            Container5_2 As groupContainer.horizontalAutoLayoutContainer:
                                AlignInContainer: =AlignInContainer.Center
                                BorderColor: =RGBA(199, 199, 199,1)
                                BorderThickness: =1
                                Fill: |-
                                    =If(
                                        selectedTab = "Owner",
                                        RGBA(
                                            116,
                                            39,
                                            116,
                                            1
                                        ),
                                        RGBA(
                                            0,
                                            0,
                                            0,
                                            0
                                        )
                                    )
                                FillPortions: =0
                                Height: =32
                                LayoutGap: =5
                                LayoutMinHeight: =100
                                LayoutMinWidth: =250
                                LayoutMode: =LayoutMode.Auto
                                PaddingLeft: =5
                                RadiusBottomLeft: =16
                                RadiusBottomRight: =16
                                RadiusTopLeft: =16
                                RadiusTopRight: =16
                                Width: |-
                                    =//130
                                    90
                                ZIndex: =2

                                "Icon3_2 As 'Fluent Icon (1.1.29)'":
                                    DisplayMode: |-
                                        =If(
                                            !ctxUpdatesInProgress,
                                            DisplayMode.Edit,
                                            DisplayMode.Disabled
                                        )
                                    FillColor: =
                                    FontColor: |-
                                        =If(selectedTab="Owner","#ffffff","#000000")
                                    FontSize: =14
                                    Height: =32
                                    IconColor: =
                                    IconName: ="ContactList"
                                    IconType: ='PowerCAT.Icon.IconType'.ActionButton
                                    LayoutMinHeight: =200
                                    LayoutMinWidth: =200
                                    OnChange: |
                                        =Set(
                                            selectedTab,
                                            "Owner"
                                        );
                                        Clear(EnvCheckedApps);
                                        Clear(OrphanedCheckedApps);
                                        Reset(chkSelectAll);
                                        Reset(chkSelectAllOrphanedApps);
                                        UpdateContext({showAddUsers: false});
                                    Text: ="Owner"
                                    TextAlignment: ='PowerCAT.Icon.TextAlignment'.Left
                                    Tooltip: =""
                                    Width: =32
                                    X: =0
                                    Y: =0
                                    ZIndex: =1

                            Container5_3 As groupContainer.horizontalAutoLayoutContainer:
                                AlignInContainer: =AlignInContainer.Center
                                BorderColor: =RGBA(199, 199, 199,1)
                                BorderThickness: =1
                                Fill: |-
                                    =If(
                                        selectedTab = "Orphaned apps",
                                        RGBA(
                                            116,
                                            39,
                                            116,
                                            1
                                        ),
                                        RGBA(
                                            0,
                                            0,
                                            0,
                                            0
                                        )
                                    )
                                FillPortions: =0
                                Height: =32
                                LayoutGap: =5
                                LayoutMinHeight: =100
                                LayoutMinWidth: =250
                                LayoutMode: =LayoutMode.Auto
                                PaddingLeft: =5
                                RadiusBottomLeft: =16
                                RadiusBottomRight: =16
                                RadiusTopLeft: =16
                                RadiusTopRight: =16
                                Width: =150
                                ZIndex: =3

                                "Icon3_3 As 'Fluent Icon (1.1.29)'":
                                    DisplayMode: |-
                                        =If(
                                            !ctxUpdatesInProgress,
                                            DisplayMode.Edit,
                                            DisplayMode.Disabled
                                        )
                                    FillColor: =
                                    FillPortions: =1
                                    FontColor: |-
                                        =If(selectedTab="Orphaned apps","#ffffff","#000000")
                                    FontSize: =14
                                    Height: =32
                                    IconColor: =
                                    IconName: ="RemoveLink"
                                    IconType: ='PowerCAT.Icon.IconType'.ActionButton
                                    LayoutMinHeight: =200
                                    LayoutMinWidth: =200
                                    OnChange: |
                                        =Set(
                                            selectedTab,
                                            "Orphaned apps"
                                        );
                                        Clear(EnvCheckedOwnerApps);
                                        Clear(EnvCheckedApps);
                                        Reset(chkSelectAll);
                                        Reset(chkSelectAllMakerApps);
                                        UpdateContext({showAddUsers: false});
                                    Text: ="Orphaned apps"
                                    TextAlignment: ='PowerCAT.Icon.TextAlignment'.Left
                                    Tooltip: =""
                                    Width: |-
                                        =//32
                                        60
                                    X: =0
                                    Y: =0
                                    ZIndex: =1

                        conEnvironmentApps As groupContainer.verticalAutoLayoutContainer:
                            LayoutGap: =10
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            LayoutOverflowX: =LayoutOverflow.Scroll
                            PaddingTop: =10
                            RadiusBottomLeft: =4
                            RadiusBottomRight: =4
                            RadiusTopLeft: =4
                            RadiusTopRight: =4
                            Visible: =(selectedTab = "Environment")
                            Width: |
                                =//500
                                Parent.Width-Parent.PaddingLeft-Parent.PaddingRight
                            ZIndex: =3

                            conLeft As groupContainer.verticalAutoLayoutContainer:
                                BorderStyle: =BorderStyle.None
                                LayoutDirection: =LayoutDirection.Vertical
                                LayoutGap: =10
                                LayoutMinHeight: =100
                                LayoutMinWidth: |-
                                    =//Parent.Width
                                    250
                                LayoutMode: =LayoutMode.Auto
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                Width: |-
                                    =Parent.Width*0.2
                                    //200
                                ZIndex: =2

                                conSortEnvs As groupContainer.horizontalAutoLayoutContainer:
                                    AlignInContainer: =AlignInContainer.Start
                                    Fill: |
                                        =//RGBA(0, 0, 0, 0)
                                        RGBA(245, 245, 245, 1)
                                    FillPortions: =0
                                    Height: =40
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    Width: |
                                        =Parent.Width
                                    ZIndex: =1

                                    "iconSort As 'Fluent Icon (1.1.29)'":
                                        AlignInContainer: =AlignInContainer.Center
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FillColor: =
                                        Height: |-
                                            =//Parent.Height
                                            32
                                        IconName: ="Sort"
                                        LayoutMinHeight: =200
                                        LayoutMinWidth: =200
                                        OnChange: |-
                                            =UpdateContext({ctxSortAsc:!ctxSortAsc})
                                        Theme: =AppThemeJson
                                        Tooltip: ="Sort"
                                        Width: =30
                                        X: =0
                                        Y: =0
                                        ZIndex: =1

                                    "txtSrchEnvironments As 'Text input'":
                                        AccessibleLabel: ="Search environments"
                                        AlignInContainer: =AlignInContainer.Center
                                        Appearance: ="FilledDarker"
                                        BasePaletteColor: =
                                        BorderColor: =""
                                        BorderStyle: =""
                                        DelayOutput: =true
                                        DisabledBorderColor: =""
                                        DisplayMode: |-
                                            =//DisplayMode.Edit
                                            If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FocusedBorderColor: =""
                                        FontColor: =
                                        Height: |-
                                            =//Parent.Height
                                            32
                                        HoverBorderColor: =""
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =320
                                        OnChange: |
                                            =//false
                                            Clear(EnvCheckedApps);
                                            Reset(chkSelectAll);
                                        Placeholder: ="Search environments"
                                        PressedBorderColor: =""
                                        Type: ='TextInputCanvas.Type'.Search
                                        Width: =Parent.Width-iconSort.Width-10
                                        X: =0
                                        Y: =0
                                        ZIndex: =4

                                galEnvironments As gallery.galleryVertical:
                                    '#CopilotOverlayLabel': ="Filtered"
                                    AlignInContainer: =AlignInContainer.Start
                                    BorderColor: =ColorValue(Style.Tertiary)
                                    BorderStyle: =BorderStyle.None
                                    DisabledBorderColor: =galEnvironments.BorderColor
                                    DisabledFill: =galEnvironments.Fill
                                    Fill: =RGBA(255, 255, 255, 1)
                                    Height: =845
                                    HoverBorderColor: =galEnvironments.BorderColor
                                    HoverFill: =galEnvironments.Fill
                                    Items: |-
                                        =SortByColumns(
                                            Search(
                                                Filter(
                                                vEnvironments,
                                                'Number Of Apps' > 0),
                                                txtSrchEnvironments.Value, 'Display Name'),
                                            "admin_displayname",
                                            If(
                                                ctxSortAsc,
                                                SortOrder.Ascending,
                                                SortOrder.Descending
                                            )
                                        )
                                    Layout: =Layout.Vertical
                                    LayoutMinHeight: =287
                                    LayoutMinWidth: =320
                                    LoadingSpinnerColor: =galEnvironments.BorderColor
                                    OnSelect: |+
                                        =Clear(EnvCheckedApps);
                                        Reset(chkSelectAll);
                                        UpdateContext({SelectedUserID:Blank()});
                                        
                                    PressedBorderColor: =galEnvironments.BorderColor
                                    PressedFill: =galEnvironments.Fill
                                    Selectable: |-
                                        =//true
                                        !ctxUpdatesInProgress
                                    ShowScrollbar: =false
                                    TemplateFill: =If(ThisItem.IsSelected, ColorValue(Style.Tertiary), Color.White)
                                    TemplatePadding: |-
                                        =//5
                                        0
                                    TemplateSize: =35
                                    Width: |-
                                        =//390 
                                        Parent.Width
                                    X: =62
                                    Y: =235
                                    ZIndex: =4

                                    lblDisplayname As label:
                                        BorderColor: =RGBA(218,218,218,1.00)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(47,41,43,1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                        FocusedBorderColor: =lblDisplayname.BorderColor
                                        FocusedBorderThickness: =2
                                        Font: =Font.'Segoe UI'
                                        Height: =galEnvironments.TemplateHeight
                                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                                        HoverColor: =RGBA(4,45,81,1.00)
                                        HoverFill: =RGBA(0, 0, 0, 0)
                                        OnSelect: =Select(Parent);
                                        PressedBorderColor: =RGBA(0, 0, 0, 0)
                                        PressedColor: =RGBA(4,45,81,1.00)
                                        PressedFill: =RGBA(0, 0, 0, 0)
                                        Size: =10
                                        Text: =ThisItem.'Display Name'
                                        Tooltip: |-
                                            ="Envt ID: " & ThisItem.Environment & "
                                            Envt Sku: " & ThisItem.'Environment Sku'
                                        Width: |
                                            =//252
                                            210
                                        X: =iconEnvironment.X+iconEnvironment.Width
                                        ZIndex: =2

                                    "iconEnvironment As 'Fluent Icon (1.1.29)'":
                                        DisplayMode: =DisplayMode.Edit
                                        Height: =Parent.TemplateHeight
                                        IconName: ="MapLayers"
                                        IconSize: =18
                                        OnChange: |-
                                            =Select(Parent);
                                            //Select(galEnvironments);
                                        Theme: =AppThemeJson
                                        Width: =35
                                        X: =0
                                        Y: =0
                                        ZIndex: =11

                            conAppsPaging As groupContainer.verticalAutoLayoutContainer:
                                AlignInContainer: =AlignInContainer.SetByContainer
                                FillPortions: =4
                                Height: =Parent.Height-Parent.PaddingTop
                                LayoutDirection: =LayoutDirection.Vertical
                                LayoutMinHeight: =100
                                LayoutMinWidth: =200
                                LayoutMode: =LayoutMode.Auto
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                Visible: =(selectedTab = "Environment")
                                Width: =Parent.Width-conLeft.Width
                                ZIndex: =3

                                Container10 As groupContainer.horizontalAutoLayoutContainer:
                                    Fill: =RGBA(122, 138, 143, 0.12)
                                    FillPortions: =0
                                    Height: =40
                                    LayoutGap: =10
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    RadiusBottomLeft: =4
                                    RadiusBottomRight: =4
                                    RadiusTopLeft: =4
                                    RadiusTopRight: =4
                                    ZIndex: =1

                                    chkSelectAll As checkbox:
                                        BorderColor: =ColorValue(Style.Primary)
                                        CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                        CheckboxSize: |-
                                            =//40
                                            25
                                        Color: =RGBA(0, 0, 0, 1)
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FocusedBorderColor: =chkSelectAll.BorderColor
                                        FocusedBorderThickness: |-
                                            =//2
                                            0
                                        Font: =Font.Arial
                                        Height: =Parent.Height
                                        HoverBorderColor: =ColorFade(chkSelectAll.BorderColor, 30%)
                                        HoverColor: =RGBA(0, 18, 107, 1)
                                        HoverFill: =ColorFade(chkSelectAll.Fill, 30%)
                                        OnCheck: |-
                                            =Clear(EnvCheckedApps);
                                            ForAll(
                                                galApps.AllItems,
                                                Collect(
                                                    EnvCheckedApps,
                                                    {
                                                        AppName: App,
                                                        AppOwner: 'App Owner',
                                                        AppIsOrphaned: 'App is Orphaned',
                                                        Environment: 'App Environment'.Environment,
                                                        EnvName: 'App Environment'.Name
                                                    }
                                                )
                                            )
                                        OnUncheck: =Clear(EnvCheckedApps)
                                        PaddingLeft: =10
                                        PressedBorderColor: =ColorFade(chkSelectAll.BorderColor, -30%)
                                        PressedColor: =ColorValue(Style.Primary)
                                        PressedFill: =ColorFade(chkSelectAll.Fill, -30%)
                                        Size: =13
                                        Text: =""
                                        Width: =35
                                        X: =20
                                        ZIndex: =1

                                    lblImage As Label:
                                        Color: =
                                        DisplayMode: =DisplayMode.Edit
                                        Height: =Container3_1.Height
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =320
                                        OnChange: =false
                                        Text: =""
                                        Width: =35
                                        X: =0
                                        Y: =0
                                        ZIndex: =2

                                    lblAppDisplayName As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =1.7
                                        FocusedBorderColor: =lblAppDisplayName.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =Parent.Height
                                        HoverBorderColor: =lblAppDisplayName.BorderColor
                                        HoverColor: =lblAppDisplayName.Color
                                        HoverFill: =lblAppDisplayName.Fill
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =lblAppDisplayName.BorderColor
                                        PressedColor: =lblAppDisplayName.Color
                                        PressedFill: =lblAppDisplayName.Fill
                                        Size: =11
                                        Text: ="App display name"
                                        Width: =151
                                        X: =95
                                        ZIndex: =3

                                    lblAppCurrentOwner As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =0.6
                                        FocusedBorderColor: =lblAppCurrentOwner.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =Parent.Height
                                        HoverBorderColor: =lblAppCurrentOwner.BorderColor
                                        HoverColor: =lblAppCurrentOwner.Color
                                        HoverFill: =lblAppCurrentOwner.Fill
                                        PaddingBottom: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =lblAppCurrentOwner.BorderColor
                                        PressedColor: =lblAppCurrentOwner.Color
                                        PressedFill: =lblAppCurrentOwner.Fill
                                        Size: =11
                                        Text: ="Current owner"
                                        Width: =151
                                        X: =391
                                        ZIndex: =4

                                    lblAppLaunchedOn_1 As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =0.6
                                        FocusedBorderColor: =lblAppLaunchedOn_1.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =Parent.Height
                                        HoverBorderColor: =lblAppLaunchedOn_1.BorderColor
                                        HoverColor: =lblAppLaunchedOn_1.Color
                                        HoverFill: =lblAppLaunchedOn_1.Fill
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =lblAppLaunchedOn_1.BorderColor
                                        PressedColor: =lblAppLaunchedOn_1.Color
                                        PressedFill: =lblAppLaunchedOn_1.Fill
                                        Size: =11
                                        Text: ="Last launched"
                                        Width: =103
                                        X: =542
                                        ZIndex: =5

                                    lblAppIdName As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =1
                                        FocusedBorderColor: =lblAppIdName.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =Parent.Height
                                        HoverBorderColor: =lblAppIdName.BorderColor
                                        HoverColor: =lblAppIdName.Color
                                        HoverFill: =lblAppIdName.Fill
                                        PaddingBottom: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =lblAppIdName.BorderColor
                                        PressedColor: =lblAppIdName.Color
                                        PressedFill: =lblAppIdName.Fill
                                        Size: =11
                                        Text: ="App id"
                                        Width: =151
                                        X: =732
                                        ZIndex: =6

                                galApps As gallery.galleryVertical:
                                    '#CopilotOverlayLabel': ="Filtered"
                                    AlignInContainer: =AlignInContainer.Start
                                    BorderColor: =ColorValue(Style.Tertiary)
                                    BorderStyle: =BorderStyle.None
                                    DisabledBorderColor: =galApps.BorderColor
                                    DisabledFill: =galApps.Fill
                                    Fill: =RGBA(255, 255, 255, 1)
                                    Height: =845
                                    HoverBorderColor: =galApps.BorderColor
                                    HoverFill: =galApps.Fill
                                    Items: |
                                        =SortByColumns(
                                            Search(
                                                If(IsBlank(galEnvironments.Selected), 
                                                    Filter(
                                                    'PowerApps Apps',
                                                    'App Environment'.'Record GUID as String' = First(galEnvironments.AllItems).'Record GUID as String' 
                                                    And 'App Deleted' = 'App Deleted (PowerApps Apps)'.No And 'App Type' = 'PowerApps Type'.Canvas),
                                        
                                                    Filter(
                                                    'PowerApps Apps',
                                                    'App Environment'.'Record GUID as String' = Text(galEnvironments.Selected.'Record GUID as String') 
                                                    And 'App Deleted' = 'App Deleted (PowerApps Apps)'.No And 'App Type' = 'PowerApps Type'.Canvas)),
                                        
                                                txtSearchApps.Value, 'App Display Name', 'App Owner Display Name', 'Record GUID as String'
                                            ),
                                            "admin_displayname"
                                        )
                                    Layout: =Layout.Vertical
                                    LayoutMinHeight: =287
                                    LayoutMinWidth: =320
                                    LoadingSpinnerColor: =galApps.BorderColor
                                    OnSelect: |-
                                        =Set(SelectedApp, galApps.Selected);
                                        Navigate(AppDetailsScreen)
                                    PressedBorderColor: =galApps.BorderColor
                                    PressedFill: =galApps.Fill
                                    Selectable: =!ctxUpdatesInProgress
                                    TemplateFill: |+
                                        =RGBA(0, 0, 0, 0)
                                        
                                    TemplateSize: =40
                                    Width: |-
                                        =//1426
                                        Parent.Width
                                    X: =479
                                    Y: =229
                                    ZIndex: =3

                                    Container9 As groupContainer.horizontalAutoLayoutContainer:
                                        Height: =40
                                        LayoutGap: =10
                                        LayoutMode: =LayoutMode.Auto
                                        RadiusBottomLeft: =4
                                        RadiusBottomRight: =4
                                        RadiusTopLeft: =4
                                        RadiusTopRight: =4
                                        Width: =Parent.Width
                                        ZIndex: =9

                                        chkSelectApp As checkbox:
                                            BorderColor: =ColorValue(Style.Primary)
                                            CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                            CheckboxSize: |-
                                                =//40
                                                25
                                            Color: =RGBA(0, 0, 0, 1)
                                            Default: |-
                                                =chkSelectAll.Value || !IsBlankOrError(
                                                    LookUp(
                                                        EnvCheckedApps,
                                                        AppName = ThisItem.App
                                                    )
                                                )
                                            DisplayMode: |-
                                                =If(
                                                    !ctxUpdatesInProgress,
                                                    DisplayMode.Edit,
                                                    DisplayMode.Disabled
                                                )
                                            FocusedBorderColor: =chkSelectApp.BorderColor
                                            FocusedBorderThickness: |-
                                                =//2
                                                0
                                            Height: |-
                                                =//Parent.TemplateHeight
                                                35
                                            HoverBorderColor: =ColorFade(chkSelectApp.BorderColor, 30%)
                                            HoverColor: =RGBA(0, 18, 107, 1)
                                            HoverFill: =ColorFade(chkSelectApp.Fill, 30%)
                                            OnCheck: |
                                                =Collect(
                                                    EnvCheckedApps,
                                                    {
                                                        AppName: ThisItem.App,
                                                        AppOwner: ThisItem.'App Owner',
                                                        AppIsOrphaned: ThisItem.'App is Orphaned',
                                                        Environment: ThisItem.'App Environment'.Environment,
                                                        EnvName: ThisItem.'App Environment'.Name
                                                    }
                                                );
                                                Clear(roleAssignmentsCollection);
                                                UpdateContext({galleryRefreshed: false});
                                                UpdateContext(
                                                    {
                                                        ctxFlowsToUpdate: Switch(
                                                            selectedTab,
                                                            "Environment",
                                                            EnvCheckedApps,
                                                            "Owner",
                                                            EnvCheckedOwnerApps,
                                                            "Orphaned apps",
                                                            OrphanedCheckedApps
                                                        )
                                                    }
                                                );
                                                If(
                                                    //CheckIfSingleSelection(),
                                                    (selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1),
                                                    Select(Hidden_UpdateTable_App);
                                                    UpdateContext({var_pivotkey: "tabMembers"});
                                                    //UpdateContext({var_pivotkey: "tabAddUser"});
                                                );
                                            OnUncheck: |
                                                =Remove(
                                                    EnvCheckedApps,
                                                    LookUp(
                                                        EnvCheckedApps,
                                                        AppName = ThisItem.App
                                                    )
                                                );
                                                Clear(roleAssignmentsCollection);
                                                UpdateContext({galleryRefreshed: false});
                                                UpdateContext(
                                                    {
                                                        ctxFlowsToUpdate: Switch(
                                                            selectedTab,
                                                            "Environment",
                                                            EnvCheckedApps,
                                                            "Owner",
                                                            EnvCheckedOwnerApps,
                                                            "Orphaned apps",
                                                            OrphanedCheckedApps
                                                        )
                                                    }
                                                );
                                                If(
                                                    //CheckIfSingleSelection(),
                                                    (selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1),
                                                    Select(Hidden_UpdateTable_App);
                                                    UpdateContext({var_pivotkey: "tabMembers"});
                                                    //,
                                                //UpdateContext({var_pivotkey: "tabAddUser"});
                                                );
                                            PaddingBottom: =10
                                            PaddingLeft: =5
                                            PaddingRight: =5
                                            PaddingTop: =5
                                            PressedBorderColor: =ColorFade(chkSelectApp.BorderColor, -30%)
                                            PressedColor: =ColorValue(Style.Primary)
                                            PressedFill: =ColorFade(chkSelectApp.Fill, -30%)
                                            Size: =13
                                            Text: =""
                                            Width: =33  
                                            ZIndex: =1

                                        Container3_1 As groupContainer.manualLayoutContainer:
                                            AlignInContainer: =AlignInContainer.Start
                                            FillPortions: =0
                                            Height: =30
                                            LayoutMinHeight: =30
                                            LayoutMinWidth: =250
                                            RadiusBottomLeft: =4
                                            RadiusBottomRight: =4
                                            RadiusTopLeft: =4
                                            RadiusTopRight: =4
                                            Width: =35
                                            ZIndex: =2

                                            lblOwnerAppBkgColor_1 As htmlViewer:
                                                AutoHeight: =true
                                                Height: =30
                                                HoverBorderColor: =lblOwnerAppBkgColor_1.BorderColor
                                                HtmlText: |-
                                                    ="<div style='width:"&imgOwnerAppIcon_1.Width&"px;height=10px;height:30px;background:" & ThisItem.'Icon Background Color' & "'></div>"
                                                OnSelect: =Select(galOwnerApps)
                                                PaddingBottom: =0
                                                PaddingLeft: =0
                                                PaddingRight: =0
                                                PaddingTop: =0   
                                                PressedBorderColor: =lblOwnerAppBkgColor_1.BorderColor
                                                Tooltip: =ThisItem.'App Display Name'
                                                Width: =imgOwnerAppIcon_1.Width
                                                ZIndex: =1

                                            imgOwnerAppIcon_1 As image:
                                                BorderColor: =ColorFade(imgOwnerAppIcon_1.Fill,-20%)
                                                DisabledBorderColor: =RGBA(159, 167, 165, 1)
                                                DisabledFill: =RGBA(193, 193, 193, 0.95)
                                                Fill: =
                                                FocusedBorderColor: =imgOwnerAppIcon_1.BorderColor
                                                Height: =30
                                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                                HoverFill: =RGBA(0, 0, 0, 0)
                                                Image: =ThisItem.'App Icon Uri'
                                                ImagePosition: =ImagePosition.Fill
                                                OnSelect: =Select(galOwnerApps)
                                                PaddingBottom: =imgOwnerAppIcon_1.PaddingTop
                                                PaddingLeft: =imgOwnerAppIcon_1.PaddingTop
                                                PaddingRight: =imgOwnerAppIcon_1.PaddingTop
                                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                                PressedFill: =RGBA(0, 0, 0, 0)
                                                Tooltip: =ThisItem.'App Display Name'
                                                Width: =35
                                                ZIndex: =2

                                        Container5_4 As groupContainer.manualLayoutContainer:
                                            FillPortions: =1.7
                                            Height: =30
                                            LayoutMinHeight: =35  
                                            LayoutMinWidth: |-
                                                =//0
                                                150
                                            RadiusBottomLeft: =4
                                            RadiusBottomRight: =4
                                            RadiusTopLeft: =4
                                            RadiusTopRight: =4
                                            ZIndex: =3

                                            LinkCanvas1 As Link:
                                                Align: ='LinkCanvas.Align'.Start
                                                Appearance: ="Default"
                                                AutoHeight: =false
                                                BasePaletteColor: |-
                                                    =If(
                                                        ThisItem.IsSelected = true,
                                                        RGBA(
                                                            116,
                                                            39,
                                                            116,
                                                            1
                                                        ),
                                                        RGBA(
                                                            47,
                                                            41,
                                                            43,
                                                            1
                                                        )
                                                    )
                                                BorderColor: =""
                                                BorderStyle: =""
                                                DisplayMode: =DisplayMode.Edit
                                                Font: =Font.'Segoe UI'
                                                FontSize: =14
                                                FontUnderline: =If(ThisItem.IsSelected=true,true,false)
                                                FontWeight: =FontWeight.Normal
                                                Height: =35
                                                Text: =ThisItem.'App Display Name'
                                                URL: =""
                                                VerticalAlign: ='LinkCanvas.VerticalAlign'.Middle
                                                Width: =Parent.Width
                                                Wrap: =false
                                                X: =0
                                                Y: =0
                                                ZIndex: =1

                                            ButtonCanvas1_2 As Button:
                                                Align: =""
                                                Appearance: ='ButtonCanvas.Appearance'.Transparent
                                                BasePaletteColor: |-
                                                    =//RGBA(66, 66, 66,1)
                                                    RGBA(
                                                        116,
                                                        39,
                                                        116,
                                                        1
                                                    )
                                                BorderColor: =""
                                                BorderStyle: =""
                                                DisabledBorderColor: =""
                                                DisplayMode: =DisplayMode.Edit
                                                FocusedBorderColor: =""
                                                Font: =Font.'Segoe UI'
                                                FontColor: |-
                                                    =If(
                                                        ThisItem.IsSelected = true,
                                                        RGBA(
                                                            116,
                                                            39,
                                                            116,
                                                            1
                                                        ),
                                                        RGBA(
                                                            116,
                                                            39,
                                                            116,
                                                            1
                                                        )
                                                    )
                                                FontSize: =10
                                                FontUnderline: =true
                                                FontWeight: =FontWeight.Normal
                                                Height: =35
                                                HoverBorderColor: =""
                                                Icon: =""
                                                IconRotation: =0
                                                IconStyle: ="Outline"
                                                Layout: ="Icon before"
                                                OnSelect: =Select(galApps)
                                                PressedBorderColor: =""
                                                Text: =""
                                                VerticalAlign: =""
                                                Width: =Parent.Width
                                                X: =0
                                                Y: =0
                                                ZIndex: =2

                                        lblOwner As label:
                                            BorderColor: =RGBA(218,218,218,1.00)
                                            BorderStyle: =BorderStyle.None
                                            BorderThickness: =2
                                            Color: =RGBA(47,41,43,1)
                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                            FillPortions: =0.6
                                            FocusedBorderColor: =lblOwner.BorderColor
                                            FocusedBorderThickness: =2
                                            Font: =Font.'Segoe UI'
                                            Height: =35
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverColor: =RGBA(4,45,81,1.00)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            OnSelect: =Select(galApps)
                                            PaddingBottom: =0
                                            PaddingLeft: =0
                                            PaddingRight: =0
                                            PaddingTop: =0
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedColor: =RGBA(4,45,81,1.00)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Size: =10
                                            Text: =If(!IsBlank(ThisItem.'App Owner'.'Display Name'),ThisItem.'App Owner'.'Display Name',ThisItem.'App Owner Display Name')
                                            Tooltip: =If(!IsBlank(ThisItem.'App Owner'.'Display Name'),ThisItem.'App Owner'.'Display Name',ThisItem.'App Owner Display Name')
                                            Width: =125
                                            ZIndex: =5

                                        lblLastLaunched_2 As label:
                                            BorderColor: =RGBA(218,218,218,1.00)
                                            BorderStyle: =BorderStyle.None
                                            BorderThickness: =2
                                            Color: =RGBA(47,41,43,1)
                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                            FillPortions: =0.6
                                            FocusedBorderColor: =lblLastLaunched_2.BorderColor
                                            FocusedBorderThickness: =2
                                            Font: =Font.'Segoe UI'
                                            Height: =35
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverColor: =RGBA(4,45,81,1.00)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            OnSelect: =Select(galApps)
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedColor: =RGBA(4,45,81,1.00)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Size: =11
                                            Text: =Text(ThisItem.'App Last Launched On',"[$-en-US]dd-mmm-yyyy")
                                            Width: =127
                                            ZIndex: =6

                                        lblAppID As label:
                                            AlignInContainer: =AlignInContainer.Start
                                            BorderColor: =RGBA(218,218,218,1.00)
                                            BorderStyle: =BorderStyle.None
                                            BorderThickness: =2
                                            Color: =RGBA(47,41,43,1)
                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                            FillPortions: =1
                                            FocusedBorderColor: =lblAppID.BorderColor
                                            FocusedBorderThickness: =2
                                            Font: =Font.'Segoe UI'
                                            Height: =35
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverColor: =RGBA(4,45,81,1.00)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedColor: =RGBA(4,45,81,1.00)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Size: =10
                                            Text: =ThisItem.App
                                            Tooltip: =ThisItem.App
                                            Width: =260
                                            Wrap: =false
                                            ZIndex: =7

                        conMakerApps As groupContainer.horizontalAutoLayoutContainer:
                            LayoutGap: =10
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            PaddingTop: =10
                            RadiusBottomLeft: =4
                            RadiusBottomRight: =4
                            RadiusTopLeft: =4
                            RadiusTopRight: =4
                            Visible: =(selectedTab = "Owner")
                            Width: |-
                                =//500
                                Parent.Width-Parent.PaddingLeft-Parent.PaddingRight
                            ZIndex: =4

                            conMakers As groupContainer.verticalAutoLayoutContainer:
                                BorderStyle: =BorderStyle.None
                                LayoutDirection: =LayoutDirection.Vertical
                                LayoutGap: =10
                                LayoutMinHeight: =100
                                LayoutMinWidth: |-
                                    =//Parent.Width
                                    250
                                LayoutMode: =LayoutMode.Auto
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                Width: =Parent.Width*0.2
                                ZIndex: =2

                                conMakersSort As groupContainer.horizontalAutoLayoutContainer:
                                    AlignInContainer: =AlignInContainer.SetByContainer
                                    Fill: |-
                                        =//RGBA(0, 0, 0, 0)
                                        RGBA(245, 245, 245, 1)
                                    FillPortions: =0
                                    Height: =40
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    Width: =Parent.Width
                                    ZIndex: =1

                                    "iconSortMakers As 'Fluent Icon (1.1.29)'":
                                        AlignInContainer: =AlignInContainer.Center
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        Height: =32
                                        IconName: ="Sort"
                                        LayoutMinHeight: =200
                                        LayoutMinWidth: =200
                                        OnChange: |-
                                            =UpdateContext({ctxSortAsc:!ctxSortAsc})
                                        Theme: =AppThemeJson
                                        Tooltip: ="Sort"
                                        Width: =30
                                        X: =0
                                        Y: =0
                                        ZIndex: =1

                                    "txtOwnersSrch As 'Text input'":
                                        AlignInContainer: =AlignInContainer.Center
                                        Appearance: ="FilledDarker"
                                        BasePaletteColor: =
                                        BorderColor: =""
                                        BorderStyle: =""
                                        DelayOutput: =true
                                        DisabledBorderColor: =""
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FocusedBorderColor: =""
                                        FontColor: =
                                        Height: =32
                                        HoverBorderColor: =""
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =320
                                        OnChange: |
                                            =Clear([@EnvCheckedOwnerApps]);
                                            Reset(chkSelectAllMakerApps);
                                        Placeholder: ="Search owners"
                                        PressedBorderColor: =""
                                        Type: ='TextInputCanvas.Type'.Search
                                        Width: |-
                                            =//Parent.Width-iconSortMakers.Width
                                            Parent.Width-iconSortMakers.Width-10
                                        X: =0
                                        Y: =0
                                        ZIndex: =4

                                galMakers As gallery.galleryVertical:
                                    '#CopilotOverlayLabel': ="Filtered"
                                    AlignInContainer: =AlignInContainer.SetByContainer
                                    BorderColor: =ColorValue(Style.Tertiary)
                                    BorderStyle: =BorderStyle.None
                                    DisabledBorderColor: =galMakers.BorderColor
                                    DisabledFill: =galMakers.Fill
                                    Fill: =RGBA(255, 255, 255, 1)
                                    Height: =845
                                    HoverBorderColor: =galMakers.BorderColor
                                    HoverFill: =galMakers.Fill
                                    Items: |-
                                        =SortByColumns(
                                            Search(
                                                colMakersAddedCols,
                                                txtOwnersSrch.Value,
                                                admin_displayname
                                            ),
                                            "admin_displayname",
                                            If(
                                                ctxSortAsc,
                                                SortOrder.Ascending,
                                                SortOrder.Descending
                                            )
                                        )
                                    Layout: =Layout.Vertical
                                    LayoutMinHeight: =287
                                    LayoutMinWidth: =320
                                    LoadingSpinnerColor: =galMakers.BorderColor
                                    OnSelect: |
                                        =Clear(EnvCheckedOwnerApps);
                                        Reset(chkSelectAllMakerApps);
                                    PressedBorderColor: =galMakers.BorderColor
                                    PressedFill: =galMakers.Fill
                                    Selectable: |
                                        =!ctxUpdatesInProgress
                                    ShowScrollbar: =false
                                    TemplateFill: =If(ThisItem.IsSelected, ColorValue(Style.Tertiary), Color.White)
                                    TemplatePadding: =0
                                    TemplateSize: =35
                                    Width: =Parent.Width
                                    X: =62
                                    Y: =235
                                    ZIndex: =4

                                    Container4_1 As groupContainer.horizontalAutoLayoutContainer:
                                        Fill: |
                                            =RGBA(0, 0, 0, 0)
                                            //If(ThisItem.IsSelected, ColorValue(Style.Tertiary), Color.White)
                                        Height: =35
                                        LayoutGap: =5
                                        LayoutMode: =LayoutMode.Auto
                                        RadiusBottomLeft: =4
                                        RadiusBottomRight: =4
                                        RadiusTopLeft: =4
                                        RadiusTopRight: =4
                                        Width: =250
                                        ZIndex: =12

                                        "Persona2 As 'Fluent Persona (1.1.29) Preview'":
                                            AlignInContainer: =AlignInContainer.Center
                                            DisplayMode: =DisplayMode.Edit
                                            Height: =35
                                            HidePersonaDetails: =true
                                            ImageInitials: |+
                                                =Upper(
                                                    Concatenate(
                                                        Left(
                                                            First(Split(ThisItem.admin_displayname, " ")).Value,
                                                            1
                                                        ),
                                                        Left(
                                                            Last(Split(ThisItem.admin_displayname, " ")).Value,
                                                            1
                                                        )
                                                    )
                                                )
                                                
                                            ImageUrl: |-
                                                =/*IfError(
                                                    Office365Users.UserPhotoMetadata(ThisItem.admin_recordguidasstring).HasPhoto,
                                                    false,
                                                    Substitute(
                                                        JSON(
                                                            Office365Users.UserPhotoV2(ThisItem.admin_recordguidasstring),
                                                            JSONFormat.IgnoreBinaryData
                                                        ),
                                                        """",
                                                        ""
                                                    )
                                                )*/
                                                ThisItem.UserImage
                                            LayoutMinHeight: =200
                                            LayoutMinWidth: =200
                                            PersonaInitialsColor: =LookUp(gblInitalsColors,Id=Mod(ThisItem.RowNumber,15)).Color
                                            PersonaSize: ='PowerCAT.Persona.PersonaSize'.Size32
                                            Presence: ='PowerCAT.Persona.Presence'.None
                                            Text: =""
                                            Theme: =AppThemeJson
                                            Width: |
                                                =//35
                                                32
                                            X: =0
                                            Y: =0
                                            ZIndex: =2

                                        lblDisplayname_1 As label:
                                            BorderColor: =RGBA(218,218,218,1.00)
                                            BorderStyle: =BorderStyle.None
                                            BorderThickness: =2
                                            Color: =RGBA(47,41,43,1)
                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                            FocusedBorderColor: =lblDisplayname_1.BorderColor
                                            FocusedBorderThickness: =2
                                            Font: =Font.'Segoe UI'
                                            Height: =35
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverColor: =RGBA(4,45,81,1.00)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            OnSelect: =Select(galMakers)
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedColor: =RGBA(4,45,81,1.00)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Size: =10
                                            Text: =ThisItem.admin_displayname
                                            Tooltip: |-
                                                ="Maker Name: " & ThisItem.admin_displayname
                                            Width: |-
                                                =//239
                                                galMakers.TemplateWidth*0.80
                                            X: |-
                                                =//57
                                                0
                                            ZIndex: =3

                            conOwnersApps As groupContainer.verticalAutoLayoutContainer:
                                AlignInContainer: =AlignInContainer.Start
                                FillPortions: =5
                                Height: =Parent.Height
                                LayoutAlignItems: =LayoutAlignItems.Stretch
                                LayoutDirection: =LayoutDirection.Vertical
                                LayoutGap: =2
                                LayoutMinHeight: =100
                                LayoutMinWidth: =20
                                LayoutMode: =LayoutMode.Auto
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                Width: =Parent.Width-conMakers.Width
                                ZIndex: =3

                                Container11 As groupContainer.horizontalAutoLayoutContainer:
                                    Fill: =RGBA(122, 138, 143, 0.12)
                                    FillPortions: =0
                                    Height: =40
                                    LayoutGap: =5
                                    LayoutMinHeight: =100
                                    LayoutMinWidth: =250
                                    LayoutMode: =LayoutMode.Auto
                                    RadiusBottomLeft: =4
                                    RadiusBottomRight: =4
                                    RadiusTopLeft: =4
                                    RadiusTopRight: =4
                                    ZIndex: =1

                                    chkSelectAllMakerApps As checkbox:
                                        BorderColor: =ColorValue(Style.Primary)
                                        CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                        CheckboxSize: =25
                                        Color: =RGBA(0, 0, 0, 1)
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FocusedBorderColor: =chkSelectAllMakerApps.BorderColor
                                        FocusedBorderThickness: =0
                                        Font: =Font.Arial
                                        Height: =33
                                        HoverBorderColor: =ColorFade(chkSelectAllMakerApps.BorderColor, 30%)
                                        HoverColor: =RGBA(0, 18, 107, 1)
                                        HoverFill: =ColorFade(chkSelectAllMakerApps.Fill, 30%)
                                        OnCheck: |-
                                            =Clear(EnvCheckedOwnerApps);
                                            ForAll(
                                                galOwnerApps.AllItems,
                                                Collect(
                                                    EnvCheckedOwnerApps,
                                                    {
                                                        AppName: App,
                                                        AppOwner: 'App Owner',
                                                        AppIsOrphaned: 'App is Orphaned',
                                                        Environment: 'App Environment'.Environment,
                                                        EnvName: 'App Environment'.Name
                                                    }
                                                )
                                            )
                                        OnUncheck: =Clear(EnvCheckedOwnerApps)
                                        PaddingLeft: =5
                                        PressedBorderColor: =ColorFade(chkSelectAllMakerApps.BorderColor, -30%)
                                        PressedColor: =ColorValue(Style.Primary)
                                        PressedFill: =ColorFade(chkSelectAllMakerApps.Fill, -30%)
                                        Size: =13
                                        Text: =""
                                        Width: =35
                                        X: =15
                                        Y: =3
                                        ZIndex: =1

                                    lblIcon As Label:
                                        Color: =
                                        DisplayMode: =DisplayMode.Edit
                                        Height: =35
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =320
                                        OnChange: =false
                                        Text: =""
                                        Width: =35
                                        X: =0
                                        Y: =0
                                        ZIndex: =2

                                    lblOwnerAppName As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =3.1
                                        FocusedBorderColor: =lblOwnerAppName.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =35
                                        HoverBorderColor: =lblOwnerAppName.BorderColor
                                        HoverColor: =lblOwnerAppName.Color
                                        HoverFill: =lblOwnerAppName.Fill
                                        PressedBorderColor: =lblOwnerAppName.BorderColor
                                        PressedColor: =lblOwnerAppName.Color
                                        PressedFill: =lblOwnerAppName.Fill
                                        Size: =11
                                        Text: ="App display name"
                                        Width: =151
                                        X: =96
                                        Y: =9
                                        ZIndex: =3

                                    lblOwnerAppEnvironment As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =0.4
                                        FocusedBorderColor: =lblOwnerAppEnvironment.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =35
                                        HoverBorderColor: =lblOwnerAppEnvironment.BorderColor
                                        HoverColor: =lblOwnerAppEnvironment.Color
                                        HoverFill: =lblOwnerAppEnvironment.Fill
                                        PaddingLeft: =0
                                        PressedBorderColor: =lblOwnerAppEnvironment.BorderColor
                                        PressedColor: =lblOwnerAppEnvironment.Color
                                        PressedFill: =lblOwnerAppEnvironment.Fill
                                        Size: =11
                                        Text: ="Environment"
                                        Width: =151
                                        X: =423
                                        Y: =3
                                        ZIndex: =4

                                    lblAppLaunchedOn As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =0.6
                                        FocusedBorderColor: =lblAppLaunchedOn.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =35
                                        HoverBorderColor: =lblAppLaunchedOn.BorderColor
                                        HoverColor: =lblAppLaunchedOn.Color
                                        HoverFill: =lblAppLaunchedOn.Fill
                                        PaddingLeft: =0
                                        PressedBorderColor: =lblAppLaunchedOn.BorderColor
                                        PressedColor: =lblAppLaunchedOn.Color
                                        PressedFill: =lblAppLaunchedOn.Fill
                                        Size: =11
                                        Text: ="Last launched"
                                        Width: =103
                                        X: =597
                                        Y: =3
                                        ZIndex: =5

                                    lblOwnerAppId As label:
                                        BorderColor: =RGBA(0, 0, 0, 0)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(128, 128, 128, 1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =RGBA(166, 166, 166, 1)
                                        FillPortions: =1.7
                                        FocusedBorderColor: =lblOwnerAppId.BorderColor
                                        FocusedBorderThickness: =4
                                        Font: =Font.'Segoe UI'
                                        FontWeight: =FontWeight.Semibold
                                        Height: =35
                                        HoverBorderColor: =lblOwnerAppId.BorderColor
                                        HoverColor: =lblOwnerAppId.Color
                                        HoverFill: =lblOwnerAppId.Fill
                                        PaddingLeft: =0
                                        PressedBorderColor: =lblOwnerAppId.BorderColor
                                        PressedColor: =lblOwnerAppId.Color
                                        PressedFill: =lblOwnerAppId.Fill
                                        Size: =11
                                        Text: ="App id"
                                        Width: =138
                                        X: =735
                                        Y: =6
                                        ZIndex: =6

                                galOwnerApps As gallery.galleryVertical:
                                    '#CopilotOverlayLabel': ="Filtered"
                                    AlignInContainer: =AlignInContainer.SetByContainer
                                    BorderColor: =ColorValue(Style.Tertiary)
                                    BorderStyle: =BorderStyle.None
                                    DisabledBorderColor: =galOwnerApps.BorderColor
                                    DisabledFill: =galOwnerApps.Fill
                                    Fill: =RGBA(255, 255, 255, 1)
                                    Height: =845
                                    HoverBorderColor: =galOwnerApps.BorderColor
                                    HoverFill: =galOwnerApps.Fill
                                    Items: |-
                                        =SortByColumns(
                                            Search(
                                                If(IsBlank(galMakers.Selected), 
                                                    Filter(
                                                    'PowerApps Apps',
                                                    'App Owner'.'Record GUID as String'  = First(galMakers.AllItems).admin_recordguidasstring
                                                    And 'App Deleted' = 'App Deleted (PowerApps Apps)'.No And 'App Type' = 'PowerApps Type'.Canvas),
                                         
                                                    Filter(
                                                    'PowerApps Apps',
                                                    'App Owner'.'Record GUID as String'  = Text(galMakers.Selected.admin_recordguidasstring) 
                                                    And 'App Deleted' = 'App Deleted (PowerApps Apps)'.No And 'App Type' = 'PowerApps Type'.Canvas)),
                                         
                                                txtSearchApps.Value, 'App Display Name', 'App Owner Display Name', 'Record GUID as String'
                                            ),
                                            "admin_displayname"
                                        )
                                    Layout: =Layout.Vertical
                                    LayoutMinHeight: =287
                                    LayoutMinWidth: =320
                                    LoadingSpinnerColor: =galOwnerApps.BorderColor
                                    OnSelect: |-
                                        =Set(SelectedApp, galOwnerApps.Selected);
                                        Navigate(AppDetailsScreen)
                                    PressedBorderColor: =galOwnerApps.BorderColor
                                    PressedFill: =galOwnerApps.Fill
                                    Selectable: =!ctxUpdatesInProgress
                                    TemplateSize: |-
                                        =//86
                                        //50  
                                        35
                                    Width: |-
                                        =//1426
                                        Parent.Width
                                    X: =479
                                    Y: =229
                                    ZIndex: =4

                                    Container12 As groupContainer.horizontalAutoLayoutContainer:
                                        Height: =40
                                        LayoutGap: =5
                                        LayoutMode: =LayoutMode.Auto
                                        RadiusBottomLeft: =4
                                        RadiusBottomRight: =4
                                        RadiusTopLeft: =4
                                        RadiusTopRight: =4
                                        Width: =Parent.Width
                                        ZIndex: =9

                                        chkSelectOwnerApp As checkbox:
                                            BorderColor: =ColorValue(Style.Primary)
                                            CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                            CheckboxSize: |-
                                                =//40
                                                25
                                            Color: =RGBA(0, 0, 0, 1)
                                            Default: |-
                                                =chkSelectAllMakerApps.Value || !IsBlankOrError(
                                                    LookUp(
                                                        EnvCheckedOwnerApps,
                                                        AppName = ThisItem.App
                                                    )
                                                )
                                            DisplayMode: |-
                                                =If(
                                                    !ctxUpdatesInProgress,
                                                    DisplayMode.Edit,
                                                    DisplayMode.Disabled
                                                )
                                            FocusedBorderColor: =chkSelectOwnerApp.BorderColor
                                            FocusedBorderThickness: =0
                                            Height: =33
                                            HoverBorderColor: =ColorFade(chkSelectOwnerApp.BorderColor, 30%)
                                            HoverColor: =RGBA(0, 18, 107, 1)
                                            HoverFill: =ColorFade(chkSelectOwnerApp.Fill, 30%)
                                            OnCheck: |
                                                =Collect(
                                                    EnvCheckedOwnerApps,
                                                    {
                                                        AppName: ThisItem.App,
                                                        AppOwner: ThisItem.'App Owner',
                                                        AppIsOrphaned: ThisItem.'App is Orphaned',
                                                        Environment: ThisItem.'App Environment'.Environment,
                                                        EnvName: ThisItem.'App Environment'.Name
                                                    }
                                                );
                                                Clear(roleAssignmentsCollection);
                                                UpdateContext({galleryRefreshed: false});
                                                UpdateContext(
                                                    {
                                                        ctxAppsToUpdate: Switch(
                                                            selectedTab,
                                                            "Environment",
                                                            EnvCheckedApps,
                                                            "Owner",
                                                            EnvCheckedOwnerApps,
                                                            "Orphaned apps",
                                                            OrphanedCheckedApps
                                                        )
                                                    }
                                                );
                                                If(
                                                    //CheckIfSingleSelection(),
                                                    (selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1),
                                                    Select(Hidden_UpdateTable_App);
                                                    
                                                );
                                                UpdateContext({var_pivotkey: "tabMembers"});
                                            OnUncheck: |
                                                =Remove(
                                                    EnvCheckedOwnerApps,
                                                    LookUp(
                                                        EnvCheckedOwnerApps,
                                                        AppName = ThisItem.App
                                                    )
                                                );
                                                Clear(roleAssignmentsCollection);
                                                UpdateContext({galleryRefreshed: false});
                                                UpdateContext(
                                                    {
                                                        ctxAppsToUpdate: Switch(
                                                            selectedTab,
                                                            "Environment",
                                                            EnvCheckedApps,
                                                            "Owner",
                                                            EnvCheckedOwnerApps,
                                                            "Orphaned apps",
                                                            OrphanedCheckedApps
                                                        )
                                                    }
                                                );
                                                If(
                                                    //CheckIfSingleSelection(),
                                                     (selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1),
                                                    Select(Hidden_UpdateTable_App);
                                                    
                                                );
                                                UpdateContext({var_pivotkey: "tabMembers"});
                                            PressedBorderColor: =ColorFade(chkSelectOwnerApp.BorderColor, -30%)
                                            PressedColor: =ColorValue(Style.Primary)
                                            PressedFill: =ColorFade(chkSelectOwnerApp.Fill, -30%)
                                            Size: =13
                                            Text: =""
                                            Width: =33  
                                            Y: =2
                                            ZIndex: =1

                                        Container3 As groupContainer.manualLayoutContainer:
                                            AlignInContainer: =AlignInContainer.Start
                                            FillPortions: =0
                                            Height: =30
                                            LayoutMinHeight: =30
                                            LayoutMinWidth: =250
                                            RadiusBottomLeft: =4
                                            RadiusBottomRight: =4
                                            RadiusTopLeft: =4
                                            RadiusTopRight: =4
                                            Width: =35
                                            ZIndex: =2

                                            lblOwnerAppBkgColor As htmlViewer:
                                                AutoHeight: =true
                                                Height: =30
                                                HoverBorderColor: =lblOwnerAppBkgColor.BorderColor
                                                HtmlText: |-
                                                    ="<div style='width:"&imgOwnerAppIcon.Width&"px;height=10px;height:30px;background:" & ThisItem.'Icon Background Color' & "'></div>"
                                                OnSelect: =Select(galOwnerApps)
                                                PaddingBottom: =0
                                                PaddingLeft: =0
                                                PaddingRight: =0
                                                PaddingTop: =0   
                                                PressedBorderColor: =lblOwnerAppBkgColor.BorderColor
                                                Width: =imgOwnerAppIcon.Width
                                                ZIndex: =1

                                            imgOwnerAppIcon As image:
                                                BorderColor: =ColorFade(imgOwnerAppIcon.Fill,-20%)
                                                DisabledBorderColor: =RGBA(159, 167, 165, 1)
                                                DisabledFill: =RGBA(193, 193, 193, 0.95)
                                                Fill: =
                                                FocusedBorderColor: =imgOwnerAppIcon.BorderColor
                                                Height: =30
                                                HoverBorderColor: =RGBA(0, 0, 0, 0)
                                                HoverFill: =RGBA(0, 0, 0, 0)
                                                Image: =ThisItem.'App Icon Uri'
                                                ImagePosition: =ImagePosition.Fill
                                                OnSelect: =Select(galOwnerApps)
                                                PaddingBottom: =imgOwnerAppIcon.PaddingTop
                                                PaddingLeft: =imgOwnerAppIcon.PaddingTop
                                                PaddingRight: =imgOwnerAppIcon.PaddingTop
                                                PressedBorderColor: =RGBA(0, 0, 0, 0)
                                                PressedFill: =RGBA(0, 0, 0, 0)
                                                Tooltip: =ThisItem.'App Display Name'
                                                Width: =35
                                                ZIndex: =2

                                        Container5_5 As groupContainer.manualLayoutContainer:
                                            AlignInContainer: =AlignInContainer.Start
                                            FillPortions: =3.1
                                            Height: =30
                                            LayoutMinHeight: =35  
                                            LayoutMinWidth: |-
                                                =//0
                                                150
                                            RadiusBottomLeft: =4
                                            RadiusBottomRight: =4
                                            RadiusTopLeft: =4
                                            RadiusTopRight: =4
                                            ZIndex: =3

                                            LinkCanvas1_1 As Link:
                                                Align: ='LinkCanvas.Align'.Start
                                                Appearance: ="Default"
                                                AutoHeight: =false
                                                BasePaletteColor: |-
                                                    =If(
                                                        ThisItem.IsSelected = true,
                                                        RGBA(
                                                            116,
                                                            39,
                                                            116,
                                                            1
                                                        ),
                                                        RGBA(
                                                            47,
                                                            41,
                                                            43,
                                                            1
                                                        )
                                                    )
                                                BorderColor: =""
                                                BorderStyle: =""
                                                DisplayMode: =DisplayMode.Edit
                                                Font: =Font.'Segoe UI'
                                                FontSize: =14
                                                FontUnderline: =If(ThisItem.IsSelected=true,true,false)
                                                FontWeight: =FontWeight.Normal
                                                Height: =35
                                                Text: =ThisItem.'App Display Name'
                                                URL: =""
                                                VerticalAlign: ='LinkCanvas.VerticalAlign'.Middle
                                                Width: =Parent.Width
                                                Wrap: =false
                                                X: =0
                                                Y: =0
                                                ZIndex: =1

                                            ButtonCanvas1_3 As Button:
                                                Align: =""
                                                Appearance: ='ButtonCanvas.Appearance'.Transparent
                                                BasePaletteColor: |-
                                                    =//RGBA(66, 66, 66,1)
                                                    RGBA(
                                                        116,
                                                        39,
                                                        116,
                                                        1
                                                    )
                                                BorderColor: =""
                                                BorderStyle: =""
                                                DisabledBorderColor: =""
                                                DisplayMode: =DisplayMode.Edit
                                                FocusedBorderColor: =""
                                                Font: =Font.'Segoe UI'
                                                FontColor: |-
                                                    =If(
                                                        ThisItem.IsSelected = true,
                                                        RGBA(
                                                            116,
                                                            39,
                                                            116,
                                                            1
                                                        ),
                                                        RGBA(
                                                            116,
                                                            39,
                                                            116,
                                                            1
                                                        )
                                                    )
                                                FontSize: =10
                                                FontUnderline: =true
                                                FontWeight: =FontWeight.Normal
                                                Height: =35
                                                HoverBorderColor: =""
                                                Icon: =""
                                                IconRotation: =0
                                                IconStyle: ="Outline"
                                                Layout: ="Icon before"
                                                OnSelect: =Select(galOwnerApps)
                                                PressedBorderColor: =""
                                                Text: =""
                                                VerticalAlign: =""
                                                Width: =Parent.Width
                                                X: =0
                                                Y: =0
                                                ZIndex: =2

                                        lblEnvironment As label:
                                            BorderColor: =RGBA(218,218,218,1.00)
                                            BorderStyle: =BorderStyle.None
                                            BorderThickness: =2
                                            Color: =RGBA(47,41,43,1)
                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                            FillPortions: =0.4
                                            FocusedBorderColor: =lblEnvironment.BorderColor
                                            FocusedBorderThickness: =2
                                            Font: =Font.'Segoe UI'
                                            Height: =32
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverColor: =RGBA(4,45,81,1.00)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            OnSelect: =Select(galOwnerApps)
                                            PaddingBottom: =0
                                            PaddingLeft: =0
                                            PaddingRight: =0
                                            PaddingTop: =0
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedColor: =RGBA(4,45,81,1.00)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Size: =10
                                            Text: =ThisItem.'App Environment'.'Display Name'
                                            Tooltip: =ThisItem.'App Environment'.'Display Name'
                                            ZIndex: =4

                                        lblLastLaunched As label:
                                            BorderColor: =RGBA(218,218,218,1.00)
                                            BorderStyle: =BorderStyle.None
                                            BorderThickness: =2
                                            Color: =RGBA(47,41,43,1)
                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                            FillPortions: =0.6
                                            FocusedBorderColor: =lblLastLaunched.BorderColor
                                            FocusedBorderThickness: =2
                                            Font: =Font.'Segoe UI'
                                            Height: =35
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverColor: =RGBA(4,45,81,1.00)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            OnSelect: =Select(galOwnerApps)
                                            PaddingBottom: =0
                                            PaddingLeft: =0
                                            PaddingRight: =0
                                            PaddingTop: =0
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedColor: =RGBA(4,45,81,1.00)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Size: =11
                                            Text: =Text(ThisItem.'App Last Launched On',"[$-en-US]dd-mmm-yyyy")
                                            Tooltip: =Text(ThisItem.'App Last Launched On',"[$-en-US]dd-mmm-yyyy")
                                            Width: =127
                                            ZIndex: =5

                                        lblOwnerAppID As label:
                                            BorderColor: =RGBA(218,218,218,1.00)
                                            BorderStyle: =BorderStyle.None
                                            BorderThickness: =2
                                            Color: =RGBA(47,41,43,1)
                                            DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                            DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                            FillPortions: =1.7
                                            FocusedBorderColor: =lblOwnerAppID.BorderColor
                                            FocusedBorderThickness: =2
                                            Font: =Font.'Segoe UI'
                                            Height: =35
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverColor: =RGBA(4,45,81,1.00)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            PaddingBottom: =0
                                            PaddingLeft: =0
                                            PaddingRight: =0
                                            PaddingTop: =0
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedColor: =RGBA(4,45,81,1.00)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Size: =10
                                            Text: =ThisItem.App
                                            Tooltip: =ThisItem.App
                                            Width: =267
                                            ZIndex: =6

                        conOrphanedApps As groupContainer.verticalAutoLayoutContainer:
                            AlignInContainer: =AlignInContainer.SetByContainer
                            LayoutDirection: =LayoutDirection.Vertical
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            PaddingTop: =20
                            RadiusBottomLeft: =4
                            RadiusBottomRight: =4
                            RadiusTopLeft: =4
                            RadiusTopRight: =4
                            Visible: =(selectedTab = "Orphaned apps")
                            Width: |-
                                =//500
                                Parent.Width-Parent.PaddingLeft-Parent.PaddingRight
                            ZIndex: =5

                            Container4 As groupContainer.horizontalAutoLayoutContainer:
                                Fill: =RGBA(122, 138, 143, 0.12)
                                FillPortions: =0
                                Height: =40
                                LayoutGap: =5
                                LayoutMinHeight: =100
                                LayoutMinWidth: =250
                                LayoutMode: =LayoutMode.Auto
                                RadiusBottomLeft: =4
                                RadiusBottomRight: =4
                                RadiusTopLeft: =4
                                RadiusTopRight: =4
                                Width: =Parent.Width
                                ZIndex: =1

                                chkSelectAllOrphanedApps As checkbox:
                                    BorderColor: =ColorValue(Style.Primary)
                                    CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                    CheckboxSize: |-
                                        =//40
                                        25
                                    Color: =RGBA(0, 0, 0, 1)
                                    DisplayMode: |-
                                        =If(
                                            !ctxUpdatesInProgress,
                                            DisplayMode.Edit,
                                            DisplayMode.Disabled
                                        )
                                    FocusedBorderColor: =chkSelectAllOrphanedApps.BorderColor
                                    FocusedBorderThickness: =0
                                    Font: =Font.Arial
                                    Height: =Parent.Height
                                    HoverBorderColor: =ColorFade(chkSelectAllOrphanedApps.BorderColor, 30%)
                                    HoverColor: =RGBA(0, 18, 107, 1)
                                    HoverFill: =ColorFade(chkSelectAllOrphanedApps.Fill, 30%)
                                    OnCheck: |-
                                        =Clear(OrphanedCheckedApps);
                                        ForAll(
                                            galOrphanedApps.AllItems,
                                            Collect(
                                                OrphanedCheckedApps,
                                                {
                                                    AppName: App,
                                                    AppOwner: 'App Owner',
                                                    AppIsOrphaned: 'App is Orphaned',
                                                    Environment: 'App Environment'.Environment,
                                                    EnvName: 'App Environment'.Name
                                                }
                                            )
                                        )
                                    OnUncheck: =Clear(OrphanedCheckedApps)
                                    PaddingLeft: =5
                                    PressedBorderColor: =ColorFade(chkSelectAllOrphanedApps.BorderColor, -30%)
                                    PressedColor: =ColorValue(Style.Primary)
                                    PressedFill: =ColorFade(chkSelectAllOrphanedApps.Fill, -30%)
                                    Size: =13
                                    Text: =""
                                    Width: =35
                                    X: =5
                                    ZIndex: =1

                                Label1 As Label:
                                    Color: =
                                    DisplayMode: =DisplayMode.Edit
                                    Height: =35
                                    LayoutMinHeight: =32
                                    LayoutMinWidth: =320
                                    OnChange: =false
                                    Text: =""
                                    Width: =35
                                    X: =0
                                    Y: =0
                                    ZIndex: =2

                                lblAppTitle_7 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(128, 128, 128, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FillPortions: =1.5
                                    FocusedBorderColor: =lblAppTitle_7.BorderColor
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height
                                    HoverBorderColor: =lblAppTitle_7.BorderColor
                                    HoverColor: =lblAppTitle_7.Color
                                    HoverFill: =lblAppTitle_7.Fill
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    PressedBorderColor: =lblAppTitle_7.BorderColor
                                    PressedColor: =lblAppTitle_7.Color
                                    PressedFill: =lblAppTitle_7.Fill
                                    Size: =11
                                    Text: ="App display name"
                                    Width: =151
                                    X: =90
                                    ZIndex: =3

                                lblAppTitle_14 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(128, 128, 128, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FillPortions: =0.6
                                    FocusedBorderColor: =lblAppTitle_14.BorderColor
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height
                                    HoverBorderColor: =lblAppTitle_14.BorderColor
                                    HoverColor: =lblAppTitle_14.Color
                                    HoverFill: =lblAppTitle_14.Fill
                                    PaddingBottom: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    PressedBorderColor: =lblAppTitle_14.BorderColor
                                    PressedColor: =lblAppTitle_14.Color
                                    PressedFill: =lblAppTitle_14.Fill
                                    Size: =11
                                    Text: ="Last launch date"
                                    Width: =151
                                    X: =440
                                    ZIndex: =4

                                lblAppTitle_8 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(128, 128, 128, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FocusedBorderColor: =lblAppTitle_8.BorderColor
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height
                                    HoverBorderColor: =lblAppTitle_8.BorderColor
                                    HoverColor: =lblAppTitle_8.Color
                                    HoverFill: =lblAppTitle_8.Fill
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    PressedBorderColor: =lblAppTitle_8.BorderColor
                                    PressedColor: =lblAppTitle_8.Color
                                    PressedFill: =lblAppTitle_8.Fill
                                    Size: =11
                                    Text: ="Number of editors"
                                    X: =612
                                    ZIndex: =5

                                lblAppTitle_5 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(128, 128, 128, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FillPortions: =1
                                    FocusedBorderColor: =lblAppTitle_5.BorderColor
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height
                                    HoverBorderColor: =lblAppTitle_5.BorderColor
                                    HoverColor: =lblAppTitle_5.Color
                                    HoverFill: =lblAppTitle_5.Fill
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    PressedBorderColor: =lblAppTitle_5.BorderColor
                                    PressedColor: =lblAppTitle_5.Color
                                    PressedFill: =lblAppTitle_5.Fill
                                    Size: =11
                                    Text: ="Environment"
                                    Width: =151
                                    X: =782
                                    ZIndex: =6

                                lblAppTitle_6 As label:
                                    BorderColor: =RGBA(0, 0, 0, 0)
                                    BorderStyle: =BorderStyle.None
                                    BorderThickness: =2
                                    Color: =RGBA(128, 128, 128, 1)
                                    DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                    DisabledColor: =RGBA(166, 166, 166, 1)
                                    FocusedBorderColor: =lblAppTitle_6.BorderColor
                                    FocusedBorderThickness: =4
                                    Font: =Font.'Segoe UI'
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height
                                    HoverBorderColor: =lblAppTitle_6.BorderColor
                                    HoverColor: =lblAppTitle_6.Color
                                    HoverFill: =lblAppTitle_6.Fill
                                    PaddingBottom: =0
                                    PaddingLeft: =0
                                    PaddingRight: =0
                                    PaddingTop: =0
                                    PressedBorderColor: =lblAppTitle_6.BorderColor
                                    PressedColor: =lblAppTitle_6.Color
                                    PressedFill: =lblAppTitle_6.Fill
                                    Size: =11
                                    Text: ="App settings"
                                    Width: =120
                                    X: =1046
                                    ZIndex: =7

                            galOrphanedApps As gallery.galleryVertical:
                                '#CopilotOverlayLabel': ="Filtered"
                                AlignInContainer: =AlignInContainer.SetByContainer
                                BorderColor: =ColorValue(Style.Tertiary)
                                BorderStyle: =BorderStyle.None
                                DisabledBorderColor: =galOrphanedApps.BorderColor
                                DisabledFill: =galOrphanedApps.Fill
                                Fill: =RGBA(255, 255, 255, 1)
                                Height: =845
                                HoverBorderColor: =galOrphanedApps.BorderColor
                                HoverFill: =galOrphanedApps.Fill
                                Items: |-
                                    =SortByColumns(
                                        If(
                                            !IsBlank(txtSearchApps.Value),
                                            Search(
                                                Filter(
                                                    'PowerApps Apps',
                                                    'App is Orphaned' = "yes" And 'App Type' = 'PowerApps Type'.Canvas And 'App Deleted' = 'App Deleted (PowerApps Apps)'.No
                                                ),
                                                txtSearchApps.Value,
                                                'App Display Name',
                                                AppIDString,
                                                'App Environment Display Name'
                                            ),
                                            Filter(
                                                'PowerApps Apps',
                                                'App is Orphaned' = "yes" And 'App Type' = 'PowerApps Type'.Canvas And 'App Deleted' = 'App Deleted (PowerApps Apps)'.No
                                            )
                                        ),
                                        "admin_displayname"
                                    )
                                Layout: =Layout.Vertical
                                LayoutMinHeight: =287
                                LayoutMinWidth: =320
                                LoadingSpinnerColor: =galOrphanedApps.BorderColor
                                OnSelect: |-
                                    =Set(SelectedApp, galOrphanedApps.Selected);
                                    Navigate(AppDetailsScreen)
                                PressedBorderColor: =galOrphanedApps.BorderColor
                                PressedFill: =galOrphanedApps.Fill
                                Selectable: =!ctxUpdatesInProgress
                                TemplateSize: =35
                                Width: =Parent.Width
                                X: =88
                                Y: =234
                                ZIndex: =2

                                Container5 As groupContainer.horizontalAutoLayoutContainer:
                                    Height: =35
                                    LayoutGap: =5
                                    LayoutMode: =LayoutMode.Auto
                                    RadiusBottomLeft: =4
                                    RadiusBottomRight: =4
                                    RadiusTopLeft: =4
                                    RadiusTopRight: =4
                                    Width: =Parent.Width-10
                                    ZIndex: =1

                                    chkSelectOrphanedApp As checkbox:
                                        AlignInContainer: =AlignInContainer.Start
                                        BorderColor: =ColorValue(Style.Primary)
                                        CheckboxBorderColor: =RGBA(128, 128, 128, 1)
                                        CheckboxSize: =25
                                        Color: =RGBA(0, 0, 0, 1)
                                        Default: |-
                                            =chkSelectAllOrphanedApps.Value || !IsBlankOrError(
                                                LookUp(
                                                    OrphanedCheckedApps,
                                                    AppName = ThisItem.App
                                                )
                                            )
                                        DisplayMode: |-
                                            =If(
                                                !ctxUpdatesInProgress,
                                                DisplayMode.Edit,
                                                DisplayMode.Disabled
                                            )
                                        FocusedBorderColor: =chkSelectOrphanedApp.BorderColor
                                        FocusedBorderThickness: =0
                                        Height: =galOrphanedApps.TemplateHeight
                                        HoverBorderColor: =ColorFade(chkSelectOrphanedApp.BorderColor, 30%)
                                        HoverColor: =RGBA(0, 18, 107, 1)
                                        HoverFill: =ColorFade(chkSelectOrphanedApp.Fill, 30%)
                                        OnCheck: |
                                            =Collect(
                                                OrphanedCheckedApps,
                                                {
                                                    AppName: ThisItem.App,
                                                    AppOwner: ThisItem.'App Owner',
                                                    AppIsOrphaned: ThisItem.'App is Orphaned',
                                                    Environment: ThisItem.'App Environment'.Environment,
                                                    EnvName: ThisItem.'App Environment'.Name
                                                }
                                            );
                                            Clear(roleAssignmentsCollection);
                                            UpdateContext({galleryRefreshed: false});
                                            UpdateContext(
                                                {
                                                    ctxAppsToUpdate: Switch(
                                                        selectedTab,
                                                        "Environment",
                                                        EnvCheckedApps,
                                                        "Owner",
                                                        EnvCheckedOwnerApps,
                                                        "Orphaned apps",
                                                        OrphanedCheckedApps
                                                    )
                                                }
                                            );
                                            If(
                                                //CheckIfSingleSelection(),
                                                 (selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1),
                                                Select(Hidden_UpdateTable_App);
                                                UpdateContext({var_pivotkey: "tabMembers"});
                                                //,UpdateContext({var_pivotkey: "tabAddUser"});
                                            );
                                        OnUncheck: |
                                            =Remove(
                                                OrphanedCheckedApps,
                                                LookUp(
                                                    OrphanedCheckedApps,
                                                    AppName = ThisItem.App
                                                )
                                            );
                                            Clear(roleAssignmentsCollection);
                                            UpdateContext({galleryRefreshed: false});
                                            UpdateContext(
                                                {
                                                    ctxAppsToUpdate: Switch(
                                                        selectedTab,
                                                        "Environment",
                                                        EnvCheckedApps,
                                                        "Owner",
                                                        EnvCheckedOwnerApps,
                                                        "Orphaned apps",
                                                        OrphanedCheckedApps
                                                    )
                                                }
                                            );
                                            If(
                                                //CheckIfSingleSelection(),
                                                 (selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1),
                                                Select(Hidden_UpdateTable_App);
                                                UpdateContext({var_pivotkey: "tabMembers"});
                                                //,UpdateContext({var_pivotkey: "tabAddUser"});
                                            );
                                        PressedBorderColor: =ColorFade(chkSelectOrphanedApp.BorderColor, -30%)
                                        PressedColor: =ColorValue(Style.Primary)
                                        PressedFill: =ColorFade(chkSelectOrphanedApp.Fill, -30%)
                                        Size: =13
                                        Text: =""
                                        Width: =33
                                        ZIndex: =1

                                    Container6 As groupContainer.manualLayoutContainer:
                                        AlignInContainer: =AlignInContainer.Start
                                        FillPortions: =0
                                        Height: =35
                                        LayoutMinHeight: =35
                                        LayoutMinWidth: =250
                                        RadiusBottomLeft: =4
                                        RadiusBottomRight: =4
                                        RadiusTopLeft: =4
                                        RadiusTopRight: =4
                                        Width: =35
                                        ZIndex: =2

                                        lblAppBkgColor_3 As htmlViewer:
                                            AutoHeight: =true
                                            Height: =35
                                            HoverBorderColor: =lblAppBkgColor_3.BorderColor
                                            HtmlText: |-
                                                ="<div style='width:"&imgAppIcon_3.Width&"px;height=35px;height:35px;background:" & ThisItem.'Icon Background Color' & "'></div>"
                                            OnSelect: =Select(galOrphanedApps)
                                            PaddingBottom: =-10
                                            PaddingLeft: =0
                                            PaddingRight: =0
                                            PaddingTop: =-10
                                            PressedBorderColor: =lblAppBkgColor_3.BorderColor
                                            Size: =10
                                            Width: =35
                                            ZIndex: =1

                                        imgAppIcon_3 As image:
                                            BorderColor: =ColorFade(imgAppIcon_3.Fill,-20%)
                                            DisabledBorderColor: =RGBA(159, 167, 165, 1)
                                            DisabledFill: =RGBA(193, 193, 193, 0.95)
                                            Fill: =
                                            FocusedBorderColor: =imgAppIcon_3.BorderColor
                                            Height: =galOrphanedApps.TemplateHeight-15
                                            HoverBorderColor: =RGBA(0, 0, 0, 0)
                                            HoverFill: =RGBA(0, 0, 0, 0)
                                            Image: =ThisItem.'App Icon Uri'
                                            ImagePosition: =ImagePosition.Fill
                                            OnSelect: =Select(galOrphanedApps)
                                            PaddingBottom: =imgAppIcon_3.PaddingTop
                                            PaddingLeft: =imgAppIcon_3.PaddingTop
                                            PaddingRight: =imgAppIcon_3.PaddingTop
                                            PressedBorderColor: =RGBA(0, 0, 0, 0)
                                            PressedFill: =RGBA(0, 0, 0, 0)
                                            Tooltip: =ThisItem.'App Display Name'
                                            Width: =35
                                            ZIndex: =2

                                    Container5_6 As groupContainer.manualLayoutContainer:
                                        AlignInContainer: =AlignInContainer.SetByContainer
                                        FillPortions: =1.5
                                        Height: =30
                                        LayoutMinHeight: =35  
                                        LayoutMinWidth: =150
                                        PaddingRight: =2
                                        RadiusBottomLeft: =4
                                        RadiusBottomRight: =4
                                        RadiusTopLeft: =4
                                        RadiusTopRight: =4
                                        ZIndex: =3

                                        LinkCanvas1_2 As Link:
                                            Align: ='LinkCanvas.Align'.Start
                                            Appearance: ="Default"
                                            AutoHeight: =false
                                            BasePaletteColor: |-
                                                =If(
                                                    ThisItem.IsSelected = true,
                                                    RGBA(
                                                        116,
                                                        39,
                                                        116,
                                                        1
                                                    ),
                                                    RGBA(
                                                        47,
                                                        41,
                                                        43,
                                                        1
                                                    )
                                                )
                                            BorderColor: =""
                                            BorderStyle: =""
                                            DisplayMode: =DisplayMode.Edit
                                            Font: =Font.'Segoe UI'
                                            FontSize: =14
                                            FontUnderline: =If(ThisItem.IsSelected=true,true,false)
                                            FontWeight: =FontWeight.Normal
                                            Height: =35
                                            Text: =ThisItem.'App Display Name'
                                            URL: =""
                                            VerticalAlign: ='LinkCanvas.VerticalAlign'.Middle
                                            Width: =Parent.Width
                                            Wrap: =false
                                            X: =0
                                            Y: =0
                                            ZIndex: =1

                                        ButtonCanvas1_4 As Button:
                                            Align: =""
                                            Appearance: ='ButtonCanvas.Appearance'.Transparent
                                            BasePaletteColor: |-
                                                =//RGBA(66, 66, 66,1)
                                                RGBA(
                                                    116,
                                                    39,
                                                    116,
                                                    1
                                                )
                                            BorderColor: =""
                                            BorderStyle: =""
                                            DisabledBorderColor: =""
                                            DisplayMode: =DisplayMode.Edit
                                            FocusedBorderColor: =""
                                            Font: =Font.'Segoe UI'
                                            FontColor: |-
                                                =If(
                                                    ThisItem.IsSelected = true,
                                                    RGBA(
                                                        116,
                                                        39,
                                                        116,
                                                        1
                                                    ),
                                                    RGBA(
                                                        116,
                                                        39,
                                                        116,
                                                        1
                                                    )
                                                )
                                            FontSize: =10
                                            FontUnderline: =true
                                            FontWeight: =FontWeight.Normal
                                            Height: =35
                                            HoverBorderColor: =""
                                            Icon: =""
                                            IconRotation: =0
                                            IconStyle: ="Outline"
                                            Layout: ="Icon before"
                                            OnSelect: =Select(galOrphanedApps)
                                            PressedBorderColor: =""
                                            Text: =""
                                            VerticalAlign: =""
                                            Width: =Parent.Width
                                            X: =0
                                            Y: =0
                                            ZIndex: =2

                                    lblLastLaunched_1 As label:
                                        AlignInContainer: =AlignInContainer.Start
                                        BorderColor: =RGBA(218,218,218,1.00)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(47,41,43,1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                        FillPortions: =0.6
                                        FocusedBorderColor: =lblLastLaunched_1.BorderColor
                                        FocusedBorderThickness: =2
                                        Font: =Font.'Segoe UI'
                                        Height: =galOrphanedApps.TemplateHeight
                                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                                        HoverColor: =RGBA(4,45,81,1.00)
                                        HoverFill: =RGBA(0, 0, 0, 0)
                                        OnSelect: =Select(galOrphanedApps)
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =RGBA(0, 0, 0, 0)
                                        PressedColor: =RGBA(4,45,81,1.00)
                                        PressedFill: =RGBA(0, 0, 0, 0)
                                        Size: =11
                                        Text: =Text(ThisItem.'App Last Launched On',"[$-en-US]dd-mmm-yyyy")
                                        Width: =127
                                        X: =440
                                        ZIndex: =5

                                    lblOwner_3 As label:
                                        AlignInContainer: =AlignInContainer.Start
                                        BorderColor: =RGBA(218,218,218,1.00)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(47,41,43,1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                        FocusedBorderColor: =lblOwner_3.BorderColor
                                        FocusedBorderThickness: =2
                                        Font: =Font.'Segoe UI'
                                        Height: =galOrphanedApps.TemplateHeight
                                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                                        HoverColor: =RGBA(4,45,81,1.00)
                                        HoverFill: =RGBA(0, 0, 0, 0)
                                        OnSelect: =Select(galOrphanedApps)
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =RGBA(0, 0, 0, 0)
                                        PressedColor: =RGBA(4,45,81,1.00)
                                        PressedFill: =RGBA(0, 0, 0, 0)
                                        Size: =10
                                        Text: |-
                                            =/*If(!IsBlankOrError(
                                                PowerAppsforAdmins.GetAdminAppRoleAssignment(
                                                    ThisItem.'App Environment'.Name,
                                                    ThisItem.App).value),
                                            CountRows(
                                                PowerAppsforAdmins.GetAdminAppRoleAssignment(
                                                    ThisItem.'App Environment'.Name,
                                                    ThisItem.App
                                                ).value))*/
                                            
                                            ThisItem.'App Shared Editors'
                                        X: =563
                                        ZIndex: =6

                                    lblAppID_3 As label:
                                        AlignInContainer: =AlignInContainer.Stretch
                                        BorderColor: =RGBA(218,218,218,1.00)
                                        BorderStyle: =BorderStyle.None
                                        BorderThickness: =2
                                        Color: =RGBA(47,41,43,1)
                                        DisabledBorderColor: =RGBA(0, 0, 0, 0)
                                        DisabledColor: =ColorFade(RGBA(47, 41, 43, 1), 70)
                                        FillPortions: =1
                                        FocusedBorderColor: =lblAppID_3.BorderColor
                                        FocusedBorderThickness: =2
                                        Font: =Font.'Segoe UI'
                                        Height: =galOrphanedApps.TemplateHeight
                                        HoverBorderColor: =RGBA(0, 0, 0, 0)
                                        HoverColor: =RGBA(4,45,81,1.00)
                                        HoverFill: =RGBA(0, 0, 0, 0)
                                        OnSelect: =Select(galOrphanedApps)
                                        PaddingBottom: =0
                                        PaddingLeft: =0
                                        PaddingRight: =0
                                        PaddingTop: =0
                                        PressedBorderColor: =RGBA(0, 0, 0, 0)
                                        PressedColor: =RGBA(4,45,81,1.00)
                                        PressedFill: =RGBA(0, 0, 0, 0)
                                        Size: =10
                                        Text: =ThisItem.'App Environment'.'Display Name'
                                        Tooltip: =ThisItem.'App Environment'.'Display Name'
                                        Width: =280
                                        X: =778
                                        ZIndex: =7

                                    btnEditSelected As Button:
                                        Align: =""
                                        AlignInContainer: =AlignInContainer.Center
                                        Appearance: ='ButtonCanvas.Appearance'.Primary
                                        BasePaletteColor: =
                                        BorderColor: =""
                                        BorderStyle: =""
                                        DisabledBorderColor: =""
                                        DisplayMode: =DisplayMode.Edit
                                        FocusedBorderColor: =""
                                        FontColor: =
                                        Height: =galOrphanedApps.TemplateHeight-10   
                                        HoverBorderColor: =""
                                        Icon: =""
                                        IconRotation: =0
                                        IconStyle: ="Outline"
                                        Layout: ="Icon before"
                                        LayoutMinHeight: =32
                                        LayoutMinWidth: =96
                                        OnSelect: =Launch(theAppMakerURL &  "environments/" & ThisItem.'App Environment'.Name &"/apps/" &ThisItem.App & "/details")
                                        PressedBorderColor: =""
                                        Text: ="App Details"
                                        VerticalAlign: =""
                                        Width: =110
                                        X: =1045
                                        Y: =12
                                        ZIndex: =8

        conManagePermissions As groupContainer.verticalAutoLayoutContainer:
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =8
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingBottom: =10
            PaddingLeft: =10
            PaddingRight: =10
            PaddingTop: =10
            Visible: |-
                =//pnlPermissions.Visible
                showAddUsers
            Y: |
                =0
            ZIndex: =2

            spinnerPerm As Spinner:
                BasePaletteColor: =
                DisplayMode: =DisplayMode.Edit
                FontColor: =
                Height: =Parent.Height
                Label: =var_Spinnerlabel
                LayoutMinHeight: =200
                LayoutMinWidth: =200
                Visible: |+
                    =var_ShowSpinner
                    
                    
                    
                    
                Width: =Parent.Width
                X: =0
                Y: =0
                ZIndex: =1

            SubtitleContainer As groupContainer.horizontalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.SetByContainer
                FillPortions: =0
                Height: =36
                LayoutGap: =5
                LayoutMinHeight: =40
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Width: =Parent.Width-20
                X: =40
                Y: |-
                    =//40
                    0
                ZIndex: =2

                "icoBackPrev As 'Fluent Icon (1.1.29)'":
                    DisplayMode: =DisplayMode.Edit
                    FontSize: =18
                    Height: =32
                    IconName: ="Back"
                    IconSize: =18
                    IconType: ='PowerCAT.Icon.IconType'.IconButon
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    OnChange: |+
                        =UpdateContext({var_pivotkey: "tabMembers"});
                        
                    Theme: =AppThemeJson
                    Tooltip: ="Back"
                    Visible: |-
                        =//If(var_pivotkey = "tabAddUser" || var_pivotkey = "tabAddGroup",true,false)
                        If(
                            (var_pivotkey = "tabAddUser" || var_pivotkey = "tabAddGroup"),
                            true,
                            false
                        )
                    Width: =32
                    X: =40
                    Y: =40
                    ZIndex: =1

                lblPanelSubtitle As Label:
                    Alignment: =Align.Justify
                    Color: =
                    DisplayMode: =DisplayMode.Edit
                    FillPortions: =1
                    FontSize: =12
                    FontWeight: =FontWeight.Semibold
                    Height: =32
                    LayoutMinHeight: =32
                    LayoutMinWidth: =320
                    OnChange: =false
                    Text: |-
                        =/*If(
                            var_pivotkey = "tabAddUser",
                            "Grant permission to a user",
                            If(
                                var_pivotkey = "tabAddGroup",
                                "Grant permission to a group",
                                "List of members"
                            )
                        )*/
                        If(
                            var_pivotkey = "tabAddUser",
                            "Grant permission to a user",
                            If(
                                var_pivotkey = "tabAddGroup",
                                "Grant permission to a group",
                                "List of members"
                            )
                        )
                    Width: =Parent.Width - Parent.PaddingLeft-70
                    X: =0
                    Y: =0
                    ZIndex: =2

                "icoBackPrev_3 As 'Fluent Icon (1.1.29)'":
                    AlignInContainer: =AlignInContainer.Center
                    DisplayMode: =DisplayMode.Edit
                    FontSize: =18
                    Height: =32
                    IconName: ="Cancel"
                    IconSize: =18
                    IconType: ='PowerCAT.Icon.IconType'.IconButon
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    OnChange: |
                        =UpdateContext({showAddUsers: false});
                        If(
                            galleryRefreshed,
                            Clear(EnvCheckedApps);
                            Clear(EnvCheckedOwnerApps);
                            Clear(OrphanedCheckedApps);
                            
                        );
                        UpdateContext({SelectedUserID: Blank()});
                    Theme: =AppThemeJson
                    Tooltip: ="Close"
                    Visible: =true
                    Width: =32
                    X: =40
                    Y: =40
                    ZIndex: =3

            MainContainer_1 As groupContainer.verticalAutoLayoutContainer:
                LayoutDirection: =LayoutDirection.Vertical
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                RadiusBottomLeft: =4
                RadiusBottomRight: =4
                RadiusTopLeft: =4
                RadiusTopRight: =4
                ZIndex: =3

                "AddEditUserCommandBar As 'Fluent Command Bar (1.1.29)'.pcfdataset":
                    DisplayMode: =DisplayMode.Edit
                    Height: =40
                    Items: |-
                        =Table(
                            {
                                ItemKey: "addedituser",
                                ItemDisplayName: If(
                                    !IsBlank(SelectedUserID) && PermissionsDetailsList.Selected.Role <> "Owner",
                                    "Change Permission",
                                    "Add User"
                                ),
                                ItemIconName: "AddFriend",
                                ItemEnabled: (CountRows(EnvCheckedApps) > 0 || CountRows(EnvCheckedOwnerApps) > 0 || CountRows(OrphanedCheckedApps) > 0) && (PermissionsDetailsList.Selected.Role <> "Owner")
                            },
                            {
                                ItemKey: "addgroup",
                                ItemDisplayName: "Add Group",
                                ItemVisible: If(
                                    IsBlank(SelectedUserID),
                                    true,
                                    false
                                ),
                                ItemIconName: "PeopleAdd",
                                ItemEnabled: (CountRows(EnvCheckedApps) > 0 || CountRows(EnvCheckedOwnerApps) > 0 || CountRows(OrphanedCheckedApps) > 0)
                            },
                            {
                                ItemKey: "removeuser",
                                ItemDisplayName: "Remove",
                                ItemIconName: "UserRemove",
                                ItemEnabled: If(
                                    (!IsBlank(SelectedUserID) && PermissionsDetailsList.Selected.Role <> "Owner"),
                                    true,
                                    false
                                )
                            }
                        )
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    OnSelect: |
                        =Switch(
                            Self.Selected.ItemKey,
                            "addedituser",
                            UpdateContext({ctxUpdatesInProgress: true});
                            If(
                                !IsBlank(SelectedUserID) && PermissionsDetailsList.Selected.Type = "Group",
                                //if group
                                UpdateContext({var_pivotkey: "tabAddGroup"});
                                Reset(cmbGroup);
                                ,
                                //not group
                                If(
                                    IsBlank(SelectedUserID) || PermissionsDetailsList.Selected.Role = "Owner",
                                    ClearCollect(
                                        DefaultUserCollection,
                                        User()
                                    );
                                    ClearCollect(
                                        DefaultUserCollection,
                                        Blank()
                                    ),
                                    ClearCollect(
                                        DefaultUserTempCollection,
                                        Office365Users.UserProfile(SelectedUserID)
                                    );
                                    ClearCollect(
                                        DefaultUserCollection,
                                        AddColumns(
                                            DefaultUserTempCollection,
                                            PersonaKey,
                                            Mail,
                                            PersonaRole,
                                            JobTitle,
                                            PersonaName,
                                            DisplayName,
                                            PersonaImgUrl,
                                //Get base64 image data
                                            Substitute(
                                                JSON(
                                                    Office365Users.UserPhotoV2(SelectedUserID),
                                                    JSONFormat.IncludeBinaryData
                                                ),
                                                """",
                                                ""
                                            )
                                        )
                                    );
                                );
                                UpdateContext({var_pivotkey: "tabAddUser"});
                            );
                            UpdateContext({ctxUpdatesInProgress: false});
                            ,
                            "addgroup",
                            UpdateContext({var_pivotkey: "tabAddGroup"});
                            Reset(cmbGroup);
                            ,
                            "removeuser",
                            UpdateContext({ctxUpdatesInProgress: true});
                            UpdateContext(
                                {
                                    var_Spinnerlabel: "Removing " & PermissionsDetailsList.Selected.Type & "...",
                                    //"Removing User...",
                                    var_ShowSpinner: true
                                }
                            );
                            UpdateContext(
                                {
                                    var_ResponseMessage: 'HELPER-ObjectOperations'.Run(
                                        PermissionsDetailsList.Selected.RowKey,
                                        First(ctxAppsToUpdate).AppName,
                                        First(ctxAppsToUpdate).EnvName,
                                        //gloSelectedRecordID,
                        //gloEnvironmentName,
                                        "removeuser",
                                        "app",
                                        {
                                            boolean: If(
                                                PermissionsDetailsList.Selected.Type = "Group",
                                                true,
                                                false
                                            )
                                        }
                                    ).thereturnstring
                                }
                            );
                            If(
                                var_ResponseMessage <> "pass",
                                Notify(
                                    var_ResponseMessage,
                                    NotificationType.Error
                                ),
                                Notify(
                                    "Permission removed for " & PermissionsDetailsList.Selected.Name,
                                    NotificationType.Success
                                );
                            );
                            // Update Permission detail list
                        UpdateContext(
                                {
                                    var_ShowSpinner: false,
                                    var_ShowShimmer: true
                                }
                            );
                            If(
                                var_ResponseMessage = "pass",
                                If(
                                    (selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1),
                                    //CheckIfSingleSelection(),
                                    Select(Hidden_UpdateTable_App);
                                );
                                Refresh('Power Platform Users');
                                Refresh(Makers);
                                Refresh('PowerApps Apps');
                                UpdateContext({galleryRefreshed: true});
                                Reset(chkSelectAll);
                                Reset(chkSelectAllMakerApps);
                                Reset(chkSelectAllOrphanedApps);
                            );
                            UpdateContext({var_ShowShimmer: false});
                            UpdateContext({ctxUpdatesInProgress: false});
                            
                        );
                    Theme: =AppThemeJson
                    Visible: |-
                        =//PermissionsDetailsList.Visible
                        If(
                            var_pivotkey = "tabAddGroup" || var_pivotkey = "tabAddUser",
                            false,
                            true
                        )
                    Width: =Parent.Width
                    X: =0
                    Y: =Parent.Height - Self.Height
                    ZIndex: =1

                Rectangle2 As rectangle:
                    AlignInContainer: =AlignInContainer.Stretch
                    BorderColor: =RGBA(166, 166, 166, 1)
                    BorderStyle: =BorderStyle.None
                    BorderThickness: =2
                    DisabledFill: =RGBA(166, 166, 166, 1)
                    Fill: =RGBA(122, 138, 143, 0.12)
                    FocusedBorderColor: =RGBA(0, 120, 212, 1)
                    Height: =1
                    HoverFill: =RGBA(0, 120, 212, 1)
                    PressedFill: =RGBA(0, 120, 212, 1)
                    ZIndex: =2

                "PermissionsDetailsList As 'Fluent Details List (1.1.29)'.pcfdataset":
                    AlternateRowColor: =
                    columns_Items: |-
                        =Table(
                            {
                                ColName: "UserType",
                                ColDisplayName: "UserType",
                                ColIsBold: true,
                                ColWidth: 50
                            },
                            {
                                ColName: "Image",
                                ColDisplayName: "",
                                ColImageWidth: 37,
                                ColWidth: 40,
                                ColPaddingTop: 5,
                                ColCellType: "image"
                            },
                            {
                                ColName: "Name",
                                ColDisplayName: "Name",
                                ColWidth: Parent.Width - 90,
                                ColIsBold: true,
                                ColSortable: true
                            },
                            {
                                ColName: "Role",
                                ColDisplayName: "Role",
                                ColIsBold: false,
                                ColSortable: true,
                                ColSubTextRow: true,
                                ColShowAsSubTextOf: "Name"
                            },
                            {
                                ColName: "Email",
                                ColDisplayName: "Email",
                                ColIsBold: false,
                                ColSortable: true,
                                ColSubTextRow: false,
                                ColShowAsSubTextOf: "Name"
                            }
                        )
                    Compact: =true
                    CurrentSortColumn: =ctxSortCol
                    CurrentSortDirection: |-
                        =If(ctxSortAsc,
                            'PowerCAT.FluentDetailsList.CurrentSortDirection'.Ascending,
                            'PowerCAT.FluentDetailsList.CurrentSortDirection'.Descending) 
                    DisplayMode: =DisplayMode.Edit
                    HeaderVisible: =false
                    Height: |-
                        =//Parent.Height -25 - pagingContainer.Height -AddEditUserCommandBar.Height
                        Parent.Height - pagingContainer.Height - AddEditUserCommandBar.Height
                    InputEvent: =varGridEvent
                    Items: =SortByColumns(roleAssignmentsCollection,ctxSortCol,If(ctxSortAsc,SortOrder.Ascending,SortOrder.Descending))
                    LargeDatasetPaging: =false
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    OnChange: |
                        =/* Runs when selected row changes and control property 'Raise OnRowSelection event' is true */
                        If(
                            Self.EventName = "OnRowSelectionChange",
                            If(
                                !IsBlank(Self.EventRowKey),
                                UpdateContext({SelectedUserID: PermissionsDetailsList.Selected.RowKey});
                                UpdateContext({SelectedUserType: PermissionsDetailsList.Selected.UserType}),
                                UpdateContext({SelectedUserID: Blank()})
                            );
                            
                        );
                        If(
                            Self.EventName = "Sort",
                            UpdateContext(
                                {
                                    ctxSortCol: Self.SortEventColumn,
                                    ctxSortAsc: If(
                                        Self.SortEventDirection = 'PowerCAT.FluentDetailsList.SortEventDirection'.Ascending,
                                        true,
                                        false
                                    )
                                }
                            )
                        );
                    PageSize: =14
                    RaiseOnRowSelectionChangeEvent: =true
                    RecordKey: =""
                    SelectionAlwaysVisible: |-
                        =//true
                        (PermissionsDetailsList.Selected.Role <> "Owner")
                    SelectionType: ='PowerCAT.FluentDetailsList.SelectionType'.Single
                    SelectRowsOnFocus: =false
                    Theme: =AppThemeJson
                    Visible: |-
                        =If(
                            var_pivotkey = "tabMembers" && !var_ShowShimmer && ((selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1)),
                            true,
                            false
                        )
                    Width: |-
                        =//Parent.Width - Parent.PaddingLeft/1.4
                        Parent.Width
                    X: =0
                    Y: =0
                    ZIndex: =4

                    Name1 As pcfDataField.textualColumn:
                        FieldDisplayName: ="Name"
                        FieldName: ="Name"
                        FieldType: ="s"
                        FieldVariantName: ="textualColumn"
                        Order: =3
                        ZIndex: =7

                    Role1 As pcfDataField.textualColumn:
                        FieldDisplayName: ="Role"
                        FieldName: ="Role"
                        FieldType: ="s"
                        FieldVariantName: ="textualColumn"
                        Order: =4
                        ZIndex: =8

                    Image1 As pcfDataField.textualColumn:
                        FieldDisplayName: ="Image"
                        FieldName: ="Image"
                        FieldType: ="s"
                        FieldVariantName: ="textualColumn"
                        Order: =3
                        ZIndex: =9

                    Email1 As pcfDataField.textualColumn:
                        FieldDisplayName: ="Email"
                        FieldName: ="Email"
                        FieldType: ="s"
                        FieldVariantName: ="textualColumn"
                        Order: =5
                        ZIndex: =12

                    UserType1 As pcfDataField.textualColumn:
                        FieldDisplayName: ="UserType"
                        FieldName: ="UserType"
                        FieldType: ="s"
                        FieldVariantName: ="textualColumn"
                        Order: =4
                        ZIndex: =57

                pagingContainer As groupContainer.horizontalAutoLayoutContainer:
                    AlignInContainer: =AlignInContainer.Start
                    BorderColor: =RGBA(0, 0, 0, 0)
                    BorderStyle: =BorderStyle.None
                    DropShadow: =DropShadow.Light
                    FillPortions: =0
                    Height: =35  
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    RadiusBottomLeft: =4
                    RadiusBottomRight: =4
                    RadiusTopLeft: =4
                    RadiusTopRight: =4
                    Visible: =PermissionsDetailsList.Visible
                    Width: =PermissionsDetailsList.Width
                    X: |-
                        =//4.285714285714278
                        0
                    Y: =PermissionsDetailsList.Y + PermissionsDetailsList.Height
                    ZIndex: =5

                    "icoFirst As 'Fluent Icon (1.1.29)'":
                        DisplayMode: =If(PermissionsDetailsList.HasPreviousPage,DisplayMode.Edit,DisplayMode.Disabled)
                        Height: =35
                        IconName: ="Previous"
                        LayoutMinHeight: =200
                        LayoutMinWidth: =200
                        OnChange: =Set(varGridEvent,"LoadFirstPage" & Text(Rand()));
                        Theme: =AppThemeJson
                        Tooltip: ="First Page"
                        Width: =35
                        X: =0
                        Y: =0
                        ZIndex: =1

                    "icoBack As 'Fluent Icon (1.1.29)'":
                        DisplayMode: |-
                            =If(
                                PermissionsDetailsList.HasPreviousPage,
                                DisplayMode.Edit,
                                DisplayMode.Disabled
                            )
                        Height: =35
                        IconName: ="Back"
                        LayoutMinHeight: =200
                        LayoutMinWidth: =200
                        OnChange: =Set(varGridEvent,"LoadPreviousPage" & Text(Rand()));
                        Theme: =AppThemeJson
                        Tooltip: ="Previous"
                        Width: =35
                        X: =icoFirst.X+icoFirst.Width
                        Y: =0
                        ZIndex: =2

                    lblPageCount As label:
                        Align: =Align.Center
                        AlignInContainer: =AlignInContainer.Stretch
                        BorderColor: =RGBA(0, 0,0,0)
                        BorderStyle: =BorderStyle.None
                        Color: =//ColorValue(AppTheme.palette.neutralPrimary)
                        DisabledColor: =RGBA(166, 166, 166, 1)
                        FillPortions: =1
                        Font: =Font.'Segoe UI'
                        Height: =24
                        LayoutMinHeight: =24
                        Size: =8
                        Text: ="Page " & PermissionsDetailsList.PageNumber
                        Visible: =PermissionsDetailsList.Visible
                        Width: =35  
                        X: =icoBack.X+icoBack.Width
                        ZIndex: =3

                    "icoNext As 'Fluent Icon (1.1.29)'":
                        DisplayMode: |-
                            =If(
                                PermissionsDetailsList.HasNextPage,
                                DisplayMode.Edit,
                                DisplayMode.Disabled
                            )
                        Height: =35
                        IconName: ="Forward"
                        LayoutMinHeight: =200
                        LayoutMinWidth: =200
                        OnChange: =Set(varGridEvent,"LoadNextPage" & Text(Rand()));
                        Theme: =AppThemeJson
                        Tooltip: ="Next Page"
                        Width: =35
                        X: =lblPageCount.X + lblPageCount.Width
                        Y: =0
                        ZIndex: =4

                    "icoNext_3 As 'Fluent Icon (1.1.29)'":
                        DisplayMode: |-
                            =If(
                                PermissionsDetailsList.HasNextPage,
                                DisplayMode.Edit,
                                DisplayMode.Disabled
                            )
                        Height: =35
                        IconName: ="Next"
                        LayoutMinHeight: =200
                        LayoutMinWidth: =200
                        OnChange: =Set(varGridEvent,"LoadNextPage" & Text(Rand()));
                        Theme: =AppThemeJson
                        Tooltip: ="Next Page"
                        Width: =35
                        X: =lblPageCount.X + lblPageCount.Width
                        Y: =0
                        ZIndex: =5

                "PermissionsDetailsListShimmer As 'Fluent Shimmer (1.1.29) Preview'.pcfdataset":
                    DisplayMode: =DisplayMode.Edit
                    Height: =PermissionsDetailsList.Height
                    Items: |-
                        =Table({
                                ItemWidth: "14",
                                ItemHeight: 12,
                                ItemType: "line"
                            },
                            {
                                ItemWidth: "5",
                                ItemHeight: 10,
                                ItemType: "gap"
                            },
                            {
                                ItemWidth: "120",
                                ItemHeight: 5,
                                ItemType: "line"
                            }
                        )
                    LayoutMinHeight: =200
                    LayoutMinWidth: =200
                    RowCount: =3
                    SpacebetweenShimmer: ='PowerCAT.Shimmer.SpacebetweenShimmer'.'0px'
                    Theme: =AppThemeJson
                    Visible: =If(var_pivotkey = "tabMembers" && var_ShowShimmer,true,false)   
                    Width: =PermissionsDetailsList.Width
                    X: |-
                        =//PermissionsDetailsList.X
                        0
                    Y: =PermissionsDetailsList.Y
                    ZIndex: =6

                AddUsersContainer As groupContainer.verticalAutoLayoutContainer:
                    Height: =Parent.Height
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutGap: =5
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    PaddingBottom: =20
                    PaddingLeft: =10
                    PaddingRight: =10
                    PaddingTop: =20
                    Visible: =If(var_pivotkey = "tabAddUser",true,false)
                    Width: =Parent.Width
                    ZIndex: =7

                    lblAddUsers As Label:
                        Color: =
                        DisplayMode: =DisplayMode.Edit
                        FontSize: =11
                        FontWeight: =FontWeight.Semibold
                        Height: =30
                        LayoutMinHeight: =32
                        LayoutMinWidth: =320
                        OnChange: =false
                        Text: ="Select user"
                        Width: =Parent.Width - Parent.PaddingLeft * 2
                        X: =24
                        Y: =102
                        ZIndex: =1

                    "PeoplePicker As 'Fluent PeoplePicker (1.1.29) Preview'.pcfdataset":
                        AlignInContainer: =AlignInContainer.Stretch
                        DisplayMode: =DisplayMode.Edit
                        Error: =false
                        Height: =60
                        Items: =DefaultUserCollection
                        LayoutMinHeight: =200
                        LayoutMinWidth: =200
                        MaxPeople: =1
                        OnBlur: =false
                        OnFocus: =false
                        OnSearch: |+
                            =IfError(
                                Office365Users.SearchUserV2(
                                    {
                                        searchTerm: Self.SearchText,
                                        top: 500
                                    }
                                ),
                                Error(FirstError)
                            );
                            ClearCollect(
                                UserCollection,
                                AddColumns(
                                    Office365Users.SearchUserV2(
                                        {
                                            searchTerm: Self.SearchText,
                                            top: 500
                                        }
                                    ).value,
                                    SuggestionImgUrl,
                                    Substitute(
                                        JSON(
                                            Office365Users.UserPhotoV2(Id),
                                            JSONFormat.IncludeBinaryData
                                        ),
                                        """",
                                        ""
                                    ),
                                    SuggestionKey,
                                    Id,
                                    SuggestionName,
                                    DisplayName,
                                    SuggestionRole,
                                    JobTitle
                                )
                            );
                            
                            
                        ShowSecondaryText: =true
                        Suggestions_Items: =UserCollection
                        Theme: =AppThemeJson
                        Width: =320
                        X: =20
                        Y: =0
                        ZIndex: =2

                        DisplayName5 As pcfDataField.textualColumn:
                            FieldDisplayName: ="DisplayName"
                            FieldName: ="DisplayName"
                            FieldType: ="s"
                            FieldVariantName: ="textualColumn"
                            Order: =3
                            ZIndex: =55

                        Email2 As pcfDataField.textualColumn:
                            FieldDisplayName: ="Email"
                            FieldName: ="Email"
                            FieldType: ="s"
                            FieldVariantName: ="textualColumn"
                            Order: =2
                            ZIndex: =56

                    lblSelectedUserRole As Label:
                        Color: =
                        DisplayMode: =DisplayMode.Edit
                        FontSize: =11
                        FontWeight: =FontWeight.Semibold
                        Height: =35
                        LayoutMinHeight: =32
                        LayoutMinWidth: =320
                        OnChange: =false
                        Text: ="Select user role"
                        Width: =Parent.Width - Parent.PaddingLeft * 2
                        X: =24
                        Y: =88
                        ZIndex: =3

                    ddUserRole As Dropdown.pcfdataset:
                        AlignInContainer: =AlignInContainer.Stretch
                        Appearance: ="FilledDarker"
                        BorderColor: =""
                        BorderStyle: =""
                        DefaultSelectedItems: =["Can View"]
                        DisabledBorderColor: =""
                        DisplayMode: =DisplayMode.Edit
                        FocusedBorderColor: =""
                        Height: =32
                        HoverBorderColor: =""
                        Items: |-
                            =[
                                "Can View",
                                "Can Edit",
                                "Owner"
                            ]
                        LayoutMinHeight: =32
                        LayoutMinWidth: =320
                        PressedBorderColor: =""
                        Width: =320
                        X: =0
                        Y: =0
                        ZIndex: =4

                    PanelFooterContainer As groupContainer.manualLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        Height: =Parent.Height - Self.Y
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        Width: =Parent.Width - Parent.PaddingLeft * 2
                        ZIndex: =6

                        icoFooterDivider As rectangle:
                            BorderColor: =//ColorValue(AppTheme.palette.neutralLight)
                            BorderThickness: =0.1
                            DisabledFill: =RGBA(166, 166, 166, 1)
                            Fill: =RGBA(0, 120, 212, 1)
                            FocusedBorderColor: =RGBA(0, 120, 212, 1)
                            Height: =0.1
                            HoverFill: =RGBA(0, 120, 212, 1)
                            PressedFill: =RGBA(0, 120, 212, 1)
                            Width: =Parent.Width
                            Y: =btnAddUser.Y - 10
                            ZIndex: =2

                        btnAddUser As Button:
                            Align: =""
                            BasePaletteColor: =
                            BorderColor: =""
                            BorderStyle: =""
                            DisabledBorderColor: =""
                            DisplayMode: |
                                =If(
                                    !IsBlank(ddUserRole.Selected.Value) && !IsBlankOrError(First(PeoplePicker.SelectedPeople)),
                                    DisplayMode.Edit,
                                    DisplayMode.Disabled
                                )
                            FocusedBorderColor: =""
                            Font: ="'Segoe UI', 'Open Sans', sans-serif"
                            FontColor: =
                            FontSize: =12
                            FontWeight: =FontWeight.Normal
                            Height: =32
                            HoverBorderColor: =""
                            Icon: =""
                            IconRotation: =0
                            IconStyle: ="Outline"
                            Layout: ="Icon before"
                            OnSelect: |
                                =UpdateContext(
                                    {
                                        ctxAppsToUpdate: Switch(
                                            selectedTab,
                                            "Environment",
                                            EnvCheckedApps,
                                            "Owner",
                                            EnvCheckedOwnerApps,
                                            "Orphaned apps",
                                            OrphanedCheckedApps
                                        ),
                                        ctxUserSelected: Office365Users.UserProfileV2(First(PeoplePicker.SelectedPeople).PersonaKey).id,
                                        ctxUserName: Office365Users.UserProfileV2(First(PeoplePicker.SelectedPeople).PersonaKey).displayName,
                                        ctxUpdatesInProgress: true
                                    }
                                );
                                If(
                                    CountRows(ctxAppsToUpdate) <= 0,
                                    Notify(
                                        "Please select any app(s) to update",
                                        NotificationType.Error
                                    )
                                );
                                If(
                                    CountRows(ctxAppsToUpdate) > 0,
                                    UpdateContext(
                                        {
                                            var_Spinnerlabel: "Assigning Permission...",
                                            var_ShowSpinner: true,
                                            var_RoleAssignment: ddUserRole.Selected.Value
                                        }
                                    );
                                    ForAll(
                                        ctxAppsToUpdate,
                                //if viewer or editor
                                        If(
                                            var_RoleAssignment <> "Owner",
                                            /*If(
                                                'HELPER-ObjectOperations'.Run(
                                                    ctxUserSelected,
                                                    ThisRecord.AppName,
                                                    ThisRecord.EnvName,
                                                    If(
                                                        var_RoleAssignment = "Can View",
                                                        "addviewer",
                                                        "addeditor"
                                                    ),
                                                    "app"
                                                ).thereturnstring <> "pass",
                                                Collect(
                                                    failedToSet,
                                                    AppName
                                                )
                                            );*/
                                            Collect(
                                                colFlowResponses,
                                                'HELPER-ObjectOperations'.Run(
                                                    ctxUserSelected,
                                                    ThisRecord.AppName,
                                                    ThisRecord.EnvName,
                                                    If(
                                                        var_RoleAssignment = "Can View",
                                                        "addviewer",
                                                        "addeditor"
                                                    ),
                                                    "app"
                                                ).thereturnstring
                                            );
                                            ,
                                //else owner
                                            Collect(
                                                colFlowResponses,
                                                'HELPER-ObjectOperations'.Run(
                                                    ctxUserSelected,
                                                    ThisRecord.AppName,
                                                    ThisRecord.EnvName,
                                                    "assign",
                                                    "app"
                                                ).thereturnstring
                                            );
                                            If(
                                                ThisRecord.AppIsOrphaned = "Yes" && Last(colFlowResponses).Value = "pass",
                                                Patch(
                                                    'PowerApps Apps',
                                                    LookUp(
                                                        'PowerApps Apps',
                                                        App = AppName
                                                    ),
                                                    {'App is Orphaned': "No"}
                                                )
                                            );
                                            /*If(
                                                'HELPER-ObjectOperations'.Run(
                                                    ctxUserSelected,
                                                    ThisRecord.AppName,
                                                    ThisRecord.EnvName,
                                                    "assign",
                                                    "app"
                                                ).thereturnstring <> "pass",
                                                Collect(
                                                    failedToSet,
                                                    AppName
                                                );
                                                ,
                                            )*/
                                        )
                                    );
                                    ForAll(
                                        colFlowResponses,
                                        If(
                                            ThisRecord.Value <> "pass",
                                            If(
                                                !IsMatch(
                                                    ThisRecord.Value,
                                                    "Disabled users cannot access the system",
                                                    MatchOptions.Contains
                                                ),
                                                Collect(
                                                    failedToSet,
                                                    ThisRecord.Value
                                                ),
                                                Collect(
                                                    colDisabledUserResponses,
                                                    ThisRecord.Value
                                                );
                                            );
                                        )
                                    );
                                    
                                //see if all permission changes passed
                                If(
                                        CountRows(failedToSet) < 1,
                                        Notify(
                                            "Permissions granted to " & ctxUserName,
                                            NotificationType.Success
                                        );
                                        If(
                                            //CheckIfSingleSelection(),
                                            (selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1),
                                            Select(Hidden_UpdateTable_App);
                                        );
                                        ClearCollect(
                                            DefaultUserCollection,
                                            User()
                                        );
                                        ClearCollect(
                                            DefaultUserCollection,
                                            Blank()
                                        );
                                        Refresh('Power Platform Users');
                                        Refresh(Makers);
                                        Refresh('PowerApps Apps');
                                        UpdateContext({galleryRefreshed: true});
                                        //Clear([@EnvCheckedApps]);
                                //Clear([@EnvCheckedOwnerApps]);
                                //Clear([@OrphanedCheckedApps]);
                                Reset(chkSelectAll);
                                        Reset(chkSelectAllMakerApps);
                                        Reset(chkSelectAllOrphanedApps);
                                        ,
                                        Notify(
                                            "Changing permissions failed for some apps, try to set via product UX",
                                            NotificationType.Error
                                        );
                                    );
                                    UpdateContext(
                                        {
                                            var_ShowShimmer: false,
                                            var_ShowSpinner: false
                                        }
                                    );
                                    
                                );
                                /*If(
                                    CountRows(colDisabledUserResponses) > 0,
                                    Notify(ctxUserName & " is a disabled user, however permissions are assigned")
                                );*/
                                Clear(failedToSet);
                                Clear(colFlowResponses);
                                Clear(colDisabledUserResponses);
                                UpdateContext({ctxUpdatesInProgress: false});
                            PressedBorderColor: =""
                            Text: =If(IsBlank(SelectedUserID),"Add User","Update Permission")
                            VerticalAlign: =""
                            Width: =If(Self.Text="Update Permission",131,80)
                            X: =0
                            Y: =Parent.Height - Self.Height -10
                            ZIndex: =3

                AddGroupsContainer As groupContainer.verticalAutoLayoutContainer:
                    Height: =Parent.Height
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutGap: =5
                    LayoutMinHeight: =100
                    LayoutMinWidth: =250
                    LayoutMode: =LayoutMode.Auto
                    PaddingBottom: =20
                    PaddingLeft: =10
                    PaddingRight: =10
                    PaddingTop: =20
                    Visible: =If(var_pivotkey = "tabAddGroup",true,false)
                    Width: =Parent.Width
                    ZIndex: =8

                    lblAddGroups As Label:
                        Color: =
                        DisplayMode: =DisplayMode.Edit
                        FontSize: =11
                        FontWeight: =FontWeight.Semibold
                        Height: =30
                        LayoutMinHeight: =32
                        LayoutMinWidth: =320
                        OnChange: =false
                        Text: ="Select group"
                        Width: =Parent.Width - Parent.PaddingLeft * 2
                        X: =24
                        Y: =102
                        ZIndex: =1

                    cmbGroup As Combobox.pcfdataset:
                        AlignInContainer: =AlignInContainer.Stretch
                        Appearance: ="FilledDarker"
                        BorderColor: =""
                        BorderStyle: =""
                        DefaultSelectedItems: =If(IsBlank(SelectedUserID), [], [First(SortByColumns(Filter(Office365Groups.ListGroups().value, id = PermissionsDetailsList.Selected.RowKey), "displayName"))])
                        DisabledBorderColor: =""
                        DisplayMode: =DisplayMode.Edit
                        FocusedBorderColor: =""
                        Height: =32
                        HoverBorderColor: =""
                        InputTextPlaceholder: ="Search groups"
                        Items: |-
                            =SortByColumns(
                                Office365Groups.ListGroups().value,
                                "displayName"
                            )
                        LayoutMinHeight: =32
                        LayoutMinWidth: =320
                        PressedBorderColor: =""
                        Width: =320
                        X: =40
                        Y: =40
                        ZIndex: =2

                        displayName1_1 As pcfDataField.textualColumn:
                            FieldDisplayName: ="displayName"
                            FieldName: ="displayName"
                            FieldType: ="s"
                            FieldVariantName: ="textualColumn"
                            Order: =1
                            ZIndex: =1

                    lblSelectedUserRole_1 As Label:
                        Color: =
                        DisplayMode: =DisplayMode.Edit
                        FontSize: =11
                        FontWeight: =FontWeight.Semibold
                        Height: =35
                        LayoutMinHeight: =32
                        LayoutMinWidth: =320
                        OnChange: =false
                        Text: ="Select user role"
                        Width: =Parent.Width - Parent.PaddingLeft * 2
                        X: =24
                        Y: =88
                        ZIndex: =4

                    ddGroupRole As Dropdown.pcfdataset:
                        AlignInContainer: =AlignInContainer.Stretch
                        Appearance: ="FilledDarker"
                        BorderColor: =""
                        BorderStyle: =""
                        DefaultSelectedItems: =["Can View"]
                        DisabledBorderColor: =""
                        DisplayMode: =DisplayMode.Edit
                        FocusedBorderColor: =""
                        Height: =32
                        HoverBorderColor: =""
                        Items: |
                            =["Can View","Can Edit"]
                        LayoutMinHeight: =32
                        LayoutMinWidth: =320
                        PressedBorderColor: =""
                        Width: =320
                        X: =0
                        Y: =0
                        ZIndex: =5

                    PanelFooterContainer_1 As groupContainer.manualLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        Height: =Parent.Height - Self.Y
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        Width: =Parent.Width - Parent.PaddingLeft * 2
                        ZIndex: =6

                        icoFooterDivider_1 As rectangle:
                            BorderColor: =//ColorValue(AppTheme.palette.neutralLight)
                            BorderThickness: =0.1
                            DisabledFill: =RGBA(166, 166, 166, 1)
                            Fill: =RGBA(0, 120, 212, 1)
                            FocusedBorderColor: =RGBA(0, 120, 212, 1)
                            Height: =0.1
                            HoverFill: =RGBA(0, 120, 212, 1)
                            PressedFill: =RGBA(0, 120, 212, 1)
                            Width: =Parent.Width
                            Y: =btnAddroup.Y - 10
                            ZIndex: =2

                        btnAddroup As Button:
                            Align: =""
                            BasePaletteColor: =
                            BorderColor: =""
                            BorderStyle: =""
                            DisabledBorderColor: =""
                            DisplayMode: =If(!IsBlank(cmbGroup.Selected),DisplayMode.Edit,DisplayMode.Disabled)
                            FocusedBorderColor: =""
                            Font: ="'Segoe UI', 'Open Sans', sans-serif"
                            FontColor: =RGBA(255, 255, 255, 1)
                            FontSize: =10.5
                            FontWeight: ="normal"
                            Height: =32
                            HoverBorderColor: =""
                            Icon: =""
                            IconRotation: =0
                            IconStyle: ="Outline"
                            Layout: ="Icon before"
                            OnSelect: |
                                =Clear(failedToSetGroup);
                                UpdateContext({ctxUpdatesInProgress: true});
                                UpdateContext(
                                    {
                                        ctxAppsToUpdate: Switch(
                                            selectedTab,
                                            "Environment",
                                            EnvCheckedApps,
                                            "Owner",
                                            EnvCheckedOwnerApps,
                                            "Orphaned apps",
                                            OrphanedCheckedApps
                                        )
                                    }
                                );
                                If(
                                    CountRows(ctxAppsToUpdate) <= 0,
                                    Notify(
                                        "Please select any app(s) to update",
                                        NotificationType.Error
                                    )
                                );
                                If(
                                    CountRows(ctxAppsToUpdate) > 0,
                                    Concurrent(
                                        UpdateContext(
                                            {
                                                var_Spinnerlabel: "Assigning Permission...",
                                                var_ShowSpinner: true,
                                                var_RoleAssignment: ddGroupRole.Selected.Value
                                            }
                                        ),
                                        Set(
                                            var_selectedGroup,
                                            First(cmbGroup.SelectedItems)
                                        ),
                                        Set(
                                            var_selectedGroupID,
                                            First(cmbGroup.SelectedItems).id
                                        )
                                    );
                                    
                                //add permissions for view or edit
                                ForAll(
                                        ctxAppsToUpdate,
                                //if viewer or editor
                                        If(
                                            var_RoleAssignment <> "Owner",
                                            If(
                                                'HELPER-ObjectOperations'.Run(
                                                    var_selectedGroupID,
                                                    ThisRecord.AppName,
                                                    ThisRecord.EnvName,
                                                    If(
                                                        var_RoleAssignment = "Can View",
                                                        "addviewer",
                                                        "addeditor"
                                                    ),
                                                    "app",
                                                    {boolean: true}
                                                ).thereturnstring <> "pass",
                                                Collect(
                                                    failedToSetGroup,
                                                    AppName
                                                );
                                            ),
                                            If(
                                                'HELPER-ObjectOperations'.Run(
                                                    var_selectedGroupID,
                                                    ThisRecord.AppName,
                                                    ThisRecord.EnvName,
                                                    "assign",
                                                    "app"
                                                ).thereturnstring <> "pass",
                                                Collect(
                                                    failedToSetGroup,
                                                    AppName
                                                )
                                            );
                                        )
                                    );
                                    
                                //see if all permission changes passed
                                If(
                                        CountRows(failedToSetGroup) < 1,
                                        Notify(
                                            "Permissions granted to " & var_selectedGroup.displayName,
                                            NotificationType.Success
                                        );
                                        If(
                                            (selectedTab = "Environment" && CountRows(EnvCheckedApps) = 1) || (selectedTab = "Owner" && CountRows(EnvCheckedOwnerApps) = 1) || (selectedTab = "Orphaned apps" && CountRows(OrphanedCheckedApps) = 1),
                                            Select(Hidden_UpdateTable_App);
                                        );
                                        Refresh('Power Platform Users');
                                        Refresh(Makers);
                                        Refresh('PowerApps Apps');
                                        UpdateContext({galleryRefreshed: true});
                                        Reset(chkSelectAll);
                                        Reset(chkSelectAllMakerApps);
                                        Reset(chkSelectAllOrphanedApps);
                                        ,
                                        Notify(
                                            "Changing permissions failed for some apps, try to set via product UX testgroup",
                                            NotificationType.Error
                                        );
                                    );
                                    UpdateContext(
                                        {var_ShowSpinner: false
                                            //var_ShowShimmer: true
                                }
                                    );
                                    
                                );
                                Clear(failedToSetGroup);
                                UpdateContext({ctxUpdatesInProgress: false});
                            PressedBorderColor: =""
                            Text: |
                                =If(IsBlank(SelectedUserID),"Add Group","Update Permission")
                            VerticalAlign: =""
                            Width: =If(Self.Text="Update Permission",116,96)
                            X: =0
                            Y: =Parent.Height - Self.Height -10
                            ZIndex: =3

    spinnerLoading As Spinner:
        AccessibleLabel: ="Loading.."
        BasePaletteColor: =
        DisplayMode: =DisplayMode.Edit
        Font: =""
        FontColor: =
        FontItalic: =false
        FontStrikethrough: =false
        FontUnderline: =false
        FontWeight: =""
        Height: =Parent.Height
        Label: =ctxSpinnerLabel
        SpinnerSize: ="Large"
        Visible: =ctxLoadSpinner
        Width: =Parent.Width
        X: =0
        Y: =0   
        ZIndex: =4

