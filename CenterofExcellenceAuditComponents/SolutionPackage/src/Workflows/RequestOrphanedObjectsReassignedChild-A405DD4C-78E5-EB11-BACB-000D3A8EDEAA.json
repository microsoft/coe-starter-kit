{
  "properties": {
    "connectionReferences": {
      "shared_office365users": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "new_CoEGovO365Users"
        },
        "api": {
          "name": "shared_office365users"
        }
      },
      "shared_commondataserviceforapps": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreDataverse"
        },
        "api": {
          "name": "shared_commondataserviceforapps"
        }
      },
      "shared_teams": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "new_CoEGovTeams"
        },
        "api": {
          "name": "shared_teams"
        }
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        },
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)": {
          "defaultValue": "https://flow.microsoft.com/manage/environments/",
          "type": "String",
          "metadata": {
            "schemaName": "admin_PowerAutomateEnvironmentVariable",
            "description": "Inventory - REQUIRED. Environment, including geographic location, for Power Automate - Ex for commercial: https://flow.microsoft.com/manage/environments/"
          }
        },
        "Admin eMail (admin_AdminMail)": {
          "defaultValue": "PowerPlatformAdmins@powercattools.onmicrosoft.com ",
          "type": "String",
          "metadata": {
            "schemaName": "admin_AdminMail",
            "description": "Inventory - CoE Admin eMail. Email address used in flows to send notifications to admins; this should be either your email address or a distribution list"
          }
        },
        "ProductionEnvironment (admin_ProductionEnvironment)": {
          "defaultValue": false,
          "type": "Bool",
          "metadata": {
            "schemaName": "admin_ProductionEnvironment",
            "description": "Inventory - Yes by default. Set to No if you are creating a dev type envt. This will allow some flows to set target users to the admin instead of resource owners"
          }
        },
        "Individual Admin (admin_ApprovalAdmin)": {
          "defaultValue": "AdeleV@powercattools.onmicrosoft.com ",
          "type": "String",
          "metadata": {
            "schemaName": "admin_ApprovalAdmin",
            "description": "Inventory - REQUIRED. An individual admin's email. Some actions (approvals / team chats) cannot accept a group/DL. So this env variable is for those instances in the kit. "
          }
        },
        "Admin eMail Preferred Language (admin_AdmineMailPreferredLanguage)": {
          "defaultValue": "en-US",
          "type": "String",
          "metadata": {
            "schemaName": "admin_AdmineMailPreferredLanguage",
            "description": "Inventory - The preferred language for the emails sent to the admin email alias, which is specified in theAdmin eMail environment variable. Default is en-US"
          }
        }
      },
      "triggers": {
        "manual": {
          "metadata": {
            "operationMetadataId": "829d0ddd-28df-4a59-8657-6d1854daa95b"
          },
          "type": "Request",
          "kind": "Button",
          "inputs": {
            "schema": {
              "type": "object",
              "properties": {
                "text": {
                  "title": "ManagerEmail",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "Please enter your input",
                  "x-ms-content-hint": "TEXT"
                }
              },
              "required": [
                "text"
              ]
            }
          }
        }
      },
      "actions": {
        "Initialize_AppsTableAppNameCol": {
          "runAfter": {
            "Initialize_theCard_with_top_contents": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "aa059df3-c819-4953-9f02-3232ed61e53b"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "AppsTableAppNameCol",
                "type": "string",
                "value": " \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"App Name\""
              }
            ]
          }
        },
        "Initialize_AppsTableEmployeeNameCol": {
          "runAfter": {
            "Initialize_AppsTableAppNameCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "86215132-b7d1-45ca-9e88-c1c5bd8203f3"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "AppsTableEmployeeNameCol",
                "type": "string",
                "value": " }\n                    ],\n                    \"width\": \"auto\"\n                },\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Employee Name\""
              }
            ]
          }
        },
        "Initialize_AppsTableLastLaunchedCol": {
          "runAfter": {
            "Initialize_AppsTableEmployeeNameCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "9f734262-eeb7-4b2b-a580-c55815c1f9a1"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "AppsTableLastLaunchedCol",
                "type": "string",
                "value": " }\n                    ],\n                    \"width\": \"auto\"\n                },\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Last Launched\""
              }
            ]
          }
        },
        "Initialize_theCard_with_top_contents": {
          "runAfter": {
            "SendToPreferredLanguage": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "327bd116-9122-4ed5-9026-7852b5dee613"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "theCard",
                "type": "string",
                "value": "{\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"type\": \"AdaptiveCard\",\n    \"version\": \"1.2\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"You can decide what to do with all the objects at once or go through them one at a time\",\n            \"wrap\": true,\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {"
              }
            ]
          }
        },
        "Initialize_OrphanedApps": {
          "runAfter": {
            "Initialize_FlowsTableStatusCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "c65cc279-6905-4f1e-ada0-39bbd4d5deda"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "OrphanedApps",
                "type": "array"
              }
            ]
          }
        },
        "Initialize_OrphanedFlows": {
          "runAfter": {
            "Initialize_OrphanedApps": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "5d5519ea-2940-4426-9bbc-fe215d5abc81"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "OrphanedFlows",
                "type": "array"
              }
            ]
          }
        },
        "Initialize_OrphanedObject": {
          "runAfter": {
            "Initialize_OrphanedFlows": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "8791ffa8-be3b-45f3-8078-3e8ecb0a6f88"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "OrphanedObject",
                "type": "object"
              }
            ]
          }
        },
        "Get_managers_id": {
          "runAfter": {},
          "metadata": {
            "operationMetadataId": "606c1267-b33c-4340-ad0f-fc55cd5c5852"
          },
          "type": "OpenApiConnection",
          "inputs": {
            "host": {
              "connectionName": "shared_office365users",
              "operationId": "UserProfile_V2",
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
            },
            "parameters": {
              "id": "@triggerBody()['text']"
            },
            "authentication": {
              "type": "Raw",
              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
            },
            "retryPolicy": {
              "type": "exponential",
              "count": 10,
              "interval": "PT10S"
            }
          }
        },
        "Initialize_timedOut": {
          "runAfter": {
            "Initialize_OrphanedObject": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "a7990a83-834a-431a-8b3a-6a6c18f9cdf8"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "timedOutOrFailed",
                "type": "boolean",
                "value": "@false"
              }
            ]
          }
        },
        "Initialize_BulkOperationSuccess_to_true": {
          "runAfter": {
            "Initialize_timedOut": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "710ca5c4-0c9b-4fb2-ade1-6ce53b3e19e2"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "BulkOperationSuccess",
                "type": "boolean",
                "value": "@true"
              }
            ]
          }
        },
        "Initialize_FlowsTableAppNameCol": {
          "runAfter": {
            "Initialize_AppsTableLastLaunchedCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "fb727b53-864b-48da-90bb-1515fffae96c"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "FlowsTableAppNameCol",
                "type": "string",
                "value": " \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Flow Name\""
              }
            ]
          }
        },
        "Initialize_FlowsTableEmployeeNameCol": {
          "runAfter": {
            "Initialize_FlowsTableAppNameCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "3f1fed01-2695-48f9-ae41-90a8bbb73b12"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "FlowsTableEmployeeNameCol",
                "type": "string",
                "value": " }\n                    ],\n                    \"width\": \"auto\"\n                },\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Employee Name\""
              }
            ]
          }
        },
        "Initialize_FlowsTableStatusCol": {
          "runAfter": {
            "Initialize_FlowsTableEmployeeNameCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "e1f97d22-d3da-43c4-a42a-e72aafbf38ed"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "FlowsTableStatusCol",
                "type": "string",
                "value": " }\n                    ],\n                    \"width\": \"auto\"\n                },\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Flow Status\""
              }
            ]
          }
        },
        "Initialize_returnValue": {
          "runAfter": {
            "Initialize_BulkOperationSuccess_to_true": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "7b18d5f7-ecc1-43bb-ac67-b1f1b4136366"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "returnValue",
                "type": "integer",
                "value": 200
              }
            ]
          }
        },
        "Initialize_appErrors": {
          "runAfter": {
            "Initialize_returnValue": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "81575c14-fc50-4c37-b495-7d81de750c77"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "appErrors",
                "type": "array"
              }
            ]
          }
        },
        "Initialize_flowErrors": {
          "runAfter": {
            "Initialize_appErrors": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "c189ee0e-5f06-42ef-b957-f1d6a5eef47b"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "flowErrors",
                "type": "array"
              }
            ]
          }
        },
        "Initialize_emailGUID": {
          "runAfter": {
            "Initialize_flowErrors": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "dad8eca6-7937-47c0-aa57-f2d48dd1c5a2"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "emailGUID",
                "type": "string"
              }
            ]
          }
        },
        "SendTo": {
          "runAfter": {
            "Get_managers_id": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "96d61c13-879c-41ed-bf34-25e37267575e"
          },
          "type": "Compose",
          "inputs": "@trim(if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text']))"
        },
        "SendToPreferredLanguage": {
          "runAfter": {
            "SendTo": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "597e2d83-c69a-4b63-a63c-57c7523459c6"
          },
          "type": "Compose",
          "inputs": "@if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Admin eMail Preferred Language (admin_AdmineMailPreferredLanguage)'), if(equals(outputs('Get_managers_id')?['body/preferredLanguage'], null), 'en-US', outputs('Get_managers_id')?['body/preferredLanguage']))"
        },
        "Request_Orphaned_Objects_Reassigned_(Child)_SCOPE": {
          "actions": {
            "Get_Orphaned_Objects_for_this_Manager": {
              "actions": {
                "List_managers_orphaned_employees": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "ce8eca65-1eb3-4178-ba62-fda2370b70c6"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_makers",
                      "$select": "admin_makerid",
                      "$filter": "admin_managerprinciplename eq '@{triggerBody()['text']}'  and admin_makerisorphaned eq true"
                    },
                    "authentication": {
                      "type": "Raw",
                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                    }
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "Apply_to_each_orphaned_employee": {
                  "foreach": "@outputs('List_managers_orphaned_employees')?['body/value']",
                  "actions": {
                    "List_their_canvas_apps": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "2cc2bd7a-23f0-40f0-82cb-a342cb8bafd0"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "ListRecords",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_apps",
                          "$select": "admin_appmodifiedon, admin_applastlaunchedon, admin_appownerdisplayname, admin_displayname, admin_appenvironmentdisplayname, _admin_appowner_value, admin_appid",
                          "$filter": "admin_appdeleted eq false and admin_powerappstype eq 597910000 and _admin_appowner_value eq @{items('Apply_to_each_orphaned_employee')?['admin_makerid']}",
                          "$expand": "admin_AppEnvironment($select=admin_environmentname)"
                        },
                        "authentication": {
                          "type": "Raw",
                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                        }
                      },
                      "runtimeConfiguration": {
                        "paginationPolicy": {
                          "minimumItemCount": 100000
                        }
                      }
                    },
                    "List_their_cloud_flows": {
                      "runAfter": {
                        "List_their_canvas_apps": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "148b4651-1813-4ad3-a183-38dbd021d0a6"
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_commondataserviceforapps",
                          "operationId": "ListRecords",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                        },
                        "parameters": {
                          "entityName": "admin_flows",
                          "$select": "admin_flowmodifiedon, admin_flowmakerdisplayname, admin_flowstate, admin_flowenvironmentdisplayname, admin_displayname, _admin_flowcreator_value,  _admin_derivedowner_value, admin_flowid, _admin_flowenvironment_value, admin_workflowentityid",
                          "$filter": "admin_flowdeleted eq false and ( _admin_derivedowner_value eq @{items('Apply_to_each_orphaned_employee')?['admin_makerid']} or (_admin_derivedowner_value eq null and _admin_flowcreator_value eq @{items('Apply_to_each_orphaned_employee')?['admin_makerid']}))",
                          "$expand": "admin_FlowEnvironment($select=admin_environmentname), admin_DerivedOwner($select=admin_displayname)"
                        },
                        "authentication": {
                          "type": "Raw",
                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                        }
                      },
                      "runtimeConfiguration": {
                        "paginationPolicy": {
                          "minimumItemCount": 100000
                        }
                      }
                    },
                    "If_count_of_orphans_small_enough_append_to_var_for_card": {
                      "actions": {
                        "Apply_to_each_of_their_apps": {
                          "foreach": "@outputs('List_their_canvas_apps')?['body/value']",
                          "actions": {
                            "Add_app_to_table_-_app_name": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "2855454b-472a-4850-9e4e-a8f7099a71a3"
                              },
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "AppsTableAppNameCol",
                                "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{replace(items('Apply_to_each_of_their_apps')?['admin_displayname'], '\"', '_')}\""
                              }
                            },
                            "Add_app_to_table_-_owner_name": {
                              "runAfter": {
                                "Add_app_to_table_-_app_name": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "7aba4407-1208-4f66-a0a2-53897960aa71"
                              },
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "AppsTableEmployeeNameCol",
                                "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{if(equals(items('Apply_to_each_of_their_apps')?['admin_appownerdisplayname'], null), 'unknown', items('Apply_to_each_of_their_apps')?['admin_appownerdisplayname'])}\""
                              }
                            },
                            "Add_app_to_table_-_last_launched": {
                              "runAfter": {
                                "Add_app_to_table_-_owner_name": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "40a39dc7-54a0-4efc-97ad-08f7ceb877fe"
                              },
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "AppsTableLastLaunchedCol",
                                "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{if(equals(items('Apply_to_each_of_their_apps')?['admin_applastlaunchedon'], null), 'unknown', formatDateTime(items('Apply_to_each_of_their_apps')?['admin_applastlaunchedon'], 'd'))}\""
                              }
                            }
                          },
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "091275a4-3a44-462f-a3d8-95fe9dbd13f7"
                          },
                          "type": "Foreach",
                          "description": "Add to card variables for tabular display"
                        },
                        "Apply_to_each_of_their_flows": {
                          "foreach": "@outputs('List_their_cloud_flows')?['body/value']",
                          "actions": {
                            "Add_flow_to_table_-_flow_name": {
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "df2cc0ad-03e7-4515-a27d-653cad10fe94"
                              },
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "FlowsTableAppNameCol",
                                "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{replace(items('Apply_to_each_of_their_flows')?['admin_displayname'], '\"', '_')}\""
                              }
                            },
                            "Add_flow_to_table_-_owner_name": {
                              "runAfter": {
                                "Add_flow_to_table_-_flow_name": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "96fa7145-e713-4c2e-bfeb-086f367efd25"
                              },
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "FlowsTableEmployeeNameCol",
                                "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{items('Apply_to_each_of_their_flows')?['admin_derivedowner/admin_displayname']}\""
                              }
                            },
                            "Add_flow_to_table_-_status": {
                              "runAfter": {
                                "Add_flow_to_table_-_owner_name": [
                                  "Succeeded"
                                ]
                              },
                              "metadata": {
                                "operationMetadataId": "60bfe1e0-6198-464c-987d-f663c35cd748"
                              },
                              "type": "AppendToStringVariable",
                              "inputs": {
                                "name": "FlowsTableStatusCol",
                                "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{items('Apply_to_each_of_their_flows')?['admin_flowstate']}\""
                              }
                            }
                          },
                          "runAfter": {
                            "Apply_to_each_of_their_apps": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "34b5ad10-4f63-4af3-bf7f-185efa0ba11b"
                          },
                          "type": "Foreach",
                          "description": "Add to card variables for tabular display"
                        }
                      },
                      "runAfter": {
                        "List_their_cloud_flows": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Add_too_big_note_to_table_-_app_name": {
                            "runAfter": {},
                            "metadata": {
                              "operationMetadataId": "f045564e-7eab-4493-91fa-2cdee1617682"
                            },
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "FlowsTableAppNameCol",
                              "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"too many objects to show\""
                            }
                          },
                          "Add_too_big_note_to_table_-_app_owner_name": {
                            "runAfter": {
                              "Add_too_big_note_to_table_-_app_name": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "8001dc97-539c-42f3-ad07-ba0a67b77864"
                            },
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "AppsTableEmployeeNameCol",
                              "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \" \""
                            }
                          },
                          "Add_too_big_note_to_table_-_app_last_launched": {
                            "runAfter": {
                              "Add_too_big_note_to_table_-_app_owner_name": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "2d94af83-59cd-489e-80e0-542caee98d8a"
                            },
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "AppsTableLastLaunchedCol",
                              "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"  \""
                            }
                          },
                          "Add_too_big_note_to_table_-_flow_name": {
                            "runAfter": {
                              "Add_too_big_note_to_table_-_app_last_launched": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "a4ee4536-2c13-46ea-8960-75a284cd3016"
                            },
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "FlowsTableAppNameCol",
                              "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \" \""
                            }
                          },
                          "Add_too_big_note_to_table_-_flow_owner_name": {
                            "runAfter": {
                              "Add_too_big_note_to_table_-_flow_name": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "1c618bd8-fc38-40c6-9cb9-97be95e43b45"
                            },
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "FlowsTableEmployeeNameCol",
                              "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"  \""
                            }
                          },
                          "Add_too_big_note_to_table_-_flow_status": {
                            "runAfter": {
                              "Add_too_big_note_to_table_-_flow_owner_name": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "c2f442c1-6c22-49b2-9771-908d7d9d3c6d"
                            },
                            "type": "AppendToStringVariable",
                            "inputs": {
                              "name": "FlowsTableStatusCol",
                              "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"  \""
                            }
                          }
                        }
                      },
                      "expression": {
                        "less": [
                          "@add(length(outputs('List_their_cloud_flows')?['body/value']), length(outputs('List_their_canvas_apps')?['body/value']))",
                          30
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "1dc08f3c-5a96-4908-ac77-0415fa1057c7"
                      },
                      "type": "If"
                    },
                    "Add_apps_to_array": {
                      "foreach": "@outputs('List_their_canvas_apps')?['body/value']",
                      "actions": {
                        "Append_to_OrphanedApps": {
                          "runAfter": {
                            "Create_Orphaned_Object_-_app": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "11cc86a8-9047-48e5-9e7b-cf1256cb0064"
                          },
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "OrphanedApps",
                            "value": "@variables('OrphanedObject')"
                          }
                        },
                        "Create_Orphaned_Object_-_app": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "c69bcf69-3175-4564-b854-432f469dc3f0"
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "OrphanedObject",
                            "value": {
                              "LastModified": "@if(equals(items('Add_apps_to_array')?['admin_appmodifiedon'], null), 'unknown', formatDateTime(items('Add_apps_to_array')?['admin_appmodifiedon'], 'd'))",
                              "LastLaunched": "@if(equals(items('Add_apps_to_array')?['admin_applastlaunchedon'], null), 'unknown', formatDateTime(items('Add_apps_to_array')?['admin_applastlaunchedon'], 'd'))",
                              "OwnerDisplayName": "@items('Add_apps_to_array')?['admin_appownerdisplayname']",
                              "AppDisplayName": "@items('Add_apps_to_array')?['admin_displayname']",
                              "EnvtDisplayName": "@items('Add_apps_to_array')?['admin_appenvironmentdisplayname']",
                              "AppID": "@items('Add_apps_to_array')?['admin_appid']",
                              "EnvtName": "@items('Add_apps_to_array')?['admin_appenvironment/admin_environmentname']"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "If_count_of_orphans_small_enough_append_to_var_for_card": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "794b4c0b-46fe-4a9b-8d9b-e070a46bf8c5"
                      },
                      "type": "Foreach"
                    },
                    "Add_flows_to_array": {
                      "foreach": "@outputs('List_their_cloud_flows')?['body/value']",
                      "actions": {
                        "Append_to_OrphanedFlows": {
                          "runAfter": {
                            "Create_Orphaned_Object_-_flow": [
                              "Succeeded"
                            ]
                          },
                          "metadata": {
                            "operationMetadataId": "1b8ee033-34bb-469a-a25e-6ca41ef1b228"
                          },
                          "type": "AppendToArrayVariable",
                          "inputs": {
                            "name": "OrphanedFlows",
                            "value": "@variables('OrphanedObject')"
                          }
                        },
                        "Create_Orphaned_Object_-_flow": {
                          "runAfter": {},
                          "metadata": {
                            "operationMetadataId": "15bfc224-bd67-4612-8ca0-2d36795aa893"
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "OrphanedObject",
                            "value": {
                              "LastModified": "@if(equals(items('Add_flows_to_array')?['admin_flowmodifiedon'], null), 'unknown', formatDateTime(items('Add_flows_to_array')?['admin_flowmodifiedon'], 'd'))",
                              "FlowState": "@items('Add_flows_to_array')?['admin_flowstate']",
                              "OwnerDisplayName": "@items('Add_flows_to_array')?['admin_derivedowner/admin_displayname']",
                              "FlowDisplayName": "@items('Add_flows_to_array')?['admin_displayname']",
                              "EnvtDisplayName": "@items('Add_flows_to_array')?['admin_flowenvironmentdisplayname']",
                              "FlowID": "@items('Add_flows_to_array')?['admin_flowid']",
                              "EnvtName": "@items('Add_flows_to_array')?['admin_flowenvironment/admin_environmentname']",
                              "isSolnFlow": "@if(equals(items('Add_flows_to_array')?['admin_workflowentityid'], null), false, true)"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Add_apps_to_array": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "225e6e76-0268-4d26-829e-1099cb8d15b9"
                      },
                      "type": "Foreach"
                    }
                  },
                  "runAfter": {
                    "List_managers_orphaned_employees": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "29b7e9c3-0d39-478d-816f-1589be8852b9"
                  },
                  "type": "Foreach"
                },
                "Parse_Orphaned_Apps": {
                  "runAfter": {
                    "Compose_2": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "1168a796-b2a3-45cc-bcbe-cc681c54a4b4"
                  },
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@variables('OrphanedApps')",
                    "schema": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "LastModified": {
                            "anyOf": [
                              {
                                "type": "string"
                              },
                              {
                                "type": "null"
                              }
                            ]
                          },
                          "LastLaunched": {
                            "anyOf": [
                              {
                                "type": "string"
                              },
                              {
                                "type": "null"
                              }
                            ]
                          },
                          "OwnerDisplayName": {
                            "anyOf": [
                              {
                                "type": "string"
                              },
                              {
                                "type": "null"
                              }
                            ]
                          },
                          "AppDisplayName": {
                            "anyOf": [
                              {
                                "type": "string"
                              },
                              {
                                "type": "null"
                              }
                            ]
                          },
                          "EnvtDisplayName": {
                            "anyOf": [
                              {
                                "type": "string"
                              },
                              {
                                "type": "null"
                              }
                            ]
                          },
                          "AppID": {
                            "type": "string"
                          },
                          "EnvtName": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "LastModified",
                          "LastLaunched",
                          "OwnerDisplayName",
                          "AppDisplayName",
                          "EnvtDisplayName",
                          "AppID",
                          "EnvtName"
                        ]
                      }
                    }
                  }
                },
                "Parse_Orphaned_Flows": {
                  "runAfter": {
                    "Parse_Orphaned_Apps": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "dbaf3bec-eeb7-421d-b75e-362185f596ec"
                  },
                  "type": "ParseJson",
                  "inputs": {
                    "content": "@variables('OrphanedFlows')",
                    "schema": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "LastModified": {
                            "anyOf": [
                              {
                                "type": "string"
                              },
                              {
                                "type": "null"
                              }
                            ]
                          },
                          "FlowState": {
                            "anyOf": [
                              {
                                "type": "string"
                              },
                              {
                                "type": "null"
                              }
                            ]
                          },
                          "OwnerDisplayName": {
                            "anyOf": [
                              {
                                "type": "string"
                              },
                              {
                                "type": "null"
                              }
                            ]
                          },
                          "FlowDisplayName": {
                            "anyOf": [
                              {
                                "type": "string"
                              },
                              {
                                "type": "null"
                              }
                            ]
                          },
                          "EnvtDisplayName": {
                            "anyOf": [
                              {
                                "type": "string"
                              },
                              {
                                "type": "null"
                              }
                            ]
                          },
                          "FlowID": {
                            "type": "string"
                          },
                          "EnvtName": {
                            "type": "string"
                          },
                          "isSolnFlow": {
                            "type": "boolean"
                          }
                        },
                        "required": [
                          "LastModified",
                          "FlowState",
                          "OwnerDisplayName",
                          "FlowDisplayName",
                          "EnvtDisplayName",
                          "FlowID",
                          "EnvtName",
                          "isSolnFlow"
                        ]
                      }
                    }
                  }
                },
                "Compose_2": {
                  "runAfter": {
                    "Apply_to_each_orphaned_employee": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "949e891f-9e13-4b4e-84ff-7794c7af549b"
                  },
                  "type": "Compose",
                  "inputs": "@variables('OrphanedFlows')"
                }
              },
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "93b58c7d-ec45-4d8d-a43c-6c92685a4c06"
              },
              "type": "Scope"
            },
            "Prepare_HTML_Table_for_Emails_if_needed": {
              "actions": {
                "Apps_List_For_Email": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "6596e623-a3c3-452f-8d53-81ab6d71040b"
                  },
                  "type": "Select",
                  "inputs": {
                    "from": "@body('Parse_Orphaned_Apps')",
                    "select": {
                      "Environment": "@item()['EnvtDisplayName']",
                      "    ": "    ",
                      "App": "@item()['AppDisplayName']",
                      "   ": "    ",
                      "Owner": "@item()['OwnerDisplayName']",
                      "     ": "    ",
                      "Last Launched": "@item()['LastLaunched']",
                      "  ": "    ",
                      "Last Modified": "@item()['LastModified']"
                    }
                  }
                },
                "Create_HTML_table_OrphanedApps": {
                  "runAfter": {
                    "Apps_List_For_Email": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "2d865015-0bdd-4ee3-b3d4-c55cb6bb5a9d"
                  },
                  "type": "Table",
                  "inputs": {
                    "from": "@body('Apps_List_For_Email')",
                    "format": "HTML"
                  }
                },
                "Flows_List_For_Email": {
                  "runAfter": {
                    "Create_HTML_table_OrphanedApps": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "cd11bb54-8958-4a50-a9e8-2476c73b550b"
                  },
                  "type": "Select",
                  "inputs": {
                    "from": "@body('Parse_Orphaned_Flows')",
                    "select": {
                      "Environment": "@item()['EnvtDisplayName']",
                      "    ": "    ",
                      "Flow": "@item()['FlowDisplayName']",
                      "   ": "    ",
                      "Owner": "@item()['OwnerDisplayName']",
                      "     ": "    ",
                      "State": "@item()['FlowState']",
                      "  ": "    ",
                      "Last Modified": "@item()['LastModified']"
                    }
                  }
                },
                "Create_HTML_table_OrphanedFlows": {
                  "runAfter": {
                    "Flows_List_For_Email": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "eca9bdb6-3150-4fdc-832a-fdb27456f1e3"
                  },
                  "type": "Table",
                  "inputs": {
                    "from": "@body('Flows_List_For_Email')",
                    "format": "HTML"
                  }
                }
              },
              "runAfter": {
                "Get_Orphaned_Objects_for_this_Manager": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "a689baa7-cf28-4372-9478-0bf3d43ec67f"
              },
              "type": "Scope"
            },
            "Create_Adaptive_Card_with_all_orphans": {
              "actions": {
                "Append_end_to_theCard": {
                  "runAfter": {
                    "Append_action_section_to_theCard": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "825a22a0-6e07-4ea0-b095-20fbd10cf7cb"
                  },
                  "type": "AppendToStringVariable",
                  "inputs": {
                    "name": "theCard",
                    "value": "            ]\n        }\n    ]\n}"
                  }
                },
                "Append_app_records_to_theCard": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "103b1f77-5c58-4f62-9f41-5f4c7e020ffe"
                  },
                  "type": "AppendToStringVariable",
                  "inputs": {
                    "name": "theCard",
                    "value": "@{variables('AppsTableAppNameCol')}@{variables('AppsTableEmployeeNameCol')}@{variables('AppsTableLastLaunchedCol')}"
                  }
                },
                "Append_action_section_to_theCard": {
                  "runAfter": {
                    "Append_flow_records_to_theCard": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "92657404-86fd-42b3-8886-6ab25ec2550e"
                  },
                  "type": "AppendToStringVariable",
                  "inputs": {
                    "name": "theCard",
                    "value": "    }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ActionSet\",\n    \"actions\": [\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Take Ownership\",\n            \"style\": \"positive\",\n            \"id\": \"TakeOwnership\"\n        },\n        {\n            \"title\": \"Delete All\",\n            \"type\": \"Action.Submit\",\n            \"id\": \"DeleteAll\"\n        },\n     {\n            \"title\": \"Assign Ownership\",\n            \"type\": \"Action.ShowCard\",\n            \"id\": \"AssignAll\",\n            \"card\":{\n                 \"type\": \"AdaptiveCard\",\n                 \"body\": [\n                            {\n                             \"type\": \"Input.Text\",\n                             \"id\": \"toWhom\",\n                             \"placeholder\": \"AssignToWhom@example.com\",\n                             \"style\": \"Email\",\n                             \"spacing\": \"None\"\n                           }\n                         ],\n                  \"actions\":[\n                         {\n                            \"type\": \"Action.Submit\",\n                            \"id\": \"AssignAllDone\",\n                            \"title\": \"Assign Now\"\n                         }\n                       ],\n                   \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\"\n              }\n        },\n        {\n            \"title\": \"Email Me\",\n            \"type\": \"Action.Submit\",\n            \"id\": \"EmailMe\"\n        },\n        {\n            \"title\": \"See Each\",\n            \"type\": \"Action.Submit\",\n            \"id\": \"SeeEach\"\n        }\n"
                  }
                },
                "Append_flow_table_start_to_theCard": {
                  "runAfter": {
                    "Append_app_records_to_theCard": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "e7eac758-19d3-4e06-8cd6-98037777df14"
                  },
                  "type": "AppendToStringVariable",
                  "inputs": {
                    "name": "theCard",
                    "value": "    }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {"
                  }
                },
                "Append_flow_records_to_theCard": {
                  "runAfter": {
                    "Append_flow_table_start_to_theCard": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "d6ed5b9b-d07b-4a95-aef7-f79e5712d903"
                  },
                  "type": "AppendToStringVariable",
                  "inputs": {
                    "name": "theCard",
                    "value": "@{variables('FlowsTableAppNameCol')}@{variables('FlowsTableEmployeeNameCol')}@{variables('FlowsTableStatusCol')}"
                  }
                },
                "the_card_content": {
                  "runAfter": {
                    "Append_end_to_theCard": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "d00aa5b3-a50c-41ee-acfb-389ad87488d0"
                  },
                  "type": "Compose",
                  "inputs": "@variables('theCard')"
                }
              },
              "runAfter": {
                "Prepare_HTML_Table_for_Emails_if_needed": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "2aeb9439-ffbe-41d1-96d4-53e21d71f8cc"
              },
              "type": "Scope",
              "description": "append the tabular columns, the mid section, and the actions"
            },
            "Send_Table_For_Response": {
              "runAfter": {
                "Create_Adaptive_Card_with_all_orphans": [
                  "Succeeded"
                ]
              },
              "limit": {
                "timeout": "P7D"
              },
              "metadata": {
                "operationMetadataId": "562c47c6-58a7-48d4-baba-3d93b0ffdc8d"
              },
              "type": "OpenApiConnectionWebhook",
              "inputs": {
                "host": {
                  "connectionName": "shared_teams",
                  "operationId": "SubscribeUserFlowContinuation",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                },
                "parameters": {
                  "UserFlowContinuationSubscriptionRequest/body/recipient/to": "@{outputs('SendTo')};",
                  "UserFlowContinuationSubscriptionRequest/body/messageBody": "@variables('theCard')",
                  "UserFlowContinuationSubscriptionRequest/body/updateMessage": "Trying that now...",
                  "UserFlowContinuationSubscriptionRequest/body/shouldUpdateCard": true,
                  "UserFlowContinuationSubscriptionRequest/body/recipient/isAlert": true
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                },
                "retryPolicy": {
                  "type": "exponential",
                  "count": 10,
                  "interval": "PT10S"
                }
              }
            },
            "Set_timeOut_true_if_timed_out": {
              "runAfter": {
                "Send_Table_For_Response": [
                  "Failed",
                  "TimedOut"
                ]
              },
              "metadata": {
                "operationMetadataId": "52eeb1ca-01b9-46d2-a6ba-1e850c8bd19f"
              },
              "type": "SetVariable",
              "inputs": {
                "name": "timedOutOrFailed",
                "value": "@true"
              }
            },
            "If_not_timed_out": {
              "actions": {
                "Switch": {
                  "runAfter": {},
                  "cases": {
                    "Case_Take_Ownership": {
                      "case": "TakeOwnership",
                      "actions": {
                        "Assign_Each_App_to_Manager": {
                          "foreach": "@variables('OrphanedApps')",
                          "actions": {
                            "Check_if_reassignment_to_self_worked": {
                              "actions": {
                                "Set_BulkOperationSuccess_to_false_manager": {
                                  "runAfter": {},
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "BulkOperationSuccess",
                                    "value": "@false"
                                  }
                                },
                                "Append_to_appErrors_-_take_ownership": {
                                  "runAfter": {
                                    "Set_BulkOperationSuccess_to_false_manager": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "appErrors",
                                    "value": {
                                      "app": "@items('Assign_Each_App_to_Manager')['AppDisplayName']",
                                      "envt": "@items('Assign_Each_App_to_Manager')['EnvtDisplayName']",
                                      "error": "@body('Reassign_This_One_to_Manager')?['thereturnstring']"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Reassign_This_One_to_Manager": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "not": {
                                  "equals": [
                                    "@body('Reassign_This_One_to_Manager')?['thereturnstring']",
                                    "pass"
                                  ]
                                }
                              },
                              "type": "If"
                            },
                            "Reassign_This_One_to_Manager": {
                              "runAfter": {},
                              "type": "Workflow",
                              "inputs": {
                                "host": {
                                  "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                                },
                                "body": {
                                  "text": "@outputs('Get_managers_id')?['body/id']",
                                  "text_1": "@items('Assign_Each_App_to_Manager')['AppID']",
                                  "text_2": "@items('Assign_Each_App_to_Manager')['EnvtName']",
                                  "text_3": "assign"
                                }
                              }
                            }
                          },
                          "runAfter": {},
                          "type": "Foreach"
                        },
                        "Let_them_know_if_objects_assigned_correctly_to_self": {
                          "actions": {
                            "Success_All_Objects_Assigned_to_Manager": {
                              "runAfter": {},
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_teams",
                                  "operationId": "PostUserNotification",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                },
                                "parameters": {
                                  "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                  "PostNotificationRequest/messageBody": "All objects assigned to @{outputs('Get_managers_id')?['body/displayName']}",
                                  "PostNotificationRequest/messageTitle": "Success!"
                                },
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                },
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 10,
                                  "interval": "PT10S"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Assign_Each_Flow_to_Manager": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Failed_to_Assign_Some_Objects_to_Manager": {
                                "runAfter": {},
                                "type": "OpenApiConnection",
                                "inputs": {
                                  "host": {
                                    "connectionName": "shared_teams",
                                    "operationId": "PostUserNotification",
                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                  },
                                  "parameters": {
                                    "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                    "PostNotificationRequest/messageBody": "Some objects could not be assigned to @{outputs('Get_managers_id')?['body/displayName']}. An email with details will be sent to you. \nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                    "PostNotificationRequest/messageTitle": "Error"
                                  },
                                  "authentication": {
                                    "type": "Raw",
                                    "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                  },
                                  "retryPolicy": {
                                    "type": "exponential",
                                    "count": 10,
                                    "interval": "PT10S"
                                  }
                                }
                              },
                              "Table_-_appErrors_-_take_ownership": {
                                "runAfter": {
                                  "Failed_to_Assign_Some_Objects_to_Manager": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Table",
                                "inputs": {
                                  "from": "@variables('appErrors')",
                                  "format": "HTML"
                                }
                              },
                              "Table_-_flowErrors_-_take_ownership": {
                                "runAfter": {
                                  "Table_-_appErrors_-_take_ownership": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Table",
                                "inputs": {
                                  "from": "@variables('flowErrors')",
                                  "format": "HTML"
                                }
                              },
                              "Get_Row_-_Send_email_list_of_failures_-_take_ownership": {
                                "actions": {
                                  "emailGUID_to_en-US_6": {
                                    "runAfter": {},
                                    "metadata": {
                                      "operationMetadataId": "3c46d691-0f2a-4c36-9611-c2c7de1ec33d"
                                    },
                                    "type": "Compose",
                                    "inputs": "a1c3db41-8a88-ed11-81ac-0022480813ff"
                                  },
                                  "List_emails_for_preferred_language_6": {
                                    "runAfter": {
                                      "emailGUID_to_en-US_6": [
                                        "Succeeded"
                                      ]
                                    },
                                    "metadata": {
                                      "operationMetadataId": "29188a43-3a3a-46da-a4f6-f162180d8254"
                                    },
                                    "type": "OpenApiConnection",
                                    "inputs": {
                                      "host": {
                                        "connectionName": "shared_commondataserviceforapps",
                                        "operationId": "ListRecords",
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                      },
                                      "parameters": {
                                        "entityName": "admin_customizedemails",
                                        "$select": "admin_customizedemailid",
                                        "$filter": "admin_basedon eq '@{outputs('emailGUID_to_en-US_6')}' and admin_language eq '@{outputs('SendToPreferredLanguage')}'"
                                      },
                                      "authentication": {
                                        "type": "Raw",
                                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                      }
                                    }
                                  },
                                  "Set_emailGUID_to_localized_row_6": {
                                    "runAfter": {
                                      "List_emails_for_preferred_language_6": [
                                        "Succeeded"
                                      ]
                                    },
                                    "metadata": {
                                      "operationMetadataId": "1e1c0a09-41a6-4b3d-a558-df89f10ca738"
                                    },
                                    "type": "SetVariable",
                                    "inputs": {
                                      "name": "emailGUID",
                                      "value": "@{if(greater(length(outputs('List_emails_for_preferred_language_6')?['body/value']), 0), first(body('List_emails_for_preferred_language_6')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US_6'))}"
                                    },
                                    "description": "if(greater(length(outputs('List_emails_for_preferred_language')?['body/value']),0), first(body('List_emails_for_preferred_language')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US'))"
                                  },
                                  "Get_a_row_by_ID_6": {
                                    "runAfter": {
                                      "Set_emailGUID_to_localized_row_6": [
                                        "Succeeded"
                                      ]
                                    },
                                    "metadata": {
                                      "operationMetadataId": "c34df6f5-d327-47a2-8e25-e33c207762e2"
                                    },
                                    "type": "OpenApiConnection",
                                    "inputs": {
                                      "host": {
                                        "connectionName": "shared_commondataserviceforapps",
                                        "operationId": "GetItem",
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                      },
                                      "parameters": {
                                        "entityName": "admin_customizedemails",
                                        "recordId": "@variables('emailGUID')",
                                        "$select": "admin_body, admin_cc, admin_replyto, admin_sendonbehalf, admin_subject, admin_importance"
                                      },
                                      "authentication": {
                                        "type": "Raw",
                                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                      }
                                    }
                                  }
                                },
                                "runAfter": {
                                  "Table_-_flowErrors_-_take_ownership": [
                                    "Succeeded"
                                  ]
                                },
                                "metadata": {
                                  "operationMetadataId": "74c8fe2a-d9bd-4ab1-a2a7-1ceffc6c9c18"
                                },
                                "type": "Scope"
                              },
                              "Send_email_list_of_failures_-_take_ownership": {
                                "runAfter": {
                                  "Get_Row_-_Send_email_list_of_failures_-_take_ownership": [
                                    "Succeeded"
                                  ]
                                },
                                "metadata": {
                                  "operationMetadataId": "7c65a863-88c1-43cc-bb02-682c5871952f"
                                },
                                "type": "Workflow",
                                "inputs": {
                                  "host": {
                                    "workflowReferenceName": "5625768c-bd3d-ec11-8c63-00224829720b"
                                  },
                                  "body": {
                                    "email": "@outputs('SendTo')",
                                    "text": "@outputs('Get_a_row_by_ID_6')?['body/admin_subject']",
                                    "text_1": "@{outputs('Get_a_row_by_ID_6')?['body/admin_body']}\n<br>\n<p><u><strong>Apps that failed to have ownership taken</strong></u><br>\n<br>\n@{body('Table_-_appErrors_-_take_ownership')}<br>\n<br>\n<br>\n<u><strong>Flows that failed to have ownership taken<br>\n</strong></u><br>\n@{body('Table_-_flowErrors_-_take_ownership')}<br>\n</p>",
                                    "email_1": "@if(equals(outputs('Get_a_row_by_ID_6')?['body/admin_cc'], null), '', outputs('Get_a_row_by_ID_6')?['body/admin_cc'])",
                                    "email_2": "@if(equals(outputs('Get_a_row_by_ID_6')?['body/admin_sendonbehalf'], null), '', outputs('Get_a_row_by_ID_6')?['body/admin_sendonbehalf'])",
                                    "email_3": "@if(equals(outputs('Get_a_row_by_ID_6')?['body/admin_replyto'], null), '', outputs('Get_a_row_by_ID_6')?['body/admin_replyto'])",
                                    "text_2": "@if(equals(outputs('Get_a_row_by_ID_6')?['body/admin_importance'], null), '', outputs('Get_a_row_by_ID_6')?['body/admin_importance'])"
                                  }
                                }
                              }
                            }
                          },
                          "expression": {
                            "equals": [
                              "@variables('BulkOperationSuccess')",
                              "@true"
                            ]
                          },
                          "type": "If"
                        },
                        "Assign_Each_Flow_to_Manager": {
                          "foreach": "@variables('OrphanedFlows')",
                          "actions": {
                            "Check_if_reassignment_to_self_worked_flows": {
                              "actions": {
                                "Set_BulkOperationSuccess_to_false_manager_flow": {
                                  "runAfter": {},
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "BulkOperationSuccess",
                                    "value": "@false"
                                  }
                                },
                                "Append_to_flowErrors_-_take_ownership": {
                                  "runAfter": {
                                    "Set_BulkOperationSuccess_to_false_manager_flow": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "flowErrors",
                                    "value": {
                                      "flow": "@items('Assign_Each_Flow_to_Manager')['FlowDisplayName']",
                                      "envt": "@items('Assign_Each_Flow_to_Manager')['EnvtDisplayName']",
                                      "error": "@body('Reassign_This_Flow_to_Manager')?['thereturnstring']"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Reassign_This_Flow_to_Manager": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "not": {
                                  "equals": [
                                    "@body('Reassign_This_Flow_to_Manager')?['thereturnstring']",
                                    "pass"
                                  ]
                                }
                              },
                              "type": "If"
                            },
                            "Reassign_This_Flow_to_Manager": {
                              "runAfter": {},
                              "type": "Workflow",
                              "inputs": {
                                "host": {
                                  "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                },
                                "body": {
                                  "text": "@outputs('Get_managers_id')?['body/id']",
                                  "text_1": "@items('Assign_Each_Flow_to_Manager')['FlowID']",
                                  "text_2": "@items('Assign_Each_Flow_to_Manager')['EnvtName']",
                                  "text_3": "assign"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Assign_Each_App_to_Manager": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        }
                      }
                    },
                    "Case_DeleteAll": {
                      "case": "DeleteAll",
                      "actions": {
                        "Delete_Each_Orphaned_App": {
                          "foreach": "@variables('OrphanedApps')",
                          "actions": {
                            "Check_if_delete_worked": {
                              "actions": {
                                "Set_BulkOperationSuccess_to_false": {
                                  "runAfter": {},
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "BulkOperationSuccess",
                                    "value": "@false"
                                  }
                                },
                                "Append_to_appErrors_-_delete": {
                                  "runAfter": {
                                    "Set_BulkOperationSuccess_to_false": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "appErrors",
                                    "value": {
                                      "app": "@items('Delete_Each_Orphaned_App')['AppDisplayName']",
                                      "envt": "@items('Delete_Each_Orphaned_App')['EnvtDisplayName']",
                                      "error": "@body('Delete_App')?['thereturnstring']"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Delete_App": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "not": {
                                  "equals": [
                                    "@body('Delete_App')?['thereturnstring']",
                                    "pass"
                                  ]
                                }
                              },
                              "type": "If"
                            },
                            "Delete_App": {
                              "runAfter": {},
                              "type": "Workflow",
                              "inputs": {
                                "host": {
                                  "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                                },
                                "body": {
                                  "text": "not used",
                                  "text_1": "@items('Delete_Each_Orphaned_App')['AppID']",
                                  "text_2": "@items('Delete_Each_Orphaned_App')['EnvtName']",
                                  "text_3": "delete"
                                }
                              }
                            }
                          },
                          "runAfter": {},
                          "type": "Foreach"
                        },
                        "Let_them_know_if_objects_deleted_correctly": {
                          "actions": {
                            "Success_All_Objects_Deleted": {
                              "runAfter": {},
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_teams",
                                  "operationId": "PostUserNotification",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                },
                                "parameters": {
                                  "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                  "PostNotificationRequest/messageBody": "All objects deleted",
                                  "PostNotificationRequest/messageTitle": "Success!"
                                },
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                },
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 10,
                                  "interval": "PT10S"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Delete_Each_Orphaned_Flow": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "get_only_solution_aware_flows": {
                                "runAfter": {},
                                "type": "Select",
                                "inputs": {
                                  "from": "@body('Parse_Orphaned_Flows')",
                                  "select": {
                                    "@{item()['isSolnFlow']}": "@true"
                                  }
                                }
                              },
                              "Failed_to_Delete_Some_Objects": {
                                "runAfter": {
                                  "get_only_solution_aware_flows": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "OpenApiConnection",
                                "inputs": {
                                  "host": {
                                    "connectionName": "shared_teams",
                                    "operationId": "PostUserNotification",
                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                  },
                                  "parameters": {
                                    "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                    "PostNotificationRequest/messageBody": "Some objects could not be deleted. An email with details will be sent to you. \n\nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                    "PostNotificationRequest/messageTitle": "Error"
                                  },
                                  "authentication": {
                                    "type": "Raw",
                                    "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                  },
                                  "retryPolicy": {
                                    "type": "exponential",
                                    "count": 10,
                                    "interval": "PT10S"
                                  }
                                }
                              },
                              "Table_-_appErrors_-_delete_all": {
                                "runAfter": {
                                  "Failed_to_Delete_Some_Objects": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Table",
                                "inputs": {
                                  "from": "@variables('appErrors')",
                                  "format": "HTML"
                                }
                              },
                              "Table_-_flowErrors_-_delete_all": {
                                "runAfter": {
                                  "Table_-_appErrors_-_delete_all": [
                                    "Succeeded"
                                  ]
                                },
                                "type": "Table",
                                "inputs": {
                                  "from": "@variables('flowErrors')",
                                  "format": "HTML"
                                }
                              },
                              "Get_Row_-_Send_email_list_of_failures_-_delete_all": {
                                "actions": {
                                  "emailGUID_to_en-US_5": {
                                    "runAfter": {},
                                    "metadata": {
                                      "operationMetadataId": "3c46d691-0f2a-4c36-9611-c2c7de1ec33d"
                                    },
                                    "type": "Compose",
                                    "inputs": "76957efe-8988-ed11-81ac-0022480813ff"
                                  },
                                  "List_emails_for_preferred_language_5": {
                                    "runAfter": {
                                      "emailGUID_to_en-US_5": [
                                        "Succeeded"
                                      ]
                                    },
                                    "metadata": {
                                      "operationMetadataId": "29188a43-3a3a-46da-a4f6-f162180d8254"
                                    },
                                    "type": "OpenApiConnection",
                                    "inputs": {
                                      "host": {
                                        "connectionName": "shared_commondataserviceforapps",
                                        "operationId": "ListRecords",
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                      },
                                      "parameters": {
                                        "entityName": "admin_customizedemails",
                                        "$select": "admin_customizedemailid",
                                        "$filter": "admin_basedon eq '@{outputs('emailGUID_to_en-US_5')}' and admin_language eq '@{outputs('SendToPreferredLanguage')}'"
                                      },
                                      "authentication": {
                                        "type": "Raw",
                                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                      }
                                    }
                                  },
                                  "Set_emailGUID_to_localized_row_5": {
                                    "runAfter": {
                                      "List_emails_for_preferred_language_5": [
                                        "Succeeded"
                                      ]
                                    },
                                    "metadata": {
                                      "operationMetadataId": "1e1c0a09-41a6-4b3d-a558-df89f10ca738"
                                    },
                                    "type": "SetVariable",
                                    "inputs": {
                                      "name": "emailGUID",
                                      "value": "@{if(greater(length(outputs('List_emails_for_preferred_language_5')?['body/value']), 0), first(body('List_emails_for_preferred_language_5')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US_5'))}"
                                    },
                                    "description": "if(greater(length(outputs('List_emails_for_preferred_language')?['body/value']),0), first(body('List_emails_for_preferred_language')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US'))"
                                  },
                                  "Get_a_row_by_ID_5": {
                                    "runAfter": {
                                      "Set_emailGUID_to_localized_row_5": [
                                        "Succeeded"
                                      ]
                                    },
                                    "metadata": {
                                      "operationMetadataId": "c34df6f5-d327-47a2-8e25-e33c207762e2"
                                    },
                                    "type": "OpenApiConnection",
                                    "inputs": {
                                      "host": {
                                        "connectionName": "shared_commondataserviceforapps",
                                        "operationId": "GetItem",
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                      },
                                      "parameters": {
                                        "entityName": "admin_customizedemails",
                                        "recordId": "@variables('emailGUID')",
                                        "$select": "admin_body, admin_cc, admin_replyto, admin_sendonbehalf, admin_subject, admin_importance"
                                      },
                                      "authentication": {
                                        "type": "Raw",
                                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                      }
                                    }
                                  }
                                },
                                "runAfter": {
                                  "Table_-_flowErrors_-_delete_all": [
                                    "Succeeded"
                                  ]
                                },
                                "metadata": {
                                  "operationMetadataId": "74c8fe2a-d9bd-4ab1-a2a7-1ceffc6c9c18"
                                },
                                "type": "Scope"
                              },
                              "Send_email_list_of_failures_-_delete_all": {
                                "runAfter": {
                                  "Get_Row_-_Send_email_list_of_failures_-_delete_all": [
                                    "Succeeded"
                                  ]
                                },
                                "metadata": {
                                  "operationMetadataId": "78d31877-7ab8-4665-b78a-61ebca23d22e"
                                },
                                "type": "Workflow",
                                "inputs": {
                                  "host": {
                                    "workflowReferenceName": "5625768c-bd3d-ec11-8c63-00224829720b"
                                  },
                                  "body": {
                                    "email": "@outputs('SendTo')",
                                    "text": "@outputs('Get_a_row_by_ID_5')?['body/admin_subject']",
                                    "text_1": "@{outputs('Get_a_row_by_ID_5')?['body/admin_body']}\n<br>\n<p><u><strong>Apps that failed to delete</strong></u><br>\n<br>\n@{body('Table_-_appErrors_-_delete_all')}<br>\n<br>\n<br>\n<u><strong>Flows that failed to delete<br>\n</strong></u><br>\n@{body('Table_-_flowErrors_-_delete_all')}<br>\n</p>",
                                    "email_1": "@if(equals(outputs('Get_a_row_by_ID_5')?['body/admin_cc'], null), '', outputs('Get_a_row_by_ID_5')?['body/admin_cc'])",
                                    "email_2": "@if(equals(outputs('Get_a_row_by_ID_5')?['body/admin_sendonbehalf'], null), '', outputs('Get_a_row_by_ID_5')?['body/admin_sendonbehalf'])",
                                    "email_3": "@if(equals(outputs('Get_a_row_by_ID_5')?['body/admin_replyto'], null), '', outputs('Get_a_row_by_ID_5')?['body/admin_replyto'])",
                                    "text_2": "@if(equals(outputs('Get_a_row_by_ID_5')?['body/admin_importance'], null), '', outputs('Get_a_row_by_ID_5')?['body/admin_importance'])"
                                  }
                                }
                              }
                            }
                          },
                          "expression": {
                            "equals": [
                              "@variables('BulkOperationSuccess')",
                              "@true"
                            ]
                          },
                          "type": "If"
                        },
                        "Delete_Each_Orphaned_Flow": {
                          "foreach": "@variables('OrphanedFlows')",
                          "actions": {
                            "Delete_Flow": {
                              "runAfter": {},
                              "type": "Workflow",
                              "inputs": {
                                "host": {
                                  "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                },
                                "body": {
                                  "text": "not used",
                                  "text_1": "@items('Delete_Each_Orphaned_Flow')['FlowID']",
                                  "text_2": "@items('Delete_Each_Orphaned_Flow')['EnvtName']",
                                  "text_3": "delete"
                                }
                              }
                            },
                            "Check_if_delete_worked_flow": {
                              "actions": {
                                "Set_BulkOperationSuccess_to_false_flow": {
                                  "runAfter": {},
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "BulkOperationSuccess",
                                    "value": "@false"
                                  }
                                },
                                "Append_to_flowErrors_-_delete": {
                                  "runAfter": {
                                    "Set_BulkOperationSuccess_to_false_flow": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "flowErrors",
                                    "value": {
                                      "flow": "@items('Delete_Each_Orphaned_Flow')['FlowDisplayName']",
                                      "envt": "@items('Delete_Each_Orphaned_Flow')['EnvtDisplayName']",
                                      "error": "@body('Delete_Flow')?['thereturnstring']"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Delete_Flow": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "not": {
                                  "equals": [
                                    "@body('Delete_Flow')?['thereturnstring']",
                                    "pass"
                                  ]
                                }
                              },
                              "type": "If"
                            }
                          },
                          "runAfter": {
                            "Delete_Each_Orphaned_App": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        }
                      }
                    },
                    "Case_Assign_All": {
                      "case": "AssignAllDone",
                      "actions": {
                        "Get_toWhom_profile": {
                          "runAfter": {},
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_office365users",
                              "operationId": "UserProfile_V2",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
                            },
                            "parameters": {
                              "id": "@outputs('Send_Table_For_Response')?['body/data/toWhom']"
                            },
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          }
                        },
                        "Switch_on_toWhom_lookup": {
                          "runAfter": {
                            "Get_toWhom_profile": [
                              "Succeeded",
                              "Failed"
                            ]
                          },
                          "cases": {
                            "200_Success": {
                              "case": 200,
                              "actions": {
                                "Assign_Each_App_to_New_Owner": {
                                  "foreach": "@variables('OrphanedApps')",
                                  "actions": {
                                    "Check_if_reassignment_worked": {
                                      "actions": {
                                        "Set_BulkOperationSuccess_to_false_AssignAllDone": {
                                          "runAfter": {},
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "BulkOperationSuccess",
                                            "value": "@false"
                                          }
                                        },
                                        "Append_to_appErrors_-_assign": {
                                          "runAfter": {
                                            "Set_BulkOperationSuccess_to_false_AssignAllDone": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToArrayVariable",
                                          "inputs": {
                                            "name": "appErrors",
                                            "value": {
                                              "app": "@items('Assign_Each_App_to_New_Owner')['AppDisplayName']",
                                              "envt": "@items('Assign_Each_App_to_New_Owner')['EnvtDisplayName']",
                                              "error": "@body('Reassign_This_One')?['thereturnstring']"
                                            }
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Reassign_This_One": [
                                          "Succeeded"
                                        ]
                                      },
                                      "expression": {
                                        "not": {
                                          "equals": [
                                            "@body('Reassign_This_One')?['thereturnstring']",
                                            "pass"
                                          ]
                                        }
                                      },
                                      "type": "If"
                                    },
                                    "Reassign_This_One": {
                                      "runAfter": {},
                                      "type": "Workflow",
                                      "inputs": {
                                        "host": {
                                          "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                                        },
                                        "body": {
                                          "text": "@outputs('Get_toWhom_profile')?['body/id']",
                                          "text_1": "@items('Assign_Each_App_to_New_Owner')['AppID']",
                                          "text_2": "@items('Assign_Each_App_to_New_Owner')['EnvtName']",
                                          "text_3": "assign"
                                        }
                                      }
                                    }
                                  },
                                  "runAfter": {},
                                  "type": "Foreach"
                                },
                                "Let_them_know_if_objects_assigned_correctly": {
                                  "actions": {
                                    "Success_All_Objects_Assigned": {
                                      "runAfter": {},
                                      "type": "OpenApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connectionName": "shared_teams",
                                          "operationId": "PostUserNotification",
                                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                        },
                                        "parameters": {
                                          "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                          "PostNotificationRequest/messageBody": "All objects assigned to @{outputs('Get_toWhom_profile')?['body/displayName']}",
                                          "PostNotificationRequest/messageTitle": "Success!"
                                        },
                                        "authentication": {
                                          "type": "Raw",
                                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                        },
                                        "retryPolicy": {
                                          "type": "exponential",
                                          "count": 10,
                                          "interval": "PT10S"
                                        }
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Assign_Each_Flow_to_New_Owner": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Failed_to_Assign_Some_Objects": {
                                        "runAfter": {},
                                        "type": "OpenApiConnection",
                                        "inputs": {
                                          "host": {
                                            "connectionName": "shared_teams",
                                            "operationId": "PostUserNotification",
                                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                          },
                                          "parameters": {
                                            "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                            "PostNotificationRequest/messageBody": "Some objects could not be assigned to @{outputs('Get_toWhom_profile')?['body/displayName']}.\nAn email with details will be sent to you. \n\nYou may need to seek help from your admin: \n\n@{parameters('Admin eMail (admin_AdminMail)')}",
                                            "PostNotificationRequest/messageTitle": "Error"
                                          },
                                          "authentication": {
                                            "type": "Raw",
                                            "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                          },
                                          "retryPolicy": {
                                            "type": "exponential",
                                            "count": 10,
                                            "interval": "PT10S"
                                          }
                                        }
                                      },
                                      "Table_-_appErrors_-_assign_all": {
                                        "runAfter": {
                                          "Failed_to_Assign_Some_Objects": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "Table",
                                        "inputs": {
                                          "from": "@variables('appErrors')",
                                          "format": "HTML"
                                        }
                                      },
                                      "Table_-_flowErrors_-_assign_all": {
                                        "runAfter": {
                                          "Table_-_appErrors_-_assign_all": [
                                            "Succeeded"
                                          ]
                                        },
                                        "type": "Table",
                                        "inputs": {
                                          "from": "@variables('flowErrors')",
                                          "format": "HTML"
                                        }
                                      },
                                      "Get_Row_-_Send_email_list_of_failures_-_assign_all": {
                                        "actions": {
                                          "emailGUID_to_en-US_4": {
                                            "runAfter": {},
                                            "metadata": {
                                              "operationMetadataId": "3c46d691-0f2a-4c36-9611-c2c7de1ec33d"
                                            },
                                            "type": "Compose",
                                            "inputs": "62c55684-8988-ed11-81ac-0022480813ff"
                                          },
                                          "List_emails_for_preferred_language_4": {
                                            "runAfter": {
                                              "emailGUID_to_en-US_4": [
                                                "Succeeded"
                                              ]
                                            },
                                            "metadata": {
                                              "operationMetadataId": "29188a43-3a3a-46da-a4f6-f162180d8254"
                                            },
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "host": {
                                                "connectionName": "shared_commondataserviceforapps",
                                                "operationId": "ListRecords",
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                              },
                                              "parameters": {
                                                "entityName": "admin_customizedemails",
                                                "$select": "admin_customizedemailid",
                                                "$filter": "admin_basedon eq '@{outputs('emailGUID_to_en-US_4')}' and admin_language eq '@{outputs('SendToPreferredLanguage')}'"
                                              },
                                              "authentication": {
                                                "type": "Raw",
                                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                              }
                                            }
                                          },
                                          "Set_emailGUID_to_localized_row_4": {
                                            "runAfter": {
                                              "List_emails_for_preferred_language_4": [
                                                "Succeeded"
                                              ]
                                            },
                                            "metadata": {
                                              "operationMetadataId": "1e1c0a09-41a6-4b3d-a558-df89f10ca738"
                                            },
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "emailGUID",
                                              "value": "@{if(greater(length(outputs('List_emails_for_preferred_language_4')?['body/value']), 0), first(body('List_emails_for_preferred_language_4')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US_4'))}"
                                            },
                                            "description": "if(greater(length(outputs('List_emails_for_preferred_language')?['body/value']),0), first(body('List_emails_for_preferred_language')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US'))"
                                          },
                                          "Get_a_row_by_ID_4": {
                                            "runAfter": {
                                              "Set_emailGUID_to_localized_row_4": [
                                                "Succeeded"
                                              ]
                                            },
                                            "metadata": {
                                              "operationMetadataId": "c34df6f5-d327-47a2-8e25-e33c207762e2"
                                            },
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "host": {
                                                "connectionName": "shared_commondataserviceforapps",
                                                "operationId": "GetItem",
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                              },
                                              "parameters": {
                                                "entityName": "admin_customizedemails",
                                                "recordId": "@variables('emailGUID')",
                                                "$select": "admin_body, admin_cc, admin_replyto, admin_sendonbehalf, admin_subject, admin_importance"
                                              },
                                              "authentication": {
                                                "type": "Raw",
                                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                              }
                                            }
                                          }
                                        },
                                        "runAfter": {
                                          "Table_-_flowErrors_-_assign_all": [
                                            "Succeeded"
                                          ]
                                        },
                                        "metadata": {
                                          "operationMetadataId": "74c8fe2a-d9bd-4ab1-a2a7-1ceffc6c9c18"
                                        },
                                        "type": "Scope"
                                      },
                                      "Send_email_list_of_failures_-_assign_all": {
                                        "runAfter": {
                                          "Get_Row_-_Send_email_list_of_failures_-_assign_all": [
                                            "Succeeded"
                                          ]
                                        },
                                        "metadata": {
                                          "operationMetadataId": "3e69d13d-daa6-4a91-85c0-c8636bc60686"
                                        },
                                        "type": "Workflow",
                                        "inputs": {
                                          "host": {
                                            "workflowReferenceName": "5625768c-bd3d-ec11-8c63-00224829720b"
                                          },
                                          "body": {
                                            "email": "@outputs('SendTo')",
                                            "text": "@outputs('Get_a_row_by_ID_4')?['body/admin_subject']",
                                            "text_1": "@{outputs('Get_a_row_by_ID_4')?['body/admin_body']}\n<br>\n<p><u><strong>Apps that failed to have ownership given</strong></u><br>\n<br>\n@{body('Table_-_appErrors_-_assign_all')}<br>\n<br>\n<br>\n<u><strong>Flows that failed to have ownership given<br>\n</strong></u><br>\n@{body('Table_-_flowErrors_-_assign_all')}<br>\n</p>",
                                            "email_1": "@if(equals(outputs('Get_a_row_by_ID_4')?['body/admin_cc'], null), '', outputs('Get_a_row_by_ID_4')?['body/admin_cc'])",
                                            "email_2": "@if(equals(outputs('Get_a_row_by_ID_4')?['body/admin_sendonbehalf'], null), '', outputs('Get_a_row_by_ID_4')?['body/admin_sendonbehalf'])",
                                            "email_3": "@if(equals(outputs('Get_a_row_by_ID_4')?['body/admin_replyto'], null), '', outputs('Get_a_row_by_ID_4')?['body/admin_replyto'])",
                                            "text_2": "@if(equals(outputs('Get_a_row_by_ID_4')?['body/admin_importance'], null), '', outputs('Get_a_row_by_ID_4')?['body/admin_importance'])"
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "equals": [
                                      "@variables('BulkOperationSuccess')",
                                      "@true"
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Assign_Each_Flow_to_New_Owner": {
                                  "foreach": "@variables('OrphanedFlows')",
                                  "actions": {
                                    "Reassign_This_One_Flow": {
                                      "runAfter": {},
                                      "type": "Workflow",
                                      "inputs": {
                                        "host": {
                                          "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                        },
                                        "body": {
                                          "text": "@outputs('Get_toWhom_profile')?['body/id']",
                                          "text_1": "@items('Assign_Each_Flow_to_New_Owner')['FlowID']",
                                          "text_2": "@items('Assign_Each_Flow_to_New_Owner')['EnvtName']",
                                          "text_3": "assign"
                                        }
                                      }
                                    },
                                    "Check_if_reassignment_worked_flow": {
                                      "actions": {
                                        "Set_BulkOperationSuccess_to_false_AssignAllDone_flow": {
                                          "runAfter": {},
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "BulkOperationSuccess",
                                            "value": "@false"
                                          }
                                        },
                                        "Append_to_flowErrors_-_assign": {
                                          "runAfter": {
                                            "Set_BulkOperationSuccess_to_false_AssignAllDone_flow": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToArrayVariable",
                                          "inputs": {
                                            "name": "flowErrors",
                                            "value": {
                                              "flow": "@items('Assign_Each_Flow_to_New_Owner')['FlowDisplayName']",
                                              "envt": "@items('Assign_Each_Flow_to_New_Owner')['EnvtDisplayName']",
                                              "error": "@body('Reassign_This_One_Flow')?['thereturnstring']"
                                            }
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Reassign_This_One_Flow": [
                                          "Succeeded"
                                        ]
                                      },
                                      "expression": {
                                        "not": {
                                          "equals": [
                                            "@body('Reassign_This_One_Flow')?['thereturnstring']",
                                            "pass"
                                          ]
                                        }
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "Assign_Each_App_to_New_Owner": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                }
                              }
                            },
                            "404_Not_Found": {
                              "case": 404,
                              "actions": {
                                "Post_a_message_as_the_Flow_bot_to_a_user_about_Bad_User": {
                                  "runAfter": {},
                                  "type": "OpenApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connectionName": "shared_teams",
                                      "operationId": "PostUserNotification",
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                    },
                                    "parameters": {
                                      "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                      "PostNotificationRequest/messageBody": "The user you entered did not resolve: @{body('Send_Table_For_Response')['toWhom']}\n\nYou will be asked again soon, and please enter a valid email adress for the new owner, in this format: @{triggerBody()['text']}",
                                      "PostNotificationRequest/messageTitle": "User did not resolve."
                                    },
                                    "authentication": {
                                      "type": "Raw",
                                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                    },
                                    "retryPolicy": {
                                      "type": "exponential",
                                      "count": 10,
                                      "interval": "PT10S"
                                    }
                                  }
                                }
                              }
                            }
                          },
                          "default": {
                            "actions": {}
                          },
                          "expression": "@outputs('Get_toWhom_profile')['statusCode']",
                          "type": "Switch"
                        }
                      }
                    },
                    "Case_See_Each": {
                      "case": "SeeEach",
                      "actions": {
                        "Show_Each_App_Separately": {
                          "foreach": "@body('Parse_Orphaned_Apps')",
                          "actions": {
                            "Set_timedOut_if_true": {
                              "runAfter": {
                                "SendAppForResponses": [
                                  "TimedOut",
                                  "Failed"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "timedOutOrFailed",
                                "value": "@true"
                              }
                            },
                            "Reset_TimedOut": {
                              "runAfter": {},
                              "type": "SetVariable",
                              "inputs": {
                                "name": "timedOutOrFailed",
                                "value": "@false"
                              }
                            },
                            "Card_Content": {
                              "runAfter": {
                                "Reset_TimedOut": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Compose",
                              "inputs": {
                                "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
                                "type": "AdaptiveCard",
                                "version": "1.2",
                                "body": [
                                  {
                                    "type": "TextBlock",
                                    "text": "Environment: @{items('Show_Each_App_Separately')['EnvtDisplayName']}",
                                    "wrap": true,
                                    "weight": "Bolder"
                                  },
                                  {
                                    "type": "TextBlock",
                                    "text": "App Name: @{items('Show_Each_App_Separately')['AppDisplayName']}",
                                    "wrap": true,
                                    "weight": "Bolder"
                                  },
                                  {
                                    "type": "TextBlock",
                                    "text": "Previous Owner: @{items('Show_Each_App_Separately')['OwnerDisplayName']}",
                                    "wrap": true,
                                    "weight": "Bolder"
                                  },
                                  {
                                    "type": "TextBlock",
                                    "text": "Last Modified: @{items('Show_Each_App_Separately')['LastModified']}",
                                    "wrap": true,
                                    "weight": "Bolder"
                                  },
                                  {
                                    "type": "TextBlock",
                                    "text": "Last Launched: @{items('Show_Each_App_Separately')['LastLaunched']}",
                                    "wrap": true,
                                    "weight": "Bolder"
                                  },
                                  {
                                    "type": "ActionSet",
                                    "actions": [
                                      {
                                        "type": "Action.Submit",
                                        "title": "Take Ownership",
                                        "style": "positive",
                                        "id": "TakeIt"
                                      },
                                      {
                                        "title": "Delete",
                                        "type": "Action.Submit",
                                        "id": "DeleteIt"
                                      },
                                      {
                                        "title": "Assign Ownership",
                                        "type": "Action.ShowCard",
                                        "id": "AssignIt",
                                        "card": {
                                          "type": "AdaptiveCard",
                                          "body": [
                                            {
                                              "type": "Input.Text",
                                              "id": "toWhom",
                                              "placeholder": "AssignToWhom@example.com",
                                              "style": "Email",
                                              "spacing": "None"
                                            }
                                          ],
                                          "actions": [
                                            {
                                              "type": "Action.Submit",
                                              "id": "AssignItlDone",
                                              "title": "Assign Now"
                                            }
                                          ],
                                          "$schema": "http://adaptivecards.io/schemas/adaptive-card.json"
                                        }
                                      },
                                      {
                                        "title": "Skip",
                                        "type": "Action.Submit",
                                        "id": "SkipIt"
                                      }
                                    ]
                                  }
                                ]
                              }
                            },
                            "If_app_not_timed_out": {
                              "actions": {
                                "Switch_app_submitActionId": {
                                  "runAfter": {},
                                  "cases": {
                                    "TakeIt": {
                                      "case": "TakeIt",
                                      "actions": {
                                        "Let_them_know_if_it_succeeded_-_assign_app_to_manager": {
                                          "actions": {
                                            "Success_App_Assigned_to_Manager": {
                                              "runAfter": {},
                                              "type": "OpenApiConnection",
                                              "inputs": {
                                                "host": {
                                                  "connectionName": "shared_teams",
                                                  "operationId": "PostUserNotification",
                                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                },
                                                "parameters": {
                                                  "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                  "PostNotificationRequest/messageBody": "@{outputs('Get_managers_id')?['body/displayName']} now owns @{items('Show_Each_App_Separately')['AppDisplayName']}",
                                                  "PostNotificationRequest/messageTitle": "Success! "
                                                },
                                                "authentication": {
                                                  "type": "Raw",
                                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                },
                                                "retryPolicy": {
                                                  "type": "exponential",
                                                  "count": 10,
                                                  "interval": "PT10S"
                                                }
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "Assign_App_to_Manager": [
                                              "Succeeded"
                                            ]
                                          },
                                          "else": {
                                            "actions": {
                                              "Failed_to_Assign_App_to_Manager": {
                                                "runAfter": {},
                                                "type": "OpenApiConnection",
                                                "inputs": {
                                                  "host": {
                                                    "connectionName": "shared_teams",
                                                    "operationId": "PostUserNotification",
                                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                  },
                                                  "parameters": {
                                                    "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                    "PostNotificationRequest/messageBody": "@{items('Show_Each_App_Separately')['AppDisplayName']} could not be assigned to @{outputs('Get_managers_id')?['body/displayName']}.\n\nHere is the error message received from the product:\n\n@{body('Assign_App_to_Manager')?['thereturnstring']}\n\nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                    "PostNotificationRequest/messageTitle": "Error"
                                                  },
                                                  "authentication": {
                                                    "type": "Raw",
                                                    "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                  },
                                                  "retryPolicy": {
                                                    "type": "exponential",
                                                    "count": 10,
                                                    "interval": "PT10S"
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "equals": [
                                              "@body('Assign_App_to_Manager')?['thereturnstring']",
                                              "pass"
                                            ]
                                          },
                                          "type": "If"
                                        },
                                        "Assign_App_to_Manager": {
                                          "runAfter": {},
                                          "type": "Workflow",
                                          "inputs": {
                                            "host": {
                                              "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                                            },
                                            "body": {
                                              "text": "@outputs('Get_managers_id')?['body/id']",
                                              "text_1": "@items('Show_Each_App_Separately')['AppID']",
                                              "text_2": "@items('Show_Each_App_Separately')['EnvtName']",
                                              "text_3": "assign"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "DeleteIt": {
                                      "case": "DeleteIt",
                                      "actions": {
                                        "Let_them_know_if_it_succeeded_-_delete_this_app": {
                                          "actions": {
                                            "Success_Delete_App": {
                                              "runAfter": {},
                                              "type": "OpenApiConnection",
                                              "inputs": {
                                                "host": {
                                                  "connectionName": "shared_teams",
                                                  "operationId": "PostUserNotification",
                                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                },
                                                "parameters": {
                                                  "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                  "PostNotificationRequest/messageBody": "@{items('Show_Each_App_Separately')['AppDisplayName']} deleted",
                                                  "PostNotificationRequest/messageTitle": "Success!"
                                                },
                                                "authentication": {
                                                  "type": "Raw",
                                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                },
                                                "retryPolicy": {
                                                  "type": "exponential",
                                                  "count": 10,
                                                  "interval": "PT10S"
                                                }
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "Delete_This_App": [
                                              "Succeeded"
                                            ]
                                          },
                                          "else": {
                                            "actions": {
                                              "Failed_Delete_App": {
                                                "runAfter": {},
                                                "type": "OpenApiConnection",
                                                "inputs": {
                                                  "host": {
                                                    "connectionName": "shared_teams",
                                                    "operationId": "PostUserNotification",
                                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                  },
                                                  "parameters": {
                                                    "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                    "PostNotificationRequest/messageBody": "Could not delete @{items('Show_Each_App_Separately')['AppDisplayName']}.\n\nHere is the error message received from the product:\n\n@{body('Delete_This_App')?['thereturnstring']}\n\n\nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                    "PostNotificationRequest/messageTitle": "Error"
                                                  },
                                                  "authentication": {
                                                    "type": "Raw",
                                                    "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                  },
                                                  "retryPolicy": {
                                                    "type": "exponential",
                                                    "count": 10,
                                                    "interval": "PT10S"
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "equals": [
                                              "@body('Delete_This_App')?['thereturnstring']",
                                              "pass"
                                            ]
                                          },
                                          "type": "If"
                                        },
                                        "Delete_This_App": {
                                          "runAfter": {},
                                          "type": "Workflow",
                                          "inputs": {
                                            "host": {
                                              "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                                            },
                                            "body": {
                                              "text": "Not Used",
                                              "text_1": "@items('Show_Each_App_Separately')['AppID']",
                                              "text_2": "@items('Show_Each_App_Separately')['EnvtName']",
                                              "text_3": "delete"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "AssignItlDone": {
                                      "case": "AssignItlDone",
                                      "actions": {
                                        "Get_toWhom_profile_-_app": {
                                          "runAfter": {},
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "host": {
                                              "connectionName": "shared_office365users",
                                              "operationId": "UserProfile_V2",
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
                                            },
                                            "parameters": {
                                              "id": "@outputs('SendAppForResponses')?['body/data/toWhom']"
                                            },
                                            "authentication": {
                                              "type": "Raw",
                                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                            },
                                            "retryPolicy": {
                                              "type": "exponential",
                                              "count": 10,
                                              "interval": "PT10S"
                                            }
                                          }
                                        },
                                        "Switch_on_toWhom_lookup_-_app": {
                                          "runAfter": {
                                            "Get_toWhom_profile_-_app": [
                                              "Succeeded",
                                              "Failed"
                                            ]
                                          },
                                          "cases": {
                                            "200_Success": {
                                              "case": 200,
                                              "actions": {
                                                "Let_them_know_if_it_succeeded_-_assign_app_toWhom": {
                                                  "actions": {
                                                    "Success_App_Assigned_toWhom": {
                                                      "runAfter": {},
                                                      "type": "OpenApiConnection",
                                                      "inputs": {
                                                        "host": {
                                                          "connectionName": "shared_teams",
                                                          "operationId": "PostUserNotification",
                                                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                        },
                                                        "parameters": {
                                                          "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                          "PostNotificationRequest/messageBody": "@{outputs('Get_toWhom_profile_-_app')?['body/displayName']} now owns @{items('Show_Each_App_Separately')['AppDisplayName']}",
                                                          "PostNotificationRequest/messageTitle": "Success!"
                                                        },
                                                        "authentication": {
                                                          "type": "Raw",
                                                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                        },
                                                        "retryPolicy": {
                                                          "type": "exponential",
                                                          "count": 10,
                                                          "interval": "PT10S"
                                                        }
                                                      }
                                                    }
                                                  },
                                                  "runAfter": {
                                                    "Assign_App_toWhom": [
                                                      "Succeeded"
                                                    ]
                                                  },
                                                  "else": {
                                                    "actions": {
                                                      "Failed_to_Assign_App_toWhom": {
                                                        "runAfter": {},
                                                        "type": "OpenApiConnection",
                                                        "inputs": {
                                                          "host": {
                                                            "connectionName": "shared_teams",
                                                            "operationId": "PostUserNotification",
                                                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                          },
                                                          "parameters": {
                                                            "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                            "PostNotificationRequest/messageBody": "@{items('Show_Each_App_Separately')['AppDisplayName']} could not be assigned to @{outputs('Get_toWhom_profile_-_app')?['body/displayName']}.\n\nHere is the error message received from the product:\n\n@{body('Assign_App_toWhom')?['thereturnstring']}\n\n\nYou may need to seek help from your admin: \n\n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                            "PostNotificationRequest/messageTitle": "Error"
                                                          },
                                                          "authentication": {
                                                            "type": "Raw",
                                                            "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                          },
                                                          "retryPolicy": {
                                                            "type": "exponential",
                                                            "count": 10,
                                                            "interval": "PT10S"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  "expression": {
                                                    "equals": [
                                                      "@body('Assign_App_toWhom')?['thereturnstring']",
                                                      "pass"
                                                    ]
                                                  },
                                                  "type": "If"
                                                },
                                                "Assign_App_toWhom": {
                                                  "runAfter": {},
                                                  "type": "Workflow",
                                                  "inputs": {
                                                    "host": {
                                                      "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                                                    },
                                                    "body": {
                                                      "text": "@outputs('Get_toWhom_profile_-_app')?['body/id']",
                                                      "text_1": "@items('Show_Each_App_Separately')['AppID']",
                                                      "text_2": "@items('Show_Each_App_Separately')['EnvtName']",
                                                      "text_3": "assign"
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "404_Not_Found": {
                                              "case": 404,
                                              "actions": {
                                                "Post_a_message_as_the_Flow_bot_to_a_user_about_Bad_User_-_app": {
                                                  "runAfter": {},
                                                  "type": "OpenApiConnection",
                                                  "inputs": {
                                                    "host": {
                                                      "connectionName": "shared_teams",
                                                      "operationId": "PostUserNotification",
                                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                    },
                                                    "parameters": {
                                                      "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                      "PostNotificationRequest/messageBody": "The user you entered did not resolve: @{outputs('SendAppForResponses')?['body/data/toWhom']}\n\nYou will be asked again soon, and please enter a valid email adress for the new owner, in this format: @{triggerBody()['text']}",
                                                      "PostNotificationRequest/messageTitle": "User did not resolve"
                                                    },
                                                    "authentication": {
                                                      "type": "Raw",
                                                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                    },
                                                    "retryPolicy": {
                                                      "type": "exponential",
                                                      "count": 10,
                                                      "interval": "PT10S"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          "default": {
                                            "actions": {}
                                          },
                                          "expression": "@outputs('Get_toWhom_profile_-_app')['statusCode']",
                                          "type": "Switch"
                                        }
                                      }
                                    },
                                    "SkipIt": {
                                      "case": "SkipIt",
                                      "actions": {
                                        "Skip_this_one": {
                                          "runAfter": {},
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "host": {
                                              "connectionName": "shared_teams",
                                              "operationId": "PostUserNotification",
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                            },
                                            "parameters": {
                                              "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                              "PostNotificationRequest/messageBody": "Moving to the next one.",
                                              "PostNotificationRequest/messageTitle": "Skipped"
                                            },
                                            "authentication": {
                                              "type": "Raw",
                                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                            },
                                            "retryPolicy": {
                                              "type": "exponential",
                                              "count": 10,
                                              "interval": "PT10S"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "default": {
                                    "actions": {}
                                  },
                                  "expression": "@body('SendAppForResponses')['submitActionId']",
                                  "type": "Switch"
                                }
                              },
                              "runAfter": {
                                "Set_timedOut_if_true": [
                                  "Succeeded",
                                  "Skipped"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Post_a_time_message_as_the_Flow_bot_to_a_user_for_this_app": {
                                    "runAfter": {},
                                    "type": "OpenApiConnection",
                                    "inputs": {
                                      "host": {
                                        "connectionName": "shared_teams",
                                        "operationId": "PostUserNotification",
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                      },
                                      "parameters": {
                                        "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                        "PostNotificationRequest/messageBody": "The above request has timed out or failed, and any responses given will not be recorded.\nYou will be asked again, so please reach out to your admin if you need assistance: @{parameters('Admin eMail (admin_AdminMail)')}\nThank you.",
                                        "PostNotificationRequest/messageTitle": "Request Timed Out or Failed"
                                      },
                                      "authentication": {
                                        "type": "Raw",
                                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                      },
                                      "retryPolicy": {
                                        "type": "exponential",
                                        "count": 10,
                                        "interval": "PT10S"
                                      }
                                    }
                                  }
                                }
                              },
                              "expression": {
                                "equals": [
                                  "@variables('timedOutOrFailed')",
                                  "@false"
                                ]
                              },
                              "type": "If"
                            },
                            "SendAppForResponses": {
                              "runAfter": {
                                "Card_Content": [
                                  "Succeeded"
                                ]
                              },
                              "limit": {
                                "timeout": "PT10M"
                              },
                              "type": "OpenApiConnectionWebhook",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_teams",
                                  "operationId": "SubscribeUserFlowContinuation",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                },
                                "parameters": {
                                  "UserFlowContinuationSubscriptionRequest/body/recipient/to": "@{outputs('SendTo')};",
                                  "UserFlowContinuationSubscriptionRequest/body/messageBody": "@outputs('Card_Content')",
                                  "UserFlowContinuationSubscriptionRequest/body/updateMessage": "Trying that now...",
                                  "UserFlowContinuationSubscriptionRequest/body/shouldUpdateCard": true
                                },
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                },
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 10,
                                  "interval": "PT10S"
                                }
                              }
                            }
                          },
                          "runAfter": {},
                          "type": "Foreach"
                        },
                        "Show_Each_Flow_Separately": {
                          "foreach": "@body('Parse_Orphaned_Flows')",
                          "actions": {
                            "Reset_TimedOut_flow": {
                              "runAfter": {},
                              "type": "SetVariable",
                              "inputs": {
                                "name": "timedOutOrFailed",
                                "value": "@false"
                              }
                            },
                            "Card_Content_flow": {
                              "runAfter": {
                                "Reset_TimedOut_flow": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Compose",
                              "inputs": {
                                "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
                                "type": "AdaptiveCard",
                                "version": "1.2",
                                "body": [
                                  {
                                    "type": "TextBlock",
                                    "text": "Environment: @{items('Show_Each_Flow_Separately')['EnvtDisplayName']}",
                                    "wrap": true,
                                    "weight": "Bolder"
                                  },
                                  {
                                    "type": "TextBlock",
                                    "text": "Flow Name: @{items('Show_Each_Flow_Separately')['FlowDisplayName']}",
                                    "wrap": true,
                                    "weight": "Bolder"
                                  },
                                  {
                                    "type": "TextBlock",
                                    "text": "Previous Owner: @{items('Show_Each_Flow_Separately')['OwnerDisplayName']}",
                                    "wrap": true,
                                    "weight": "Bolder"
                                  },
                                  {
                                    "type": "TextBlock",
                                    "text": "Last Modified: @{items('Show_Each_Flow_Separately')['LastModified']}",
                                    "wrap": true,
                                    "weight": "Bolder"
                                  },
                                  {
                                    "type": "TextBlock",
                                    "text": "Flow State: @{items('Show_Each_Flow_Separately')['FlowState']}",
                                    "wrap": true,
                                    "weight": "Bolder"
                                  },
                                  {
                                    "type": "ActionSet",
                                    "actions": [
                                      {
                                        "type": "Action.Submit",
                                        "title": "Take Ownership",
                                        "style": "positive",
                                        "id": "TakeIt"
                                      },
                                      {
                                        "title": "Delete",
                                        "type": "Action.Submit",
                                        "id": "DeleteIt"
                                      },
                                      {
                                        "title": "Assign Out",
                                        "type": "Action.ShowCard",
                                        "id": "AssignIt",
                                        "card": {
                                          "type": "AdaptiveCard",
                                          "body": [
                                            {
                                              "type": "Input.Text",
                                              "id": "toWhom",
                                              "placeholder": "AssignToWhom@example.com",
                                              "style": "Email",
                                              "spacing": "None"
                                            }
                                          ],
                                          "actions": [
                                            {
                                              "type": "Action.Submit",
                                              "id": "AssignItlDone",
                                              "title": "Assign Now"
                                            }
                                          ],
                                          "$schema": "http://adaptivecards.io/schemas/adaptive-card.json"
                                        }
                                      },
                                      {
                                        "title": "Skip",
                                        "type": "Action.Submit",
                                        "id": "SkipIt"
                                      }
                                    ]
                                  }
                                ]
                              }
                            },
                            "SendAppForResponses_flow": {
                              "runAfter": {
                                "Card_Content_flow": [
                                  "Succeeded"
                                ]
                              },
                              "limit": {
                                "timeout": "PT10M"
                              },
                              "type": "OpenApiConnectionWebhook",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_teams",
                                  "operationId": "SubscribeUserFlowContinuation",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                },
                                "parameters": {
                                  "UserFlowContinuationSubscriptionRequest/body/recipient/to": "@{outputs('SendTo')};",
                                  "UserFlowContinuationSubscriptionRequest/body/messageBody": "@outputs('Card_Content_flow')",
                                  "UserFlowContinuationSubscriptionRequest/body/updateMessage": "Trying that now...",
                                  "UserFlowContinuationSubscriptionRequest/body/shouldUpdateCard": true
                                },
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                },
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 10,
                                  "interval": "PT10S"
                                }
                              }
                            },
                            "Set_timedOut_if_true_flow": {
                              "runAfter": {
                                "SendAppForResponses_flow": [
                                  "TimedOut",
                                  "Failed"
                                ]
                              },
                              "type": "SetVariable",
                              "inputs": {
                                "name": "timedOutOrFailed",
                                "value": "@true"
                              }
                            },
                            "If_app_not_timed_out_flow": {
                              "actions": {
                                "Switch_flow_submitActionId": {
                                  "runAfter": {},
                                  "cases": {
                                    "TakeIt": {
                                      "case": "TakeIt",
                                      "actions": {
                                        "Let_them_know_if_it_succeeded_-_assign_flow_to_manager": {
                                          "actions": {
                                            "Success_Flow_Assigned_to_Manager": {
                                              "runAfter": {},
                                              "type": "OpenApiConnection",
                                              "inputs": {
                                                "host": {
                                                  "connectionName": "shared_teams",
                                                  "operationId": "PostUserNotification",
                                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                },
                                                "parameters": {
                                                  "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                  "PostNotificationRequest/messageBody": "@{outputs('Get_managers_id')?['body/displayName']} now owns @{items('Show_Each_Flow_Separately')['FlowDisplayName']}",
                                                  "PostNotificationRequest/messageTitle": "Success! "
                                                },
                                                "authentication": {
                                                  "type": "Raw",
                                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                },
                                                "retryPolicy": {
                                                  "type": "exponential",
                                                  "count": 10,
                                                  "interval": "PT10S"
                                                }
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "Assign_Flow_to_Manager": [
                                              "Succeeded"
                                            ]
                                          },
                                          "else": {
                                            "actions": {
                                              "Failed_to_Assign_Flow_to_Manager": {
                                                "runAfter": {},
                                                "type": "OpenApiConnection",
                                                "inputs": {
                                                  "host": {
                                                    "connectionName": "shared_teams",
                                                    "operationId": "PostUserNotification",
                                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                  },
                                                  "parameters": {
                                                    "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                    "PostNotificationRequest/messageBody": "@{items('Show_Each_Flow_Separately')['FlowDisplayName']} could not be assigned to @{outputs('Get_managers_id')?['body/displayName']}.\n\nHere is the error message received from the product:\n\n@{body('Assign_Flow_to_Manager')?['thereturnstring']}\n\nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                    "PostNotificationRequest/messageTitle": "Error"
                                                  },
                                                  "authentication": {
                                                    "type": "Raw",
                                                    "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                  },
                                                  "retryPolicy": {
                                                    "type": "exponential",
                                                    "count": 10,
                                                    "interval": "PT10S"
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "equals": [
                                              "@body('Assign_Flow_to_Manager')?['thereturnstring']",
                                              "pass"
                                            ]
                                          },
                                          "type": "If"
                                        },
                                        "Assign_Flow_to_Manager": {
                                          "runAfter": {},
                                          "type": "Workflow",
                                          "inputs": {
                                            "host": {
                                              "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                            },
                                            "body": {
                                              "text": "@outputs('Get_managers_id')?['body/id']",
                                              "text_1": "@items('Show_Each_Flow_Separately')['FlowID']",
                                              "text_2": "@items('Show_Each_Flow_Separately')['EnvtName']",
                                              "text_3": "assign"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "DeleteIt": {
                                      "case": "DeleteIt",
                                      "actions": {
                                        "Let_them_know_if_it_succeeded_-_delete_this_flow": {
                                          "actions": {
                                            "Success_Delete_Flow": {
                                              "runAfter": {},
                                              "type": "OpenApiConnection",
                                              "inputs": {
                                                "host": {
                                                  "connectionName": "shared_teams",
                                                  "operationId": "PostUserNotification",
                                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                },
                                                "parameters": {
                                                  "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                  "PostNotificationRequest/messageBody": "@{items('Show_Each_Flow_Separately')['FlowDisplayName']} deleted",
                                                  "PostNotificationRequest/messageTitle": "Success!"
                                                },
                                                "authentication": {
                                                  "type": "Raw",
                                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                },
                                                "retryPolicy": {
                                                  "type": "exponential",
                                                  "count": 10,
                                                  "interval": "PT10S"
                                                }
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "Delete_This_Flow": [
                                              "Succeeded"
                                            ]
                                          },
                                          "else": {
                                            "actions": {
                                              "Failed_Delete_Flow": {
                                                "runAfter": {},
                                                "type": "OpenApiConnection",
                                                "inputs": {
                                                  "host": {
                                                    "connectionName": "shared_teams",
                                                    "operationId": "PostUserNotification",
                                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                  },
                                                  "parameters": {
                                                    "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                    "PostNotificationRequest/messageBody": "Could not delete @{items('Show_Each_Flow_Separately')['FlowDisplayName']}.\n\nHere is the error message received from the product:\n\n@{body('Delete_This_Flow')?['thereturnstring']}\n\n\nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                    "PostNotificationRequest/messageTitle": "Error"
                                                  },
                                                  "authentication": {
                                                    "type": "Raw",
                                                    "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                  },
                                                  "retryPolicy": {
                                                    "type": "exponential",
                                                    "count": 10,
                                                    "interval": "PT10S"
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "equals": [
                                              "@body('Delete_This_Flow')?['thereturnstring']",
                                              "pass"
                                            ]
                                          },
                                          "type": "If"
                                        },
                                        "Delete_This_Flow": {
                                          "runAfter": {},
                                          "type": "Workflow",
                                          "inputs": {
                                            "host": {
                                              "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                            },
                                            "body": {
                                              "text": "Not Used",
                                              "text_1": "@items('Show_Each_Flow_Separately')['FlowID']",
                                              "text_2": "@items('Show_Each_Flow_Separately')['EnvtName']",
                                              "text_3": "delete"
                                            }
                                          }
                                        }
                                      }
                                    },
                                    "AssignItlDone": {
                                      "case": "AssignItlDone",
                                      "actions": {
                                        "Get_toWhom_profile_-_flow": {
                                          "runAfter": {},
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "host": {
                                              "connectionName": "shared_office365users",
                                              "operationId": "UserProfile_V2",
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
                                            },
                                            "parameters": {
                                              "id": "@outputs('SendAppForResponses_flow')?['body/data/toWhom']"
                                            },
                                            "authentication": {
                                              "type": "Raw",
                                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                            },
                                            "retryPolicy": {
                                              "type": "exponential",
                                              "count": 10,
                                              "interval": "PT10S"
                                            }
                                          }
                                        },
                                        "Switch_on_toWhom_lookup_-_flow": {
                                          "runAfter": {
                                            "Get_toWhom_profile_-_flow": [
                                              "Succeeded",
                                              "Failed"
                                            ]
                                          },
                                          "cases": {
                                            "200_Success": {
                                              "case": 200,
                                              "actions": {
                                                "Let_them_know_if_it_succeeded_-_assign_flow_toWhom": {
                                                  "actions": {
                                                    "Success_Flow_Assigned_toWhom": {
                                                      "runAfter": {},
                                                      "type": "OpenApiConnection",
                                                      "inputs": {
                                                        "host": {
                                                          "connectionName": "shared_teams",
                                                          "operationId": "PostUserNotification",
                                                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                        },
                                                        "parameters": {
                                                          "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                          "PostNotificationRequest/messageBody": "@{outputs('Get_toWhom_profile_-_flow')?['body/displayName']} now owns @{items('Show_Each_Flow_Separately')['FlowDisplayName']}",
                                                          "PostNotificationRequest/messageTitle": "Success!"
                                                        },
                                                        "authentication": {
                                                          "type": "Raw",
                                                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                        },
                                                        "retryPolicy": {
                                                          "type": "exponential",
                                                          "count": 10,
                                                          "interval": "PT10S"
                                                        }
                                                      }
                                                    }
                                                  },
                                                  "runAfter": {
                                                    "Assign_Flow_toWhom": [
                                                      "Succeeded"
                                                    ]
                                                  },
                                                  "else": {
                                                    "actions": {
                                                      "Failed_to_Assign_Flow_toWhom": {
                                                        "runAfter": {},
                                                        "type": "OpenApiConnection",
                                                        "inputs": {
                                                          "host": {
                                                            "connectionName": "shared_teams",
                                                            "operationId": "PostUserNotification",
                                                            "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                          },
                                                          "parameters": {
                                                            "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                            "PostNotificationRequest/messageBody": "@{items('Show_Each_Flow_Separately')['FlowDisplayName']} could not be assigned to @{outputs('Get_toWhom_profile_-_flow')?['body/displayName']}.\n\nHere is the error message received from the product:\n\n@{body('Assign_Flow_toWhom')?['thereturnstring']}\n\n\nYou may need to seek help from your admin: \n\n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                            "PostNotificationRequest/messageTitle": "Error"
                                                          },
                                                          "authentication": {
                                                            "type": "Raw",
                                                            "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                          },
                                                          "retryPolicy": {
                                                            "type": "exponential",
                                                            "count": 10,
                                                            "interval": "PT10S"
                                                          }
                                                        }
                                                      }
                                                    }
                                                  },
                                                  "expression": {
                                                    "equals": [
                                                      "@body('Assign_Flow_toWhom')?['thereturnstring']",
                                                      "pass"
                                                    ]
                                                  },
                                                  "type": "If"
                                                },
                                                "Assign_Flow_toWhom": {
                                                  "runAfter": {},
                                                  "type": "Workflow",
                                                  "inputs": {
                                                    "host": {
                                                      "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                                    },
                                                    "body": {
                                                      "text": "@outputs('Get_toWhom_profile_-_flow')?['body/id']",
                                                      "text_1": "@items('Show_Each_Flow_Separately')['FlowID']",
                                                      "text_2": "@items('Show_Each_Flow_Separately')['EnvtName']",
                                                      "text_3": "assign"
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            "404_Not_Found": {
                                              "case": 404,
                                              "actions": {
                                                "Post_a_message_as_the_Flow_bot_to_a_user_about_Bad_User_-_flow": {
                                                  "runAfter": {},
                                                  "type": "OpenApiConnection",
                                                  "inputs": {
                                                    "host": {
                                                      "connectionName": "shared_teams",
                                                      "operationId": "PostUserNotification",
                                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                    },
                                                    "parameters": {
                                                      "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                                      "PostNotificationRequest/messageBody": "The user you entered did not resolve: @{outputs('SendAppForResponses_flow')?['body/data/toWhom']}\n\nYou will be asked again soon, and please enter a valid email adress for the new owner, in this format: @{triggerBody()['text']}",
                                                      "PostNotificationRequest/messageTitle": "User did not resolve"
                                                    },
                                                    "authentication": {
                                                      "type": "Raw",
                                                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                    },
                                                    "retryPolicy": {
                                                      "type": "exponential",
                                                      "count": 10,
                                                      "interval": "PT10S"
                                                    }
                                                  }
                                                }
                                              }
                                            }
                                          },
                                          "default": {
                                            "actions": {}
                                          },
                                          "expression": "@outputs('Get_toWhom_profile_-_flow')['statusCode']",
                                          "type": "Switch"
                                        }
                                      }
                                    },
                                    "SkipIt": {
                                      "case": "SkipIt",
                                      "actions": {
                                        "Skip_this_flow": {
                                          "runAfter": {},
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "host": {
                                              "connectionName": "shared_teams",
                                              "operationId": "PostUserNotification",
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                            },
                                            "parameters": {
                                              "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                              "PostNotificationRequest/messageBody": "Moving to the next one.",
                                              "PostNotificationRequest/messageTitle": "Skipped"
                                            },
                                            "authentication": {
                                              "type": "Raw",
                                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                            },
                                            "retryPolicy": {
                                              "type": "exponential",
                                              "count": 10,
                                              "interval": "PT10S"
                                            }
                                          }
                                        }
                                      }
                                    }
                                  },
                                  "default": {
                                    "actions": {}
                                  },
                                  "expression": "@body('SendAppForResponses_flow')['submitActionId']",
                                  "type": "Switch"
                                }
                              },
                              "runAfter": {
                                "Set_timedOut_if_true_flow": [
                                  "Succeeded",
                                  "Skipped"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Post_a_time_message_as_the_Flow_bot_to_a_user_for_this_flow": {
                                    "runAfter": {},
                                    "type": "OpenApiConnection",
                                    "inputs": {
                                      "host": {
                                        "connectionName": "shared_teams",
                                        "operationId": "PostUserNotification",
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                      },
                                      "parameters": {
                                        "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                                        "PostNotificationRequest/messageBody": "The above request has timed out or failed, and any responses given will not be recorded.\nYou will be asked again, so please reach out to your admin if you need assistance: @{parameters('Admin eMail (admin_AdminMail)')}\nThank you.",
                                        "PostNotificationRequest/messageTitle": "Request Timed Out or Failed"
                                      },
                                      "authentication": {
                                        "type": "Raw",
                                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                      },
                                      "retryPolicy": {
                                        "type": "exponential",
                                        "count": 10,
                                        "interval": "PT10S"
                                      }
                                    }
                                  }
                                }
                              },
                              "expression": {
                                "equals": [
                                  "@variables('timedOutOrFailed')",
                                  "@false"
                                ]
                              },
                              "type": "If"
                            }
                          },
                          "runAfter": {
                            "Show_Each_App_Separately": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        }
                      }
                    },
                    "Case_EmailMe": {
                      "case": "EmailMe",
                      "actions": {
                        "If_apps_or_flows_exist_for_mail,_send_it": {
                          "actions": {
                            "Send_list_to_manager": {
                              "runAfter": {
                                "Get_Row_-_Send_list_to_manager": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Workflow",
                              "inputs": {
                                "host": {
                                  "workflowReferenceName": "5625768c-bd3d-ec11-8c63-00224829720b"
                                },
                                "body": {
                                  "email": "@outputs('SendTo')",
                                  "text": "@outputs('Get_a_row_by_ID_3')?['body/admin_subject']",
                                  "text_1": "@{outputs('Get_a_row_by_ID_3')?['body/admin_body']}\n<br>\n<u><strong>Apps<br>\n</strong></u>@{body('Create_HTML_table_OrphanedApps')}<u><br>\n</u><u><strong><br>\nFlows<br>\n</strong></u>@{body('Create_HTML_table_OrphanedFlows')}</p>",
                                  "email_1": "@if(equals(outputs('Get_a_row_by_ID_3')?['body/admin_cc'], null), '', outputs('Get_a_row_by_ID_3')?['body/admin_cc'])",
                                  "email_2": "@if(equals(outputs('Get_a_row_by_ID_3')?['body/admin_sendonbehalf'], null), '', outputs('Get_a_row_by_ID_3')?['body/admin_sendonbehalf'])",
                                  "email_3": "@if(equals(outputs('Get_a_row_by_ID_3')?['body/admin_replyto'], null), '', outputs('Get_a_row_by_ID_3')?['body/admin_replyto'])",
                                  "text_2": "@if(equals(outputs('Get_a_row_by_ID_3')?['body/admin_importance'], null), '', outputs('Get_a_row_by_ID_3')?['body/admin_importance'])"
                                }
                              }
                            },
                            "Get_Row_-_Send_list_to_manager": {
                              "actions": {
                                "emailGUID_to_en-US_3": {
                                  "runAfter": {},
                                  "metadata": {
                                    "operationMetadataId": "3c46d691-0f2a-4c36-9611-c2c7de1ec33d"
                                  },
                                  "type": "Compose",
                                  "inputs": "629e7c0d-6186-ed11-81ac-0022480813ff"
                                },
                                "List_emails_for_preferred_language_3": {
                                  "runAfter": {
                                    "emailGUID_to_en-US_3": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "29188a43-3a3a-46da-a4f6-f162180d8254"
                                  },
                                  "type": "OpenApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connectionName": "shared_commondataserviceforapps",
                                      "operationId": "ListRecords",
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                    },
                                    "parameters": {
                                      "entityName": "admin_customizedemails",
                                      "$select": "admin_customizedemailid",
                                      "$filter": "admin_basedon eq '@{outputs('emailGUID_to_en-US_3')}' and admin_language eq '@{outputs('SendToPreferredLanguage')}'"
                                    },
                                    "authentication": {
                                      "type": "Raw",
                                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                    }
                                  }
                                },
                                "Set_emailGUID_to_localized_row_3": {
                                  "runAfter": {
                                    "List_emails_for_preferred_language_3": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "1e1c0a09-41a6-4b3d-a558-df89f10ca738"
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "emailGUID",
                                    "value": "@{if(greater(length(outputs('List_emails_for_preferred_language_3')?['body/value']), 0), first(body('List_emails_for_preferred_language_3')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US_3'))}"
                                  },
                                  "description": "if(greater(length(outputs('List_emails_for_preferred_language')?['body/value']),0), first(body('List_emails_for_preferred_language')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US'))"
                                },
                                "Get_a_row_by_ID_3": {
                                  "runAfter": {
                                    "Set_emailGUID_to_localized_row_3": [
                                      "Succeeded"
                                    ]
                                  },
                                  "metadata": {
                                    "operationMetadataId": "c34df6f5-d327-47a2-8e25-e33c207762e2"
                                  },
                                  "type": "OpenApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connectionName": "shared_commondataserviceforapps",
                                      "operationId": "GetItem",
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                                    },
                                    "parameters": {
                                      "entityName": "admin_customizedemails",
                                      "recordId": "@variables('emailGUID')",
                                      "$select": "admin_body, admin_cc, admin_replyto, admin_sendonbehalf, admin_subject, admin_importance"
                                    },
                                    "authentication": {
                                      "type": "Raw",
                                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                    }
                                  }
                                }
                              },
                              "runAfter": {},
                              "metadata": {
                                "operationMetadataId": "74c8fe2a-d9bd-4ab1-a2a7-1ceffc6c9c18"
                              },
                              "type": "Scope"
                            }
                          },
                          "runAfter": {},
                          "expression": {
                            "or": [
                              {
                                "greater": [
                                  "@length(body('Apps_List_For_Email'))",
                                  0
                                ]
                              },
                              {
                                "greater": [
                                  "@length(body('Flows_List_For_Email'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Tell_manager_email_of_list_was_sent": {
                          "runAfter": {
                            "If_apps_or_flows_exist_for_mail,_send_it": [
                              "Succeeded"
                            ]
                          },
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_teams",
                              "operationId": "PostUserNotification",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                            },
                            "parameters": {
                              "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                              "PostNotificationRequest/messageBody": "Email has been sent",
                              "PostNotificationRequest/messageTitle": "Email Sent"
                            },
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          }
                        }
                      }
                    }
                  },
                  "default": {
                    "actions": {}
                  },
                  "expression": "@body('Send_Table_For_Response')['submitActionId']",
                  "metadata": {
                    "operationMetadataId": "4a734f1a-f56f-40fc-ad44-90646ad19a1c"
                  },
                  "type": "Switch"
                }
              },
              "runAfter": {
                "Set_timeOut_true_if_timed_out": [
                  "Succeeded",
                  "Skipped"
                ]
              },
              "else": {
                "actions": {
                  "Post_a_timeout_message_as_the_Flow_bot_to_a_user": {
                    "runAfter": {},
                    "metadata": {
                      "operationMetadataId": "5941704e-1841-49a1-a257-a4a070a4d0c4"
                    },
                    "type": "OpenApiConnection",
                    "inputs": {
                      "host": {
                        "connectionName": "shared_teams",
                        "operationId": "PostUserNotification",
                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                      },
                      "parameters": {
                        "PostNotificationRequest/recipient/to": "@{outputs('SendTo')};",
                        "PostNotificationRequest/messageBody": "The request to resolve orphaned objechas timed out or failed, and any responses given now will not be recorded.\nYou will be emailed and asked again. Thank you.",
                        "PostNotificationRequest/messageTitle": "Request has timed out or failed",
                        "PostNotificationRequest/recipient/isAlert": false
                      },
                      "authentication": {
                        "type": "Raw",
                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                      },
                      "retryPolicy": {
                        "type": "exponential",
                        "count": 10,
                        "interval": "PT10S"
                      }
                    }
                  },
                  "Set_returnValue_404": {
                    "runAfter": {
                      "Send_mails_about_failure_to_respond": [
                        "Succeeded"
                      ]
                    },
                    "metadata": {
                      "operationMetadataId": "7e72afc5-d178-4952-a55d-c5be981b27a0"
                    },
                    "type": "SetVariable",
                    "inputs": {
                      "name": "returnValue",
                      "value": 404
                    }
                  },
                  "Send_mails_about_failure_to_respond": {
                    "actions": {
                      "Get_Row_-_Send_list_to_manager_-_failed_or_timed_out": {
                        "actions": {
                          "emailGUID_to_en-US_2": {
                            "runAfter": {},
                            "metadata": {
                              "operationMetadataId": "3c46d691-0f2a-4c36-9611-c2c7de1ec33d"
                            },
                            "type": "Compose",
                            "inputs": "8732d7fe-6086-ed11-81ac-0022480813ff"
                          },
                          "List_emails_for_preferred_language_2": {
                            "runAfter": {
                              "emailGUID_to_en-US_2": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "29188a43-3a3a-46da-a4f6-f162180d8254"
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_commondataserviceforapps",
                                "operationId": "ListRecords",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                              },
                              "parameters": {
                                "entityName": "admin_customizedemails",
                                "$select": "admin_customizedemailid",
                                "$filter": "admin_basedon eq '@{outputs('emailGUID_to_en-US_2')}' and admin_language eq '@{outputs('SendToPreferredLanguage')}'"
                              },
                              "authentication": {
                                "type": "Raw",
                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                              }
                            }
                          },
                          "Set_emailGUID_to_localized_row_2": {
                            "runAfter": {
                              "List_emails_for_preferred_language_2": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "1e1c0a09-41a6-4b3d-a558-df89f10ca738"
                            },
                            "type": "SetVariable",
                            "inputs": {
                              "name": "emailGUID",
                              "value": "@{if(greater(length(outputs('List_emails_for_preferred_language_2')?['body/value']), 0), first(body('List_emails_for_preferred_language_2')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US_2'))}"
                            },
                            "description": "if(greater(length(outputs('List_emails_for_preferred_language')?['body/value']),0), first(body('List_emails_for_preferred_language')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US'))"
                          },
                          "Get_a_row_by_ID_2": {
                            "runAfter": {
                              "Set_emailGUID_to_localized_row_2": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "c34df6f5-d327-47a2-8e25-e33c207762e2"
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_commondataserviceforapps",
                                "operationId": "GetItem",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                              },
                              "parameters": {
                                "entityName": "admin_customizedemails",
                                "recordId": "@variables('emailGUID')",
                                "$select": "admin_body, admin_cc, admin_replyto, admin_sendonbehalf, admin_subject, admin_importance"
                              },
                              "authentication": {
                                "type": "Raw",
                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                              }
                            }
                          }
                        },
                        "runAfter": {},
                        "metadata": {
                          "operationMetadataId": "74c8fe2a-d9bd-4ab1-a2a7-1ceffc6c9c18"
                        },
                        "type": "Scope"
                      },
                      "Send_list_to_manager_-_failed_or_timed_out": {
                        "runAfter": {
                          "Get_Row_-_Send_list_to_manager_-_failed_or_timed_out": [
                            "Succeeded"
                          ]
                        },
                        "metadata": {
                          "operationMetadataId": "504cea33-6ca5-4a10-a826-b3fe0f132299"
                        },
                        "type": "Workflow",
                        "inputs": {
                          "host": {
                            "workflowReferenceName": "5625768c-bd3d-ec11-8c63-00224829720b"
                          },
                          "body": {
                            "email": "@outputs('SendTo')",
                            "text": "@outputs('Get_a_row_by_ID_2')?['body/admin_subject']",
                            "text_1": "@{outputs('Get_a_row_by_ID_2')?['body/admin_body']}\nApps\n@{body('Create_HTML_table_OrphanedApps')}\n\nFlows\n@{body('Create_HTML_table_OrphanedFlows')}",
                            "email_1": "@if(equals(outputs('Get_a_row_by_ID_2')?['body/admin_cc'], null), '', outputs('Get_a_row_by_ID_2')?['body/admin_cc'])",
                            "email_2": "@if(equals(outputs('Get_a_row_by_ID_2')?['body/admin_sendonbehalf'], null), '', outputs('Get_a_row_by_ID_2')?['body/admin_sendonbehalf'])",
                            "email_3": "@if(equals(outputs('Get_a_row_by_ID_2')?['body/admin_replyto'], null), '', outputs('Get_a_row_by_ID_2')?['body/admin_replyto'])",
                            "text_2": "@if(equals(outputs('Get_a_row_by_ID_2')?['body/admin_importance'], null), '', outputs('Get_a_row_by_ID_2')?['body/admin_importance'])"
                          }
                        },
                        "description": "8732d7fe-6086-ed11-81ac-0022480813ff"
                      },
                      "Get_Row_-_Send_list_to_admin_-_failed_or_timed_out": {
                        "actions": {
                          "emailGUID_to_en-US": {
                            "runAfter": {},
                            "metadata": {
                              "operationMetadataId": "3c46d691-0f2a-4c36-9611-c2c7de1ec33d"
                            },
                            "type": "Compose",
                            "inputs": "e2902a05-6186-ed11-81ac-0022480813ff"
                          },
                          "List_emails_for_preferred_language": {
                            "runAfter": {
                              "emailGUID_to_en-US": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "29188a43-3a3a-46da-a4f6-f162180d8254"
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_commondataserviceforapps",
                                "operationId": "ListRecords",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                              },
                              "parameters": {
                                "entityName": "admin_customizedemails",
                                "$select": "admin_customizedemailid",
                                "$filter": "admin_basedon eq '@{outputs('emailGUID_to_en-US')}' and admin_language eq '@{parameters('Admin eMail Preferred Language (admin_AdmineMailPreferredLanguage)')}'"
                              },
                              "authentication": {
                                "type": "Raw",
                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                              }
                            }
                          },
                          "Set_emailGUID_to_localized_row": {
                            "runAfter": {
                              "List_emails_for_preferred_language": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "1e1c0a09-41a6-4b3d-a558-df89f10ca738"
                            },
                            "type": "SetVariable",
                            "inputs": {
                              "name": "emailGUID",
                              "value": "@{if(greater(length(outputs('List_emails_for_preferred_language')?['body/value']), 0), first(body('List_emails_for_preferred_language')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US'))}"
                            },
                            "description": "if(greater(length(outputs('List_emails_for_preferred_language')?['body/value']),0), first(body('List_emails_for_preferred_language')?['value'])['admin_customizedemailid'], outputs('emailGUID_to_en-US'))"
                          },
                          "Get_a_row_by_ID": {
                            "runAfter": {
                              "Set_emailGUID_to_localized_row": [
                                "Succeeded"
                              ]
                            },
                            "metadata": {
                              "operationMetadataId": "c34df6f5-d327-47a2-8e25-e33c207762e2"
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_commondataserviceforapps",
                                "operationId": "GetItem",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                              },
                              "parameters": {
                                "entityName": "admin_customizedemails",
                                "recordId": "@variables('emailGUID')",
                                "$select": "admin_body, admin_cc, admin_replyto, admin_sendonbehalf, admin_subject, admin_importance"
                              },
                              "authentication": {
                                "type": "Raw",
                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                              }
                            }
                          }
                        },
                        "runAfter": {
                          "Send_list_to_manager_-_failed_or_timed_out": [
                            "Succeeded"
                          ]
                        },
                        "metadata": {
                          "operationMetadataId": "74c8fe2a-d9bd-4ab1-a2a7-1ceffc6c9c18"
                        },
                        "type": "Scope"
                      },
                      "Send_list_to_admin_-_failed_or_timed_out": {
                        "runAfter": {
                          "Get_Row_-_Send_list_to_admin_-_failed_or_timed_out": [
                            "Succeeded"
                          ]
                        },
                        "metadata": {
                          "operationMetadataId": "504cea33-6ca5-4a10-a826-b3fe0f132299"
                        },
                        "type": "Workflow",
                        "inputs": {
                          "host": {
                            "workflowReferenceName": "5625768c-bd3d-ec11-8c63-00224829720b"
                          },
                          "body": {
                            "email": "@parameters('Admin eMail (admin_AdminMail)')",
                            "text": "@outputs('Get_a_row_by_ID')?['body/admin_subject']",
                            "text_1": "@{outputs('Get_a_row_by_ID')?['body/admin_body']}\n<br>\n<br>\n<u><strong>Manager</strong></u>: @{triggerBody()['text']}<br>\n<u><strong>See run</strong></u>: <a href=\"@{concat(parameters('Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)'), workflow()?['tags']['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])}\">Click here</a><br>\n<br>\n<u><strong>Apps<br>\n</strong></u>@{body('Create_HTML_table_OrphanedApps')}<u><br>\n</u><u><strong><br>\nFlows<br>\n</strong></u>@{body('Create_HTML_table_OrphanedFlows')}</p>",
                            "email_1": "@if(equals(outputs('Get_a_row_by_ID')?['body/admin_cc'], null), '', outputs('Get_a_row_by_ID')?['body/admin_cc'])",
                            "email_2": "@if(equals(outputs('Get_a_row_by_ID')?['body/admin_sendonbehalf'], null), '', outputs('Get_a_row_by_ID')?['body/admin_sendonbehalf'])",
                            "email_3": "@if(equals(outputs('Get_a_row_by_ID')?['body/admin_replyto'], null), '', outputs('Get_a_row_by_ID')?['body/admin_replyto'])",
                            "text_2": "@if(equals(outputs('Get_a_row_by_ID')?['body/admin_importance'], null), '', outputs('Get_a_row_by_ID')?['body/admin_importance'])"
                          }
                        },
                        "description": "e2902a05-6186-ed11-81ac-0022480813ff"
                      }
                    },
                    "runAfter": {
                      "Post_a_timeout_message_as_the_Flow_bot_to_a_user": [
                        "Succeeded",
                        "Failed"
                      ]
                    },
                    "metadata": {
                      "operationMetadataId": "cd2ef044-14a4-428c-b542-0f89949d6537"
                    },
                    "type": "Scope"
                  }
                }
              },
              "expression": {
                "equals": [
                  "@variables('timedOutOrFailed')",
                  "@false"
                ]
              },
              "metadata": {
                "operationMetadataId": "de777216-022f-40af-bdb7-a0fd5035b10b"
              },
              "type": "If"
            },
            "Respond_to_a_PowerApp_or_flow": {
              "runAfter": {
                "If_not_timed_out": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "61e58f23-ee75-4e28-81d3-a9ad38aad914"
              },
              "type": "Response",
              "kind": "PowerApp",
              "inputs": {
                "statusCode": 200,
                "body": {
                  "success": "@variables('returnValue')"
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "title": "Success",
                      "x-ms-dynamically-added": true,
                      "type": "number"
                    }
                  }
                }
              }
            }
          },
          "runAfter": {
            "Initialize_emailGUID": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "aa06e74b-0b1c-49fd-bded-ef48d63df649"
          },
          "type": "Scope"
        },
        "Error_Handling": {
          "actions": {
            "Create_a_new_record_-_Sync_Flow_Errors": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "87961ff0-e261-4890-9ab9-a53f88fe0de5"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "CreateRecord",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_syncflowerrorses",
                  "item/admin_name": "@workflow()?['tags']['flowDisplayName']",
                  "item/admin_flowinstanceurl": "@concat(parameters('Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)'), workflow()?['tags']['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])"
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                },
                "retryPolicy": {
                  "type": "exponential",
                  "count": 10,
                  "interval": "PT10S"
                }
              }
            },
            "Terminate": {
              "runAfter": {
                "Update_Last_Run_Fail": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "9e5a2a18-dba2-47a1-96d5-3356f4348e5a"
              },
              "type": "Terminate",
              "inputs": {
                "runStatus": "Failed",
                "runError": {
                  "code": "500",
                  "message": "Get Environments Failed"
                }
              }
            },
            "Get_ID_Fail": {
              "runAfter": {
                "Create_a_new_record_-_Sync_Flow_Errors": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "47329bf2-8aac-400d-9778-a793b4f1180f"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "$select": "admin_coesolutionmetadataid",
                  "$filter": "admin_objectname eq '@{workflow()?['tags']['flowDisplayName']}'",
                  "$top": 1
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                }
              }
            },
            "Update_Last_Run_Fail": {
              "runAfter": {
                "Get_ID_Fail": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "c63eb7cc-6101-4567-b520-a4a8881264e9"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "UpdateRecord",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "recordId": "@first(outputs('Get_ID_Fail')?['body/value'])?['admin_coesolutionmetadataid']",
                  "item/admin_lastrun": "@utcNow()",
                  "item/admin_lastrunpassed": false
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                }
              }
            }
          },
          "runAfter": {
            "Request_Orphaned_Objects_Reassigned_(Child)_SCOPE": [
              "Failed"
            ]
          },
          "metadata": {
            "operationMetadataId": "38ae684e-622d-42ea-abd2-ee571aee3a5f"
          },
          "type": "Scope"
        },
        "Update_last_run_as_pass": {
          "actions": {
            "Update_Last_Run_Successful": {
              "runAfter": {
                "Get_ID_Pass": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "78ef70e5-7f67-4737-9a02-8533f12caa19"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "UpdateRecord",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "recordId": "@first(outputs('Get_ID_Pass')?['body/value'])?['admin_coesolutionmetadataid']",
                  "item/admin_lastrun": "@utcNow()",
                  "item/admin_lastrunpassed": true
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                }
              }
            },
            "Get_ID_Pass": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "f4f314b6-89d3-4056-af1c-73115e7d6bd1"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_coesolutionmetadatas",
                  "$select": "admin_coesolutionmetadataid",
                  "$filter": "admin_objectname eq '@{workflow()?['tags']['flowDisplayName']}'",
                  "$top": 1
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                }
              }
            },
            "Catch_-_not_ready_to_take_last_run_date": {
              "runAfter": {
                "Update_Last_Run_Successful": [
                  "Failed"
                ]
              },
              "metadata": {
                "operationMetadataId": "f88cdefe-c402-49d7-8f4a-934475e6f741"
              },
              "type": "Compose",
              "inputs": "Catch - not ready to take last run date"
            }
          },
          "runAfter": {
            "Error_Handling": [
              "Skipped"
            ]
          },
          "metadata": {
            "operationMetadataId": "5c140442-d939-4ca4-8ec8-d1ee2bed4a81"
          },
          "type": "Scope"
        }
      },
      "outputs": {}
    },
    "templateName": ""
  },
  "schemaVersion": "1.0.0.0"
}