{
  "properties": {
    "connectionReferences": {
      "shared_commondataserviceforapps": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "admin_CoECoreDataverse"
        },
        "api": {
          "name": "shared_commondataserviceforapps"
        }
      },
      "shared_teams": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "new_CoEGovTeams"
        },
        "api": {
          "name": "shared_teams"
        }
      },
      "shared_office365": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "new_CoEGovO365Outlook"
        },
        "api": {
          "name": "shared_office365"
        }
      },
      "shared_office365users": {
        "runtimeSource": "embedded",
        "connection": {
          "connectionReferenceLogicalName": "new_CoEGovO365Users"
        },
        "api": {
          "name": "shared_office365users"
        }
      }
    },
    "definition": {
      "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
      "contentVersion": "1.0.0.0",
      "parameters": {
        "$connections": {
          "defaultValue": {},
          "type": "Object"
        },
        "$authentication": {
          "defaultValue": {},
          "type": "SecureObject"
        },
        "Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)": {
          "defaultValue": "https://us.flow.microsoft.com/manage/environments/",
          "type": "String",
          "metadata": {
            "schemaName": "admin_PowerAutomateEnvironmentVariable",
            "description": "REQUIRED. Environment, including geographic location, for Power Automate - Ex for commercial: https://flow.microsoft.com/manage/environments/"
          }
        },
        "Admin eMail (admin_AdminMail)": {
          "defaultValue": "adelev@pplatform.onmicrosoft.com",
          "type": "String",
          "metadata": {
            "schemaName": "admin_AdminMail",
            "description": "CoE Admin eMail. Email address used in flows to send notifications to admins; this should be either your email address or a distribution list"
          }
        },
        "ProductionEnvironment (admin_ProductionEnvironment)": {
          "defaultValue": true,
          "type": "Bool",
          "metadata": {
            "schemaName": "admin_ProductionEnvironment",
            "description": "Yes by default. Set to No if you are creating a dev type envt. This will allow some flows to set target users to the admin instead of resource owners"
          }
        },
        "Individual Admin (admin_ApprovalAdmin)": {
          "defaultValue": "adelev@pplatform.onmicrosoft.com",
          "type": "String",
          "metadata": {
            "schemaName": "admin_ApprovalAdmin",
            "description": "REQUIRED. An individual admin's email. Some actions (approvals / team chats) cannot accept a group/DL. So this env variable is for those instances in the kit. "
          }
        }
      },
      "triggers": {
        "manual": {
          "metadata": {
            "operationMetadataId": "829d0ddd-28df-4a59-8657-6d1854daa95b"
          },
          "type": "Request",
          "kind": "Button",
          "inputs": {
            "schema": {
              "type": "object",
              "properties": {
                "text": {
                  "title": "ManagerEmail",
                  "type": "string",
                  "x-ms-dynamically-added": true,
                  "description": "Please enter your input",
                  "x-ms-content-hint": "TEXT"
                }
              },
              "required": [
                "text"
              ]
            }
          }
        }
      },
      "actions": {
        "Respond_to_a_PowerApp_or_flow": {
          "runAfter": {
            "If_not_timed_out": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "61e58f23-ee75-4e28-81d3-a9ad38aad914"
          },
          "type": "Response",
          "kind": "PowerApp",
          "inputs": {
            "statusCode": 200,
            "body": {
              "success": "@variables('returnValue')"
            },
            "schema": {
              "type": "object",
              "properties": {
                "success": {
                  "title": "Success",
                  "x-ms-dynamically-added": true,
                  "type": "number"
                }
              }
            }
          }
        },
        "Get_Orphaned_Objects_for_this_Manager": {
          "actions": {
            "List_managers_orphaned_employees": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "ce8eca65-1eb3-4178-ba62-fda2370b70c6"
              },
              "type": "OpenApiConnection",
              "inputs": {
                "host": {
                  "connectionName": "shared_commondataserviceforapps",
                  "operationId": "ListRecords",
                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                },
                "parameters": {
                  "entityName": "admin_makers",
                  "$select": "admin_makerid",
                  "$filter": "admin_managerprinciplename eq '@{triggerBody()['text']}'  and admin_makerisorphaned eq true"
                },
                "authentication": {
                  "type": "Raw",
                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                }
              },
              "runtimeConfiguration": {
                "paginationPolicy": {
                  "minimumItemCount": 100000
                }
              }
            },
            "Apply_to_each_orphaned_employee": {
              "foreach": "@outputs('List_managers_orphaned_employees')?['body/value']",
              "actions": {
                "List_their_canvas_apps": {
                  "runAfter": {},
                  "metadata": {
                    "operationMetadataId": "2cc2bd7a-23f0-40f0-82cb-a342cb8bafd0"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_apps",
                      "$select": "admin_appmodifiedon, admin_applastlaunchedon, admin_appownerdisplayname, admin_displayname, admin_appenvironmentdisplayname, _admin_appowner_value, admin_appid",
                      "$filter": "admin_appdeleted eq false and admin_powerappstype eq 597910000 and _admin_appowner_value eq @{items('Apply_to_each_orphaned_employee')?['admin_makerid']}",
                      "$expand": "admin_AppEnvironment($select=admin_environmentname)"
                    },
                    "authentication": {
                      "type": "Raw",
                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                    }
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "List_their_cloud_flows": {
                  "runAfter": {
                    "Apply_to_each_of_their_apps": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "148b4651-1813-4ad3-a183-38dbd021d0a6"
                  },
                  "type": "OpenApiConnection",
                  "inputs": {
                    "host": {
                      "connectionName": "shared_commondataserviceforapps",
                      "operationId": "ListRecords",
                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_commondataserviceforapps"
                    },
                    "parameters": {
                      "entityName": "admin_flows",
                      "$select": "admin_flowmodifiedon, admin_flowmakerdisplayname, admin_flowstate, admin_flowenvironmentdisplayname, admin_displayname, _admin_flowcreator_value,  _admin_derivedowner_value, admin_flowid, _admin_flowenvironment_value, admin_workflowentityid",
                      "$filter": "admin_flowdeleted eq false and ( _admin_derivedowner_value eq @{items('Apply_to_each_orphaned_employee')?['admin_makerid']} or (_admin_derivedowner_value eq null and _admin_flowcreator_value eq @{items('Apply_to_each_orphaned_employee')?['admin_makerid']}))",
                      "$expand": "admin_FlowEnvironment($select=admin_environmentname), admin_DerivedOwner($select=admin_displayname)"
                    },
                    "authentication": {
                      "type": "Raw",
                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                    }
                  },
                  "runtimeConfiguration": {
                    "paginationPolicy": {
                      "minimumItemCount": 100000
                    }
                  }
                },
                "Apply_to_each_of_their_apps": {
                  "foreach": "@outputs('List_their_canvas_apps')?['body/value']",
                  "actions": {
                    "Add_app_to_table_-_app_name": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "2855454b-472a-4850-9e4e-a8f7099a71a3"
                      },
                      "type": "AppendToStringVariable",
                      "inputs": {
                        "name": "AppsTableAppNameCol",
                        "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{replace(items('Apply_to_each_of_their_apps')?['admin_displayname'], '\"', '_')}\""
                      }
                    },
                    "Add_app_to_table_-_owner_name": {
                      "runAfter": {
                        "Add_app_to_table_-_app_name": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "7aba4407-1208-4f66-a0a2-53897960aa71"
                      },
                      "type": "AppendToStringVariable",
                      "inputs": {
                        "name": "AppsTableEmployeeNameCol",
                        "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{if(equals(items('Apply_to_each_of_their_apps')?['admin_appownerdisplayname'], null), 'unknown', items('Apply_to_each_of_their_apps')?['admin_appownerdisplayname'])}\""
                      }
                    },
                    "Add_app_to_table_-_last_launched": {
                      "runAfter": {
                        "Add_app_to_table_-_owner_name": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "40a39dc7-54a0-4efc-97ad-08f7ceb877fe"
                      },
                      "type": "AppendToStringVariable",
                      "inputs": {
                        "name": "AppsTableLastLaunchedCol",
                        "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{if(equals(items('Apply_to_each_of_their_apps')?['admin_applastlaunchedon'], null), 'unknown', formatDateTime(items('Apply_to_each_of_their_apps')?['admin_applastlaunchedon'], 'd'))}\""
                      }
                    },
                    "Create_Orphaned_Object_-_App": {
                      "runAfter": {
                        "Add_app_to_table_-_last_launched": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "0653e876-fe72-46e8-a0e8-e6f4040847ca"
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "OrphanedObject",
                        "value": {
                          "LastModified": "@if(equals(items('Apply_to_each_of_their_apps')?['admin_appmodifiedon'], null), 'unknown', formatDateTime(items('Apply_to_each_of_their_apps')?['admin_appmodifiedon'], 'd'))",
                          "LastLaunched": "@if(equals(items('Apply_to_each_of_their_apps')?['admin_applastlaunchedon'], null), 'unknown', formatDateTime(items('Apply_to_each_of_their_apps')?['admin_applastlaunchedon'], 'd'))",
                          "OwnerDisplayName": "@items('Apply_to_each_of_their_apps')?['admin_appownerdisplayname']",
                          "AppDisplayName": "@items('Apply_to_each_of_their_apps')?['admin_displayname']",
                          "EnvtDisplayName": "@items('Apply_to_each_of_their_apps')?['admin_appenvironmentdisplayname']",
                          "AppID": "@items('Apply_to_each_of_their_apps')?['admin_appid']",
                          "EnvtName": "@items('Apply_to_each_of_their_apps')?['admin_appenvironment/admin_environmentname']"
                        }
                      }
                    },
                    "Append_to_OrphanedApps": {
                      "runAfter": {
                        "Create_Orphaned_Object_-_App": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "11cc86a8-9047-48e5-9e7b-cf1256cb0064"
                      },
                      "type": "AppendToArrayVariable",
                      "inputs": {
                        "name": "OrphanedApps",
                        "value": "@variables('OrphanedObject')"
                      }
                    }
                  },
                  "runAfter": {
                    "List_their_canvas_apps": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "091275a4-3a44-462f-a3d8-95fe9dbd13f7"
                  },
                  "type": "Foreach",
                  "description": "Add to card variables for tabular display and add to app array"
                },
                "Apply_to_each_of_their_flows": {
                  "foreach": "@outputs('List_their_cloud_flows')?['body/value']",
                  "actions": {
                    "Add_flow_to_table_-_flow_name": {
                      "runAfter": {},
                      "metadata": {
                        "operationMetadataId": "df2cc0ad-03e7-4515-a27d-653cad10fe94"
                      },
                      "type": "AppendToStringVariable",
                      "inputs": {
                        "name": "FlowsTableAppNameCol",
                        "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{replace(items('Apply_to_each_of_their_flows')?['admin_displayname'], '\"', '_')}\""
                      }
                    },
                    "Add_flow_to_table_-_owner_name": {
                      "runAfter": {
                        "Add_flow_to_table_-_flow_name": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "96fa7145-e713-4c2e-bfeb-086f367efd25"
                      },
                      "type": "AppendToStringVariable",
                      "inputs": {
                        "name": "FlowsTableEmployeeNameCol",
                        "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{items('Apply_to_each_of_their_flows')?['admin_derivedowner/admin_displayname']}\""
                      }
                    },
                    "Add_flow_to_table_-_status": {
                      "runAfter": {
                        "Add_flow_to_table_-_owner_name": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "60bfe1e0-6198-464c-987d-f663c35cd748"
                      },
                      "type": "AppendToStringVariable",
                      "inputs": {
                        "name": "FlowsTableStatusCol",
                        "value": "                        },\n                        {\n                            \"type\": \"TextBlock\",\n                            \"separator\": true,\n                            \"text\": \"@{items('Apply_to_each_of_their_flows')?['admin_flowstate']}\""
                      }
                    },
                    "Create_Orphaned_Object_-_flow": {
                      "runAfter": {
                        "Add_flow_to_table_-_status": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "54624be0-efce-48ae-b5d7-3d9d71db3b9e"
                      },
                      "type": "SetVariable",
                      "inputs": {
                        "name": "OrphanedObject",
                        "value": {
                          "LastModified": "@if(equals(items('Apply_to_each_of_their_flows')?['admin_flowmodifiedon'], null), 'unknown', formatDateTime(items('Apply_to_each_of_their_flows')?['admin_flowmodifiedon'], 'd'))",
                          "FlowState": "@{items('Apply_to_each_of_their_flows')?['admin_flowstate']}",
                          "OwnerDisplayName": "@{items('Apply_to_each_of_their_flows')?['admin_derivedowner/admin_displayname']}",
                          "FlowDisplayName": "@{items('Apply_to_each_of_their_flows')?['admin_displayname']}",
                          "EnvtDisplayName": "@{items('Apply_to_each_of_their_flows')?['admin_flowenvironmentdisplayname']}",
                          "FlowID": "@{items('Apply_to_each_of_their_flows')?['admin_flowid']}",
                          "EnvtName": "@{items('Apply_to_each_of_their_flows')?['admin_flowenvironment/admin_environmentname']}",
                          "isSolnFlow": "@if(equals(items('Apply_to_each_of_their_flows')?['admin_workflowentityid'], null), false, true)"
                        }
                      }
                    },
                    "Append_to_OrphanedFlows": {
                      "runAfter": {
                        "Create_Orphaned_Object_-_flow": [
                          "Succeeded"
                        ]
                      },
                      "metadata": {
                        "operationMetadataId": "1b8ee033-34bb-469a-a25e-6ca41ef1b228"
                      },
                      "type": "AppendToArrayVariable",
                      "inputs": {
                        "name": "OrphanedFlows",
                        "value": "@variables('OrphanedObject')"
                      }
                    }
                  },
                  "runAfter": {
                    "List_their_cloud_flows": [
                      "Succeeded"
                    ]
                  },
                  "metadata": {
                    "operationMetadataId": "34b5ad10-4f63-4af3-bf7f-185efa0ba11b"
                  },
                  "type": "Foreach",
                  "description": "Add to card variables for tabular display and add to flow array"
                }
              },
              "runAfter": {
                "List_managers_orphaned_employees": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "29b7e9c3-0d39-478d-816f-1589be8852b9"
              },
              "type": "Foreach"
            },
            "Parse_Orphaned_Apps": {
              "runAfter": {
                "Compose_2": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "1168a796-b2a3-45cc-bcbe-cc681c54a4b4"
              },
              "type": "ParseJson",
              "inputs": {
                "content": "@variables('OrphanedApps')",
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "LastModified": {
                        "anyOf": [
                          {
                            "type": "string"
                          },
                          {
                            "type": "null"
                          }
                        ]
                      },
                      "LastLaunched": {
                        "anyOf": [
                          {
                            "type": "string"
                          },
                          {
                            "type": "null"
                          }
                        ]
                      },
                      "OwnerDisplayName": {
                        "anyOf": [
                          {
                            "type": "string"
                          },
                          {
                            "type": "null"
                          }
                        ]
                      },
                      "AppDisplayName": {
                        "anyOf": [
                          {
                            "type": "string"
                          },
                          {
                            "type": "null"
                          }
                        ]
                      },
                      "EnvtDisplayName": {
                        "anyOf": [
                          {
                            "type": "string"
                          },
                          {
                            "type": "null"
                          }
                        ]
                      },
                      "AppID": {
                        "type": "string"
                      },
                      "EnvtName": {
                        "type": "string"
                      }
                    },
                    "required": [
                      "LastModified",
                      "LastLaunched",
                      "OwnerDisplayName",
                      "AppDisplayName",
                      "EnvtDisplayName",
                      "AppID",
                      "EnvtName"
                    ]
                  }
                }
              }
            },
            "Parse_Orphaned_Flows": {
              "runAfter": {
                "Parse_Orphaned_Apps": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "dbaf3bec-eeb7-421d-b75e-362185f596ec"
              },
              "type": "ParseJson",
              "inputs": {
                "content": "@variables('OrphanedFlows')",
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "LastModified": {
                        "anyOf": [
                          {
                            "type": "string"
                          },
                          {
                            "type": "null"
                          }
                        ]
                      },
                      "FlowState": {
                        "anyOf": [
                          {
                            "type": "string"
                          },
                          {
                            "type": "null"
                          }
                        ]
                      },
                      "OwnerDisplayName": {
                        "anyOf": [
                          {
                            "type": "string"
                          },
                          {
                            "type": "null"
                          }
                        ]
                      },
                      "FlowDisplayName": {
                        "anyOf": [
                          {
                            "type": "string"
                          },
                          {
                            "type": "null"
                          }
                        ]
                      },
                      "EnvtDisplayName": {
                        "anyOf": [
                          {
                            "type": "string"
                          },
                          {
                            "type": "null"
                          }
                        ]
                      },
                      "FlowID": {
                        "type": "string"
                      },
                      "EnvtName": {
                        "type": "string"
                      },
                      "isSolnFlow": {
                        "type": "boolean"
                      }
                    },
                    "required": [
                      "LastModified",
                      "FlowState",
                      "OwnerDisplayName",
                      "FlowDisplayName",
                      "EnvtDisplayName",
                      "FlowID",
                      "EnvtName",
                      "isSolnFlow"
                    ]
                  }
                }
              }
            },
            "Compose_2": {
              "runAfter": {
                "Apply_to_each_orphaned_employee": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "949e891f-9e13-4b4e-84ff-7794c7af549b"
              },
              "type": "Compose",
              "inputs": "@variables('OrphanedFlows')"
            }
          },
          "runAfter": {
            "Initialize_flowErrors": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "93b58c7d-ec45-4d8d-a43c-6c92685a4c06"
          },
          "type": "Scope"
        },
        "Initialize_AppsTableAppNameCol": {
          "runAfter": {
            "Initialize_theCard_with_top_contents": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "aa059df3-c819-4953-9f02-3232ed61e53b"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "AppsTableAppNameCol",
                "type": "string",
                "value": " \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"App Name\""
              }
            ]
          }
        },
        "Initialize_AppsTableEmployeeNameCol": {
          "runAfter": {
            "Initialize_AppsTableAppNameCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "86215132-b7d1-45ca-9e88-c1c5bd8203f3"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "AppsTableEmployeeNameCol",
                "type": "string",
                "value": " }\n                    ],\n                    \"width\": \"auto\"\n                },\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Employee Name\""
              }
            ]
          }
        },
        "Initialize_AppsTableLastLaunchedCol": {
          "runAfter": {
            "Initialize_AppsTableEmployeeNameCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "9f734262-eeb7-4b2b-a580-c55815c1f9a1"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "AppsTableLastLaunchedCol",
                "type": "string",
                "value": " }\n                    ],\n                    \"width\": \"auto\"\n                },\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Last Launched\""
              }
            ]
          }
        },
        "Initialize_theCard_with_top_contents": {
          "runAfter": {
            "Get_managers_id": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "327bd116-9122-4ed5-9026-7852b5dee613"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "theCard",
                "type": "string",
                "value": "{\n    \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n    \"type\": \"AdaptiveCard\",\n    \"version\": \"1.2\",\n    \"body\": [\n        {\n            \"type\": \"TextBlock\",\n            \"text\": \"You can decide what to do with all the objects at once or go through them one at a time\",\n            \"wrap\": true,\n            \"weight\": \"Bolder\"\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {"
              }
            ]
          }
        },
        "Initialize_OrphanedApps": {
          "runAfter": {
            "Initialize_FlowsTableStatusCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "c65cc279-6905-4f1e-ada0-39bbd4d5deda"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "OrphanedApps",
                "type": "array"
              }
            ]
          }
        },
        "Initialize_OrphanedFlows": {
          "runAfter": {
            "Initialize_OrphanedApps": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "5d5519ea-2940-4426-9bbc-fe215d5abc81"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "OrphanedFlows",
                "type": "array"
              }
            ]
          }
        },
        "Initialize_OrphanedObject": {
          "runAfter": {
            "Initialize_OrphanedFlows": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "8791ffa8-be3b-45f3-8078-3e8ecb0a6f88"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "OrphanedObject",
                "type": "object"
              }
            ]
          }
        },
        "Create_Adaptive_Card_with_all_orphans": {
          "actions": {
            "Append_end_to_theCard": {
              "runAfter": {
                "Append_action_section_to_theCard": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "825a22a0-6e07-4ea0-b095-20fbd10cf7cb"
              },
              "type": "AppendToStringVariable",
              "inputs": {
                "name": "theCard",
                "value": "            ]\n        }\n    ]\n}"
              }
            },
            "Append_app_records_to_theCard": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "103b1f77-5c58-4f62-9f41-5f4c7e020ffe"
              },
              "type": "AppendToStringVariable",
              "inputs": {
                "name": "theCard",
                "value": "@{variables('AppsTableAppNameCol')}@{variables('AppsTableEmployeeNameCol')}@{variables('AppsTableLastLaunchedCol')}"
              }
            },
            "Append_action_section_to_theCard": {
              "runAfter": {
                "Append_flow_records_to_theCard": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "92657404-86fd-42b3-8886-6ab25ec2550e"
              },
              "type": "AppendToStringVariable",
              "inputs": {
                "name": "theCard",
                "value": "    }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ActionSet\",\n    \"actions\": [\n        {\n            \"type\": \"Action.Submit\",\n            \"title\": \"Take Ownership\",\n            \"style\": \"positive\",\n            \"id\": \"TakeOwnership\"\n        },\n        {\n            \"title\": \"Delete All\",\n            \"type\": \"Action.Submit\",\n            \"id\": \"DeleteAll\"\n        },\n     {\n            \"title\": \"Assign Ownership\",\n            \"type\": \"Action.ShowCard\",\n            \"id\": \"AssignAll\",\n            \"card\":{\n                 \"type\": \"AdaptiveCard\",\n                 \"body\": [\n                            {\n                             \"type\": \"Input.Text\",\n                             \"id\": \"toWhom\",\n                             \"placeholder\": \"AssignToWhom@example.com\",\n                             \"style\": \"Email\",\n                             \"spacing\": \"None\"\n                           }\n                         ],\n                  \"actions\":[\n                         {\n                            \"type\": \"Action.Submit\",\n                            \"id\": \"AssignAllDone\",\n                            \"title\": \"Assign Now\"\n                         }\n                       ],\n                   \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\"\n              }\n        },\n        {\n            \"title\": \"Email Me\",\n            \"type\": \"Action.Submit\",\n            \"id\": \"EmailMe\"\n        },\n        {\n            \"title\": \"See Each\",\n            \"type\": \"Action.Submit\",\n            \"id\": \"SeeEach\"\n        }\n"
              }
            },
            "Append_flow_table_start_to_theCard": {
              "runAfter": {
                "Append_app_records_to_theCard": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "e7eac758-19d3-4e06-8cd6-98037777df14"
              },
              "type": "AppendToStringVariable",
              "inputs": {
                "name": "theCard",
                "value": "    }\n                    ],\n                    \"width\": \"auto\"\n                }\n            ]\n        },\n        {\n            \"type\": \"ColumnSet\",\n            \"columns\": [\n                {"
              }
            },
            "Compose": {
              "runAfter": {
                "Append_end_to_theCard": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "c82af6c4-89b4-4932-a959-1bda9af8ff99"
              },
              "type": "Compose",
              "inputs": "@variables('OrphanedFlows')"
            },
            "Append_flow_records_to_theCard": {
              "runAfter": {
                "Append_flow_table_start_to_theCard": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "d6ed5b9b-d07b-4a95-aef7-f79e5712d903"
              },
              "type": "AppendToStringVariable",
              "inputs": {
                "name": "theCard",
                "value": "@{variables('FlowsTableAppNameCol')}@{variables('FlowsTableEmployeeNameCol')}@{variables('FlowsTableStatusCol')}"
              }
            }
          },
          "runAfter": {
            "Prepare_HTML_Table_for_Emails_if_needed": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "2aeb9439-ffbe-41d1-96d4-53e21d71f8cc"
          },
          "type": "Scope",
          "description": "append the tabular columns, the mid section, and the actions"
        },
        "Set_timeOut_true_if_timed_out": {
          "runAfter": {
            "Send_Table_For_Response": [
              "TimedOut",
              "Failed"
            ]
          },
          "metadata": {
            "operationMetadataId": "52eeb1ca-01b9-46d2-a6ba-1e850c8bd19f"
          },
          "type": "SetVariable",
          "inputs": {
            "name": "timedOutOrFailed",
            "value": "@true"
          }
        },
        "Send_Table_For_Response": {
          "runAfter": {
            "Create_Adaptive_Card_with_all_orphans": [
              "Succeeded"
            ]
          },
          "limit": {
            "timeout": "P7D"
          },
          "metadata": {
            "operationMetadataId": "562c47c6-58a7-48d4-baba-3d93b0ffdc8d"
          },
          "type": "OpenApiConnectionWebhook",
          "inputs": {
            "host": {
              "connectionName": "shared_teams",
              "operationId": "SubscribeUserFlowContinuation",
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
            },
            "parameters": {
              "UserFlowContinuationSubscriptionRequest/body/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
              "UserFlowContinuationSubscriptionRequest/body/messageBody": "@variables('theCard')",
              "UserFlowContinuationSubscriptionRequest/body/updateMessage": "Trying that now...",
              "UserFlowContinuationSubscriptionRequest/body/shouldUpdateCard": true,
              "UserFlowContinuationSubscriptionRequest/body/recipient/isAlert": true
            },
            "authentication": {
              "type": "Raw",
              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
            },
            "retryPolicy": {
              "type": "exponential",
              "count": 10,
              "interval": "PT10S"
            }
          }
        },
        "If_not_timed_out": {
          "actions": {
            "Switch": {
              "runAfter": {},
              "cases": {
                "Case_Take_Ownership": {
                  "case": "TakeOwnership",
                  "actions": {
                    "Assign_Each_App_to_Manager": {
                      "foreach": "@variables('OrphanedApps')",
                      "actions": {
                        "Check_if_reassignment_to_self_worked": {
                          "actions": {
                            "Set_BulkOperationSuccess_to_false_manager": {
                              "runAfter": {},
                              "type": "SetVariable",
                              "inputs": {
                                "name": "BulkOperationSuccess",
                                "value": "@false"
                              }
                            },
                            "Append_to_appErrors_-_take_ownership": {
                              "runAfter": {
                                "Set_BulkOperationSuccess_to_false_manager": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "appErrors",
                                "value": {
                                  "app": "@items('Assign_Each_App_to_Manager')['AppDisplayName']",
                                  "envt": "@items('Assign_Each_App_to_Manager')['EnvtDisplayName']",
                                  "error": "@body('Reassign_This_One_to_Manager')?['thereturnstring']"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Reassign_This_One_to_Manager": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@body('Reassign_This_One_to_Manager')?['thereturnstring']",
                                "pass"
                              ]
                            }
                          },
                          "type": "If"
                        },
                        "Reassign_This_One_to_Manager": {
                          "runAfter": {},
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                            },
                            "body": {
                              "text": "@outputs('Get_managers_id')?['body/id']",
                              "text_1": "@items('Assign_Each_App_to_Manager')['AppID']",
                              "text_2": "@items('Assign_Each_App_to_Manager')['EnvtName']",
                              "text_3": "assign"
                            }
                          }
                        }
                      },
                      "runAfter": {},
                      "type": "Foreach"
                    },
                    "Let_them_know_if_objects_assigned_correctly_to_self": {
                      "actions": {
                        "Success_All_Objects_Assigned_to_Manager": {
                          "runAfter": {},
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_teams",
                              "operationId": "PostUserNotification",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                            },
                            "parameters": {
                              "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                              "PostNotificationRequest/messageBody": "All objects assigned to @{outputs('Get_managers_id')?['body/displayName']}",
                              "PostNotificationRequest/messageTitle": "Success!"
                            },
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Assign_Each_Flow_to_Manager": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "Failed_to_Assign_Some_Objects_to_Manager": {
                            "runAfter": {},
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_teams",
                                "operationId": "PostUserNotification",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                              },
                              "parameters": {
                                "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                "PostNotificationRequest/messageBody": "Some objects could not be assigned to @{outputs('Get_managers_id')?['body/displayName']}. An email with details will be sent to you. \nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                "PostNotificationRequest/messageTitle": "Error"
                              },
                              "authentication": {
                                "type": "Raw",
                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                              },
                              "retryPolicy": {
                                "type": "exponential",
                                "count": 10,
                                "interval": "PT10S"
                              }
                            }
                          },
                          "Send_email_list_of_failures_-_take_ownership": {
                            "runAfter": {
                              "Table_-_flowErrors_-_take_ownership": [
                                "Succeeded"
                              ]
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_office365",
                                "operationId": "SendEmailV2",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365"
                              },
                              "parameters": {
                                "emailMessage/To": "@if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])",
                                "emailMessage/Subject": "Failed to take ownership of orphaned objects",
                                "emailMessage/Body": "<p><u><strong>Apps that failed to have ownership taken</strong></u><br>\n<br>\n@{body('Table_-_appErrors_-_take_ownership')}<br>\n<br>\n<br>\n<u><strong>Flows that failed to have ownership taken<br></strong></u><br>\n@{body('Table_-_flowErrors_-_take_ownership')}<br>\n</p>",
                                "emailMessage/Importance": "Normal"
                              },
                              "authentication": {
                                "type": "Raw",
                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                              }
                            }
                          },
                          "Table_-_appErrors_-_take_ownership": {
                            "runAfter": {
                              "Failed_to_Assign_Some_Objects_to_Manager": [
                                "Succeeded"
                              ]
                            },
                            "type": "Table",
                            "inputs": {
                              "from": "@variables('appErrors')",
                              "format": "HTML"
                            }
                          },
                          "Table_-_flowErrors_-_take_ownership": {
                            "runAfter": {
                              "Table_-_appErrors_-_take_ownership": [
                                "Succeeded"
                              ]
                            },
                            "type": "Table",
                            "inputs": {
                              "from": "@variables('flowErrors')",
                              "format": "HTML"
                            }
                          }
                        }
                      },
                      "expression": {
                        "equals": [
                          "@variables('BulkOperationSuccess')",
                          "@true"
                        ]
                      },
                      "type": "If"
                    },
                    "Assign_Each_Flow_to_Manager": {
                      "foreach": "@variables('OrphanedFlows')",
                      "actions": {
                        "Check_if_reassignment_to_self_worked_flows": {
                          "actions": {
                            "Set_BulkOperationSuccess_to_false_manager_flow": {
                              "runAfter": {},
                              "type": "SetVariable",
                              "inputs": {
                                "name": "BulkOperationSuccess",
                                "value": "@false"
                              }
                            },
                            "Append_to_flowErrors_-_take_ownership": {
                              "runAfter": {
                                "Set_BulkOperationSuccess_to_false_manager_flow": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "flowErrors",
                                "value": {
                                  "flow": "@items('Assign_Each_Flow_to_Manager')['FlowDisplayName']",
                                  "envt": "@items('Assign_Each_Flow_to_Manager')['EnvtDisplayName']",
                                  "error": "@body('Reassign_This_Flow_to_Manager')?['thereturnstring']"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Reassign_This_Flow_to_Manager": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@body('Reassign_This_Flow_to_Manager')?['thereturnstring']",
                                "pass"
                              ]
                            }
                          },
                          "type": "If"
                        },
                        "Reassign_This_Flow_to_Manager": {
                          "runAfter": {},
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                            },
                            "body": {
                              "text": "@outputs('Get_managers_id')?['body/id']",
                              "text_1": "@items('Assign_Each_Flow_to_Manager')['FlowID']",
                              "text_2": "@items('Assign_Each_Flow_to_Manager')['EnvtName']",
                              "text_3": "assign"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Assign_Each_App_to_Manager": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    }
                  }
                },
                "Case_DeleteAll": {
                  "case": "DeleteAll",
                  "actions": {
                    "Delete_Each_Orphaned_App": {
                      "foreach": "@variables('OrphanedApps')",
                      "actions": {
                        "Check_if_delete_worked": {
                          "actions": {
                            "Set_BulkOperationSuccess_to_false": {
                              "runAfter": {},
                              "type": "SetVariable",
                              "inputs": {
                                "name": "BulkOperationSuccess",
                                "value": "@false"
                              }
                            },
                            "Append_to_appErrors_-_delete": {
                              "runAfter": {
                                "Set_BulkOperationSuccess_to_false": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "appErrors",
                                "value": {
                                  "app": "@items('Delete_Each_Orphaned_App')['AppDisplayName']",
                                  "envt": "@items('Delete_Each_Orphaned_App')['EnvtDisplayName']",
                                  "error": "@body('Delete_App')?['thereturnstring']"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Delete_App": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@body('Delete_App')?['thereturnstring']",
                                "pass"
                              ]
                            }
                          },
                          "type": "If"
                        },
                        "Delete_App": {
                          "runAfter": {},
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                            },
                            "body": {
                              "text": "not used",
                              "text_1": "@items('Delete_Each_Orphaned_App')['AppID']",
                              "text_2": "@items('Delete_Each_Orphaned_App')['EnvtName']",
                              "text_3": "delete"
                            }
                          }
                        }
                      },
                      "runAfter": {},
                      "type": "Foreach"
                    },
                    "Let_them_know_if_objects_deleted_correctly": {
                      "actions": {
                        "Success_All_Objects_Deleted": {
                          "runAfter": {},
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_teams",
                              "operationId": "PostUserNotification",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                            },
                            "parameters": {
                              "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                              "PostNotificationRequest/messageBody": "All objects deleted",
                              "PostNotificationRequest/messageTitle": "Success!"
                            },
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Delete_Each_Orphaned_Flow": [
                          "Succeeded"
                        ]
                      },
                      "else": {
                        "actions": {
                          "get_only_solution_aware_flows": {
                            "runAfter": {},
                            "type": "Select",
                            "inputs": {
                              "from": "@body('Parse_Orphaned_Flows')",
                              "select": {
                                "@{item()['isSolnFlow']}": "@true"
                              }
                            }
                          },
                          "Failed_to_Delete_Some_Objects": {
                            "runAfter": {
                              "get_only_solution_aware_flows": [
                                "Succeeded"
                              ]
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_teams",
                                "operationId": "PostUserNotification",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                              },
                              "parameters": {
                                "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                "PostNotificationRequest/messageBody": "Some objects could not be deleted. An email with details will be sent to you. \n\nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                "PostNotificationRequest/messageTitle": "Error"
                              },
                              "authentication": {
                                "type": "Raw",
                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                              },
                              "retryPolicy": {
                                "type": "exponential",
                                "count": 10,
                                "interval": "PT10S"
                              }
                            }
                          },
                          "Table_-_appErrors_-_delete_all": {
                            "runAfter": {
                              "Failed_to_Delete_Some_Objects": [
                                "Succeeded"
                              ]
                            },
                            "type": "Table",
                            "inputs": {
                              "from": "@variables('appErrors')",
                              "format": "HTML"
                            }
                          },
                          "Table_-_flowErrors_-_delete_all": {
                            "runAfter": {
                              "Table_-_appErrors_-_delete_all": [
                                "Succeeded"
                              ]
                            },
                            "type": "Table",
                            "inputs": {
                              "from": "@variables('flowErrors')",
                              "format": "HTML"
                            }
                          },
                          "Send_email_list_of_failures_-_delete_all": {
                            "runAfter": {
                              "Table_-_flowErrors_-_delete_all": [
                                "Succeeded"
                              ]
                            },
                            "type": "OpenApiConnection",
                            "inputs": {
                              "host": {
                                "connectionName": "shared_office365",
                                "operationId": "SendEmailV2",
                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365"
                              },
                              "parameters": {
                                "emailMessage/To": "@if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])",
                                "emailMessage/Subject": "Failed to delete orphaned objects",
                                "emailMessage/Body": "<p><u><strong>Apps that failed to delete</strong></u><br>\n<br>\n@{body('Table_-_appErrors_-_delete_all')}<br>\n<br>\n<br>\n<u><strong>Flows that failed to delete<br></strong></u><br>\n@{body('Table_-_flowErrors_-_delete_all')}<br>\n</p>",
                                "emailMessage/Importance": "Normal"
                              },
                              "authentication": {
                                "type": "Raw",
                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                              }
                            }
                          }
                        }
                      },
                      "expression": {
                        "equals": [
                          "@variables('BulkOperationSuccess')",
                          "@true"
                        ]
                      },
                      "type": "If"
                    },
                    "Delete_Each_Orphaned_Flow": {
                      "foreach": "@variables('OrphanedFlows')",
                      "actions": {
                        "Delete_Flow": {
                          "runAfter": {},
                          "type": "Workflow",
                          "inputs": {
                            "host": {
                              "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                            },
                            "body": {
                              "text": "not used",
                              "text_1": "@items('Delete_Each_Orphaned_Flow')['FlowID']",
                              "text_2": "@items('Delete_Each_Orphaned_Flow')['EnvtName']",
                              "text_3": "delete"
                            }
                          }
                        },
                        "Check_if_delete_worked_flow": {
                          "actions": {
                            "Set_BulkOperationSuccess_to_false_flow": {
                              "runAfter": {},
                              "type": "SetVariable",
                              "inputs": {
                                "name": "BulkOperationSuccess",
                                "value": "@false"
                              }
                            },
                            "Append_to_flowErrors_-_delete": {
                              "runAfter": {
                                "Set_BulkOperationSuccess_to_false_flow": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "flowErrors",
                                "value": {
                                  "flow": "@items('Delete_Each_Orphaned_Flow')['FlowDisplayName']",
                                  "envt": "@items('Delete_Each_Orphaned_Flow')['EnvtDisplayName']",
                                  "error": "@body('Delete_Flow')?['thereturnstring']"
                                }
                              }
                            }
                          },
                          "runAfter": {
                            "Delete_Flow": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "not": {
                              "equals": [
                                "@body('Delete_Flow')?['thereturnstring']",
                                "pass"
                              ]
                            }
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "Delete_Each_Orphaned_App": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    }
                  }
                },
                "Case_Assign_All": {
                  "case": "AssignAllDone",
                  "actions": {
                    "Get_toWhom_profile": {
                      "runAfter": {},
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_office365users",
                          "operationId": "UserProfile_V2",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
                        },
                        "parameters": {
                          "id": "@outputs('Send_Table_For_Response')?['body/data/toWhom']"
                        },
                        "authentication": {
                          "type": "Raw",
                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                        },
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    },
                    "Switch_on_toWhom_lookup": {
                      "runAfter": {
                        "Get_toWhom_profile": [
                          "Succeeded",
                          "Failed"
                        ]
                      },
                      "cases": {
                        "200_Success": {
                          "case": 200,
                          "actions": {
                            "Assign_Each_App_to_New_Owner": {
                              "foreach": "@variables('OrphanedApps')",
                              "actions": {
                                "Check_if_reassignment_worked": {
                                  "actions": {
                                    "Set_BulkOperationSuccess_to_false_AssignAllDone": {
                                      "runAfter": {},
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "BulkOperationSuccess",
                                        "value": "@false"
                                      }
                                    },
                                    "Append_to_appErrors_-_assign": {
                                      "runAfter": {
                                        "Set_BulkOperationSuccess_to_false_AssignAllDone": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "appErrors",
                                        "value": {
                                          "app": "@items('Assign_Each_App_to_New_Owner')['AppDisplayName']",
                                          "envt": "@items('Assign_Each_App_to_New_Owner')['EnvtDisplayName']",
                                          "error": "@body('Reassign_This_One')?['thereturnstring']"
                                        }
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Reassign_This_One": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "not": {
                                      "equals": [
                                        "@body('Reassign_This_One')?['thereturnstring']",
                                        "pass"
                                      ]
                                    }
                                  },
                                  "type": "If"
                                },
                                "Reassign_This_One": {
                                  "runAfter": {},
                                  "type": "Workflow",
                                  "inputs": {
                                    "host": {
                                      "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                                    },
                                    "body": {
                                      "text": "@outputs('Get_toWhom_profile')?['body/id']",
                                      "text_1": "@items('Assign_Each_App_to_New_Owner')['AppID']",
                                      "text_2": "@items('Assign_Each_App_to_New_Owner')['EnvtName']",
                                      "text_3": "assign"
                                    }
                                  }
                                }
                              },
                              "runAfter": {},
                              "type": "Foreach"
                            },
                            "Let_them_know_if_objects_assigned_correctly": {
                              "actions": {
                                "Success_All_Objects_Assigned": {
                                  "runAfter": {},
                                  "type": "OpenApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connectionName": "shared_teams",
                                      "operationId": "PostUserNotification",
                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                    },
                                    "parameters": {
                                      "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                      "PostNotificationRequest/messageBody": "All objects assigned to @{outputs('Get_toWhom_profile')?['body/displayName']}",
                                      "PostNotificationRequest/messageTitle": "Success!"
                                    },
                                    "authentication": {
                                      "type": "Raw",
                                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                    },
                                    "retryPolicy": {
                                      "type": "exponential",
                                      "count": 10,
                                      "interval": "PT10S"
                                    }
                                  }
                                }
                              },
                              "runAfter": {
                                "Assign_Each_Flow_to_New_Owner": [
                                  "Succeeded"
                                ]
                              },
                              "else": {
                                "actions": {
                                  "Failed_to_Assign_Some_Objects": {
                                    "runAfter": {},
                                    "type": "OpenApiConnection",
                                    "inputs": {
                                      "host": {
                                        "connectionName": "shared_teams",
                                        "operationId": "PostUserNotification",
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                      },
                                      "parameters": {
                                        "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                        "PostNotificationRequest/messageBody": "Some objects could not be assigned to @{outputs('Get_toWhom_profile')?['body/displayName']}.\nAn email with details will be sent to you. \n\nYou may need to seek help from your admin: \n\n@{parameters('Admin eMail (admin_AdminMail)')}",
                                        "PostNotificationRequest/messageTitle": "Error"
                                      },
                                      "authentication": {
                                        "type": "Raw",
                                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                      },
                                      "retryPolicy": {
                                        "type": "exponential",
                                        "count": 10,
                                        "interval": "PT10S"
                                      }
                                    }
                                  },
                                  "Table_-_appErrors_-_assign_all": {
                                    "runAfter": {
                                      "Failed_to_Assign_Some_Objects": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "Table",
                                    "inputs": {
                                      "from": "@variables('appErrors')",
                                      "format": "HTML"
                                    }
                                  },
                                  "Table_-_flowErrors_-_assign_all": {
                                    "runAfter": {
                                      "Table_-_appErrors_-_assign_all": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "Table",
                                    "inputs": {
                                      "from": "@variables('flowErrors')",
                                      "format": "HTML"
                                    }
                                  },
                                  "Send_email_list_of_failures_-_assign_all": {
                                    "runAfter": {
                                      "Table_-_flowErrors_-_assign_all": [
                                        "Succeeded"
                                      ]
                                    },
                                    "type": "OpenApiConnection",
                                    "inputs": {
                                      "host": {
                                        "connectionName": "shared_office365",
                                        "operationId": "SendEmailV2",
                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365"
                                      },
                                      "parameters": {
                                        "emailMessage/To": "@if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])",
                                        "emailMessage/Subject": "Failed to assign ownership of orphaned objects",
                                        "emailMessage/Body": "<p><u><strong>Apps that failed to have ownership given</strong></u><br>\n<br>\n@{body('Table_-_appErrors_-_assign_all')}<br>\n<br>\n<br>\n<u><strong>Flows that failed to have ownership given<br></strong></u><br>\n@{body('Table_-_flowErrors_-_assign_all')}<br>\n</p>",
                                        "emailMessage/Importance": "Normal"
                                      },
                                      "authentication": {
                                        "type": "Raw",
                                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                      }
                                    }
                                  }
                                }
                              },
                              "expression": {
                                "equals": [
                                  "@variables('BulkOperationSuccess')",
                                  "@true"
                                ]
                              },
                              "type": "If"
                            },
                            "Assign_Each_Flow_to_New_Owner": {
                              "foreach": "@variables('OrphanedFlows')",
                              "actions": {
                                "Reassign_This_One_Flow": {
                                  "runAfter": {},
                                  "type": "Workflow",
                                  "inputs": {
                                    "host": {
                                      "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                    },
                                    "body": {
                                      "text": "@outputs('Get_toWhom_profile')?['body/id']",
                                      "text_1": "@items('Assign_Each_Flow_to_New_Owner')['FlowID']",
                                      "text_2": "@items('Assign_Each_Flow_to_New_Owner')['EnvtName']",
                                      "text_3": "assign"
                                    }
                                  }
                                },
                                "Check_if_reassignment_worked_flow": {
                                  "actions": {
                                    "Set_BulkOperationSuccess_to_false_AssignAllDone_flow": {
                                      "runAfter": {},
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "BulkOperationSuccess",
                                        "value": "@false"
                                      }
                                    },
                                    "Append_to_flowErrors_-_assign": {
                                      "runAfter": {
                                        "Set_BulkOperationSuccess_to_false_AssignAllDone_flow": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "flowErrors",
                                        "value": {
                                          "flow": "@items('Assign_Each_Flow_to_New_Owner')['FlowDisplayName']",
                                          "envt": "@items('Assign_Each_Flow_to_New_Owner')['EnvtDisplayName']",
                                          "error": "@body('Reassign_This_One_Flow')?['thereturnstring']"
                                        }
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Reassign_This_One_Flow": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "not": {
                                      "equals": [
                                        "@body('Reassign_This_One_Flow')?['thereturnstring']",
                                        "pass"
                                      ]
                                    }
                                  },
                                  "type": "If"
                                }
                              },
                              "runAfter": {
                                "Assign_Each_App_to_New_Owner": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Foreach"
                            }
                          }
                        },
                        "404_Not_Found": {
                          "case": 404,
                          "actions": {
                            "Post_a_message_as_the_Flow_bot_to_a_user_about_Bad_User": {
                              "runAfter": {},
                              "type": "OpenApiConnection",
                              "inputs": {
                                "host": {
                                  "connectionName": "shared_teams",
                                  "operationId": "PostUserNotification",
                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                },
                                "parameters": {
                                  "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                  "PostNotificationRequest/messageBody": "The user you entered did not resolve: @{body('Send_Table_For_Response')['toWhom']}\n\nYou will be asked again soon, and please enter a valid email adress for the new owner, in this format: @{triggerBody()['text']}",
                                  "PostNotificationRequest/messageTitle": "User did not resolve."
                                },
                                "authentication": {
                                  "type": "Raw",
                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                },
                                "retryPolicy": {
                                  "type": "exponential",
                                  "count": 10,
                                  "interval": "PT10S"
                                }
                              }
                            }
                          }
                        }
                      },
                      "default": {
                        "actions": {}
                      },
                      "expression": "@outputs('Get_toWhom_profile')['statusCode']",
                      "type": "Switch"
                    }
                  }
                },
                "Case_See_Each": {
                  "case": "SeeEach",
                  "actions": {
                    "Show_Each_App_Separately": {
                      "foreach": "@body('Parse_Orphaned_Apps')",
                      "actions": {
                        "Set_timedOut_if_true": {
                          "runAfter": {
                            "SendAppForResponses": [
                              "TimedOut",
                              "Failed"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "timedOutOrFailed",
                            "value": "@true"
                          }
                        },
                        "Reset_TimedOut": {
                          "runAfter": {},
                          "type": "SetVariable",
                          "inputs": {
                            "name": "timedOutOrFailed",
                            "value": "@false"
                          }
                        },
                        "Card_Content": {
                          "runAfter": {
                            "Reset_TimedOut": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": {
                            "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
                            "type": "AdaptiveCard",
                            "version": "1.2",
                            "body": [
                              {
                                "type": "TextBlock",
                                "text": "Environment: @{items('Show_Each_App_Separately')['EnvtDisplayName']}",
                                "wrap": true,
                                "weight": "Bolder"
                              },
                              {
                                "type": "TextBlock",
                                "text": "App Name: @{items('Show_Each_App_Separately')['AppDisplayName']}",
                                "wrap": true,
                                "weight": "Bolder"
                              },
                              {
                                "type": "TextBlock",
                                "text": "Previous Owner: @{items('Show_Each_App_Separately')['OwnerDisplayName']}",
                                "wrap": true,
                                "weight": "Bolder"
                              },
                              {
                                "type": "TextBlock",
                                "text": "Last Modified: @{items('Show_Each_App_Separately')['LastModified']}",
                                "wrap": true,
                                "weight": "Bolder"
                              },
                              {
                                "type": "TextBlock",
                                "text": "Last Launched: @{items('Show_Each_App_Separately')['LastLaunched']}",
                                "wrap": true,
                                "weight": "Bolder"
                              },
                              {
                                "type": "ActionSet",
                                "actions": [
                                  {
                                    "type": "Action.Submit",
                                    "title": "Take Ownership",
                                    "style": "positive",
                                    "id": "TakeIt"
                                  },
                                  {
                                    "title": "Delete",
                                    "type": "Action.Submit",
                                    "id": "DeleteIt"
                                  },
                                  {
                                    "title": "Assign Ownership",
                                    "type": "Action.ShowCard",
                                    "id": "AssignIt",
                                    "card": {
                                      "type": "AdaptiveCard",
                                      "body": [
                                        {
                                          "type": "Input.Text",
                                          "id": "toWhom",
                                          "placeholder": "AssignToWhom@example.com",
                                          "style": "Email",
                                          "spacing": "None"
                                        }
                                      ],
                                      "actions": [
                                        {
                                          "type": "Action.Submit",
                                          "id": "AssignItlDone",
                                          "title": "Assign Now"
                                        }
                                      ],
                                      "$schema": "http://adaptivecards.io/schemas/adaptive-card.json"
                                    }
                                  },
                                  {
                                    "title": "Skip",
                                    "type": "Action.Submit",
                                    "id": "SkipIt"
                                  }
                                ]
                              }
                            ]
                          }
                        },
                        "If_app_not_timed_out": {
                          "actions": {
                            "Switch_app_submitActionId": {
                              "runAfter": {},
                              "cases": {
                                "TakeIt": {
                                  "case": "TakeIt",
                                  "actions": {
                                    "Let_them_know_if_it_succeeded_-_assign_app_to_manager": {
                                      "actions": {
                                        "Success_App_Assigned_to_Manager": {
                                          "runAfter": {},
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "host": {
                                              "connectionName": "shared_teams",
                                              "operationId": "PostUserNotification",
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                            },
                                            "parameters": {
                                              "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                              "PostNotificationRequest/messageBody": "@{outputs('Get_managers_id')?['body/displayName']} now owns @{items('Show_Each_App_Separately')['AppDisplayName']}",
                                              "PostNotificationRequest/messageTitle": "Success! "
                                            },
                                            "authentication": {
                                              "type": "Raw",
                                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                            },
                                            "retryPolicy": {
                                              "type": "exponential",
                                              "count": 10,
                                              "interval": "PT10S"
                                            }
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Assign_App_to_Manager": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Failed_to_Assign_App_to_Manager": {
                                            "runAfter": {},
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "host": {
                                                "connectionName": "shared_teams",
                                                "operationId": "PostUserNotification",
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                              },
                                              "parameters": {
                                                "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                                "PostNotificationRequest/messageBody": "@{items('Show_Each_App_Separately')['AppDisplayName']} could not be assigned to @{outputs('Get_managers_id')?['body/displayName']}.\n\nHere is the error message received from the product:\n\n@{body('Assign_App_to_Manager')?['thereturnstring']}\n\nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                "PostNotificationRequest/messageTitle": "Error"
                                              },
                                              "authentication": {
                                                "type": "Raw",
                                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                              },
                                              "retryPolicy": {
                                                "type": "exponential",
                                                "count": 10,
                                                "interval": "PT10S"
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "equals": [
                                          "@body('Assign_App_to_Manager')?['thereturnstring']",
                                          "pass"
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Assign_App_to_Manager": {
                                      "runAfter": {},
                                      "type": "Workflow",
                                      "inputs": {
                                        "host": {
                                          "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                                        },
                                        "body": {
                                          "text": "@outputs('Get_managers_id')?['body/id']",
                                          "text_1": "@items('Show_Each_App_Separately')['AppID']",
                                          "text_2": "@items('Show_Each_App_Separately')['EnvtName']",
                                          "text_3": "assign"
                                        }
                                      }
                                    }
                                  }
                                },
                                "DeleteIt": {
                                  "case": "DeleteIt",
                                  "actions": {
                                    "Let_them_know_if_it_succeeded_-_delete_this_app": {
                                      "actions": {
                                        "Success_Delete_App": {
                                          "runAfter": {},
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "host": {
                                              "connectionName": "shared_teams",
                                              "operationId": "PostUserNotification",
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                            },
                                            "parameters": {
                                              "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                              "PostNotificationRequest/messageBody": "@{items('Show_Each_App_Separately')['AppDisplayName']} deleted",
                                              "PostNotificationRequest/messageTitle": "Success!"
                                            },
                                            "authentication": {
                                              "type": "Raw",
                                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                            },
                                            "retryPolicy": {
                                              "type": "exponential",
                                              "count": 10,
                                              "interval": "PT10S"
                                            }
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Delete_This_App": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Failed_Delete_App": {
                                            "runAfter": {},
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "host": {
                                                "connectionName": "shared_teams",
                                                "operationId": "PostUserNotification",
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                              },
                                              "parameters": {
                                                "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                                "PostNotificationRequest/messageBody": "Could not delete @{items('Show_Each_App_Separately')['AppDisplayName']}.\n\nHere is the error message received from the product:\n\n@{body('Delete_This_App')?['thereturnstring']}\n\n\nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                "PostNotificationRequest/messageTitle": "Error"
                                              },
                                              "authentication": {
                                                "type": "Raw",
                                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                              },
                                              "retryPolicy": {
                                                "type": "exponential",
                                                "count": 10,
                                                "interval": "PT10S"
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "equals": [
                                          "@body('Delete_This_App')?['thereturnstring']",
                                          "pass"
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Delete_This_App": {
                                      "runAfter": {},
                                      "type": "Workflow",
                                      "inputs": {
                                        "host": {
                                          "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                                        },
                                        "body": {
                                          "text": "Not Used",
                                          "text_1": "@items('Show_Each_App_Separately')['AppID']",
                                          "text_2": "@items('Show_Each_App_Separately')['EnvtName']",
                                          "text_3": "delete"
                                        }
                                      }
                                    }
                                  }
                                },
                                "AssignItlDone": {
                                  "case": "AssignItlDone",
                                  "actions": {
                                    "Get_toWhom_profile_-_app": {
                                      "runAfter": {},
                                      "type": "OpenApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connectionName": "shared_office365users",
                                          "operationId": "UserProfile_V2",
                                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
                                        },
                                        "parameters": {
                                          "id": "@outputs('SendAppForResponses')?['body/data/toWhom']"
                                        },
                                        "authentication": {
                                          "type": "Raw",
                                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                        },
                                        "retryPolicy": {
                                          "type": "exponential",
                                          "count": 10,
                                          "interval": "PT10S"
                                        }
                                      }
                                    },
                                    "Switch_on_toWhom_lookup_-_app": {
                                      "runAfter": {
                                        "Get_toWhom_profile_-_app": [
                                          "Succeeded",
                                          "Failed"
                                        ]
                                      },
                                      "cases": {
                                        "200_Success": {
                                          "case": 200,
                                          "actions": {
                                            "Let_them_know_if_it_succeeded_-_assign_app_toWhom": {
                                              "actions": {
                                                "Success_App_Assigned_toWhom": {
                                                  "runAfter": {},
                                                  "type": "OpenApiConnection",
                                                  "inputs": {
                                                    "host": {
                                                      "connectionName": "shared_teams",
                                                      "operationId": "PostUserNotification",
                                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                    },
                                                    "parameters": {
                                                      "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                                      "PostNotificationRequest/messageBody": "@{outputs('Get_toWhom_profile_-_app')?['body/displayName']} now owns @{items('Show_Each_App_Separately')['AppDisplayName']}",
                                                      "PostNotificationRequest/messageTitle": "Success!"
                                                    },
                                                    "authentication": {
                                                      "type": "Raw",
                                                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                    },
                                                    "retryPolicy": {
                                                      "type": "exponential",
                                                      "count": 10,
                                                      "interval": "PT10S"
                                                    }
                                                  }
                                                }
                                              },
                                              "runAfter": {
                                                "Assign_App_toWhom": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "else": {
                                                "actions": {
                                                  "Failed_to_Assign_App_toWhom": {
                                                    "runAfter": {},
                                                    "type": "OpenApiConnection",
                                                    "inputs": {
                                                      "host": {
                                                        "connectionName": "shared_teams",
                                                        "operationId": "PostUserNotification",
                                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                      },
                                                      "parameters": {
                                                        "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                                        "PostNotificationRequest/messageBody": "@{items('Show_Each_App_Separately')['AppDisplayName']} could not be assigned to @{outputs('Get_toWhom_profile_-_app')?['body/displayName']}.\n\nHere is the error message received from the product:\n\n@{body('Assign_App_toWhom')?['thereturnstring']}\n\n\nYou may need to seek help from your admin: \n\n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                        "PostNotificationRequest/messageTitle": "Error"
                                                      },
                                                      "authentication": {
                                                        "type": "Raw",
                                                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                      },
                                                      "retryPolicy": {
                                                        "type": "exponential",
                                                        "count": 10,
                                                        "interval": "PT10S"
                                                      }
                                                    }
                                                  }
                                                }
                                              },
                                              "expression": {
                                                "equals": [
                                                  "@body('Assign_App_toWhom')?['thereturnstring']",
                                                  "pass"
                                                ]
                                              },
                                              "type": "If"
                                            },
                                            "Assign_App_toWhom": {
                                              "runAfter": {},
                                              "type": "Workflow",
                                              "inputs": {
                                                "host": {
                                                  "workflowReferenceName": "41263d72-4dea-eb11-bacb-000d3a5786fb"
                                                },
                                                "body": {
                                                  "text": "@outputs('Get_toWhom_profile_-_app')?['body/id']",
                                                  "text_1": "@items('Show_Each_App_Separately')['AppID']",
                                                  "text_2": "@items('Show_Each_App_Separately')['EnvtName']",
                                                  "text_3": "assign"
                                                }
                                              }
                                            }
                                          }
                                        },
                                        "404_Not_Found": {
                                          "case": 404,
                                          "actions": {
                                            "Post_a_message_as_the_Flow_bot_to_a_user_about_Bad_User_-_app": {
                                              "runAfter": {},
                                              "type": "OpenApiConnection",
                                              "inputs": {
                                                "host": {
                                                  "connectionName": "shared_teams",
                                                  "operationId": "PostUserNotification",
                                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                },
                                                "parameters": {
                                                  "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                                  "PostNotificationRequest/messageBody": "The user you entered did not resolve: @{outputs('SendAppForResponses')?['body/data/toWhom']}\n\nYou will be asked again soon, and please enter a valid email adress for the new owner, in this format: @{triggerBody()['text']}",
                                                  "PostNotificationRequest/messageTitle": "User did not resolve"
                                                },
                                                "authentication": {
                                                  "type": "Raw",
                                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                },
                                                "retryPolicy": {
                                                  "type": "exponential",
                                                  "count": 10,
                                                  "interval": "PT10S"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "default": {
                                        "actions": {}
                                      },
                                      "expression": "@outputs('Get_toWhom_profile_-_app')['statusCode']",
                                      "type": "Switch"
                                    }
                                  }
                                },
                                "SkipIt": {
                                  "case": "SkipIt",
                                  "actions": {
                                    "Skip_this_one": {
                                      "runAfter": {},
                                      "type": "OpenApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connectionName": "shared_teams",
                                          "operationId": "PostUserNotification",
                                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                        },
                                        "parameters": {
                                          "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                          "PostNotificationRequest/messageBody": "Moving to the next one.",
                                          "PostNotificationRequest/messageTitle": "Skipped"
                                        },
                                        "authentication": {
                                          "type": "Raw",
                                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                        },
                                        "retryPolicy": {
                                          "type": "exponential",
                                          "count": 10,
                                          "interval": "PT10S"
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "default": {
                                "actions": {}
                              },
                              "expression": "@body('SendAppForResponses')['submitActionId']",
                              "type": "Switch"
                            }
                          },
                          "runAfter": {
                            "Set_timedOut_if_true": [
                              "Succeeded",
                              "Skipped"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Post_a_time_message_as_the_Flow_bot_to_a_user_for_this_app": {
                                "runAfter": {},
                                "type": "OpenApiConnection",
                                "inputs": {
                                  "host": {
                                    "connectionName": "shared_teams",
                                    "operationId": "PostUserNotification",
                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                  },
                                  "parameters": {
                                    "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                    "PostNotificationRequest/messageBody": "The above request has timed out or failed, and any responses given will not be recorded.\nYou will be asked again, so please reach out to your admin if you need assistance: @{parameters('Admin eMail (admin_AdminMail)')}\nThank you.",
                                    "PostNotificationRequest/messageTitle": "Request Timed Out or Failed"
                                  },
                                  "authentication": {
                                    "type": "Raw",
                                    "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                  },
                                  "retryPolicy": {
                                    "type": "exponential",
                                    "count": 10,
                                    "interval": "PT10S"
                                  }
                                }
                              }
                            }
                          },
                          "expression": {
                            "equals": [
                              "@variables('timedOutOrFailed')",
                              "@false"
                            ]
                          },
                          "type": "If"
                        },
                        "SendAppForResponses": {
                          "runAfter": {
                            "Card_Content": [
                              "Succeeded"
                            ]
                          },
                          "limit": {
                            "timeout": "PT10M"
                          },
                          "type": "OpenApiConnectionWebhook",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_teams",
                              "operationId": "SubscribeUserFlowContinuation",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                            },
                            "parameters": {
                              "UserFlowContinuationSubscriptionRequest/body/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                              "UserFlowContinuationSubscriptionRequest/body/messageBody": "@outputs('Card_Content')",
                              "UserFlowContinuationSubscriptionRequest/body/updateMessage": "Trying that now...",
                              "UserFlowContinuationSubscriptionRequest/body/shouldUpdateCard": true
                            },
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          }
                        }
                      },
                      "runAfter": {},
                      "type": "Foreach"
                    },
                    "Show_Each_Flow_Separately": {
                      "foreach": "@body('Parse_Orphaned_Flows')",
                      "actions": {
                        "Reset_TimedOut_flow": {
                          "runAfter": {},
                          "type": "SetVariable",
                          "inputs": {
                            "name": "timedOutOrFailed",
                            "value": "@false"
                          }
                        },
                        "Card_Content_flow": {
                          "runAfter": {
                            "Reset_TimedOut_flow": [
                              "Succeeded"
                            ]
                          },
                          "type": "Compose",
                          "inputs": {
                            "$schema": "http://adaptivecards.io/schemas/adaptive-card.json",
                            "type": "AdaptiveCard",
                            "version": "1.2",
                            "body": [
                              {
                                "type": "TextBlock",
                                "text": "Environment: @{items('Show_Each_Flow_Separately')['EnvtDisplayName']}",
                                "wrap": true,
                                "weight": "Bolder"
                              },
                              {
                                "type": "TextBlock",
                                "text": "Flow Name: @{items('Show_Each_Flow_Separately')['FlowDisplayName']}",
                                "wrap": true,
                                "weight": "Bolder"
                              },
                              {
                                "type": "TextBlock",
                                "text": "Previous Owner: @{items('Show_Each_Flow_Separately')['OwnerDisplayName']}",
                                "wrap": true,
                                "weight": "Bolder"
                              },
                              {
                                "type": "TextBlock",
                                "text": "Last Modified: @{items('Show_Each_Flow_Separately')['LastModified']}",
                                "wrap": true,
                                "weight": "Bolder"
                              },
                              {
                                "type": "TextBlock",
                                "text": "Flow State: @{items('Show_Each_Flow_Separately')['FlowState']}",
                                "wrap": true,
                                "weight": "Bolder"
                              },
                              {
                                "type": "ActionSet",
                                "actions": [
                                  {
                                    "type": "Action.Submit",
                                    "title": "Take Ownership",
                                    "style": "positive",
                                    "id": "TakeIt"
                                  },
                                  {
                                    "title": "Delete",
                                    "type": "Action.Submit",
                                    "id": "DeleteIt"
                                  },
                                  {
                                    "title": "Assign Out",
                                    "type": "Action.ShowCard",
                                    "id": "AssignIt",
                                    "card": {
                                      "type": "AdaptiveCard",
                                      "body": [
                                        {
                                          "type": "Input.Text",
                                          "id": "toWhom",
                                          "placeholder": "AssignToWhom@example.com",
                                          "style": "Email",
                                          "spacing": "None"
                                        }
                                      ],
                                      "actions": [
                                        {
                                          "type": "Action.Submit",
                                          "id": "AssignItlDone",
                                          "title": "Assign Now"
                                        }
                                      ],
                                      "$schema": "http://adaptivecards.io/schemas/adaptive-card.json"
                                    }
                                  },
                                  {
                                    "title": "Skip",
                                    "type": "Action.Submit",
                                    "id": "SkipIt"
                                  }
                                ]
                              }
                            ]
                          }
                        },
                        "SendAppForResponses_flow": {
                          "runAfter": {
                            "Card_Content_flow": [
                              "Succeeded"
                            ]
                          },
                          "limit": {
                            "timeout": "PT10M"
                          },
                          "type": "OpenApiConnectionWebhook",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_teams",
                              "operationId": "SubscribeUserFlowContinuation",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                            },
                            "parameters": {
                              "UserFlowContinuationSubscriptionRequest/body/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                              "UserFlowContinuationSubscriptionRequest/body/messageBody": "@outputs('Card_Content_flow')",
                              "UserFlowContinuationSubscriptionRequest/body/updateMessage": "Trying that now...",
                              "UserFlowContinuationSubscriptionRequest/body/shouldUpdateCard": true
                            },
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          }
                        },
                        "Set_timedOut_if_true_flow": {
                          "runAfter": {
                            "SendAppForResponses_flow": [
                              "TimedOut",
                              "Failed"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "timedOutOrFailed",
                            "value": "@true"
                          }
                        },
                        "If_app_not_timed_out_flow": {
                          "actions": {
                            "Switch_flow_submitActionId": {
                              "runAfter": {},
                              "cases": {
                                "TakeIt": {
                                  "case": "TakeIt",
                                  "actions": {
                                    "Let_them_know_if_it_succeeded_-_assign_flow_to_manager": {
                                      "actions": {
                                        "Success_Flow_Assigned_to_Manager": {
                                          "runAfter": {},
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "host": {
                                              "connectionName": "shared_teams",
                                              "operationId": "PostUserNotification",
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                            },
                                            "parameters": {
                                              "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                              "PostNotificationRequest/messageBody": "@{outputs('Get_managers_id')?['body/displayName']} now owns @{items('Show_Each_Flow_Separately')['FlowDisplayName']}",
                                              "PostNotificationRequest/messageTitle": "Success! "
                                            },
                                            "authentication": {
                                              "type": "Raw",
                                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                            },
                                            "retryPolicy": {
                                              "type": "exponential",
                                              "count": 10,
                                              "interval": "PT10S"
                                            }
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Assign_Flow_to_Manager": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Failed_to_Assign_Flow_to_Manager": {
                                            "runAfter": {},
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "host": {
                                                "connectionName": "shared_teams",
                                                "operationId": "PostUserNotification",
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                              },
                                              "parameters": {
                                                "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                                "PostNotificationRequest/messageBody": "@{items('Show_Each_Flow_Separately')['FlowDisplayName']} could not be assigned to @{outputs('Get_managers_id')?['body/displayName']}.\n\nHere is the error message received from the product:\n\n@{body('Assign_Flow_to_Manager')?['thereturnstring']}\n\nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                "PostNotificationRequest/messageTitle": "Error"
                                              },
                                              "authentication": {
                                                "type": "Raw",
                                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                              },
                                              "retryPolicy": {
                                                "type": "exponential",
                                                "count": 10,
                                                "interval": "PT10S"
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "equals": [
                                          "@body('Assign_Flow_to_Manager')?['thereturnstring']",
                                          "pass"
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Assign_Flow_to_Manager": {
                                      "runAfter": {},
                                      "type": "Workflow",
                                      "inputs": {
                                        "host": {
                                          "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                        },
                                        "body": {
                                          "text": "@outputs('Get_managers_id')?['body/id']",
                                          "text_1": "@items('Show_Each_Flow_Separately')['FlowID']",
                                          "text_2": "@items('Show_Each_Flow_Separately')['EnvtName']",
                                          "text_3": "assign"
                                        }
                                      }
                                    }
                                  }
                                },
                                "DeleteIt": {
                                  "case": "DeleteIt",
                                  "actions": {
                                    "Let_them_know_if_it_succeeded_-_delete_this_flow": {
                                      "actions": {
                                        "Success_Delete_Flow": {
                                          "runAfter": {},
                                          "type": "OpenApiConnection",
                                          "inputs": {
                                            "host": {
                                              "connectionName": "shared_teams",
                                              "operationId": "PostUserNotification",
                                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                            },
                                            "parameters": {
                                              "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                              "PostNotificationRequest/messageBody": "@{items('Show_Each_Flow_Separately')['FlowDisplayName']} deleted",
                                              "PostNotificationRequest/messageTitle": "Success!"
                                            },
                                            "authentication": {
                                              "type": "Raw",
                                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                            },
                                            "retryPolicy": {
                                              "type": "exponential",
                                              "count": 10,
                                              "interval": "PT10S"
                                            }
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Delete_This_Flow": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Failed_Delete_Flow": {
                                            "runAfter": {},
                                            "type": "OpenApiConnection",
                                            "inputs": {
                                              "host": {
                                                "connectionName": "shared_teams",
                                                "operationId": "PostUserNotification",
                                                "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                              },
                                              "parameters": {
                                                "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                                "PostNotificationRequest/messageBody": "Could not delete @{items('Show_Each_Flow_Separately')['FlowDisplayName']}.\n\nHere is the error message received from the product:\n\n@{body('Delete_This_Flow')?['thereturnstring']}\n\n\nYou may need to seek help from your admin: \n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                "PostNotificationRequest/messageTitle": "Error"
                                              },
                                              "authentication": {
                                                "type": "Raw",
                                                "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                              },
                                              "retryPolicy": {
                                                "type": "exponential",
                                                "count": 10,
                                                "interval": "PT10S"
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "equals": [
                                          "@body('Delete_This_Flow')?['thereturnstring']",
                                          "pass"
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Delete_This_Flow": {
                                      "runAfter": {},
                                      "type": "Workflow",
                                      "inputs": {
                                        "host": {
                                          "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                        },
                                        "body": {
                                          "text": "notused",
                                          "text_1": "@items('Show_Each_Flow_Separately')['FlowID']",
                                          "text_2": "@items('Show_Each_Flow_Separately')['EnvtName']",
                                          "text_3": "delete"
                                        }
                                      }
                                    }
                                  }
                                },
                                "AssignItlDone": {
                                  "case": "AssignItlDone",
                                  "actions": {
                                    "Get_toWhom_profile_-_flow": {
                                      "runAfter": {},
                                      "type": "OpenApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connectionName": "shared_office365users",
                                          "operationId": "UserProfile_V2",
                                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
                                        },
                                        "parameters": {
                                          "id": "@outputs('SendAppForResponses_flow')?['body/data/toWhom']"
                                        },
                                        "authentication": {
                                          "type": "Raw",
                                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                        },
                                        "retryPolicy": {
                                          "type": "exponential",
                                          "count": 10,
                                          "interval": "PT10S"
                                        }
                                      }
                                    },
                                    "Switch_on_toWhom_lookup_-_flow": {
                                      "runAfter": {
                                        "Get_toWhom_profile_-_flow": [
                                          "Succeeded",
                                          "Failed"
                                        ]
                                      },
                                      "cases": {
                                        "200_Success": {
                                          "case": 200,
                                          "actions": {
                                            "Let_them_know_if_it_succeeded_-_assign_flow_toWhom": {
                                              "actions": {
                                                "Success_Flow_Assigned_toWhom": {
                                                  "runAfter": {},
                                                  "type": "OpenApiConnection",
                                                  "inputs": {
                                                    "host": {
                                                      "connectionName": "shared_teams",
                                                      "operationId": "PostUserNotification",
                                                      "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                    },
                                                    "parameters": {
                                                      "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                                      "PostNotificationRequest/messageBody": "@{outputs('Get_toWhom_profile_-_flow')?['body/displayName']} now owns @{items('Show_Each_Flow_Separately')['FlowDisplayName']}",
                                                      "PostNotificationRequest/messageTitle": "Success!"
                                                    },
                                                    "authentication": {
                                                      "type": "Raw",
                                                      "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                    },
                                                    "retryPolicy": {
                                                      "type": "exponential",
                                                      "count": 10,
                                                      "interval": "PT10S"
                                                    }
                                                  }
                                                }
                                              },
                                              "runAfter": {
                                                "Assign_Flow_toWhom": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "else": {
                                                "actions": {
                                                  "Failed_to_Assign_Flow_toWhom": {
                                                    "runAfter": {},
                                                    "type": "OpenApiConnection",
                                                    "inputs": {
                                                      "host": {
                                                        "connectionName": "shared_teams",
                                                        "operationId": "PostUserNotification",
                                                        "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                      },
                                                      "parameters": {
                                                        "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                                        "PostNotificationRequest/messageBody": "@{items('Show_Each_Flow_Separately')['FlowDisplayName']} could not be assigned to @{outputs('Get_toWhom_profile_-_flow')?['body/displayName']}.\n\nHere is the error message received from the product:\n\n@{body('Assign_Flow_toWhom')?['thereturnstring']}\n\n\nYou may need to seek help from your admin: \n\n@{parameters('Admin eMail (admin_AdminMail)')}",
                                                        "PostNotificationRequest/messageTitle": "Error"
                                                      },
                                                      "authentication": {
                                                        "type": "Raw",
                                                        "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                      },
                                                      "retryPolicy": {
                                                        "type": "exponential",
                                                        "count": 10,
                                                        "interval": "PT10S"
                                                      }
                                                    }
                                                  }
                                                }
                                              },
                                              "expression": {
                                                "equals": [
                                                  "@body('Assign_Flow_toWhom')?['thereturnstring']",
                                                  "pass"
                                                ]
                                              },
                                              "type": "If"
                                            },
                                            "Assign_Flow_toWhom": {
                                              "runAfter": {},
                                              "type": "Workflow",
                                              "inputs": {
                                                "host": {
                                                  "workflowReferenceName": "6093b58a-4fea-eb11-bacb-000d3a578f6c"
                                                },
                                                "body": {
                                                  "text": "@outputs('Get_toWhom_profile_-_flow')?['body/id']",
                                                  "text_1": "@items('Show_Each_Flow_Separately')['FlowID']",
                                                  "text_2": "@items('Show_Each_Flow_Separately')['EnvtName']",
                                                  "text_3": "assign"
                                                }
                                              }
                                            }
                                          }
                                        },
                                        "404_Not_Found": {
                                          "case": 404,
                                          "actions": {
                                            "Post_a_message_as_the_Flow_bot_to_a_user_about_Bad_User_-_flow": {
                                              "runAfter": {},
                                              "type": "OpenApiConnection",
                                              "inputs": {
                                                "host": {
                                                  "connectionName": "shared_teams",
                                                  "operationId": "PostUserNotification",
                                                  "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                                },
                                                "parameters": {
                                                  "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                                  "PostNotificationRequest/messageBody": "The user you entered did not resolve: @{outputs('SendAppForResponses_flow')?['body/data/toWhom']}\n\nYou will be asked again soon, and please enter a valid email adress for the new owner, in this format: @{triggerBody()['text']}",
                                                  "PostNotificationRequest/messageTitle": "User did not resolve"
                                                },
                                                "authentication": {
                                                  "type": "Raw",
                                                  "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                                },
                                                "retryPolicy": {
                                                  "type": "exponential",
                                                  "count": 10,
                                                  "interval": "PT10S"
                                                }
                                              }
                                            }
                                          }
                                        }
                                      },
                                      "default": {
                                        "actions": {}
                                      },
                                      "expression": "@outputs('Get_toWhom_profile_-_flow')['statusCode']",
                                      "type": "Switch"
                                    }
                                  }
                                },
                                "SkipIt": {
                                  "case": "SkipIt",
                                  "actions": {
                                    "Skip_this_flow": {
                                      "runAfter": {},
                                      "type": "OpenApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connectionName": "shared_teams",
                                          "operationId": "PostUserNotification",
                                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                        },
                                        "parameters": {
                                          "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                          "PostNotificationRequest/messageBody": "Moving to the next one.",
                                          "PostNotificationRequest/messageTitle": "Skipped"
                                        },
                                        "authentication": {
                                          "type": "Raw",
                                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                        },
                                        "retryPolicy": {
                                          "type": "exponential",
                                          "count": 10,
                                          "interval": "PT10S"
                                        }
                                      }
                                    }
                                  }
                                }
                              },
                              "default": {
                                "actions": {}
                              },
                              "expression": "@body('SendAppForResponses_flow')['submitActionId']",
                              "type": "Switch"
                            }
                          },
                          "runAfter": {
                            "Set_timedOut_if_true_flow": [
                              "Succeeded",
                              "Skipped"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Post_a_time_message_as_the_Flow_bot_to_a_user_for_this_flow": {
                                "runAfter": {},
                                "type": "OpenApiConnection",
                                "inputs": {
                                  "host": {
                                    "connectionName": "shared_teams",
                                    "operationId": "PostUserNotification",
                                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                                  },
                                  "parameters": {
                                    "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                                    "PostNotificationRequest/messageBody": "The above request has timed out or failed, and any responses given will not be recorded.\nYou will be asked again, so please reach out to your admin if you need assistance: @{parameters('Admin eMail (admin_AdminMail)')}\nThank you.",
                                    "PostNotificationRequest/messageTitle": "Request Timed Out or Failed"
                                  },
                                  "authentication": {
                                    "type": "Raw",
                                    "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                                  },
                                  "retryPolicy": {
                                    "type": "exponential",
                                    "count": 10,
                                    "interval": "PT10S"
                                  }
                                }
                              }
                            }
                          },
                          "expression": {
                            "equals": [
                              "@variables('timedOutOrFailed')",
                              "@false"
                            ]
                          },
                          "type": "If"
                        }
                      },
                      "runAfter": {
                        "Show_Each_App_Separately": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach"
                    }
                  }
                },
                "Case_EmailMe": {
                  "case": "EmailMe",
                  "actions": {
                    "If_apps_or_flows_exist_for_mail,_send_it": {
                      "actions": {
                        "Send_list_to_manager": {
                          "runAfter": {},
                          "type": "OpenApiConnection",
                          "inputs": {
                            "host": {
                              "connectionName": "shared_office365",
                              "operationId": "SendEmailV2",
                              "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365"
                            },
                            "parameters": {
                              "emailMessage/To": "@if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Admin eMail (admin_AdminMail)'), triggerBody()['text'])",
                              "emailMessage/Subject": "Orphaned Objects to Clean",
                              "emailMessage/Body": "<p>Thank you for looking through these orphaned objects from your former employees. Please prepare a plan for each, to see if you would like to take ownership, assign to another person, or delete.<br>\n<br>\n<u><strong>Apps<br>\n</strong></u>@{body('Create_HTML_table_OrphanedApps')}<u><br>\n</u><u><strong><br>\nFlows<br>\n</strong></u>@{body('Create_HTML_table_OrphanedFlows')}</p>"
                            },
                            "authentication": {
                              "type": "Raw",
                              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                            },
                            "retryPolicy": {
                              "type": "exponential",
                              "count": 10,
                              "interval": "PT10S"
                            }
                          }
                        }
                      },
                      "runAfter": {},
                      "expression": {
                        "or": [
                          {
                            "greater": [
                              "@length(body('Apps_List_For_Email'))",
                              0
                            ]
                          },
                          {
                            "greater": [
                              "@length(body('Flows_List_For_Email'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Tell_manager_email_of_list_was_sent": {
                      "runAfter": {
                        "If_apps_or_flows_exist_for_mail,_send_it": [
                          "Succeeded"
                        ]
                      },
                      "type": "OpenApiConnection",
                      "inputs": {
                        "host": {
                          "connectionName": "shared_teams",
                          "operationId": "PostUserNotification",
                          "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                        },
                        "parameters": {
                          "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                          "PostNotificationRequest/messageBody": "Email has been sent",
                          "PostNotificationRequest/messageTitle": "Email Sent"
                        },
                        "authentication": {
                          "type": "Raw",
                          "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                        },
                        "retryPolicy": {
                          "type": "exponential",
                          "count": 10,
                          "interval": "PT10S"
                        }
                      }
                    }
                  }
                }
              },
              "default": {
                "actions": {}
              },
              "expression": "@body('Send_Table_For_Response')['submitActionId']",
              "metadata": {
                "operationMetadataId": "4a734f1a-f56f-40fc-ad44-90646ad19a1c"
              },
              "type": "Switch"
            }
          },
          "runAfter": {
            "Set_timeOut_true_if_timed_out": [
              "Succeeded",
              "Skipped"
            ]
          },
          "else": {
            "actions": {
              "Post_a_timeout_message_as_the_Flow_bot_to_a_user": {
                "runAfter": {},
                "metadata": {
                  "operationMetadataId": "5941704e-1841-49a1-a257-a4a070a4d0c4"
                },
                "type": "OpenApiConnection",
                "inputs": {
                  "host": {
                    "connectionName": "shared_teams",
                    "operationId": "PostUserNotification",
                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_teams"
                  },
                  "parameters": {
                    "PostNotificationRequest/recipient/to": "@{if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Individual Admin (admin_ApprovalAdmin)'), triggerBody()['text'])};",
                    "PostNotificationRequest/messageBody": "The request to resolve orphaned objechas timed out or failed, and any responses given now will not be recorded.\nYou will be emailed and asked again. Thank you.",
                    "PostNotificationRequest/messageTitle": "Request has timed out or failed",
                    "PostNotificationRequest/recipient/isAlert": false
                  },
                  "authentication": {
                    "type": "Raw",
                    "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                  },
                  "retryPolicy": {
                    "type": "exponential",
                    "count": 10,
                    "interval": "PT10S"
                  }
                }
              },
              "Send_list_to_manager_-_failed_or_timed_out": {
                "runAfter": {
                  "Post_a_timeout_message_as_the_Flow_bot_to_a_user": [
                    "Succeeded",
                    "Failed"
                  ]
                },
                "metadata": {
                  "operationMetadataId": "4210e15c-7972-481b-802c-22d71b2b98f6"
                },
                "type": "OpenApiConnection",
                "inputs": {
                  "host": {
                    "connectionName": "shared_office365",
                    "operationId": "SendEmailV2",
                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365"
                  },
                  "parameters": {
                    "emailMessage/To": "@if(equals(parameters('ProductionEnvironment (admin_ProductionEnvironment)'), false), parameters('Admin eMail (admin_AdminMail)'), triggerBody()['text'])",
                    "emailMessage/Subject": "Orphaned Objects to Clean",
                    "emailMessage/Body": "<p>Former employees of yours have left the company with Power Platform objects left behind. These require reassignment or deletion in order to keep our tenant tidy of objects. We have attempted to communicate these with you via a flow chat bot, and it seems that you either did not respond to these communciations, or you have the chatbot disabled.<br>\n<br>\nNote also that if these objects are important to your team, not having a current owner could lead to them breaking later due to many reasons. Ex expired connections or tenant changes that will not have an owner to notify.<br>\n<br>\nPlease prepare a plan for each of these, to see if you would like to take ownership, assign to another person, or delete.<br>\n<br>\nIf you do not see the chat in teams from the Flow Bot, then you will not be able to perform these actions. As a result, please ensure you have <a href=\"https://powerautomate.microsoft.com/en-us/blog/microsoft-flow-in-microsoft-teams/\">turned on flow integration</a> and that you have not <a href=\"https://support.microsoft.com/en-us/office/hide-unhide-mute-or-pin-a-chat-in-teams-9aee02ef-713d-495b-8a73-9762d8e4b066\">muted or hidden the bot</a>.<br>\n<br>\n<u><strong>Apps<br>\n</strong></u>@{body('Create_HTML_table_OrphanedApps')}<u><br>\n</u><u><strong><br>\nFlows<br>\n</strong></u>@{body('Create_HTML_table_OrphanedFlows')}</p>"
                  },
                  "authentication": {
                    "type": "Raw",
                    "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                  },
                  "retryPolicy": {
                    "type": "exponential",
                    "count": 10,
                    "interval": "PT10S"
                  }
                }
              },
              "Send_list_to_admin_-_failed_or_timed_out": {
                "runAfter": {
                  "Send_list_to_manager_-_failed_or_timed_out": [
                    "Succeeded"
                  ]
                },
                "metadata": {
                  "operationMetadataId": "4210e15c-7972-481b-802c-22d71b2b98f6"
                },
                "type": "OpenApiConnection",
                "inputs": {
                  "host": {
                    "connectionName": "shared_office365",
                    "operationId": "SendEmailV2",
                    "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365"
                  },
                  "parameters": {
                    "emailMessage/To": "@parameters('Admin eMail (admin_AdminMail)')",
                    "emailMessage/Subject": "Orphaned Objects to Clean - Manager did not respond",
                    "emailMessage/Body": "<p>The request to this manager failed or timed out. <br>\n<br>\nIf timed out, consider reaching out to them to ensure they understand the importance of this work. <br>\n<br>\nIf failed it may be due to the number of objects being too large for the adaptive card, you will need to work with them to resolve, or just assign all objects to them. <br>\nOr it could be due to other reasons like them blocking conversations with the flow bot. <br>\n<br>\nPlease look at the run to see what occurred, and the list of objects, to determine how best to proceed.<br>\n<br>\n<u><strong>Manager</strong></u>: @{triggerBody()['text']}<br>\n<u><strong>See run</strong></u>: <a href='@{concat(parameters('Power Automate Environment Variable (admin_PowerAutomateEnvironmentVariable)'), workflow()?['tags']['environmentName'], '/flows/', workflow()?['name'], '/runs/', workflow()?['run']['name'])}'>Click here</a><br>\n<br>\n <u><strong>Apps<br>\n</strong></u>@{body('Create_HTML_table_OrphanedApps')}<u><br>\n</u><u><strong><br>\nFlows<br>\n</strong></u>@{body('Create_HTML_table_OrphanedFlows')}</p>"
                  },
                  "authentication": {
                    "type": "Raw",
                    "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
                  },
                  "retryPolicy": {
                    "type": "exponential",
                    "count": 10,
                    "interval": "PT10S"
                  }
                }
              },
              "Set_returnValue_404": {
                "runAfter": {
                  "Send_list_to_admin_-_failed_or_timed_out": [
                    "Succeeded"
                  ]
                },
                "metadata": {
                  "operationMetadataId": "7e72afc5-d178-4952-a55d-c5be981b27a0"
                },
                "type": "SetVariable",
                "inputs": {
                  "name": "returnValue",
                  "value": 404
                }
              }
            }
          },
          "expression": {
            "equals": [
              "@variables('timedOutOrFailed')",
              "@false"
            ]
          },
          "metadata": {
            "operationMetadataId": "de777216-022f-40af-bdb7-a0fd5035b10b"
          },
          "type": "If"
        },
        "Get_managers_id": {
          "runAfter": {},
          "metadata": {
            "operationMetadataId": "606c1267-b33c-4340-ad0f-fc55cd5c5852"
          },
          "type": "OpenApiConnection",
          "inputs": {
            "host": {
              "connectionName": "shared_office365users",
              "operationId": "UserProfile_V2",
              "apiId": "/providers/Microsoft.PowerApps/apis/shared_office365users"
            },
            "parameters": {
              "id": "@triggerBody()['text']"
            },
            "authentication": {
              "type": "Raw",
              "value": "@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"
            },
            "retryPolicy": {
              "type": "exponential",
              "count": 10,
              "interval": "PT10S"
            }
          }
        },
        "Initialize_timedOut": {
          "runAfter": {
            "Initialize_OrphanedObject": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "a7990a83-834a-431a-8b3a-6a6c18f9cdf8"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "timedOutOrFailed",
                "type": "boolean",
                "value": "@false"
              }
            ]
          }
        },
        "Initialize_BulkOperationSuccess_to_true": {
          "runAfter": {
            "Initialize_timedOut": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "710ca5c4-0c9b-4fb2-ade1-6ce53b3e19e2"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "BulkOperationSuccess",
                "type": "boolean",
                "value": "@true"
              }
            ]
          }
        },
        "Initialize_FlowsTableAppNameCol": {
          "runAfter": {
            "Initialize_AppsTableLastLaunchedCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "fb727b53-864b-48da-90bb-1515fffae96c"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "FlowsTableAppNameCol",
                "type": "string",
                "value": " \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Flow Name\""
              }
            ]
          }
        },
        "Initialize_FlowsTableEmployeeNameCol": {
          "runAfter": {
            "Initialize_FlowsTableAppNameCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "3f1fed01-2695-48f9-ae41-90a8bbb73b12"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "FlowsTableEmployeeNameCol",
                "type": "string",
                "value": " }\n                    ],\n                    \"width\": \"auto\"\n                },\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Employee Name\""
              }
            ]
          }
        },
        "Initialize_FlowsTableStatusCol": {
          "runAfter": {
            "Initialize_FlowsTableEmployeeNameCol": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "e1f97d22-d3da-43c4-a42a-e72aafbf38ed"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "FlowsTableStatusCol",
                "type": "string",
                "value": " }\n                    ],\n                    \"width\": \"auto\"\n                },\n                {\n                    \"type\": \"Column\",\n                    \"items\": [\n                        {\n                            \"type\": \"TextBlock\",\n                            \"weight\": \"bolder\",\n                            \"text\": \"Flow Status\""
              }
            ]
          }
        },
        "Prepare_HTML_Table_for_Emails_if_needed": {
          "actions": {
            "Apps_List_For_Email": {
              "runAfter": {},
              "metadata": {
                "operationMetadataId": "6596e623-a3c3-452f-8d53-81ab6d71040b"
              },
              "type": "Select",
              "inputs": {
                "from": "@body('Parse_Orphaned_Apps')",
                "select": {
                  "Environment": "@item()['EnvtDisplayName']",
                  "|": "|",
                  "App": "@item()['AppDisplayName']",
                  "||": "||",
                  "Owner": "@item()['OwnerDisplayName']",
                  "|||": "|||",
                  "Last Launched": "@item()['LastLaunched']",
                  "||||": "||||",
                  "Last Modified": "@item()['LastModified']"
                }
              }
            },
            "Create_HTML_table_OrphanedApps": {
              "runAfter": {
                "Apps_List_For_Email": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "2d865015-0bdd-4ee3-b3d4-c55cb6bb5a9d"
              },
              "type": "Table",
              "inputs": {
                "from": "@body('Apps_List_For_Email')",
                "format": "HTML"
              }
            },
            "Flows_List_For_Email": {
              "runAfter": {
                "Create_HTML_table_OrphanedApps": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "cd11bb54-8958-4a50-a9e8-2476c73b550b"
              },
              "type": "Select",
              "inputs": {
                "from": "@body('Parse_Orphaned_Flows')",
                "select": {
                  "Environment": "@item()['EnvtDisplayName']",
                  "|": "|",
                  "Flow": "@item()['FlowDisplayName']",
                  "||": "||",
                  "Owner": "@item()['OwnerDisplayName']",
                  "|||": "|||",
                  "State": "@item()['FlowState']",
                  "||||": "||||",
                  "Last Modified": "@item()['LastModified']"
                }
              }
            },
            "Create_HTML_table_OrphanedFlows": {
              "runAfter": {
                "Flows_List_For_Email": [
                  "Succeeded"
                ]
              },
              "metadata": {
                "operationMetadataId": "eca9bdb6-3150-4fdc-832a-fdb27456f1e3"
              },
              "type": "Table",
              "inputs": {
                "from": "@body('Flows_List_For_Email')",
                "format": "HTML"
              }
            }
          },
          "runAfter": {
            "Get_Orphaned_Objects_for_this_Manager": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "a689baa7-cf28-4372-9478-0bf3d43ec67f"
          },
          "type": "Scope"
        },
        "Initialize_returnValue": {
          "runAfter": {
            "Initialize_BulkOperationSuccess_to_true": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "7b18d5f7-ecc1-43bb-ac67-b1f1b4136366"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "returnValue",
                "type": "integer",
                "value": 200
              }
            ]
          }
        },
        "Initialize_appErrors": {
          "runAfter": {
            "Initialize_returnValue": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "81575c14-fc50-4c37-b495-7d81de750c77"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "appErrors",
                "type": "array"
              }
            ]
          }
        },
        "Initialize_flowErrors": {
          "runAfter": {
            "Initialize_appErrors": [
              "Succeeded"
            ]
          },
          "metadata": {
            "operationMetadataId": "c189ee0e-5f06-42ef-b957-f1d6a5eef47b"
          },
          "type": "InitializeVariable",
          "inputs": {
            "variables": [
              {
                "name": "flowErrors",
                "type": "array"
              }
            ]
          }
        }
      },
      "outputs": {}
    },
    "templateName": null
  },
  "schemaVersion": "1.0.0.0"
}